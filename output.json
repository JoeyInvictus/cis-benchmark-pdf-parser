[{"Rule_number": "1.1.1", "Rule": "1.1.1 (L1) Ensure Administrative accounts are separate and cloud-only (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Administrative accounts are special privileged accounts that could have varying levels of access to data, users, and settings. Regular user accounts should never be utilized for administrative tasks and care should be taken, in the case of a hybrid environment, to keep Administrative accounts separated from on-prem accounts. Administrative accounts should not have applications assigned so that they have no access to potentially vulnerable services (EX. email, Teams, SharePoint, etc.) and only access to perform tasks as needed for administrative purposes. Ensure administrative accounts are licensed without attached applications and cloud-only.", "Rationale": "Ensuring administrative accounts are cloud-only, without applications assigned to them will reduce the attack surface of high privileged identities in your environment. In order to participate in Microsoft 365 security services such as Identity Protection, PIM and Conditional Access an administrative account will need a license attached to it. Ensure that the license used does not include any applications with potentially vulnerable services by using either Microsoft Entra ID P1 or Microsoft Entra ID P2 for the cloud-only account with administrator roles. In a hybrid environment, having separate accounts will help ensure that in the event of a breach in the cloud, that the breach does not affect the on-prem environment and vice versa.", "Impact": "Administrative users will have to switch accounts and utilizing login/logout functionality when performing administrative tasks, as well as not benefiting from SSO. Note: Alerts will be sent to the TenantAdmins, including Global Administrators, by default. To ensure proper receipt, configure alerts to be sent to security or operations staff with valid email addresses or a security operations center. Otherwise, after adoption of this recommendation, alerts sent to TenantAdmins may go unreceived due to the lack of an application-based license assigned to the Global Administrator accounts.", "Audit": {"General Audit Instructions": "Ensure Administrative accounts are separate and cloud-only1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Users select Active users. \n3. Sort by the Licenses column. \n4. For each user account in an administrative role verify the followingo The account is Cloud only (not synced) \no The account is assigned a license that is not associated with applications \ni.e. (Microsoft Entra ID P1, Microsoft Entra ID P2)"}, "Remediation": {"General Remediation Instructions": "To created licensed, separate Administrative accounts for Administrative users1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Users select Active users \n3. Click Add a user. \n4. Fill out the appropriate fields for Name, user, etc. \n5. When prompted to assign licenses select as needed Microsoft Entra ID P1 or \nMicrosoft Entra ID P2, then click Next. \n6. Under the Option settings screen you may choose from several types of \nAdministrative access roles. Choose Admin center access followed by the \nappropriate role then click Next. \n7. Select Finish adding."}, "Default_value": "N/A References: 1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-users?view=o365-worldwide 2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-administrator-accounts?view=o365-worldwide 3. https://learn.microsoft.com/en-us/azure/active-directory/roles/best-practices#9-use-cloud-native-accounts-for-azure-ad-roles 4. https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/whatis", "pdf": "m365"}, {"Rule_number": "1.1.2", "Rule": "1.1.2 (L1) Ensure two emergency access accounts have been defined (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Emergency access or \"break glass\" accounts are limited for emergency scenarios where normal administrative accounts are unavailable. They are not assigned to a specific user and will have a combination of physical and technical controls to prevent them from being accessed outside a true emergency. These emergencies could be due to several things, including: \u2022 Technical failures of a cellular provider or Microsoft related service such as MFA. \u2022 The last remaining Global Administrator account is inaccessible. Ensure two Emergency Access accounts have been defined. Note: Microsoft provides several recommendations for these accounts and how to configure them. For more information on this, please refer to the references section. The CIS Benchmark outlines the more critical things to consider.", "Rationale": "In various situations, an organization may require the use of a break glass account to gain emergency access. In the event of losing access to administrative functions, an organization may experience a significant loss in its ability to provide support, lose insight into its security posture, and potentially suffer financial losses.", "Impact": "If care is not taken in properly implementing an emergency access account this could weaken security posture. Microsoft recommends to exclude at least one of these accounts from all conditional access rules therefore passwords must have sufficient entropy and length to protect against random guesses. FIDO2 security keys may be used instead of a password for secure passwordless solution.", "Audit": {"General Audit Instructions": "Step 1 - Ensure a policy and procedure is in place at the organization\n\u2022 \nIn order for accounts to be effectively used in a break-glass situation the proper \npolicies and procedures must be authorized and distributed by senior \nmanagement. \n\u2022FIDO2 Security Keys, if used, should be locked in a secure separate fireproof \nlocation. \n\u2022Passwords should be at least 16 characters, randomly generated and MAY be \nseparated in multiple pieces to be joined on emergency. \nStep 2 - Ensure two emergency access accounts are defined1. Navigate to Microsoft 365 admin center https://admin.microsoft.com \n2. Expand Users > Active Users \n3. Inspect the designated emergency access accounts and ensure the following\n\u2022 \nThe accounts are named correctly, and do NOT identify with a particular \nperson. \n\u2022The accounts use the default .onmicrosoft.com domain and not the \norganization's. \n\u2022The accounts are cloud-only. \n\u2022The accounts are unlicensed. \n\u2022The accounts are assigned the Global Administrator directory role. \nStep 3 - Ensure at least one account is excluded from all conditional access \nrules1. Navigate Microsoft Entra admin center https://entra.microsoft.com/ \n2. Expand Protection > Conditional Access. \n3. Inspect the conditional access rules. \n4. Ensure one of the emergency access accounts is excluded from all rules."}, "Remediation": {"General Remediation Instructions": "Step 1 - Create two emergency access accounts1. Navigate to Microsoft 365 admin center https://admin.microsoft.com \n2. Expand Users > Active Users \n3. Click Add user and create a new user with this criteria\n\u2022 \nName the account in a way that does NOT identify it with a particular person. \n\u2022Assign the account to the default .onmicrosoft.com domain and not the \norganization's. \n\u2022The password must be at least 16 characters and generated randomly. \n\u2022Do not assign a license. \n\u2022Assign the user the Global Administrator role. \n4. Repeat the above steps for the second account. \nStep 2 - Exclude at least one account from conditional access policies1. Navigate Microsoft Entra admin center https://entra.microsoft.com/ \n2. Expand Protection > Conditional Access. \n3. Inspect the conditional access policies. \n4. For each rule add an exclusion for at least one of the emergency access \naccounts. \n5. Users > Exclude > Users and groups and select one emergency access account. \nStep 3 - Ensure the necessary procedures and policies are in place\n\u2022 \nIn order for accounts to be effectively used in a break glass situation the proper \npolicies and procedures must be authorized and distributed by senior \nmanagement. \n\u2022FIDO2 Security Keys, if used, should be locked in a secure separate fireproof \nlocation. \n\u2022Passwords should be at least 16 characters, randomly generated and MAY be \nseparated in multiple pieces to be joined on emergency. \nNote: Additional suggestions for emergency account management\n\u2022 \nCreate access reviews for these users. \n\u2022Exclude users from conditional access rules. \nWarning: If CA (conditional access) exclusion is managed by a group, this group should \nbe added to PIM for groups (licensing required) or be created as a role-assignable \ngroup. If it is a regular security group, then users with the Group Administrators role are \nable to bypass CA entirely."}, "Default_value": "N/A References: 1. https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/add-users?view=o365-worldwide 2. https://learn.microsoft.com/en-us/microsoft-365/enterprise/protect-your-global-administrator-accounts?view=o365-worldwide 3. https://learn.microsoft.com/en-us/azure/active-directory/roles/best-practices#9-use-cloud-native-accounts-for-azure-ad-roles 4. https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/whatis", "pdf": "m365"}, {"Rule_number": "1.1.3", "Rule": "1.1.3 (L1) Ensure that between two and four global admins are designated (Automated)", "Profile_applicability": " E3 Level 1", "Description": "More than one global administrator should be designated so a single admin can be monitored and to provide redundancy should a single admin leave an organization. Additionally, there should be no more than four global admins set for any tenant. Ideally global administrators will have no licenses assigned to them.", "Rationale": "If there is only one global tenant administrator, he or she can perform malicious activity without the possibility of being discovered by another admin. If there are numerous global tenant administrators, the more likely it is that one of their accounts will be successfully breached by an external attacker.", "Impact": "The potential impact associated with ensuring compliance with this requirement is dependent upon the current number of global administrators configured in the tenant. If there is only one global administrator in a tenant, an additional global administrator will need to be identified and configured. If there are more than four global administrators, a review of role requirements for current global administrators will be required to identify which of the users require global administrator access.", "Audit": {"General Audit Instructions": "Ensure that between two and four global admins are designated1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com \n2. Select Users > Active Users. \n3. Select Filter then select Global Admins. \n4. Review the list of Global Admins to confirm there are from two to four such \naccounts. \nTo verify the number of global tenant administrators using PowerShell1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \nDirectory.Read.All \n2. Run the following PowerShell script# Determine Id of role using the immutable RoleTemplateId value. \n$globalAdminRole = Get-MgDirectoryRole -Filter \"RoleTemplateId eq '62e90394-\n69f5-4237-9190-012177145e10'\" \n$globalAdmins = Get-MgDirectoryRoleMember -DirectoryRoleId \n$globalAdminRole.Id \n \nWrite-Host \"*** There are\" $globalAdmins.AdditionalProperties.Count \"Global \nAdministrators assigned.\" \nThis information is also available via the Microsoft Graph Security APIGET https://graph.microsoft.com/beta/security/secureScores \nNote: When tallying the number of Global Administrators the above does not account \nfor Partner relationships. Those are located under Settings > Partner Relationships \nand should be reviewed on a reoccurring basis."}, "Remediation": {"To remove Global Admins:": "1. Select User. \n2. Under Roles select Manage roles \n3. De-Select the appropriate role. \n4. Click Save changes. \nReferences1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.identity.directorymanagement/get-\nmgdirectoryrole?view=graph-powershell-1.0 \n2. https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-\nreference#role-template-ids \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.1 Establish and Maintain an Inventory of Accounts \n \nEstablish and maintain an inventory of all accounts managed in the enterprise. \nThe inventory must include both user and administrator accounts. The inventory, at \na minimum, should contain the person\u2019s name, username, start/stop dates, and \ndepartment. Validate that all active accounts are authorized, on a recurring \nschedule at a minimum quarterly, or more frequently. \n\u25cf \n\u25cf \n\u25cf \nv7 \n4.1 Maintain Inventory of Administrative Accounts \n \nUse automated tools to inventory all administrative accounts, including domain \nand local accounts, to ensure that only authorized individuals have elevated \nprivileges. \n \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "1.1.4", "Rule": "1.1.4 (L1) Ensure Guest Users are reviewed at least biweekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Guest users can be set up for those users not in the organization to still be granted access to resources. It is important to maintain visibility for what guest users are established in the tenant. Ensure Guest Users are reviewed no less frequently than biweekly. Note: With the E5 license an access review can be configured to review guest accounts automatically on a reoccurring basis. This is the preferred method if the licensing is available.", "Rationale": "Periodic review of guest users ensures proper access to resources. Audit: To verify the report is being reviewed at least biweekly, confirm that the necessary procedures are in place and being followed. Remediation: To review guest users in the UI: 1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/. 2. Click to expand Users and select Guest Users. 3. Review the list of users. To verify Microsoft 365 audit log search is enabled using Microsoft Graph PowerShell: 1. Connect using Connect-MgGraph -Scopes \"User.Read.All\" 2. Run the following PowerShell command: Get-MgUser -All -Property UserType,UserPrincipalName |      Where {$_.UserType -ne \"Member\"} |     Format-Table UserPrincipalName, UserType 3. Review the list of users. If nothing is returned then there are no guest users.", "Impact": "The potential impact associated with ensuring compliance with this requirement is dependent upon the current number of global administrators configured in the tenant. If there is only one global administrator in a tenant, an additional global administrator will need to be identified and configured. If there are more than four global administrators, a review of role requirements for current global administrators will be required to identify which of the users require global administrator access.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least biweekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review guest users in the UI1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/. \n2. Click to expand Users and select Guest Users. \n3. Review the list of users. \nTo verify Microsoft 365 audit log search is enabled using Microsoft Graph \nPowerShell1. Connect using Connect-MgGraph -Scopes \"User.Read.All\" \n2. Run the following PowerShell commandGet-MgUser -All -Property UserType,UserPrincipalName |  \n    Where {$_.UserType -ne \"Member\"} | \n    Format-Table UserPrincipalName, UserType \n3. Review the list of users. If nothing is returned then there are no guest users."}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "1.2.1", "Rule": "1.2.1 (L2) Ensure that only organizationally managed/approved public groups exist (Automated)", "Profile_applicability": " E3 Level 2", "Description": "Microsoft 365 Groups is the foundational membership service that drives all teamwork across Microsoft 365. With Microsoft 365 Groups, you can give a group of people access to a collection of shared resources. While there are several different group types this recommendation concerns Microsoft 365 Groups. In the Administration panel, when a group is created, the default privacy value is \"Public\".", "Rationale": "Ensure that only organizationally managed and approved public groups exist. When a group has a \"public\" privacy, users may access data related to this group (e.g. SharePoint), through three methods: \u2022 By using the Azure portal, and adding themselves into the public group \u2022 By requesting access to the group from the Group application of the Access Panel \u2022 By accessing the SharePoint URL Administrators are notified when a user uses the Azure Portal. Requesting access to the group forces users to send a message to the group owner, but they still have immediate access to the group. The SharePoint URL is usually guessable and can be found from the Group application of the Access Panel. If group privacy is not controlled, any user may access sensitive information, according to the group they try to access. Note: Public in this case means public to the identities within the organization.", "Impact": "If the recommendation is applied, group owners could receive more access requests than usual, especially regarding groups originally meant to be public.", "Audit": {"General Audit Instructions": "Ensure only organizationally managed/approved public groups exist1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Teams & groups select Active teams & groups. \n3. On the Active teams and groups page, check that no groups have the status \n'Public' in the privacy column. \nUsing the Microsoft Graph PowerShell module1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \n\"Group.Read.All\". \n2. Run the following Microsoft Graph PowerShell commandGet-MgGroup | where {$_.Visibility -eq \"Public\"} | select \nDisplayName,Visibility \n3. Ensure Visibility is Private for each group."}, "Remediation": {"General Remediation Instructions": "To enable only organizationally managed/approved public groups exist1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Teams & groups select Active teams & groups.. \n3. On the Active teams and groups page, select the group's name that is public. \n4. On the popup groups name page, Select Settings. \n5. Under Privacy, select Private."}, "Default_value": "Public when created from the Administration portal; private otherwise. References: 1. https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/groups-self-service-management 2. https://learn.microsoft.com/en-us/microsoft-365/admin/create-groups/compare-groups?view=o365-worldwide", "pdf": "m365"}, {"Rule_number": "1.2.2", "Rule": "1.2.2 (L1) Ensure sign-in to shared mailboxes is blocked (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Shared mailboxes are used when multiple people need access to the same mailbox, such as a company information or support email address, reception desk, or other function that might be shared by multiple people. Users with permissions to the group mailbox can send as or send on behalf of the mailbox email address if the administrator has given that user permissions to do that. This is particularly useful for help and support mailboxes because users can send emails from \"Contoso Support\" or \"Building A Reception Desk.\" Shared mailboxes are created with a corresponding user account using a system generated password that is unknown at the time of creation. The recommended state is Sign in blocked for Shared mailboxes.", "Rationale": "The intent of the shared mailbox is the only allow delegated access from other mailboxes. An admin could reset the password, or an attacker could potentially gain access to the shared mailbox allowing the direct sign-in to the shared mailbox and subsequently the sending of email from a sender that does not have a unique identity. To prevent this, block sign-in for the account that is associated with the shared mailbox.", "Impact": "If the recommendation is applied, group owners could receive more access requests than usual, especially regarding groups originally meant to be public.", "Audit": {"General Audit Instructions": "Review Shared mailboxes in the UI1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/ \n2. Click to expand Teams & groups and select Shared mailboxes. \n3. Take note of all shared mailboxes. \n4. Click to expand Users and select Active users. \n5. Select a shared mailbox account to open its properties pane, and review. \n6. Ensure the option reads Unblock sign-in. \n7. Repeat for any additional shared mailboxes. \nNote: If sign-in is not blocked it will read Block sign-in. \n \nAudit in PowerShell using 2 modules1. Connect to Exchange Online using Connect-ExchangeOnline \n2. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.Read.All\" \n3. Run the following PowerShell commands$MBX = Get-EXOMailbox -RecipientTypeDetails SharedMailbox \n$MBX | ForEach-Object { Get-MgUser -UserId $_.ExternalDirectoryObjectId ` \n    -Property DisplayName, UserPrincipalName, AccountEnabled } |  \n    Format-Table DisplayName, UserPrincipalName, AccountEnabled \n4. Ensure AccountEnabled is set to False for all Shared Mailboxes."}, "Remediation": {"General Remediation Instructions": "Block sign-in to shared mailboxes in the UI1. Navigate to Microsoft 365 admin center https://admin.microsoft.com/ \n2. Click to expand Teams & groups and select Shared mailboxes. \n3. Take note of all shared mailboxes. \n4. Click to expand Users and select Active users. \n5. Select a shared mailbox account to open it's properties pane and then select \nBlock sign-in. \n6. Check the box for Block this user from signing in. \n7. Repeat for any additional shared mailboxes."}, "Default_value": "Public when created from the Administration portal; private otherwise. References: 1. https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/groups-self-service-management 2. https://learn.microsoft.com/en-us/microsoft-365/admin/create-groups/compare-groups?view=o365-worldwide", "pdf": "m365"}, {"Rule_number": "1.3.1", "Rule": "1.3.1 (L1) Ensure the 'Password expiration policy' is set to 'Set passwords to never expire (recommended)' (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Microsoft cloud-only accounts have a pre-defined password policy that cannot be changed. The only items that can change are the number of days until a password expires and whether or whether passwords expire at all.", "Rationale": "Organizations such as NIST and Microsoft have updated their password policy recommendations to not arbitrarily require users to change their passwords after a specific amount of time, unless there is evidence that the password is compromised, or the user forgot it. They suggest this even for single factor (Password Only) use cases, with a reasoning that forcing arbitrary password changes on users actually make the passwords less secure. Other recommendations within this Benchmark suggest the use of MFA authentication for at least critical accounts (at minimum), which makes password expiration even less useful as well as password protection for Entra ID.", "Impact": "When setting passwords not to expire it is important to have other controls in place to supplement this setting. See below for related recommendations and user guidance. \u2022 Ban common passwords. \u2022 Educate users to not reuse organization passwords anywhere else. \u2022 Enforce Multi-Factor Authentication registration for all users.", "Audit": {"General Audit Instructions": "Ensure that Office 365 passwords are set to never expire1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings select Org Settings. \n3. Click on Security & privacy. \n4. Select Password expiration policy ensure that Set passwords to never \nexpire (recommended) has been checked. \nTo verify Office 365 Passwords Are Not Set to Expire, use the Microsoft Graph \nPowerShell module1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \n\"Domain.Read.All\". \n2. Run the following Microsoft Online PowerShell commandGet-MgDomain -DomainId <Domain Name> | ft PasswordValidityPeriodInDays"}, "Remediation": {"General Remediation Instructions": "To set Office 365 passwords are set to never expire1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings select Org Settings. \n3. Click on Security & privacy. \n4. Check the Set passwords to never expire (recommended) box. \n5. Click Save. \nTo set Office 365 Passwords Are Not Set to Expire, use the Microsoft Graph \nPowerShell module1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \n\"Domain.ReadWrite.All\". \n2. Run the following Microsoft Graph PowerShell commandUpdate-MgDomain -DomainId <Domain> -PasswordValidityPeriodInDays 2147483647 -\nPasswordNotificationWindowInDays 30"}, "Default_value": "If the property is not set, a default value of 90 days will be used", "pdf": "m365"}, {"Rule_number": "1.3.2", "Rule": "1.3.2 (L1) Ensure 'Idle session timeout' is set to '3 hours (or less)' for unmanaged devices (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Idle session timeout allows the configuration of a setting which will timeout inactive users after a pre-determined amount of time. When a user reaches the set idle timeout session, they'll get a notification that they're about to be signed out. They have to select to stay signed in or they'll be automatically signed out of all Microsoft 365 web apps. Combined with a Conditional Access rule this will only impact unmanaged devices. A managed device is considered a device managed by Intune MDM. The following Microsoft 365 web apps are supported. \u2022 Outlook Web App \u2022 OneDrive for Business \u2022 SharePoint Online (SPO) \u2022 Office.com and other start pages \u2022 Office (Word, Excel, PowerPoint) on the web \u2022 Microsoft 365 Admin Center NOTE: Idle session timeout doesn't affect Microsoft 365 desktop and mobile apps. The recommended setting is 3 hours (or less) for unmanaged devices.", "Rationale": "Ending idle sessions through an automatic process can help protect sensitive company data and will add another layer of security for end users who work on unmanaged devices that can potentially be accessed by the public. Unauthorized individuals onsite or remotely can take advantage of systems left unattended over time. Automatic timing out of sessions makes this more difficult.", "Impact": "If step 2 in the Audit/Remediation procedure is left out then there is no issue with this from a security standpoint. However, it will require users on trusted devices to sign in more frequently which could result in credential prompt fatigue.", "Audit": {"General Audit Instructions": "Step 1 - Ensure Idle session timeout is configured1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/. \n2. Click to expand Settings Select Org settings. \n3. Click Security & Privacy tab. \n4. Select Idle session timeout. \n5. Verify Turn on to set the period of inactivity for users to be signed off \nof Microsoft 365 web apps is set to 3 hours (or less). \nStep 2 - Ensure the Conditional Access policy is in place1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Expand Protect > Conditional Access. \n3. Inspect existing conditional access rules for one that meets the below conditions\n\u2022 \nUsers is set to All users \n\u2022Cloud apps or actions > Select apps is set to Office 365. \n\u2022Conditions > Client apps is Browser and nothing else. \n\u2022Session is set to Use app enforced restrictions. \n\u2022Enable Policy is set to On \nNOTE: To ensure that idle timeouts affect only unmanaged devices, both steps must be \ncompleted."}, "Remediation": {"General Remediation Instructions": "To configure Idle session timeout1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/. \n2. Click to expand Settings Select Org settings. \n3. Click Security & Privacy tab. \n4. Select Idle session timeout. \n5. Check the box Turn on to set the period of inactivity for users to be \nsigned off of Microsoft 365 web apps \n6. Set a maximum value of 3 hours. \n7. Click save. \nStep 2 - Ensure the Conditional Access policy is in place1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Expand Protect > Conditional Access \n3. Click New policy and give the policy a name. \n4. Select Users > All users. \n5. Select Cloud apps or actions > Select apps and select Office 365 \n6. Select Conditions > Client apps > Yes check only Browser unchecking all other \nboxes. \n7. Select Sessions and check Use app enforced restrictions. \n8. Set Enable policy to On and click Create. \nNOTE: To ensure that idle timeouts affect only unmanaged devices, both steps must be \ncompleted."}, "Default_value": "Not configured. (Idle sessions will not timeout.) References: 1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/idle-session-timeout-web-apps?view=o365-worldwide Additional Information: According to Microsoft idle session timeout isn't supported when third party cookies are disabled in the browser. Users won't see any sign-out prompts.", "pdf": "m365"}, {"Rule_number": "1.3.3", "Rule": "1.3.3 (L2) Ensure 'External sharing' of calendars is not available (Automated)", "Profile_applicability": " E3 Level 2", "Description": "External calendar sharing allows an administrator to enable the ability for users to share calendars with anyone outside of the organization. Outside users will be sent a URL that can be used to view the calendar.", "Rationale": "Attackers often spend time learning about organizations before launching an attack. Publicly available calendars can help attackers understand organizational relationships and determine when specific users may be more vulnerable to an attack, such as when they are traveling.", "Impact": "This functionality is not widely used. As a result, it is unlikely that implementation of this setting will cause an impact to most users. Users that do utilize this functionality are likely to experience a minor inconvenience when scheduling meetings or synchronizing calendars with people outside the tenant.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings select Org settings. \n3. In the Services section click Calendar. \n4. Verify Let your users share their calendars with people outside of your \norganization who have Office 365 or Exchange is unchecked.", "To audit using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandGet-SharingPolicy -Identity \"Default Sharing Policy\" \n3. Verify Enabled is set to False"}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings select Org settings. \n3. In the Services section click Calendar. \n4. Uncheck Let your users share their calendars with people outside of \nyour organization who have Office 365 or Exchange. \n5. Click Save.", "To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandSet-SharingPolicy -Identity \"Default Sharing Policy\" -Enabled $False"}, "Default_value": "Enabled (True) References: 1. https://learn.microsoft.com/en-us/microsoft-365/admin/manage/share-calendars-with-external-users?view=o365-worldwide", "pdf": "m365"}, {"Rule_number": "1.3.4", "Rule": "1.3.4 (L1) Ensure 'User owned apps and services' is restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "By default, users can install add-ins in their Microsoft Word, Excel, and PowerPoint applications, allowing data access within the application. Do not allow users to install add-ins in Word, Excel, or PowerPoint.", "Rationale": "Attackers commonly use vulnerable and custom-built add-ins to access data in user applications. While allowing users to install add-ins by themselves does allow them to easily acquire useful add-ins that integrate with Microsoft applications, it can represent a risk if not used and monitored carefully. Disable future user's ability to install add-ins in Microsoft Word, Excel, or PowerPoint helps reduce your threat-surface and mitigate this risk.", "Impact": "Implementation of this change will impact both end users and administrators. End users will not be able to install add-ins that they may want to install.", "Audit": {"General Audit Instructions": "Ensure users installing Office Store add-ins, and enabling 365 trials is not \nallowed1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings Select Org settings. \n3. Under Services select User owned apps and services. \n4. Verify Let users access the Office Store and Let users start trials on \nbehalf of your organization are Not Checked."}, "Remediation": {"General Remediation Instructions": "To prohibit users installing Office Store add-ins and starting 365 trials1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings Select `Org settings'. \n3. Under Services select User owned apps and services. \n4. Uncheck Let users access the Office Store and Let users start trials on \nbehalf of your organization. \n5. Click Save."}, "Default_value": "Let users access the Office Store is Checked Let users start trials on behalf of your organization is Checked", "pdf": "m365"}, {"Rule_number": "1.3.5", "Rule": "1.3.5 (L1) Ensure internal phishing protection for Forms is enabled (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Microsoft Forms can be used for phishing attacks by asking personal or sensitive information and collecting the results. Microsoft 365 has built-in protection that will proactively scan for phishing attempt in forms such personal information request.", "Rationale": "Enabling internal phishing protection for Microsoft Forms will prevent attackers using forms for phishing attacks by asking personal or other sensitive information and URLs.", "Impact": "If potential phishing was detected, the form will be temporarily blocked and cannot be distributed, and response collection will not happen until it is unblocked by the administrator or keywords were removed by the creator.", "Audit": {"General Audit Instructions": "Ensure internal phishing protection for Forms is enabled1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings then select Org settings. \n3. Under Services select Microsoft Forms. \n4. Ensure the checkbox labeled Add internal phishing protection is checked \nunder Phishing protection."}, "Remediation": {"General Remediation Instructions": "To enable internal phishing protection for Forms1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings then select Org settings. \n3. Under Services select Microsoft Forms. \n4. Click the checkbox labeled Add internal phishing protection under Phishing \nprotection. \n5. Click Save."}, "Default_value": "Internal Phishing Protection is enabled.", "pdf": "m365"}, {"Rule_number": "1.3.6", "Rule": "1.3.6 (L2) Ensure the customer lockbox feature is enabled (Automated)", "Profile_applicability": " E5 Level 2", "Description": "Customer Lockbox is a security feature that provides an additional layer of control and transparency to customer data in Microsoft 365. It offers an approval process for Microsoft support personnel to access organization data and creates an audited trail to meet compliance requirements.", "Rationale": "Enabling this feature protects organizational data against data spillage and exfiltration.", "Impact": "Administrators will need to grant Microsoft access to the tenant environment prior to a Microsoft engineer accessing the environment for support or troubleshooting.", "Audit": {"General Audit Instructions": "Ensure the customer lockbox feature is enabled1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings then select Org settings. \n3. Select Security & privacy tab. \n4. Click Customer lockbox. \n5. Ensure the box labeled Require approval for all data access requests is \nchecked. \nTo verify the Customer Lockbox feature is enabled using the SecureScore Portal1. Navigate to the Microsoft 365 SecureScore portal. \nhttps://securescore.microsoft.com \n2. Search for Turn on customer lockbox feature under Improvement actions \nTo verify the Customer Lockbox feature is enabled using the REST APIGET https://graph.microsoft.com/beta/security/secureScores \nTo verify the Customer Lockbox feature is enabled using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-OrganizationConfig | Select-Object CustomerLockBoxEnabled \n3. Verify the value is set to True"}, "Remediation": {"General Remediation Instructions": "To enable the Customer Lockbox feature1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings then select Org settings. \n3. Select Security & privacy tab. \n4. Click Customer lockbox. \n5. Check the box Require approval for all data access requests. \n6. Click Save. \nTo set the Customer Lockbox feature to enabled using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandSet-OrganizationConfig -CustomerLockBoxEnabled $true"}, "Default_value": "Require approval for all data access requests - Unchecked CustomerLockboxEnabled - False References: 1. https://learn.microsoft.com/en-us/azure/security/fundamentals/customer-lockbox-overview", "pdf": "m365"}, {"Rule_number": "1.3.7", "Rule": "1.3.7 (L2) Ensure 'third-party storage services' are restricted in 'Microsoft 365 on the web' (Manual)", "Profile_applicability": " E3 Level 2", "Description": "Third-party storage can be enabled for users in Microsoft 365, allowing them to store and share documents using services such as Dropbox, alongside OneDrive and team sites. Ensure Microsoft 365 on the web third-party storage services are restricted.", "Rationale": "By using external storage services an organization may increase the risk of data breaches and unauthorized access to confidential information. Additionally, third-party services may not adhere to the same security standards as the organization, making it difficult to maintain data privacy and security.", "Impact": "Impact associated with this change is highly dependent upon current practices in the tenant. If users do not use other storage providers, then minimal impact is likely. However, if users do regularly utilize providers outside of the tenant this will affect their ability to continue to do so.", "Audit": {"General Audit Instructions": "Ensure Microsoft 365 on the web is restricted1. Navigate to Microsoft 365 admin center https://admin.microsoft.com \n2. Go to Settings > Org Settings > Services > Microsoft 365 on the web \n3. Ensure Let users open files stored in third-party storage services in \nMicrosoft 365 on the web is not checked."}, "Remediation": {"General Remediation Instructions": "To restrict Microsoft 365 on the web1. Navigate to Microsoft 365 admin center https://admin.microsoft.com \n2. Go to Settings > Org Settings > Services > Microsoft 365 on the web \n3. Uncheck Let users open files stored in third-party storage services in \nMicrosoft 365 on the web"}, "Default_value": "Require approval for all data access requests - Unchecked CustomerLockboxEnabled - False References: 1. https://learn.microsoft.com/en-us/azure/security/fundamentals/customer-lockbox-overview", "pdf": "m365"}, {"Rule_number": "1.3.8", "Rule": "1.3.8 (L2) Ensure that Sways cannot be shared with people outside of your organization (Manual)", "Profile_applicability": " E3 Level 2", "Description": "Sway is a new app from Microsoft Office that allows users to create and share interactive reports, personal stories, presentations, and more. This setting controls user Sway sharing capability, both within and outside of the organization. By default, Sway is enabled for everyone in the organization.", "Rationale": "Disable external sharing of Sway documents that can contain sensitive information to prevent accidental or arbitrary data leaks.", "Impact": "Interactive reports, presentations, newsletters, and other items created in Sway will not be shared outside the organization by users.", "Audit": {"General Audit Instructions": "Ensure that Sways cannot be shared with people outside of your organization1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings then select Org settings. \n3. Under Services select Sway. \n4. Confirm that under Sharing the following is not checked \no Option: Let people in your organization share their sways with \npeople outside your organization."}, "Remediation": {"General Remediation Instructions": "To ensure Sways cannot be viewed outside of your organization1. Navigate to Microsoft 365 admin center https://admin.microsoft.com. \n2. Click to expand Settings then select Org settings. \n3. Under Services select Sway \no Uncheck: Let people in your organization share their sways with \npeople outside your organization. \n4. Click Save."}, "Default_value": "Enabled - Users are able to open files stored in third-party storage services References: 1. https://learn.microsoft.com/en-us/microsoft-365/admin/setup/set-up-file-storage-and-sharing?view=o365-worldwide#enable-or-disable-third-party-storage-services", "pdf": "m365"}, {"Rule_number": "2.1.1", "Rule": "2.1.1 (L2) Ensure Safe Links for Office Applications is Enabled (Automated)", "Profile_applicability": " E5 Level 2", "Description": "Enabling Safe Links policy for Office applications allows URL's that exist inside of Office documents and email applications opened by Office, Office Online and Office mobile to be processed against Defender for Office time-of-click verification and rewritten if required. Note: E5 Licensing includes a number of Built-in Protection policies. When auditing policies note which policy you are viewing, and keep in mind CIS recommendations often extend the Default or Build-in Policies provided by MS. In order to Pass the highest priority policy must match all settings recommended.", "Rationale": "Safe Links for Office applications extends phishing protection to documents and emails that contain hyperlinks, even after they have been delivered to a user.", "Impact": "User impact associated with this change is minor - users may experience a very short delay when clicking on URLs in Office documents before being directed to the requested site. Users should be informed of the change as, in the event a link is unsafe and blocked, they will receive a message that it has been blocked.", "Audit": {"General Audit Instructions": "Ensure Safe Links for Office Applications is Enabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com \n2. Under Email & collaboration select Policies & rules \n3. Select Threat policies then Safe Links \n4. Inspect each policy and attempt to identify one that matches the parameters \noutlined below. \n5. Scroll down the pane and click on Edit Protection settings (Global Readers \nwill look for on or off values) \n6. Ensure the following protection settings are set as outlined \nEmail \no Checked On: Safe Links checks a list of known, malicious links \nwhen users click links in email. URLs are rewritten by default \no Checked Apply Safe Links to email messages sent within the \norganization \no Checked Apply real-time URL scanning for suspicious links and \nlinks that point to files \no Checked Wait for URL scanning to complete before delivering the \nmessage \no Unchecked Do not rewrite URLs, do checks via Safe Links API only. \nTeams \no Checked On: Safe Links checks a list of known, malicious links \nwhen users click links in Microsoft Teams. URLs are not rewritten \nOffice 365 Apps \no Checked On: Safe Links checks a list of known, malicious links \nwhen users click links in Microsoft Office apps. URLs are not \nrewritten \nClick protection settings \no Checked Track user clicks \no Unchecked Let users click through the original URL \n7. There is no recommendation for organization branding. \n8. Click close"}, "Remediation": {"General Remediation Instructions": "To create a Safe Links policy1. Navigate to Microsoft 365 Defender https://security.microsoft.com \n2. Under Email & collaboration select Policies & rules \n3. Select Threat policies then Safe Links \n4. Click on +Create \n5. Name the policy then click Next \n6. In Domains select all valid domains for the organization and Next \n7. Ensure the following URL & click protection settings are defined \nEmail \no Checked On: Safe Links checks a list of known, malicious links \nwhen users click links in email. URLs are rewritten by default \no Checked Apply Safe Links to email messages sent within the \norganization \no Checked Apply real-time URL scanning for suspicious links and \nlinks that point to files \no Checked Wait for URL scanning to complete before delivering the \nmessage \no Unchecked Do not rewrite URLs, do checks via Safe Links API only."}, "Default_value": "Let people in your organization share their sways with people outside your organization - Enabled References: 1. https://support.microsoft.com/en-us/office/administrator-settings-for-sway-d298e79b-b6ab-44c6-9239-aa312f5784d4", "pdf": "m365"}, {"Rule_number": "2.1.2", "Rule": "2.1.2 (L1) Ensure the Common Attachment Types Filter is enabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "The Common Attachment Types Filter lets a user block known and custom malicious file types from being attached to emails.", "Rationale": "Blocking known malicious file types can help prevent malware-infested files from infecting a host.", "Impact": "Blocking common malicious file types should not cause an impact in modern computing environments.", "Audit": {"General Audit Instructions": "Ensure the Common Attachment Types Filter is enabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand Email & collaboration select Policies & rules. \n3. On the Policies & rules page select Threat policies. \n4. Under polices select Anti-malware and click on the Default (Default) policy. \n5. On the policy page that appears on the righthand pane, under Protection \nsettings, verify that the Enable the common attachments filter has the value \nof On. \nTo verify the Common Attachment Types Filter is enabled using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandGet-MalwareFilterPolicy -Identity Default | Select-Object EnableFileFilter \n3. Verify EnableFileFilter is set to True. \nNOTE: Audit and"}, "Remediation": {"General Remediation Instructions": "To enable the Common Attachment Types Filter1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand Email & collaboration select Policies & rules. \n3. On the Policies & rules page select Threat policies. \n4. Under polices select Anti-malware and click on the Default (Default) policy. \n5. On the Policy page that appears on the right hand pane scroll to the bottom and \nclick on Edit protection settings, check the Enable the common attachments \nfilter. \n6. Click Save. \nTo enable the Common Attachment Types Filter using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandSet-MalwareFilterPolicy -Identity Default -EnableFileFilter $true \nNOTE: Audit and Remediation guidance may focus on the Default policy however, if a \nCustom Policy exists in the organization's tenant then ensure the setting is set as \noutlined in the highest priority policy listed."}, "Default_value": "Always on References: 1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-malwarefilterpolicy?view=exchange-ps 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-malware-policies-configure?view=o365-worldwide", "pdf": "m365"}, {"Rule_number": "2.1.3", "Rule": "2.1.3 (L1) Ensure notifications for internal users sending malware is Enabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Exchange Online Protection (EOP) is the cloud-based filtering service that protects organizations against spam, malware, and other email threats. EOP is included in all Microsoft 365 organizations with Exchange Online mailboxes. EOP uses flexible anti-malware policies for malware protection settings. These policies can be set to notify Admins of malicious activity.", "Rationale": "This setting alerts administrators that an internal user sent a message that contained malware. This may indicate an account or machine compromise that would need to be investigated.", "Impact": "Notification of account with potential issues should not cause an impact to the user.", "Audit": {"General Audit Instructions": "Ensure notifications for internal users sending malware is Enabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand E-mail & Collaboration select Policies & rules. \n3. On the Policies & rules page select Threat policies. \n4. Under Policies select Anti-malware. \n5. Click on the Default (Default) policy. \n6. Ensure the setting Notify an admin about undelivered messages from \ninternal senders is set to On and that there is at least one email address under \nAdministrator email address."}, "Remediation": {"To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following commandSet-MalwareFilterPolicy -Identity '{Identity Name}' -\nEnableInternalSenderAdminNotifications $True -InternalSenderAdminAddress \n{admin@domain1.com} \nNOTE: Audit and Remediation guidance may focus on the Default policy however, if a \nCustom Policy exists in the organization's tenant then ensure the setting is set as \noutlined in the highest priority policy listed."}, "Default_value": "Always on References: 1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-malwarefilterpolicy?view=exchange-ps 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-malware-policies-configure?view=o365-worldwide", "pdf": "m365"}, {"Rule_number": "2.1.4", "Rule": "2.1.4 (L2) Ensure Safe Attachments policy is enabled (Automated)", "Profile_applicability": " E5 Level 2", "Description": "The Safe Attachments policy helps protect users from malware in email attachments by scanning attachments for viruses, malware, and other malicious content. When an email attachment is received by a user, Safe Attachments will scan the attachment in a secure environment and provide a verdict on whether the attachment is safe or not.", "Rationale": "Enabling Safe Attachments policy helps protect against malware threats in email attachments by analyzing suspicious attachments in a secure, cloud-based environment before they are delivered to the user's inbox. This provides an additional layer of security and can prevent new or unseen types of malware from infiltrating the organization's network.", "Impact": "Delivery of email with attachments may be delayed while scanning is occurring.", "Audit": {"General Audit Instructions": "Ensure Safe Attachments policy is enabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand E-mail & Collaboration select Policies & rules. \n3. On the Policies & rules page select Threat policies. \n4. Under Policies select Safe Attachments. \n5. Inspect the highest priority policy. \n6. Ensure Users and domains and Included recipient domains are in scope for \nthe organization. \n7. Ensure Safe Attachments detection response: is set to Block - Block current \nand future messages and attachments with detected malware. \n8. Ensure the Quarantine Policy is set to AdminOnlyAccessPolicy. \n9. Ensure the policy is not disabled."}, "Remediation": {"General Remediation Instructions": "To enable the Safe Attachments policy1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand E-mail & Collaboration select Policies & rules. \n3. On the Policies & rules page select Threat policies. \n4. Under Policies select Safe Attachments. \n5. Click + Create. \n6. Create a Policy Name and Description, and then click Next. \n7. Select all valid domains and click Next. \n8. Select Block. \n9. Quarantine policy is AdminOnlyAccessPolicy. \n10. \nLeave Enable redirect unchecked. \n11. \nClick Next and finally Submit."}, "Default_value": "disabled", "pdf": "m365"}, {"Rule_number": "2.1.5", "Rule": "2.1.5 (L2) Ensure Safe Attachments for SharePoint, OneDrive, and Microsoft Teams is Enabled (Automated)", "Profile_applicability": " E5 Level 2", "Description": "Safe Attachments for SharePoint, OneDrive, and Microsoft Teams scans these services for malicious files.", "Rationale": "Safe Attachments for SharePoint, OneDrive, and Microsoft Teams protect organizations from inadvertently sharing malicious files. When a malicious file is detected that file is blocked so that no one can open, copy, move, or share it until further actions are taken by the organization's security team.", "Impact": "Impact associated with Safe Attachments is minimal, and equivalent to impact associated with anti-virus scanners in an environment.", "Audit": {"General Audit Instructions": "Ensure Safe Attachments for SharePoint, OneDrive, and Microsoft Teams is \nEnabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com \n2. Under Email & collaboration select Policies & rules \n3. Select Threat policies then Safe Attachments. \n4. Click on Global settings \n5. Ensure the toggle is Enabled to Turn on Defender for Office 365 for \nSharePoint, OneDrive, and Microsoft Teams. \n6. Ensure the toggle is Enabled to Turn on Safe Documents for Office clients. \n7. Ensure the toggle is Deselected/Disabled to Allow people to click through \nProtected View even if Safe Documents identified the file as malicious."}, "Remediation": {"To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandSet-AtpPolicyForO365 -EnableATPForSPOTeamsODB $true -EnableSafeDocs $true -\nAllowSafeDocsOpen $false"}, "Default_value": "disabled", "pdf": "m365"}, {"Rule_number": "2.1.6", "Rule": "2.1.6 (L1) Ensure Exchange Online Spam Policies are set to notify administrators (Automated)", "Profile_applicability": " E3 Level 1", "Description": "In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, email messages are automatically protected against spam (junk email) by EOP. Configure Exchange Online Spam Policies to copy emails and notify someone when a sender in the organization has been blocked for sending spam emails.", "Rationale": "A blocked account is a good indication that the account in question has been breached and an attacker is using it to send spam emails to other people.", "Impact": "Notification of users that have been blocked should not cause an impact to the user.", "Audit": {"General Audit Instructions": "Ensure Exchange Online Spam Policies are set to notify administrators1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand Email & collaboration select Policies & rules > Threat \npolicies. \n3. Under Policies select Anti-spam. \n4. Click on the Anti-spam outbound policy (default). \n5. Verify that Send a copy of outbound messages that exceed these limits to \nthese users and groups is set to On, ensure the email address is correct."}, "Remediation": {"General Remediation Instructions": "To set the Exchange Online Spam Policies1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand Email & collaboration select Policies & rules> Threat \npolicies. \n3. Under Policies select Anti-spam. \n4. Click on the Anti-spam outbound policy (default). \n5. Select Edit protection settings then under Notifications \n6. Check Send a copy of outbound messages that exceed these limits to \nthese users and groups then enter the desired email addresses. \n7. Check Notify these users and groups if a sender is blocked due to \nsending outbound spam then enter the desired email addresses. \n8. Click Save. \nTo set the Exchange Online Spam Policies correctly using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell command$BccEmailAddress = @(\"<INSERT-EMAIL>\") \n \n$NotifyEmailAddress = @(\"<INSERT-EMAIL>\") \n \nSet-HostedOutboundSpamFilterPolicy -Identity Default -\nBccSuspiciousOutboundAdditionalRecipients $BccEmailAddress -\nBccSuspiciousOutboundMail $true -NotifyOutboundSpam $true -\nNotifyOutboundSpamRecipients $NotifyEmailAddress \nNote: Audit and Remediation guidance may focus on the Default policy however, if a \nCustom Policy exists in the organization's tenant then ensure the setting is set as \noutlined in the highest priority policy listed."}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.7", "Rule": "2.1.7 (L1) Ensure that an anti-phishing policy has been created (Automated)", "Profile_applicability": " E5 Level 1", "Description": "By default, Office 365 includes built-in features that help protect users from phishing attacks. Set up anti-phishing polices to increase this protection, for example by refining settings to better detect and prevent impersonation and spoofing attacks. The default policy applies to all users within the organization and is a single view to fine-tune anti-phishing protection. Custom policies can be created and configured for specific users, groups or domains within the organization and will take precedence over the default policy for the scoped users.", "Rationale": "Protects users from phishing attacks (like impersonation and spoofing), and uses safety tips to warn users about potentially harmful messages.", "Impact": "Turning on Anti-Phishing should not cause an impact; messages will be displayed when applicable.", "Audit": {"General Audit Instructions": "Note: Audit and"}, "Remediation": {"General Remediation Instructions": "Note: Audit and Remediation guidance may focus on the Default policy however, if a \nCustom Policy exists in the organization's tenant then ensure the setting is set as \noutlined in the highest priority policy listed. \nTo set the anti-phishing policy 1.Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand Email & collaboration select Policies & rules \n3. Select Threat policies. \n4. Under Policies select Anti-phishing. \n5. Select the Office365 AntiPhish Default (Default) policy and click Edit \nprotection settings. \n6. Set the Phishing email threshold to at least 2 - Aggressive. \nUnder Impersonation \n\u2022Check Enable mailbox intelligence (Recommended) \n\u2022Check Enable Intelligence for impersonation protection (Recommended). \nUnder Spoof \n\u2022Check Enable spoof intelligence (Recommended). \n7. Click Save. \nTo create an anti-phishing policy using PowerShell1. Connect to Exchange Online service using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandNew-AntiPhishPolicy -Name \"Office365 AntiPhish Policy\" \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n9.7 Deploy and Maintain Email Server Anti-Malware \nProtections \n \nDeploy and maintain email server anti-malware protections, such as \nattachment scanning and/or sandboxing. \n \n \n\u25cf \nv7 \n7 Email and Web Browser Protections \n \nEmail and Web Browser Protections"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.8", "Rule": "2.1.8 (L1) Ensure that SPF records are published for all Exchange Domains (Manual)", "Profile_applicability": " E3 Level 1", "Description": "For each domain that is configured in Exchange, a corresponding Sender Policy Framework (SPF) record should be created.", "Rationale": "SPF records allow Exchange Online Protection and other mail systems to know where messages from domains are allowed to originate. This information can be used by that system to determine how to treat the message based on if it is being spoofed or is valid.", "Impact": "There should be minimal impact of setting up SPF records however, organizations should ensure proper SPF record setup as email could be flagged as spam if SPF is not setup appropriately.", "Audit": {"General Audit Instructions": "Ensure that SPF records are published for all Exchange Domains1. Open a command prompt. \n2. Type the following command in PowerShellResolve-DnsName [domain1.com] txt | fl \n3. Ensure that a value exists and that it includes v=spf1 \ninclude:spf.protection.outlook.com. This designates Exchange Online as a \ndesignated sender. \nTo verify the SPF records are published, use the REST API for each domainhttps://graph.microsoft.com/v1.0/domains/[DOMAIN.COM]/serviceConfigurationRec\nords 1.Ensure that a value exists that includes v=spf1 \ninclude:spf.protection.outlook.com. This designates Exchange Online as a \ndesignated sender."}, "Remediation": {"General Remediation Instructions": "To setup SPF records for Exchange Online accepted domains, perform the \nfollowing steps1. If all email in your domain is sent from and received by Exchange Online, add the \nfollowing TXT record for each Accepted Domainv=spf1 include:spf.protection.outlook.com -all \n2. If there are other systems that send email in the environment, refer to this article \nfor the proper SPF configuration: https://docs.microsoft.com/en-\nus/office365/SecurityCompliance/set-up-spf-in-office-365-to-help-prevent-\nspoofing. \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-spf-configure?view=o365-worldwide \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n9.5 Implement DMARC \n \nTo lower the chance of spoofed or modified emails from valid domains, \nimplement DMARC policy and verification, starting with implementing the Sender \nPolicy Framework (SPF) and the DomainKeys Identified Mail (DKIM) standards. \n \n\u25cf \n\u25cf \nv7 \n7.8 Implement DMARC and Enable Receiver-Side \nVerification \n \nTo lower the chance of spoofed or modified emails from valid domains, \nimplement Domain-based Message Authentication, Reporting and Conformance \n(DMARC) policy and verification, starting by implementing the Sender Policy \nFramework (SPF) and the DomainKeys Identified Mail(DKIM) standards. \n \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.9", "Rule": "2.1.9 (L1) Ensure that DKIM is enabled for all Exchange Online Domains (Automated)", "Profile_applicability": " E3 Level 1", "Description": "DKIM is one of the trio of Authentication methods (SPF, DKIM and DMARC) that help prevent attackers from sending messages that look like they come from your domain. DKIM lets an organization add a digital signature to outbound email messages in the message header. When DKIM is configured, the organization authorizes it's domain to associate, or sign, its name to an email message using cryptographic authentication. Email systems that get email from this domain can use a digital signature to help verify whether incoming email is legitimate. Use of DKIM in addition to SPF and DMARC to help prevent malicious actors using spoofing techniques from sending messages that look like they are coming from your domain.", "Rationale": "By enabling DKIM with Office 365, messages that are sent from Exchange Online will be cryptographically signed. This will allow the receiving email system to validate that the messages were generated by a server that the organization authorized and not being spoofed.", "Impact": "There should be no impact of setting up DKIM however, organizations should ensure appropriate setup to ensure continuous mail-flow.", "Audit": {"General Audit Instructions": "To ensure DKIM is enabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Expand Email & collaboration > Policies & rules > Threat policies. \n3. Under Rules section click Email authentication settings. \n4. Select DKIM \n5. Click on each domain and confirm that Sign messages for this domain with \nDKIM signatures is Enabled. \n6. A status of Not signing DKIM signatures for this domain is an audit fail. \nTo verify DKIM is enabled, use the Exchange Online PowerShell Module1. Connect to Exchange Online service using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandGet-DkimSigningConfig \n3. Verify Enabled is set to True"}, "Remediation": {"General Remediation Instructions": "To setup DKIM records, first add the following records to your DNS system, for \neach domain in Exchange Online that you plan to use to send email with1. For each accepted domain in Exchange Online, two DNS entries are required. \nHost name \n \nselector1._domainkey \nPoints to address or valueselector1-\n<domainGUID>._domainkey.<initialDomain>  \nTTL \n \n \n3600 \nHost name \n \nselector2._domainkey \nPoints to address or valueselector2-\n<domainGUID>._domainkey.<initialDomain>  \nTTL \n \n \n3600 \nFor Office 365, the selectors will always be selector1 or selector2. \ndomainGUID is the same as the domainGUID in the customized MX record for your \ncustom domain that appears before mail.protection.outlook.com. For example, in the \nfollowing MX record for the domain contoso.com, the domainGUID is contoso-comcontoso.com.  3600  IN  MX   5 contoso-com.mail.protection.outlook.com \nThe initial domain is the domain that you used when you signed up for Office 365. Initial \ndomains always end in on microsoft.com. 1.After the DNS records are created, enable DKIM signing in Defender. \n2. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n3. Expand Email & collaboration > Policies & rules > Threat policies. \n4. Under Rules section click Email authentication settings. \n5. Select DKIM \n6. Click on each domain and click Enable next to Sign messages for this domain \nwith DKIM signature. \nTo set DKIM is enabled, use the Exchange Online PowerShell Module1. Connect to Exchange Online service using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell commandSet-DkimSigningConfig -Identity < domainName > -Enabled $True \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-dkim-configure?view=o365-worldwide"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.10", "Rule": "2.1.10 (L1) Ensure DMARC Records for all Exchange Online domains are published (Manual)", "Profile_applicability": " E3 Level 1", "Description": "DMARC, or Domain-based Message Authentication, Reporting, and Conformance, assists recipient mail systems in determining the appropriate action to take when messages from a domain fail to meet SPF or DKIM authentication criteria.", "Rationale": "DMARC strengthens the trustworthiness of messages sent from an organization's domain to destination email systems. By integrating DMARC with SPF (Sender Policy Framework) and DKIM (DomainKeys Identified Mail), organizations can significantly enhance their defenses against email spoofing and phishing attempts.", "Impact": "There should be no impact of setting up DMARC however, organizations should ensure appropriate setup to ensure continuous mail-flow.", "Audit": {"General Audit Instructions": "Ensure DMARC Records for all Exchange Online domains are published1. Open a command prompt. \n2. For each of the Accepted Domains in Exchange Online run the following in \nPowerShellResolve-DnsName _dmarc.[domain1.com] txt \n3. Ensure that the record exists and has at minimum the following flags defined as \nfollowsv=DMARC1; (p=quarantine OR p=reject), pct=100, rua=mailto:<reporting email \naddress> and ruf=mailto:<reporting email address> \nThe below example records would pass as they contain a policy that would either \nquarantine or reject messages failing DMARC, the policy affects 100% of mail pct=100 \nas well as containing valid reporting addressesv=DMARC1; p=reject; pct=100; rua=mailto:rua@contoso.com; \nruf=mailto:ruf@contoso.com; fo=1 \n \nv=DMARC1; p=reject; pct=100; fo=1; ri=3600; rua=mailto:rua@contoso.com; \nruf=mailto:ruf@contoso.com \n \nv=DMARC1; p=quarantine; pct=100; sp=none; fo=1; ri=3600; \nrua=mailto:rua@contoso.com; ruf=ruf@contoso.com; \n \n4. Ensure the Microsoft MOERA domain is also configured. \nResolve-DnsName _dmarc.[tenant].onmicrosoft.com txt \n5. Ensure the record meets the same criteria listed in step #3."}, "Remediation": {"General Remediation Instructions": "To add DMARC records, use the following steps1. For each Exchange Online Accepted Domain, add the following record to DNSRecord:  _dmarc.domain1.com \nType:  TXT \nValue:  v=DMARC1; p=none; rua=mailto:<rua-report@example.com>; \nruf=mailto:<ruf-report@example.com> \n2. This will create a basic DMARC policy that will allow the organization to start \nmonitoring message statistics. \n3. The next steps will involve first implementing quarantine and next a reject policy \nwith 100 percent of email is affected. Microsoft has a list of best practices for \nimplementing DMARC that cover these steps in detail. \nTo establish a DMARC record for the MOERA domain1. Navigate to the Microsoft 365 admin center https://admin.microsoft.com/ \n2. Expand Settings and select Domains. \n3. Select your tenant domain (for example, contoso.onmicrosoft.com). \n4. Select DNS records and click + Add record. \n5. Add a new record with the TXT name of _dmarc with the appropriate values \noutlined above. \nNote: The remediation portion involves a multi-staged approach over a period of time. \nFirst, a baseline of the current state of email will be established with p=none and rua and \nruf. Once the environment is better understood and reports have been analyzed an \norganization will move to the final state with dmarc record values as outlined in the audit \nsection. \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/email-authentication-dmarc-configure?view=o365-worldwide \n2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/step-\nby-step-guides/how-to-enable-dmarc-reporting-for-microsoft-online-email-routing-\naddress-moera-and-parked-domains?view=o365-worldwide"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.11", "Rule": "2.1.11 (L1) Ensure the spoofed domains report is reviewed weekly (Manual)", "Profile_applicability": " E5 Level 1", "Description": "Use spoof intelligence in the Security Center on the Anti-spam settings page to review all senders who are spoofing either domains that are part of the organization or spoofing external domains. Spoof intelligence is available as part of Office 365 Enterprise E5 or separately as part of Defender for Office 365 and as of October 2018 Exchange Online Protection (EOP).", "Rationale": "Bad actors spoof domains to trick users into conducting actions they normally would not or should not via phishing emails. Running this report will inform the message administrators of current activities, and the phishing techniques used by bad actors. This information can be used to inform end users and plan against future campaigns. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To review the spoofed domains report: 1. Navigate to Microsoft 365 Defender https://security.microsoft.com. 2. Under Email & collaboration click on Policies & rules then select Threat policies. 3. Under Rules click on Tenant Allow / Block Lists then select Spoofed senders. 4. Review. To view spoofed senders that were allowed or blocked by spoof intelligence in the last 7 days: 1. Connect to Exchange Online using Connect-ExchangeOnline. 2. Run the following PowerShell command: Get-SpoofIntelligenceInsight 3. Review.", "Impact": "There should be no impact of setting up DMARC however, organizations should ensure appropriate setup to ensure continuous mail-flow.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review the spoofed domains report1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Under Email & collaboration click on Policies & rules then select Threat \npolicies. \n3. Under Rules click on Tenant Allow / Block Lists then select Spoofed senders. \n4. Review. \nTo view spoofed senders that were allowed or blocked by spoof intelligence in \nthe last 7 days1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-SpoofIntelligenceInsight \n3. Review."}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.12", "Rule": "2.1.12 (L1) Ensure the 'Restricted entities' report is reviewed weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Microsoft 365 Defender reviews of Restricted Entities will provide a list of user accounts restricted from sending e-mail. If a user exceeds one of the outbound sending limits as specified in the service limits or in outbound spam policies, the user is restricted from sending email, but they can still receive email.", "Rationale": "Users who are found on the restricted users list have a high probability of having been compromised. Review of this list will allow an organization to remediate these user accounts, and then unblock them. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To review the report of users who have had their email privileges restricted due to spamming: 1. Navigate to Microsoft 365 Defender https://security.microsoft.com. 2. Under Email & collaboration navigate to Review. 3. Click Restricted Entities. 4. Review alerts and take appropriate action (unblocking) after account has been remediated. Review a list of users blocked from sending messages using PowerShell: 1. Connect to Exchange Online using Connect-ExchangeOnline 2. Run the following PowerShell command: Get-BlockedSenderAddress 3. Review.", "Impact": "There should be no impact of setting up DMARC however, organizations should ensure appropriate setup to ensure continuous mail-flow.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review the report of users who have had their email privileges restricted due to \nspamming1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Under Email & collaboration navigate to Review. \n3. Click Restricted Entities. \n4. Review alerts and take appropriate action (unblocking) after account has been \nremediated. \nReview a list of users blocked from sending messages using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline \n2. Run the following PowerShell commandGet-BlockedSenderAddress \n3. Review."}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.13", "Rule": "2.1.13 (L1) Ensure malware trends are reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Threat explorer shows specific instances of Microsoft blocking a malware attachment from reaching users, phishing being blocked, impersonation attempts, etc. The report should be reviewed at least weekly.", "Rationale": "While this report isn't strictly actionable, reviewing it will give a sense of the overall volume of various security threats targeting users, which may prompt adoption of more aggressive threat mitigations. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To remediate using the UI: 1. Navigate to Microsoft 365 Defender https://security.microsoft.com. 2. Click to expand Email & collaboration select Review. 3. Select Malware trends. 4. On the Threat Explorer page, select each tab to review statistics. References: 1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/reports-email-security?view=o365-worldwide 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/threat-explorer-real-time-detections-about?view=o365-worldwide", "Impact": "There should be no impact of setting up DMARC however, organizations should ensure appropriate setup to ensure continuous mail-flow.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click to expand Email & collaboration select Review. \n3. Select Malware trends. \n4. On the Threat Explorer page, select each tab to review statistics. \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/reports-email-security?view=o365-worldwide \n2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-\nsecurity/threat-explorer-real-time-detections-about?view=o365-worldwide"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.1.14", "Rule": "2.1.14 (L2) Ensure comprehensive attachment filtering is applied (Automated)", "Profile_applicability": " E3 Level 2", "Description": "The Common Attachment Types Filter lets a user block known and custom malicious file types from being attached to emails. The policy provided by Microsoft covers 53 extensions, and an additional custom list of extensions can be defined. The list of 187 extensions provided in this recommendation is comprehensive but not exhaustive.", "Rationale": "Blocking known malicious file types can help prevent malware-infested files from infecting a host or performing other malicious attacks such as phishing and data extraction. Defining a comprehensive list of attachments can help protect against additional unknown and known threats. Many legacy file formats, binary files and compressed files have been used as delivery mechanisms for malicious software. Organizations can protect themselves from Business E-mail Compromise (BEC) by allow-listing only the file types relevant to their line of business and blocking all others.", "Impact": "For file types that are business necessary users will need to use other organizationally approved methods to transfer blocked extension types between business partners.", "Audit": {"General Audit Instructions": "Note: Utilizing the UI for auditing Anti-malware policies can be very time consuming so \nit is recommended to use a script like the one supplied below. \nTo Audit using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following script:"}, "Remediation": {"General Remediation Instructions": "To Remediate using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following script# Create an attachment policy and associated rule. The rule is \n# intentionally disabled allowing the org to enable it when ready \n \n$Policy = @{ \n    Name             = \"CIS L2 Attachment Policy\" \n    EnableFileFilter = $true \n    ZapEnabled       = $true \n    EnableInternalSenderAdminNotifications = $true \n    InternalSenderAdminAddress = 'admin@contoso.com' # Change this. \n} \n \n$L2Extensions = @( \n    \"7z\", \"a3x\", \"ace\", \"ade\", \"adp\", \"ani\", \"app\", \"appinstaller\", \n    \"applescript\", \"application\", \"appref-ms\", \"appx\", \"appxbundle\", \"arj\", \n    \"asd\", \"asx\", \"bas\", \"bat\", \"bgi\", \"bz2\", \"cab\", \"chm\", \"cmd\", \"com\", \n    \"cpl\", \"crt\", \"cs\", \"csh\", \"daa\", \"dbf\", \"dcr\", \"deb\", \n    \"desktopthemepackfile\", \"dex\", \"diagcab\", \"dif\", \"dir\", \"dll\", \"dmg\", \n    \"doc\", \"docm\", \"dot\", \"dotm\", \"elf\", \"eml\", \"exe\", \"fxp\", \"gadget\", \"gz\", \n    \"hlp\", \"hta\", \"htc\", \"htm\", \"htm\", \"html\", \"html\", \"hwpx\", \"ics\", \"img\", \n    \"inf\", \"ins\", \"iqy\", \"iso\", \"isp\", \"jar\", \"jnlp\", \"js\", \"jse\", \"kext\", \n    \"ksh\", \"lha\", \"lib\", \"library-ms\", \"lnk\", \"lzh\", \"macho\", \"mam\", \"mda\", \n    \"mdb\", \"mde\", \"mdt\", \"mdw\", \"mdz\", \"mht\", \"mhtml\", \"mof\", \"msc\", \"msi\", \n    \"msix\", \"msp\", \"msrcincident\", \"mst\", \"ocx\", \"odt\", \"ops\", \"oxps\", \"pcd\", \n    \"pif\", \"plg\", \"pot\", \"potm\", \"ppa\", \"ppam\", \"ppkg\", \"pps\", \"ppsm\", \"ppt\", \n    \"pptm\", \"prf\", \"prg\", \"ps1\", \"ps11\", \"ps11xml\", \"ps1xml\", \"ps2\",  \n    \"ps2xml\", \"psc1\", \"psc2\", \"pub\", \"py\", \"pyc\", \"pyo\", \"pyw\", \"pyz\",  \n    \"pyzw\", \"rar\", \"reg\", \"rev\", \"rtf\", \"scf\", \"scpt\", \"scr\", \"sct\", \n    \"searchConnector-ms\", \"service\", \"settingcontent-ms\", \"sh\", \"shb\", \"shs\", \n    \"shtm\", \"shtml\", \"sldm\", \"slk\", \"so\", \"spl\", \"stm\", \"svg\", \"swf\", \"sys\", \n    \"tar\", \"theme\", \"themepack\", \"timer\", \"uif\", \"url\", \"uue\", \"vb\", \"vbe\", \n    \"vbs\", \"vhd\", \"vhdx\", \"vxd\", \"wbk\", \"website\", \"wim\", \"wiz\", \"ws\", \"wsc\", \n    \"wsf\", \"wsh\", \"xla\", \"xlam\", \"xlc\", \"xll\", \"xlm\", \"xls\", \"xlsb\", \"xlsm\", \n    \"xlt\", \"xltm\", \"xlw\", \"xml\", \"xnk\", \"xps\", \"xsl\", \"xz\", \"z\" \n) \n \n# Create the policy \nNew-MalwareFilterPolicy @Policy -FileTypes $L2Extensions \n# Create the rule for all accepted domains \n$Rule = @{ \n    Name = $Policy.Name \n    Enabled = $false \n    MalwareFilterPolicy = $Policy.Name \n    RecipientDomainIs = (Get-AcceptedDomain).Name \n    Priority = 0 \n} \n \nNew-MalwareFilterRule @Rule"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.3.1", "Rule": "2.3.1 (L1) Ensure the Account Provisioning Activity report is reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "The Account Provisioning Activity report details any account provisioning that was attempted by an external application.", "Rationale": "If the organization doesn't usually use a third-party provider to manage accounts, any entry on the list is likely illicit. Otherwise, it is recommended to monitor transaction volumes and look for new or unusual third party applications that may be managing users. If anything unusual is observed, the provider should be contacted to determine the legitimacy of the action. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed.", "Impact": "For file types that are business necessary users will need to use other organizationally approved methods to transfer blocked extension types between business partners.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review the Account Provisioning Activity report1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click on Audit. \n3. Set Activities to Added user for User administration activities. \n4. Set Start Date and End Date. \n5. Click Search. \n6. Review. \nTo review Account Provisioning Activity report using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following Exchange Online PowerShell command$startDate = ((Get-date).AddDays(-7)).ToShortDateString() \n$endDate = (Get-date).ToShortDateString() \n \nSearch-UnifiedAuditLog -StartDate $startDate -EndDate $endDate | Where-Object \n{ $_.Operations -eq \"add user.\" } \n3. Review the output. \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.11 Conduct Audit Log Reviews \n \nConduct reviews of audit logs to detect anomalies or abnormal events that \ncould indicate a potential threat. Conduct reviews on a weekly, or more frequent, \nbasis. \n \n\u25cf \n\u25cf \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n\u25cf \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.3.2", "Rule": "2.3.2 (L1) Ensure non-global administrator role group assignments are reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Non-global administrator role group assignments should be reviewed at least every week.", "Rationale": "While these roles are less powerful than a global admin, they do grant special privileges that can be used illicitly. If unusual activity is detected, contact the user to confirm it is a legitimate need. Audit: To verify non-global administrator role group assignments are being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To review non-global administrator role group assignments: 1. Navigate to Microsoft 365 Defender https://security.microsoft.com. 2. Click on Audit. 3. Set Added member to Role and Removed a user from a directory role for Activities. 4. Set Start Date and End Date. 5. Click Search. 6. Review. CIS Controls: Controls Version Control IG 1 IG 2 IG 3 v8 8.11 Conduct Audit Log Reviews  Conduct reviews of audit logs to detect anomalies or abnormal events that could indicate a potential threat. Conduct reviews on a weekly, or more frequent, basis.  \u25cf \u25cf v7 6.2 Activate audit logging  Ensure that local logging has been enabled on all systems and networking devices. \u25cf \u25cf \u25cf", "Impact": "For file types that are business necessary users will need to use other organizationally approved methods to transfer blocked extension types between business partners.", "Audit": {"General Audit Instructions": "To verify non-global administrator role group assignments are being reviewed at least \nweekly, confirm that the necessary procedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review non-global administrator role group assignments1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Click on Audit. \n3. Set Added member to Role and Removed a user from a directory role for \nActivities. \n4. Set Start Date and End Date. \n5. Click Search. \n6. Review. \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.11 Conduct Audit Log Reviews \n \nConduct reviews of audit logs to detect anomalies or abnormal events that \ncould indicate a potential threat. Conduct reviews on a weekly, or more frequent, \nbasis. \n \n\u25cf \n\u25cf \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n\u25cf \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "2.4.1", "Rule": "2.4.1 (L1) Ensure Priority account protection is enabled and configured (Manual)", "Profile_applicability": " E5 Level 1", "Description": "Identify priority accounts to utilize Microsoft 365's advanced custom security features. This is an essential tool to bolster protection for users who are frequently targeted due to their critical positions, such as executives, leaders, managers, or others who have access to sensitive, confidential, financial, or high-priority information. Once these accounts are identified, several services and features can be enabled, including threat policies, enhanced sign-in protection through conditional access policies, and alert policies, enabling faster response times for incident response teams.", "Rationale": "Enabling priority account protection for users in Microsoft 365 is necessary to enhance security for accounts with access to sensitive data and high privileges, such as CEOs, CISOs, CFOs, and IT admins. These priority accounts are often targeted by spear phishing or whaling attacks and require stronger protection to prevent account compromise. To address this, Microsoft 365 and Microsoft Defender for Office 365 offer several key features that provide extra security, including the identification of incidents and alerts involving priority accounts and the use of built-in custom protections designed specifically for them.", "Impact": "For file types that are business necessary users will need to use other organizationally approved methods to transfer blocked extension types between business partners.", "Audit": {"General Audit Instructions": "Audit with a 3-step process \n \nStep 1: Verify Priority account protection is enabled1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Select Settings > E-mail & Collaboration > Priority account protection \n3. Ensure Priority account protection is set to On \nStep 2: Verify that priority accounts are identified and tagged accordingly4. Select User tags \n5. Select the PRIORITY ACCOUNT tag and click Edit \n6. Verify the assigned members match the organization's defined priority accounts \nor groups. \n7. Repeat the previous 2 steps for any additional tags identified, such as Finance or \nHR. \nStep 3: Ensure alerts are configured8. Expand E-mail & Collaboration on the left column. \n9. Select Policies & rules > Alert policy \n10. \nEnsure alert policies are configured for priority accounts, enabled and have a \nvalid recipient. The tags column can be used to identify policies using a specific \ntag."}, "Remediation": {"Enable Priority account protection in Microsoft 365 Defender:": "1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Select Settings > E-mail & Collaboration > Priority account protection \n3. Ensure Priority account protection is set to On \nStep 2: Tag priority accounts4. Select User tags \n5. Select the PRIORITY ACCOUNT tag and click Edit \n6. Select Add members to add users, or groups. Groups are recommended. \n7. Repeat the previous 2 steps for any additional tags needed, such as Finance or \nHR. \n8. Next and Submit. \nStep 3: Configure E-mail alerts for Priority Accounts9. Expand E-mail & Collaboration on the left column. \n10. \nSelect New Alert Policy \n11. \nEnter a valid policy Name & Description. Set Severity to High and Category to \nThreat management. \n12. \nSet Activity is to Detected malware in an e-mail message \n13. \nMail direction is Inbound \n14. \nSelect Add Condition and User: recipient tags are \n15. \nIn the Selection option field add chosen priority tags such as Priority account. \n16. \nSelect Every time an activity matches the rule. \n17. \nNext and Verify valid recipient(s) are selected. \n18. \nNext and select Yes, turn it on right away. Click Submit to save the alert. \n19. \nRepeat steps 10 - 18 for the Activity field Activity is: Phishing email detected \nat time of delivery \nNOTE: Any additional activity types may be added as needed. Above are the minimum \nrecommended."}, "Default_value": "By default, priority accounts are undefined. References: 1. https://learn.microsoft.com/en-us/microsoft-365/admin/setup/priority-accounts 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/security-recommendations-for-priority-accounts", "pdf": "m365"}, {"Rule_number": "2.4.2", "Rule": "2.4.2 (L1) Ensure Priority accounts have 'Strict protection' presets applied (Manual)", "Profile_applicability": " E5 Level 1", "Description": "Preset security policies have been established by Microsoft, utilizing observations and experiences within datacenters to strike a balance between the exclusion of malicious content from users and limiting unwarranted disruptions. These policies can apply to all, or select users and encompass recommendations for addressing spam, malware, and phishing threats. The policy parameters are pre-determined and non-adjustable. Strict protection has the most aggressive protection of the 3 presets. \u2022 EOP: Anti-spam, Anti-malware and Anti-phishing \u2022 Defender: Spoof protection, Impersonation protection and Advanced phishing \u2022 Defender: Safe Links and Safe Attachments NOTE: The preset security polices cannot target Priority account TAGS currently, groups should be used instead.", "Rationale": "Enabling priority account protection for users in Microsoft 365 is necessary to enhance security for accounts with access to sensitive data and high privileges, such as CEOs, CISOs, CFOs, and IT admins. These priority accounts are often targeted by spear phishing or whaling attacks and require stronger protection to prevent account compromise. The implementation of stringent, pre-defined policies may result in instances of false positive, however, the benefit of requiring the end-user to preview junk email before accessing their inbox outweighs the potential risk of mistakenly perceiving a malicious email as safe due to its placement in the inbox.", "Impact": "Strict policies are more likely to cause false positives in anti-spam, phishing, impersonation, spoofing and intelligence responses.", "Audit": {"From here visit each section in turn:": "Anti-phishing Anti-spam Anti-malware Safe \nAttachments Safe Links \n5. Ensure in each there is a policy named Strict Preset Security Policy which \nincludes the organization's priority Accounts/Groups."}, "Remediation": {"Enable strict preset security policies for Priority accounts:": "1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Select to expand E-mail & collaboration. \n3. Select Policies & rules > Threat policies > Preset security policies. \n4. Click to Manage protection settings for Strict protection preset. \n5. For Apply Exchange Online Protection select at minimum Specific recipients \nand include the Accounts/Groups identified as Priority Accounts. \n6. For Apply Defender for Office 365 Protection select at minimum Specific \nrecipients and include the Accounts/Groups identified as Priority Accounts. \n7. For Impersonation protection click Next and add valid e-mails or priority \naccounts both internal and external that may be subject to impersonation. \n8. For Protected custom domains add the organization's domain name, along side \nother key partners. \n9. Click Next and finally Confirm"}, "Default_value": "By default, presets are not applied to any users or groups. References: 1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/preset-security-policies?view=o365-worldwide 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/security-recommendations-for-priority-accounts 3. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/recommended-settings-for-eop-and-office365?view=o365-worldwide#impersonation-settings-in-anti-phishing-policies-in-microsoft-defender-for-office-365", "pdf": "m365"}, {"Rule_number": "2.4.3", "Rule": "2.4.3 (L2) Ensure Microsoft Defender for Cloud Apps is enabled and configured (Manual)", "Profile_applicability": " E5 Level 2", "Description": "Microsoft Defender for Cloud Apps is a Cloud Access Security Broker (CASB). It provides visibility into suspicious activity in Microsoft 365, enabling investigation into potential security issues and facilitating the implementation of remediation measures if necessary. Some risk detection methods provided by Entra Identity Protection also require Microsoft Defender for Cloud Apps: \u2022 Suspicious manipulation of inbox rules \u2022 Suspicious inbox forwarding \u2022 New country detection \u2022 Impossible travel detection \u2022 Activity from anonymous IP addresses \u2022 Mass access to sensitive files", "Rationale": "Security teams can receive notifications of triggered alerts for atypical or suspicious activities, see how the organization's data in Microsoft 365 is accessed and used, suspend user accounts exhibiting suspicious activity, and require users to log back in to Microsoft 365 apps after an alert has been triggered. Audit: Ensure Microsoft Defender for Cloud Apps is enabled and configured: 1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ 2. Select Settings > Cloud apps. 3. Scroll to Connected apps and select App connectors. 4. Ensure that Microsoft 365 and Microsoft Azure both show in the list as Connected. 5. Go to Cloud Discovery > Microsoft Defender for Endpoint and check if the integration is enabled. 6. Go to Information Protection > Files and verify Enable file monitoring is checked.", "Impact": "Strict policies are more likely to cause false positives in anti-spam, phishing, impersonation, spoofing and intelligence responses.", "Audit": {"General Audit Instructions": "Ensure Microsoft Defender for Cloud Apps is enabled and configured1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Select Settings > Cloud apps. \n3. Scroll to Connected apps and select App connectors. \n4. Ensure that Microsoft 365 and Microsoft Azure both show in the list as \nConnected. \n5. Go to Cloud Discovery > Microsoft Defender for Endpoint and check if the \nintegration is enabled. \n6. Go to Information Protection > Files and verify Enable file monitoring is \nchecked."}, "Remediation": {"General Remediation Instructions": "Configure Information Protection and Cloud Discovery1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Select Settings > Cloud apps. \n3. Scroll to Information Protection and select Files. \n4. Check Enable file monitoring. \n5. Scroll up to Cloud Discovery and select Microsoft Defender for Endpoint. \n6. Check Enforce app access, configure a Notification URL and Save. \nNote: Defender for Endpoint requires a Defender for Endpoint license. \nConfigure App Connectors1. Scroll to Connected apps and select App connectors. \n2. Click on Connect an app and select Microsoft 365. \n3. Check all Azure and Office 365 boxes then click Connect Office 365. \n4. Repeat for the Microsoft Azure application."}, "Default_value": "Disabled References: 1. https://learn.microsoft.com/en-us/defender-cloud-apps/connect-office-365 2. https://learn.microsoft.com/en-us/defender-cloud-apps/connect-azure 3. https://learn.microsoft.com/en-us/defender-cloud-apps/best-practices 4. https://learn.microsoft.com/en-us/defender-cloud-apps/get-started 5. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/concept-identity-protection-risks Additional Information: Additional Microsoft 365 Defender features include: \u2022 The option to use Defender for cloud apps as a reverse proxy, allowing for the application of access or session controls through the definition of a conditional access policy. \u2022 The purchase and implementation of the \"App Governance\" add-on, which provides more precise control over OAuth app permissions and includes additional built-in policies. A list of Defender for Cloud Apps built-in policies for Office 365 can be found at https://learn.microsoft.com/en-us/defender-cloud-apps/protect-office-365.", "pdf": "m365"}, {"Rule_number": "2.4.4", "Rule": "2.4.4 (L1) Ensure Zero-hour auto purge for Microsoft Teams is on (Automated)", "Profile_applicability": " E5 Level 1", "Description": "Zero-hour auto purge (ZAP) is a protection feature that retroactively detects and neutralizes malware and high confidence phishing. When ZAP for Teams protection blocks a message, the message is blocked for everyone in the chat. The initial block happens right after delivery, but ZAP occurs up to 48 hours after delivery.", "Rationale": "ZAP is intended to protect users that have received zero-day malware messages or content that is weaponized after being delivered to users. It does this by continually monitoring spam and malware signatures taking automated retroactive action on messages that have already been delivered.", "Impact": "As with any anti-malware or anti-phishing product false positives may occur.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Defender https://security.microsoft.com/ \n2. Click Settings > Email & collaboration > Microsoft Teams protection. \n3. Ensure Zero-hour auto purge (ZAP) is set to On (Default) \n4. Under Exclude these participants review the list of exclusions and ensure they \nare justified and within tolerance for the organization.", "To audit using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following cmdletsGet-TeamsProtectionPolicy | fl ZapEnabled \nGet-TeamsProtectionPolicyRule | fl ExceptIf* \n3. Ensure ZapEnabled is True. \n4. Review the list of exclusions and ensure they are justified and within tolerance for \nthe organization. If nothing returns from the 2nd cmdlet then there are no \nexclusions defined."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Defender https://security.microsoft.com/ \n2. Click Settings > Email & collaboration > Microsoft Teams protection. \n3. Set Zero-hour auto purge (ZAP) to On (Default)", "To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following cmdletSet-TeamsProtectionPolicy -Identity \"Teams Protection Policy\" -ZapEnabled \n$true"}, "Default_value": "On (Default) References: 1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/zero-hour-auto-purge?view=o365-worldwide#zero-hour-auto-purge-zap-in-microsoft-teams 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/mdo-support-teams-about?view=o365-worldwide#configure-zap-for-teams-protection-in-defender-for-office-365-plan-2", "pdf": "m365"}, {"Rule_number": "3.1.1", "Rule": "3.1.1 (L1) Ensure Microsoft 365 audit log search is Enabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "When audit log search is enabled in the Microsoft Purview compliance portal, user and admin activity within the organization is recorded in the audit log and retained for 90 days. However, some organizations may prefer to use a third-party security information and event management (SIEM) application to access their auditing data. In this scenario, a global admin can choose to turn off audit log search in Microsoft 365.", "Rationale": "Enabling audit log search in the Microsoft Purview compliance portal can help organizations improve their security posture, meet regulatory compliance requirements, respond to security incidents, and gain valuable operational insights. Audit: Ensure Microsoft 365 audit log search is Enabled: 1. Navigate to Microsoft Purview https://compliance.microsoft.com. 2. Select Audit to open the audit search. 3. Choose a date and time frame in the past 30 days. 4. Verify search capabilities (e.g. try searching for Activities as Accessed file and results should be displayed). To verify audit log search is enabled using PowerShell: 1. Connect to Exchange Online using Connect-ExchangeOnline. 2. Run the following PowerShell command: Get-AdminAuditLogConfig | Select-Object UnifiedAuditLogIngestionEnabled 3. Ensure UnifiedAuditLogIngestionEnabled is set to True.", "Impact": "As with any anti-malware or anti-phishing product false positives may occur.", "Audit": {"General Audit Instructions": "Ensure Microsoft 365 audit log search is Enabled1. Navigate to Microsoft Purview https://compliance.microsoft.com. \n2. Select Audit to open the audit search. \n3. Choose a date and time frame in the past 30 days. \n4. Verify search capabilities (e.g. try searching for Activities as Accessed file and \nresults should be displayed). \nTo verify audit log search is enabled using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-AdminAuditLogConfig | Select-Object UnifiedAuditLogIngestionEnabled \n3. Ensure UnifiedAuditLogIngestionEnabled is set to True."}, "Remediation": {"General Remediation Instructions": "To enable Microsoft 365 audit log search1. Navigate to Microsoft Purview https://compliance.microsoft.com. \n2. Select Audit to open the audit search. \n3. Click Start recording user and admin activity next to the information warning \nat the top. \n4. Click Yes on the dialog box to confirm. \nTo enable Microsoft 365 audit log search using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandSet-AdminAuditLogConfig -UnifiedAuditLogIngestionEnabled $true \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/compliance/audit-log-enable-\ndisable?view=o365-worldwide \n2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-\nadminauditlogconfig?view=exchange-ps \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging, per the enterprise\u2019s audit log \nmanagement process, has been enabled across enterprise assets. \n\u25cf \n\u25cf \n\u25cf \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n\u25cf \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "3.1.2", "Rule": "3.1.2 (L1) Ensure user role group changes are reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Role-Based Access Control allows for permissions to be assigned to users based on their roles within an organization. It is a more manageable form of access control that is less prone to errors. These user roles can be audited inside of Microsoft Purview to provide a security auditor insight into user privilege change.", "Rationale": "Weekly reviews provide an opportunity to identify rights changes in an organization and are a large part of maintaining Least Privilege and preventing Privilege creep. Insider Threats, either intentional or unintentional, can occur when a user has higher than needed privileges. Maintaining accountability of role membership will keep insiders and malicious actors limited in the scope of potential damaging activities.", "Impact": "By performing regular reviews, the Administrators assigning rights to users will need to inevitably provide justification for those changes to security auditors. Documentation that includes detailed policies, procedures, and change requests will need to be considered to keep a secure organization functioning within its planned operational level.", "Audit": {"General Audit Instructions": "To verify user role group changes are being reviewed at least weekly, confirm that the \nnecessary procedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review user role group changes1. Navigate to Microsoft Purview https://compliance.microsoft.com/. \n2. Under Solutions click on Audit then select New Search. \n3. In Activities find Added member to Role under the Role administration \nactivities section and select it. \n4. Set a valid Start Date and End Date within the last week. \n5. Click Search. \n6. Review once the search is completed. \nTo review user role group changes using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline \n2. Run the following Exchange Online PowerShell command$startDate = ((Get-date).AddDays(-7)).ToShortDateString() \n$endDate = (Get-date).ToShortDateString() \n \nSearch-UnifiedAuditLog -StartDate $startDate -EndDate $endDate -RecordType \nAzureActiveDirectory -Operations \"Add member to role.\" \n3. Review the output. \nReferences1. https://learn.microsoft.com/en-us/powershell/module/exchange/search-\nunifiedauditlog?view=exchange-ps \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.11 Conduct Audit Log Reviews \n \nConduct reviews of audit logs to detect anomalies or abnormal events that \ncould indicate a potential threat. Conduct reviews on a weekly, or more frequent, \nbasis. \n \n\u25cf \n\u25cf \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n\u25cf \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "3.2.1", "Rule": "3.2.1 (L1) Ensure DLP policies are enabled (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Data Loss Prevention (DLP) policies allow Exchange Online and SharePoint Online content to be scanned for specific types of data like social security numbers, credit card numbers, or passwords.", "Rationale": "Enabling DLP policies alerts users and administrators that specific types of data should not be exposed, helping to protect the data from accidental exposure.", "Impact": "Enabling a Teams DLP policy will allow sensitive data in Exchange Online and SharePoint Online to be detected or blocked. Always ensure to follow appropriate procedures during testing and implementation of DLP policies based on organizational standards.", "Audit": {"General Audit Instructions": "Ensure DLP policies are enabled1. Navigate to Microsoft Purview https://compliance.microsoft.com. \n2. Under Solutions select Data loss prevention then Policies. \n3. Verify that policies exist and are enabled."}, "Remediation": {"General Remediation Instructions": "To enable DLP policies1. Navigate to Microsoft Purview https://compliance.microsoft.com. \n2. Under Solutions select Data loss prevention then Policies. \n3. Click Create policy. \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/compliance/dlp-learn-about-\ndlp?view=o365-worldwide"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "3.2.2", "Rule": "3.2.2 (L1) Ensure DLP policies are enabled for Microsoft Teams (Manual)", "Profile_applicability": " E5 Level 1", "Description": "The default Teams Data Loss Prevention (DLP) policy rule in Microsoft 365 is a preconfigured rule that is automatically applied to all Teams conversations and channels. The default rule helps prevent accidental sharing of sensitive information by detecting and blocking certain types of content that are deemed sensitive or inappropriate by the organization. By default, the rule includes a check for the sensitive info type Credit Card Number which is pre-defined by Microsoft.", "Rationale": "Enabling the default Teams DLP policy rule in Microsoft 365 helps protect an organization's sensitive information by preventing accidental sharing or leakage Credit Card information in Teams conversations and channels. DLP rules are not one size fits all, but at a minimum something should be defined. The organization should identify sensitive information important to them and seek to intercept it using DLP.", "Impact": "End-users may be prevented from sharing certain types of content, which may require them to adjust their behavior or seek permission from administrators to share specific content. Administrators may receive requests from end-users for permission to share certain types of content or to modify the policy to better fit the needs of their teams.", "Audit": {"To audit using PowerShell": "1. Connect to the Security & Compliance PowerShell using Connect-IPPSSession. \n2. Run the following to return policies that include Teams chat and channel \nmessages$DlpPolicy = Get-DlpCompliancePolicy \n$DlpPolicy | Where-Object {$_.Workload -match \"Teams\"} |  \n    ft Name,Mode,TeamsLocation* \n3. If nothing returns then there are no policies that include Teams and remediation \nis required. \n4. For any returned policy verify Mode is set to Enable. \n5. Verify TeamsLocation includes All. \n6. Verify TeamsLocationException includes only permitted exceptions. \nNote: Some tenants may not have a default policy for teams as Microsoft started \ncreating these by default at a particular point in time. In this case a new policy will have \nto be created that includes a rule to protect data important to the organization such as \ncredit cards and PII."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Purview compliance portal \nhttps://compliance.microsoft.com. \n2. Under Solutions select Data loss prevention then Policies. \n3. Click Policies tab. \n4. Check Default policy for Teams then click Edit policy. \n5. The edit policy window will appear click Next \n6. At the Choose locations to apply the policy page, turn the status toggle to On \nfor Teams chat and channel messages location and then click Next. \n7. On Customized advanced DLP rules page, ensure the Default Teams DLP \npolicy rule Status is On and click Next. \n8. On the Policy mode page, select the radial for Turn it on right away and click \nNext. \n9. Review all the settings for the created policy on the Review your policy and \ncreate it page, and then click submit. \n10. \nOnce the policy has been successfully submitted click Done. \nNote: Some tenants may not have a default policy for teams as Microsoft started \ncreating these by default at a particular point in time. In this case a new policy will have \nto be created that includes a rule to protect data important to the organization such as \ncredit cards and PII."}, "Default_value": "Enabled (On) References: 1. https://learn.microsoft.com/en-us/powershell/exchange/connect-to-scc-powershell?view=exchange-ps 2. https://learn.microsoft.com/en-us/purview/dlp-teams-default-policy?view=o365-worldwide%2F1000 3. https://learn.microsoft.com/en-us/powershell/module/exchange/connect-ippssession?view=exchange-ps", "pdf": "m365"}, {"Rule_number": "3.3.1", "Rule": "3.3.1 (L1) Ensure SharePoint Online Information Protection policies are set up and used (Manual)", "Profile_applicability": " E3 Level 1", "Description": "SharePoint Online Data Classification Policies enables organizations to classify and label content in SharePoint Online based on its sensitivity and business impact. This setting helps organizations to manage and protect sensitive data by automatically applying labels to content, which can then be used to apply policy-based protection and governance controls.", "Rationale": "By categorizing and applying policy-based protection, SharePoint Online Data Classification Policies can help reduce the risk of data loss or exposure and enable more effective incident response if a breach does occur.", "Impact": "The creation of data classification policies is unlikely to have a significant impact on an organization. However, maintaining long-term adherence to policies may require ongoing training and compliance efforts across the organization. Therefore, organizations should include training and compliance planning as part of the data classification policy creation process.", "Audit": {"General Audit Instructions": "Ensure SharePoint Online Information Protection policies are set up and used1. Navigate to Microsoft Purview compliance portal \nhttps://compliance.microsoft.com. \n2. Under Solutions select Information protection. \n3. Click on the Label policies tab. \n4. Ensure that a Label policy exists and is published accordingly."}, "Remediation": {"General Remediation Instructions": "To set up SharePoint Online Information Protection1. Navigate to Microsoft Purview compliance portal \nhttps://compliance.microsoft.com. \n2. Under Solutions select Information protection. \n3. Click on the Label policies tab. \n4. Click Create a label to create a label. \n5. Select the label and click on the Publish label. \n6. Fill out the forms to create the policy. \nReferences1. https://learn.microsoft.com/en-us/microsoft-365/compliance/data-classification-\noverview?view=o365-worldwide#top-sensitivity-labels-applied-to-content \n2. https://learn.microsoft.com/en-us/purview/sensitivity-labels-sharepoint-onedrive-\nfiles \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.7 Establish and Maintain a Data Classification Scheme \n \nEstablish and maintain an overall data classification scheme for the enterprise. \nEnterprises may use labels, such as \u201cSensitive,\u201d \u201cConfidential,\u201d and \u201cPublic,\u201d and \nclassify their data according to those labels. Review and update the classification \nscheme annually, or when significant enterprise changes occur that could impact \nthis Safeguard. \n \n\u25cf \n\u25cf \nv7 \n13.1 Maintain an Inventory Sensitive Information \n \nMaintain an inventory of all sensitive information stored, processed, or \ntransmitted by the organization's technology systems, including those located \nonsite or at a remote service provider. \n\u25cf \n\u25cf \n\u25cf \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system, network share, claims, \napplication, or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n\u25cf \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.1.1.1", "Rule": "5.1.1.1 (L1) Ensure Security Defaults is disabled on Azure Active Directory (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Security defaults in Microsoft Entra ID make it easier to be secure and help protect the organization. Security defaults contain preconfigured security settings for common attacks. By default, Microsoft enables security defaults. The goal is to ensure that all organizations have a basic level of security enabled. The security default setting is manipulated in the Azure Portal. The use of security defaults, however, will prohibit custom settings which are being set with more advanced settings from this benchmark.", "Rationale": "Security defaults provide secure default settings that are managed on behalf of organizations to keep customers safe until they are ready to manage their own identity security settings. For example, doing the following: \u2022 Requiring all users and admins to register for MFA. \u2022 Challenging users with MFA - mostly when they show up on a new device or app, but more often for critical roles and tasks. \u2022 Disabling authentication from legacy authentication clients, which can\u2019t do MFA.", "Impact": "The potential impact associated with disabling of Security Defaults is dependent upon the security controls implemented in the environment. It is likely that most organizations disabling Security Defaults plan to implement equivalent controls to replace Security Defaults. It may be necessary to check settings in other Microsoft products, such as Azure, to ensure settings and functionality are as expected when disabling security defaults for MS365.", "Audit": {"General Audit Instructions": "Ensure security defaults is disabled1. Navigate to\u202fMicrosoft Entra admin center https://entra.microsoft.com. \n2. Click to expand\u202fIdentity select\u202fOverview \n3. Click Properties. \n4. Review the section Security Defaults near the bottom \n5. If Manage security defaults appears clickable then proceed to the remediation \nsection, otherwise read the note below. \nNOTE: If Manage Conditional Access appears in blue then Security defaults are already \ndisabled, and CA is in use. The audit can be considered a Pass. \n \nTo verify security defaults is disabled using Microsoft Graph PowerShell1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \n\"Policy.Read.All\". \n2. Run the following Microsoft Graph PowerShell commandGet-MgPolicyIdentitySecurityDefaultEnforcementPolicy | ft IsEnabled  \n3. If the value is false then Security Defaults is disabled."}, "Remediation": {"General Remediation Instructions": "To disable security defaults1. Navigate to the\u202fMicrosoft Entra admin center https://entra.microsoft.com. \n2. Click to expand\u202fIdentity select\u202fOverview \n3. Click Properties. \n4. Click Manage security defaults. \n5. Set the Security defaults dropdown to Disabled. \n6. Select Save. \nTo configure security defaults using Microsoft Graph PowerShell1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \n\"Policy.ReadWrite.ConditionalAccess\". \n2. Run the following Microsoft Graph PowerShell command$params = @{ IsEnabled = $false } \nUpdate-MgPolicyIdentitySecurityDefaultEnforcementPolicy -BodyParameter \n$params \nWarning: It is recommended not to disable security defaults until you are ready to \nimplement conditional access rules in the benchmark. Rules such as requiring MFA for \nall users and blocking legacy protocols are required in CA to make up for the gap \ncreated by disabling defaults. Plan accordingly. See the reference section for more \ndetails on what coverage Security Defaults provide."}, "Default_value": "Enabled. References: 1. https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/concept-fundamentals-security-defaults 2. https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-security-defaults/ba-p/1061414", "pdf": "m365"}, {"Rule_number": "5.1.2.1", "Rule": "5.1.2.1 (L1) Ensure 'Per-user MFA' is disabled (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Legacy per-user Multi-Factor Authentication (MFA) can be configured to require individual users to provide multiple authentication factors, such as passwords and additional verification codes, to access their accounts. It was introduced in earlier versions of Office 365, prior to the more comprehensive implementation of Conditional Access (CA).", "Rationale": "Both security defaults and conditional access with security defaults turned off are not compatible with per-user multi-factor authentication (MFA), which can lead to undesirable user authentication states. The CIS Microsoft 365 Benchmark explicitly employs Conditional Access for MFA as an enhancement over security defaults and as a replacement for the outdated per-user MFA. To ensure a consistent authentication state disable per-user MFA on all accounts.", "Impact": "Accounts using per-user MFA will need to be migrated to use CA. Prior to disabling per-user MFA the organization must be prepared to implement conditional access MFA to avoid security gaps and allow for a smooth transition. This will help ensure relevant accounts are covered by MFA during the change phase from disabling per-user MFA to enabling CA MFA. Section 5.2.2 in this document covers creating of a CA rule for both administrators and all users in the tenant. Microsoft has documentation on migrating from per-user MFA Convert users from per-user MFA to Conditional Access based MFA", "Audit": {"General Audit Instructions": "To audit per-user MFA using the UI1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Users select All users. \n3. Click on Per-user MFA on the top row. \n4. Ensure under the column Multi-factor Auth Status that each account is set to \nDisabled"}, "Remediation": {"General Remediation Instructions": "Disable per-user MFA using the UI1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Users select All users. \n3. Click on Per-user MFA on the top row. \n4. Click the empty box next to Display Name to select all accounts. \n5. On the far right under quick steps click Disable."}, "Default_value": "Disabled References: 1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-userstates#convert-users-from-per-user-mfa-to-conditional-access 2. https://learn.microsoft.com/en-us/microsoft-365/admin/security-and-compliance/set-up-multi-factor-authentication?view=o365-worldwide#use-conditional-access-policies 3. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-userstates#convert-per-user-mfa-enabled-and-enforced-users-to-disabled", "pdf": "m365"}, {"Rule_number": "5.1.2.2", "Rule": "5.1.2.2 (L2) Ensure third party integrated applications are not allowed (Automated)", "Profile_applicability": " E3 Level 2", "Description": "App registration allows users to register custom-developed applications for use within the directory.", "Rationale": "Third-party integrated applications connection to services should be disabled unless there is a very clear value and robust security controls are in place. While there are legitimate uses, attackers can grant access from breached accounts to third party applications to exfiltrate data from your tenancy without having to maintain the breached account.", "Impact": "Implementation of this change will impact both end users and administrators. End users will not be able to integrate third-party applications that they may wish to use. Administrators are likely to receive requests from end users to grant them permission to necessary third-party applications.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Users select Users settings. \n3. Verify Users can register applications is set to No.", "To audit using PowerShell": "1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.Read.All\" \n2. Run the following command(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions | fl \nAllowedToCreateApps \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Users select Users settings. \n3. Set Users can register applications to No. \n4. Click Save.", "To remediate using PowerShell": "1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \n\"Policy.ReadWrite.Authorization\" \n2. Run the following commands$param = @{ AllowedToCreateApps = \"$false\" } \nUpdate-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $param"}, "Default_value": "Yes (Users can register applications.) References: 1. https://learn.microsoft.com/en-us/azure/active-directory/develop/active-directory-how-applications-are-added", "pdf": "m365"}, {"Rule_number": "5.1.2.3", "Rule": "5.1.2.3 (L1) Ensure 'Restrict non-admin users from creating tenants' is set to 'Yes' (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Non-privileged users can create tenants in the Entra administration portal under Manage tenant. The creation of a tenant is recorded in the Audit log as category \"DirectoryManagement\" and activity \"Create Company\". Anyone who creates a tenant becomes the Global Administrator of that tenant. The newly created tenant doesn't inherit any settings or configurations.", "Rationale": "Restricting tenant creation prevents unauthorized or uncontrolled deployment of resources and ensures that the organization retains control over its infrastructure. User generation of shadow IT could lead to multiple, disjointed environments that can make it difficult for IT to manage and secure the organization's data, especially if other users in the organization began using these tenants for business purposes under the misunderstanding that they were secured by the organization's security team.", "Impact": "Non-admin users will need to contact I.T. if they have a valid reason to create a tenant.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity> Users > User settings. \n3. Ensure Restrict non-admin users from creating tenants is set to Yes", "To audit using PowerShell": "1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.Read.All\" \n2. Run the following commands(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions |  \n    Select-Object AllowedToCreateTenants \n3. Ensure the returned value is False"}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity> Users > User settings. \n3. Set Restrict non-admin users from creating tenants to Yes then Save.", "To remediate using PowerShell": "1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \n\"Policy.ReadWrite.Authorization\" \n2. Run the following commands. \n# Create hashtable and update the auth policy \n$params = @{ AllowedToCreateTenants = $false } \nUpdate-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions $params"}, "Default_value": "No - Non-administrators can create tenants. AllowedToCreateTenants is True References: 1. https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions#restrict-member-users-default-permissions", "pdf": "m365"}, {"Rule_number": "5.1.2.4", "Rule": "5.1.2.4 (L1) Ensure 'Restrict access to the Azure AD administration portal' is set to 'Yes' (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Restrict non-privileged users from signing into the Microsoft Entra admin center. Note: This recommendation only affects access to the web portal. It does not prevent privileged users from using other methods such as Rest API or PowerShell to obtain information. Those channels are addressed elsewhere in this document.", "Rationale": "The Microsoft Entra admin center contains sensitive data and permission settings, which are still enforced based on the user's role. However, an end user may inadvertently change properties or account settings that could result in increased administrative overhead. Additionally, a compromised end user account could be used by a malicious attacker as a means to gather additional information and escalate an attack. Note: Users will still be able to sign into Microsoft Entra admin center but will be unable to see directory information. Audit: To audit using the UI: 1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ 2. Click to expand Identity> Users > User settings. 3. Verify under the Administration center section that Restrict access to Microsoft Entra admin center is set to Yes Remediation: To remediate using the UI: 1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ 2. Click to expand Identity> Users > User settings. 3. Set Restrict access to Microsoft Entra admin center to Yes then Save. Default Value: No - Non-administrators can access the Microsoft Entra admin center.", "Impact": "Non-admin users will need to contact I.T. if they have a valid reason to create a tenant.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity> Users > User settings. \n3. Verify under the Administration center section that Restrict access to \nMicrosoft Entra admin center is set to Yes"}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity> Users > User settings. \n3. Set Restrict access to Microsoft Entra admin center to Yes then Save."}, "Default_value": "No - Non-administrators can access the Microsoft Entra admin center.", "pdf": "m365"}, {"Rule_number": "5.1.2.5", "Rule": "5.1.2.5 (L2) Ensure the option to remain signed in is hidden (Manual)", "Profile_applicability": " E3 Level 2", "Description": "The option for the user to Stay signed in, or the Keep me signed in option, will prompt a user after a successful login. When the user selects this option, a persistent refresh token is created. The refresh token lasts for 90 days by default and does not prompt for sign-in or multifactor.", "Rationale": "Allowing users to select this option presents risk, especially if the user signs into their account on a publicly accessible computer/web browser. In this case it would be trivial for an unauthorized person to gain access to any associated cloud data from that account.", "Impact": "Once this setting is hidden users will no longer be prompted upon sign-in with the message Stay signed in?. This may mean users will be forced to sign in more frequently. Important: some features of SharePoint Online and Office 2010 have a dependency on users remaining signed in. If you hide this option, users may get additional and unexpected sign in prompts.", "Audit": {"General Audit Instructions": "Ensure the option to remain signed in is hidden1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity> Users > User settings. \n3. Ensure Show keep user signed in is highlighted No."}, "Remediation": {"General Remediation Instructions": "To disable the option to remain signed in1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity> Users > User settings. \n3. Set Show keep user signed in to No. \n4. Click Save."}, "Default_value": "No - Non-administrators can access the Microsoft Entra admin center.", "pdf": "m365"}, {"Rule_number": "5.1.2.6", "Rule": "5.1.2.6 (L2) Ensure 'LinkedIn account connections' is disabled (Manual)", "Profile_applicability": " E3 Level 2", "Description": "LinkedIn account connections allow users to connect their Microsoft work or school account with LinkedIn. After a user connects their accounts, information and highlights from LinkedIn are available in some Microsoft apps and services.", "Rationale": "Disabling LinkedIn integration prevents potential phishing attacks and risk scenarios where an external party could accidentally disclose sensitive information.", "Impact": "Users will not be able to sync contacts or use LinkedIn integration.", "Audit": {"General Audit Instructions": "Ensure that LinkedIn account connections is disabled1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Users select User settings. \n3. Under LinkedIn account connections ensure No is highlighted."}, "Remediation": {"General Remediation Instructions": "To disable LinkedIn account connections1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Users select User settings. \n3. Under LinkedIn account connections select No. \n4. Click Save."}, "Default_value": "LinkedIn integration is enabled by default. References: 1. https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/linkedin-integration 2. https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/linkedin-user-consent", "pdf": "m365"}, {"Rule_number": "5.1.3.1", "Rule": "5.1.3.1 (L1) Ensure a dynamic group for guest users is created (Automated)", "Profile_applicability": " E3 Level 1", "Description": "A dynamic group is a dynamic configuration of security group membership for Microsoft Entra ID. Administrators can set rules to populate groups that are created in Entra ID based on user attributes (such as userType, department, or country/region). Members can be automatically added to or removed from a security group based on their attributes. The recommended state is to create a dynamic group that includes guest accounts.", "Rationale": "Dynamic groups allow for an automated method to assign group membership. Guest user accounts will be automatically added to this group and through this existing conditional access rules, access controls and other security measures will ensure that new guest accounts are restricted in the same manner as existing guest accounts. Audit: Ensure a dynamic guest group is created: 1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. 2. Click to expand Identity > Groups select All groups. 3. On the right of the search field click Add filter. 4. Set Filter to Membership type and Value to Dynamic then apply. 5. Identify a dynamic group and select it. 6. Under manage, select Dynamic membership rules and ensure the rule syntax contains (user.userType -eq \"Guest\") 7. If necessary, inspect other dynamic groups for the value above. Using PowerShell: 1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Group.Read.All\" 2. Run the following commands: $groups = Get-MgGroup | Where-Object { $_.GroupTypes -contains \"DynamicMembership\" } $groups | ft DisplayName,GroupTypes,MembershipRule 3. Look for a dynamic group containing the rule (user.userType -eq \"Guest\")", "Impact": "Users will not be able to sync contacts or use LinkedIn integration.", "Audit": {"General Audit Instructions": "Ensure a dynamic guest group is created1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Groups select All groups. \n3. On the right of the search field click Add filter. \n4. Set Filter to Membership type and Value to Dynamic then apply. \n5. Identify a dynamic group and select it. \n6. Under manage, select Dynamic membership rules and ensure the rule syntax \ncontains (user.userType -eq \"Guest\") \n7. If necessary, inspect other dynamic groups for the value above. \nUsing PowerShell1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Group.Read.All\" \n2. Run the following commands$groups = Get-MgGroup | Where-Object { $_.GroupTypes -contains \n\"DynamicMembership\" } \n$groups | ft DisplayName,GroupTypes,MembershipRule \n3. Look for a dynamic group containing the rule (user.userType -eq \"Guest\")"}, "Remediation": {"General Remediation Instructions": "Create a dynamic guest group1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Groups select All groups. \n3. Select New group and assign the following valueso Group type: Security \no Microsoft Entra roles can be assigned to the group: No \no Membership type: Dynamic User \n4. Select Add dynamic query. \n5. Above the Rule syntax text box, select Edit. \n6. Place the following expression in the box(user.userType -eq \"Guest\") \n7. Select OK and Save \nUsing PowerShell1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \n\"Group.ReadWrite.All\" \n2. In the script below edit DisplayName and MailNickname as needed and run$params = @{ \n     DisplayName                   = \"Dynamic Test Group\" \n     MailNickname                  = \"DynGuestUsers\" \n     MailEnabled                   = $false \n     SecurityEnabled               = $true \n     GroupTypes                    = \"DynamicMembership\" \n     MembershipRule                = '(user.userType -eq \"Guest\")' \n     MembershipRuleProcessingState = \"On\" \n} \n \nNew-MgGroup @params"}, "Default_value": "Undefined References: 1. https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/groups-create-rule 2. https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/groups-dynamic-membership 3. https://learn.microsoft.com/en-us/azure/active-directory/external-identities/use-dynamic-groups", "pdf": "m365"}, {"Rule_number": "5.1.5.1", "Rule": "5.1.5.1 (L1) Ensure the Application Usage report is reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "The Application Usage report includes a usage summary for all Software as a Service (SaaS) applications that are integrated with the organization's directory.", "Rationale": "Review the list of app registrations on a regular basis to look for risky apps that users have enabled that could cause data spillage or accidental elevation of privilege. Attackers can often get access to data illicitly through third-party SaaS applications. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To review the Application Usage report: 1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. 2. Click to expand Identity > Applications select Enterprise applications. 3. Under Activity select Usage & insights. 4. Review the information. CIS Controls: Controls Version Control IG 1 IG 2 IG 3 v8 8.11 Conduct Audit Log Reviews  Conduct reviews of audit logs to detect anomalies or abnormal events that could indicate a potential threat. Conduct reviews on a weekly, or more frequent, basis.  \u25cf \u25cf v7 6.2 Activate audit logging  Ensure that local logging has been enabled on all systems and networking devices. \u25cf \u25cf \u25cf", "Impact": "Users will not be able to sync contacts or use LinkedIn integration.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review the Application Usage report1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Applications select Enterprise applications. \n3. Under Activity select Usage & insights. \n4. Review the information. \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.11 Conduct Audit Log Reviews \n \nConduct reviews of audit logs to detect anomalies or abnormal events that \ncould indicate a potential threat. Conduct reviews on a weekly, or more frequent, \nbasis. \n \n\u25cf \n\u25cf \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n\u25cf \n\u25cf \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.1.5.2", "Rule": "5.1.5.2 (L2) Ensure user consent to apps accessing company data on their behalf is not allowed (Automated)", "Profile_applicability": " E3 Level 2", "Description": "Control when end users and group owners are allowed to grant consent to applications, and when they will be required to request administrator review and approval. Allowing users to grant apps access to data helps them acquire useful applications and be productive but can represent a risk in some situations if it's not monitored and controlled carefully.", "Rationale": "Attackers commonly use custom applications to trick users into granting them access to company data. Disabling future user consent operations setting mitigates this risk, and helps to reduce the threat-surface. If user consent is disabled previous consent grants will still be honored but all future consent operations must be performed by an administrator.", "Impact": "If user consent is disabled, previous consent grants will still be honored but all future consent operations must be performed by an administrator. Tenant-wide admin consent can be requested by users through an integrated administrator consent request workflow or through organizational support processes.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Applications select Enterprise applications. \n3. Under Security select Consent and permissions > User consent settings. \n4. Verify User consent for applications is set to Do not allow user consent.", "To audit using PowerShell": "1. Connect to Microsoft Graph using Connect-MgGraph -Scopes \"Policy.Read.All\" \n2. Run the following command(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions |  \n    Select-Object -ExpandProperty PermissionGrantPoliciesAssigned \n3. Ensure ManagePermissionGrantsForSelf.microsoft-user-default-low is not \npresent OR that nothing is returned."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Applications select Enterprise applications. \n3. Under Security select Consent and permissions > User consent settings. \n4. Under User consent for applications select Do not allow user consent. \n5. Click the Save option at the top of the window."}, "Default_value": "UI - Allow user consent for apps References: 1. https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/configure-user-consent?tabs=azure-portal&pivots=portal", "pdf": "m365"}, {"Rule_number": "5.1.5.3", "Rule": "5.1.5.3 (L1) Ensure the admin consent workflow is enabled (Manual)", "Profile_applicability": " E3 Level 1", "Description": "The admin consent workflow gives admins a secure way to grant access to applications that require admin approval. When a user tries to access an application but is unable to provide consent, they can send a request for admin approval. The request is sent via email to admins who have been designated as reviewers. A reviewer takes action on the request, and the user is notified of the action.", "Rationale": "The admin consent workflow (Preview) gives admins a secure way to grant access to applications that require admin approval. When a user tries to access an application but is unable to provide consent, they can send a request for admin approval. The request is sent via email to admins who have been designated as reviewers. A reviewer acts on the request, and the user is notified of the action.", "Impact": "To approve requests, a reviewer must be a global administrator, cloud application administrator, or application administrator. The reviewer must already have one of these admin roles assigned; simply designating them as a reviewer doesn't elevate their privileges.", "Audit": {"General Audit Instructions": "Ensure the admin consent workflow is enabled1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Applications select Enterprise applications. \n3. Under Security select Consent and permissions. \n4. Under Manage select Admin consent settings. \n5. Verify that Users can request admin consent to apps they are unable to \nconsent to is set to Yes."}, "Remediation": {"General Remediation Instructions": "To enable the admin consent workflow, use the Microsoft 365 Admin Center1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Applications select Enterprise applications. \n3. Under Security select Consent and permissions. \n4. Under Manage select Admin consent settings. \n5. Set Users can request admin consent to apps they are unable to consent \nto to Yes under Admin consent requests. \n6. Under the Reviewers choose the Roles and Groups that will review user \ngenerated app consent requests. \n7. Set Selected users will receive email notifications for requests to Yes \n8. Select Save at the top of the window."}, "Default_value": "\u2022 Users can request admin consent to apps they are unable to consent to: No  \u2022 Selected users to review admin consent requests: None  \u2022 Selected users will receive email notifications for requests: Yes  \u2022 Selected users will receive request expiration reminders: Yes  \u2022 Consent request expires after (days): 30  References: 1. https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/configure-admin-consent-workflow", "pdf": "m365"}, {"Rule_number": "5.1.6.1", "Rule": "5.1.6.1 (L2) Ensure that collaboration invitations are sent to allowed domains only (Manual)", "Profile_applicability": " E3 Level 2", "Description": "B2B collaboration is a feature within Microsoft Entra External ID that allows for guest invitations to an organization. Ensure users can only send invitations to specified domains. NOTE: This list works independently from OneDrive for Business and SharePoint Online allow/block lists. To restrict individual file sharing in SharePoint Online, set up an allow or blocklist for OneDrive for Business and SharePoint Online. For instance, in SharePoint or OneDrive users can still share with external users from prohibited domains by using Anyone links if they haven't been disabled.", "Rationale": "By specifying allowed domains for collaborations, external user\u2019s companies are explicitly identified. Also, this prevents internal users from inviting unknown external users such as personal accounts and granting them access to resources.", "Impact": "This could make harder collaboration if the setting is not quickly updated when a new domain is identified as \"allowed\".", "Audit": {"General Audit Instructions": "Ensure that collaboration invitations are sent to allowed domains only1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > External Identities select External collaboration \nsettings. \n3. Under Collaboration restrictions, verify that Allow invitations only to the \nspecified domains (most restrictive) is selected. Then verify allowed \ndomains are specified under Target domains."}, "Remediation": {"General Remediation Instructions": "To restrict collaboration invitations only to the specified domains1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > External Identities select External collaboration \nsettings. \n3. Under Collaboration restrictions, select Allow invitations only to the \nspecified domains (most restrictive) is selected. Then specify the allowed \ndomains under Target domains."}, "Default_value": "Allow invitations to be sent to any domain (most inclusive) References: 1. https://learn.microsoft.com/en-us/azure/active-directory/external-identities/allow-deny-list 2. https://learn.microsoft.com/en-us/azure/active-directory/external-identities/what-is-b2b", "pdf": "m365"}, {"Rule_number": "5.1.8.1", "Rule": "5.1.8.1 (L1) Ensure that password hash sync is enabled for hybrid deployments (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Password hash synchronization is one of the sign-in methods used to accomplish hybrid identity synchronization. Microsoft Entra Connect synchronizes a hash, of the hash, of a user's password from an on-premises Active Directory instance to a cloud-based Entra ID instance. Note: Audit and remediation procedures in this recommendation only apply to Microsoft 365 tenants operating in a hybrid configuration using Entra Connect sync.", "Rationale": "Password hash synchronization helps by reducing the number of passwords your users need to maintain to just one and enables leaked credential detection for your hybrid accounts. Leaked credential protection is leveraged through Entra ID Protection and is a subset of that feature which can help identify if an organization's user account passwords have appeared on the dark web or public spaces. Using other options for your directory synchronization may be less resilient as Microsoft can still process sign-ins to 365 with Hash Sync even if a network connection to your on-premises environment is not available.", "Impact": "Compliance or regulatory restrictions may exist, depending on the organization's business sector, that preclude hashed versions of passwords from being securely transmitted to cloud data centers.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity > Hybrid management > Microsoft Entra Connect. \n3. Select Connect Sync \n4. Under Microsoft Entra Connect sync, verify Password Hash Sync is Enabled. \nTo audit for the on-prem tool1. Log in to the server that hosts the Microsoft Entra Connect tool. \n2. Run Azure AD Connect, and then click Configure and View or export current \nconfiguration. \n3. Determine whether PASSWORD HASH SYNCHRONIZATION is enabled on your tenant. \nThis information is also available via the Microsoft Graph Security APIGET https://graph.microsoft.com/beta/security/secureScores", "To audit using PowerShell": "1. Connect to the Microsoft Graph service using Connect-MgGraph -Scopes \n\"Organization.Read.All\". \n2. Run the following Microsoft Graph PowerShell commandGet-MgOrganization | ft OnPremisesSyncEnabled \n3. If nothing returns then password sync is not enabled for the on premises AD."}, "Remediation": {"General Remediation Instructions": "To setup Password Hash Sync, use the following steps1. Log in to the on premises server that hosts the Microsoft Entra Connect tool \n2. Double-click the Azure AD Connect icon that was created on the desktop \n3. Click Configure. \n4. On the Additional tasks page, select Customize synchronization options and \nclick Next. \n5. Enter the username and password for your global administrator. \n6. On the Connect your directories screen, click Next. \n7. On the Domain and OU filtering screen, click Next. \n8. On the Optional features screen, check Password hash synchronization and \nclick Next. \n9. On the Ready to configure screen click Configure. \n10. \nOnce the configuration completes, click Exit."}, "Default_value": "Allow invitations to be sent to any domain (most inclusive) References: 1. https://learn.microsoft.com/en-us/azure/active-directory/external-identities/allow-deny-list 2. https://learn.microsoft.com/en-us/azure/active-directory/external-identities/what-is-b2b", "pdf": "m365"}, {"Rule_number": "5.2.2.1", "Rule": "5.2.2.1 (L1) Ensure multifactor authentication is enabled for all users in administrative roles (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Multifactor authentication is a process that requires an additional form of identification during the sign-in process, such as a code from a mobile device or a fingerprint scan, to enhance security. Ensure users in administrator roles have MFA capabilities enabled.", "Rationale": "Multifactor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Multifactor authentication provides additional assurance that the individual attempting to gain access is who they claim to be. With multifactor authentication, an attacker would need to compromise at least two different authentication mechanisms, increasing the difficulty of compromise and thus reducing the risk.", "Impact": "Implementation of multifactor authentication for all users in administrative roles will necessitate a change to user routine. All users in administrative roles will be required to enroll in multifactor authentication using phone, SMS, or an authentication application. After enrollment, use of multifactor authentication will be required for future access to the environment.", "Audit": {"To audit using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click to expand Protection > Conditional Access select Policies. \n3. Review the list of policies and ensure that there is a policy meeting at least the \nfollowing criteriao Users: Include: Directory roles specific to administrators are selected. \no Target resources: All cloud apps. \no Grant: Grant access with Require multifactor authentication checked. \n4. Ensure Enable policy is set to On.", "To audit using SecureScore:": "1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Select Secure score. \n3. Select Recommended actions. \n4. Click on Ensure multifactor authentication is enabled for all users in \nadministrative roles. \n5. Review the number of Admin users who do not have MFA configured. \nThis information is also available via the Microsoft Graph Security APIGET https://graph.microsoft.com/beta/security/secureScores \nNote: A list of required Directory roles can be found in the"}, "Remediation": {"To remediate using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Click New policy. \n4. Go to Assignments > Users and groups > Include > Select users and groups > check Directory roles. \n5. At a minimum, select the Directory roles listed below in this section of the \ndocument. \n6. Go to Cloud apps or actions > Cloud apps > Include > select All cloud apps \n(and don't exclude any apps). \n7. Under Access controls > Grant > select Grant access > check Require multi-\nfactor authentication. \n8. Set Enable policy to Report-only or On. \n9. Create. \nAt minimum these directory roles should be included for MFA\n\u2022 \nApplication administrator \n\u2022Authentication administrator \n\u2022Billing administrator \n\u2022Cloud application administrator \n\u2022Conditional Access administrator \n\u2022Exchange administrator \n\u2022Global administrator \n\u2022Global reader \n\u2022Helpdesk administrator \n\u2022Password administrator \n\u2022Privileged authentication administrator \n\u2022Privileged role administrator \n\u2022Security administrator \n\u2022SharePoint administrator \n\u2022User administrator \nNote: Report-only is an acceptable first stage when introducing any CA policy. The \ncontrol, however, is not complete until the policy is on. \nReferences1. https://learn.microsoft.com/en-us/graph/api/resources/security-api-\noverview?view=graph-rest-beta"}, "Default_value": "\u2022 Microsoft Entra Connect sync disabled by default \u2022 Password Hash Sync is Microsoft's recommended setting for new deployments References: 1. https://learn.microsoft.com/en-us/azure/active-directory/hybrid/whatis-phs 2. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/concept-identity-protection-risks#user-linked-detections 3. https://www.microsoft.com/en-us/download/details.aspx?id=47594", "pdf": "m365"}, {"Rule_number": "5.2.2.2", "Rule": "5.2.2.2 (L1) Ensure multifactor authentication is enabled for all users (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Enable multifactor authentication for all users in the Microsoft 365 tenant. Users will be prompted to authenticate with a second factor upon logging in to Microsoft 365 services. The second factor is most commonly a text message to a registered mobile phone number where they type in an authorization code, or with a mobile application like Microsoft Authenticator.", "Rationale": "Multifactor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Multifactor authentication provides additional assurance that the individual attempting to gain access is who they claim to be. With multifactor authentication, an attacker would need to compromise at least two different authentication mechanisms, increasing the difficulty of compromise and thus reducing the risk.", "Impact": "Implementation of multifactor authentication for all users will necessitate a change to user routine. All users will be required to enroll in multifactor authentication using phone, SMS, or an authentication application. After enrollment, use of multifactor authentication will be required for future authentication to the environment. Note: Organizations that have difficulty enforcing MFA globally due lack of the budget to provide company owned mobile devices to every user, or equally are unable to force end users to use their personal devices due to regulations, unions, or policy have another option. FIDO2 Security keys may be used as a stand in for this recommendation. They are more secure, phishing resistant, and are affordable for an organization to issue to every end user.", "Audit": {"To audit using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Review the list of policies and ensure that there is a policy meeting at least the \nfollowing criteriao Users: Include: All users. \no Target resources: All cloud apps. \no Grant: Grant access with Require multifactor authentication checked. \n4. Ensure Enable policy is set to On.", "To audit using SecureScore:": "1. Navigate to Microsoft 365 Defender https://security.microsoft.com. \n2. Select Secure score. \n3. Select Recommended actions. \n4. Click on Ensure multifactor authentication is enabled for all users. \n5. Review the list of users who do not have MFA configured."}, "Remediation": {"To remediate using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Click New policy. \n4. Go to Assignments > Users and groups > Include > select All users (and do not \nexclude any user). \n5. Select Cloud apps or actions > All cloud apps (and don't exclude any apps). \n6. Access Controls > Grant > Require multi-factor authentication. \n7. Set Enable policy to Report-only or On. \n8. Create. \nNote: Report-only is an acceptable first stage when introducing any CA policy. The \ncontrol, however, is not complete until the policy is on."}, "Default_value": "Disabled References: 1. https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa", "pdf": "m365"}, {"Rule_number": "5.2.2.3", "Rule": "5.2.2.3 (L1) Enable Conditional Access policies to block legacy authentication (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Entra ID supports the most widely used authentication and authorization protocols including legacy authentication. This authentication pattern includes basic authentication, a widely used industry-standard method for collecting username and password information. The following messaging protocols support legacy authentication: \u2022 Authenticated SMTP - Used to send authenticated email messages. \u2022 Autodiscover - Used by Outlook and EAS clients to find and connect to mailboxes in Exchange Online. \u2022 Exchange ActiveSync (EAS) - Used to connect to mailboxes in Exchange Online. \u2022 Exchange Online PowerShell - Used to connect to Exchange Online with remote PowerShell. If you block Basic authentication for Exchange Online PowerShell, you need to use the Exchange Online PowerShell Module to connect. For instructions, see Connect to Exchange Online PowerShell using multifactor authentication. \u2022 Exchange Web Services (EWS) - A programming interface that's used by Outlook, Outlook for Mac, and third-party apps. \u2022 IMAP4 - Used by IMAP email clients. \u2022 MAPI over HTTP (MAPI/HTTP) - Primary mailbox access protocol used by Outlook 2010 SP2 and later. \u2022 Offline Address Book (OAB) - A copy of address list collections that are downloaded and used by Outlook. \u2022 Outlook Anywhere (RPC over HTTP) - Legacy mailbox access protocol supported by all current Outlook versions. \u2022 POP3 - Used by POP email clients. \u2022 Reporting Web Services - Used to retrieve report data in Exchange Online. \u2022 Universal Outlook - Used by the Mail and Calendar app for Windows 10. \u2022 Other clients - Other protocols identified as utilizing legacy authentication.", "Rationale": "Legacy authentication protocols do not support multi-factor authentication. These protocols are often used by attackers because of this deficiency. Blocking legacy authentication makes it harder for attackers to gain access.", "Impact": "Enabling this setting will prevent users from connecting with older versions of Office, ActiveSync or using protocols like IMAP, POP or SMTP and may require upgrades to older versions of Office, and use of mobile mail clients that support modern authentication. This will also cause multifunction devices such as printers from using scan to e-mail function if they are using a legacy authentication method. Microsoft has mail flow best practices in the link below which can be used to configure a MFP to work with modern authentication: https://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/how-to-set-up-a-multifunction-device-or-application-to-send-email-using-microsoft-365-or-office-365", "Audit": {"General Audit Instructions": "Ensure a Conditional Access policy to block legacy authentication is enabled1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Verify that either the policy Baseline policy: Block legacy authentication is \nset to On or find another with the following settings enabledo Under Conditions then Client apps ensure the settings are enabled for \nand Exchange ActiveSync clients and other clients. \no Under Access controls ensure the Grant is set to Block access \no Under Assignments ensure All users is enabled \no Under Assignments and Users and groups ensure the Exclude is set to \nleast one low risk account or directory role. This is required as a best \npractice. \nThis information is also available via the Microsoft Graph Security APIGET https://graph.microsoft.com/beta/security/secureScores"}, "Remediation": {"General Remediation Instructions": "To setup a conditional access policy to block legacy authentication, use the \nfollowing steps1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Create a new policy by selecting New policy. \n4. Set the following conditions within the policy. \no Select Conditions then Client apps enable the settings for and Exchange \nActiveSync clients and other clients. \no Under Access controls set the Grant section to Block access \no Under Assignments enable All users \no Under Assignments and Users and groups set the Exclude to be at least \none low risk account or directory role. This is required as a best practice."}, "Default_value": "Basic authentication is disabled by default as of January 2023. References: 1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/disable-basic-authentication-in-exchange-online 2. https://learn.microsoft.com/en-us/exchange/mail-flow-best-practices/how-to-set-up-a-multifunction-device-or-application-to-send-email-using-microsoft-365-or-office-365 3. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/deprecation-of-basic-authentication-exchange-online", "pdf": "m365"}, {"Rule_number": "5.2.2.4", "Rule": "5.2.2.4 (L1) Ensure Sign-in frequency is enabled and browser sessions are not persistent for Administrative users (Manual)", "Profile_applicability": " E3 Level 1", "Description": "In complex deployments, organizations might have a need to restrict authentication sessions. Conditional Access policies allow for the targeting of specific user accounts. Some scenarios might include: \u2022 Resource access from an unmanaged or shared device \u2022 Access to sensitive information from an external network \u2022 High-privileged users \u2022 Business-critical applications Ensure Sign-in frequency does not exceed 4 hours for E3 tenants, or 24 hours for E5 tenants using Privileged Identity Management. Ensure Persistent browser session is set to Never persist NOTE: This CA policy can be added to the previous CA policy in this benchmark \"Ensure multifactor authentication is enabled for all users in administrative roles\"", "Rationale": "Forcing a time out for MFA will help ensure that sessions are not kept alive for an indefinite period of time, ensuring that browser sessions are not persistent will help in prevention of drive-by attacks in web browsers, this also prevents creation and saving of session cookies leaving nothing for an attacker to take.", "Impact": "Users with Administrative roles will be prompted at the frequency set for MFA.", "Audit": {"General Audit Instructions": "Ensure Sign-in frequency is enabled and browser sessions are not persistent for \nAdministrative users1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection > Conditional Access Select Policies. \n3. Review the list of policies and ensure that there is a policy that have Sign-in \nfrequency set to the time determined by your organization and that Persistent \nbrowser session is set to Never persistent. \n4. Ensure Sign-in frequency does not exceed 4 hours for E3 tenants. E5 tenants \nusing PIM may be set to a maximum of 24 hours. \n\u2022A list of directory role applying to Administrators can be found in the \nremediation section."}, "Remediation": {"Enable Policy select On and click Save \nAt minimum these directory roles should be included for MFA:": "\n\u2022 \nApplication administrator \n\u2022Authentication administrator \n\u2022Billing administrator \n\u2022Cloud application administrator \n\u2022Conditional Access administrator \n\u2022Exchange administrator \n\u2022Global administrator \n\u2022Global reader \n\u2022Helpdesk administrator \n\u2022Password administrator \n\u2022Privileged authentication administrator \n\u2022Privileged role administrator \n\u2022Security administrator \n\u2022SharePoint administrator \n\u2022User administrator"}, "Default_value": "The default configuration for user sign-in frequency is a rolling window of 90 days.", "pdf": "m365"}, {"Rule_number": "5.2.2.5", "Rule": "5.2.2.5 (L2) Ensure 'Phishing-resistant MFA strength' is required for Administrators (Manual)", "Profile_applicability": " E3 Level 2", "Description": "Authentication strength is a Conditional Access control that allows administrators to specify which combination of authentication methods can be used to access a resource. For example, they can make only phishing-resistant authentication methods available to access a sensitive resource. But to access a non-sensitive resource, they can allow less secure multifactor authentication (MFA) combinations, such as password + SMS. Microsoft has 3 built-in authentication strengths. MFA strength, Passwordless MFA strength, and Phishing-resistant MFA strength. Ensure administrator roles are using a CA policy with Phishing-resistant MFA strength. Administrators can then enroll using one of 3 methods: \u2022 FIDO2 Security Key \u2022 Windows Hello for Business \u2022 Certificate-based authentication (Multi-Factor) Note: Additional steps to configure methods such as FIDO2 keys are not covered here but can be found in related MS articles in the references section. The Conditional Access policy only ensures 1 of the 3 methods is used. Warning: Administrators should be pre-registered for a strong authentication mechanism before this Conditional Access Policy is enforced. Additionally, as stated elsewhere in the CIS Benchmark a break-glass administrator account should be excluded from this policy to ensure unfettered access in the case of an emergency.", "Rationale": "Sophisticated attacks targeting MFA are more prevalent as the use of it becomes more widespread. These 3 methods are considered phishing-resistant as they remove passwords from the login workflow. It also ensures that public/private key exchange can only happen between the devices and a registered provider which prevents login to fake or phishing websites.", "Impact": "If administrators aren't pre-registered for a strong authentication method prior to a conditional access policy being created, then a condition could occur where a user can't register for strong authentication because they don't meet the conditional access policy requirements and therefore are prevented from signing in. Additionally, Internet Explorer based credential prompts in PowerShell do not support prompting for a security key. Implementing phishing-resistant MFA with a security key may prevent admins from running their existing sets of PowerShell scripts. Device Authorization Grant Flow can be used as a workaround in some instances.", "Audit": {"To audit using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Review the list of policies and ensure that there is a policy with the Grant access \ncontrol set to Require authentication strength (Preview): Phishing-\nresistant MFA \n4. Ensure the above policy conforms to these settingso \nUsers > Include > Select users and groups > Directory Roles to include \nat minimum the roles listed in the remediation section. Cloud apps or actions > All cloud apps Grant > Grant Access with Require authentication strength (Preview)Phishing-resistant MFA set. \n5. The policy is set to On."}, "Remediation": {"To remediate using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Click New policy. \n4. Go to Users > Users and groups > Include > Select users and groups > Directory roles \n5. Add at least the Directory roles listed after these steps. \n6. Select Cloud apps or actions > All cloud apps (and don't exclude any apps). \n7. Grant > Grant Access with Require authentication strength (Preview)Phishing-resistant MFA \n8. Click `Select' \n9. Set Enable policy to Report-only and click Create \nAt minimum these directory roles should be included for the policy\n\u2022 \nApplication administrator \n\u2022Authentication administrator \n\u2022Billing administrator \n\u2022Cloud application administrator \n\u2022Conditional Access administrator \n\u2022Exchange administrator \n\u2022Global administrator \n\u2022Global reader \n\u2022Helpdesk administrator \n\u2022Password administrator \n\u2022Privileged authentication administrator \n\u2022Privileged role administrator \n\u2022Security administrator \n\u2022SharePoint administrator \n\u2022User administrator \nWarning: Ensure administrators are pre-registered with strong authentication before \nenforcing the policy. After which the policy must be set to On. \nReferences1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-\nauthentication-passwordless#fido2-security-keys \n2. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-\nauthentication-passwordless-security-key \n3. https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-\nauthentication-strengths \n4. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/howto-\nidentity-protection-configure-mfa-policy"}, "Default_value": "The default configuration for user sign-in frequency is a rolling window of 90 days.", "pdf": "m365"}, {"Rule_number": "5.2.2.6", "Rule": "5.2.2.6 (L2) Enable Azure AD Identity Protection user risk policies (Manual)", "Profile_applicability": " E5 Level 2", "Description": "Microsoft Entra ID Protection user risk policies detect the probability that a user account has been compromised. Note: While Identity Protection also provides two risk policies with limited conditions, Microsoft highly recommends setting up risk-based policies in Conditional Access as opposed to the \"legacy method\" for the following benefits: \u2022 Enhanced diagnostic data \u2022 Report-only mode integration \u2022 Graph API support \u2022 Use more Conditional Access attributes like sign-in frequency in the policy", "Rationale": "With the user risk policy turned on, Entra ID protection detects the probability that a user account has been compromised. Administrators can configure a user risk conditional access policy to automatically respond to a specific user risk level.", "Impact": "Upon policy activation, account access will be either blocked or the user will be required to use multi-factor authentication (MFA) and change their password. Users without registered MFA will be denied access, necessitating an admin to recover the account. To avoid inconvenience, it is advised to configure the MFA registration policy for all users under the User Risk policy. Additionally, users identified in the Risky Users section will be affected by this policy. To gain a better understanding of the impact on the organization's environment, the list of Risky Users should be reviewed before enforcing the policy.", "Audit": {"General Audit Instructions": "Ensure a user risk policy is enabled1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Ensure that a policy exist with the following characteristics and is set to Ono Under Users or workload identities choose All users \no Under Cloud apps or actions choose All cloud apps \no Under Conditions choose User risk then Yes is set to High. \no Under Access Controls select Grant then in the right pane click Grant \naccess, then select Require multifactor authentication and Require \npassword change. \no Under Session ensure Sign-in frequency is set to Every time."}, "Remediation": {"General Remediation Instructions": "To configure a User risk policy, use the following steps1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Create a new policy by selecting New policy. \n4. Set the following conditions within the policyo Under Users or workload identities choose All users \no Under Cloud apps or actions choose All cloud apps \no Under Conditions choose User risk then Yes and select the user risk \nlevel High. \no Under Access Controls select Grant then in the right pane click Grant \naccess then select Require multifactor authentication and Require \npassword change. \no Under Session ensure Sign-in frequency is set to Every time. \n5. Click Select. \n6. You may opt to begin in a state of Report Only as you step through \nimplementation however, the policy will need to be set to On to be in effect. \n7. Click Create. \nNOTE: for more information regarding risk levels refer to Microsoft's Identity Protection \n& Risk Doc \nReferences1. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/howto-\nidentity-protection-risk-feedback \n2. https://learn.microsoft.com/en-us/azure/active-directory/identity-\nprotection/concept-identity-protection-risks"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.2.2.7", "Rule": "5.2.2.7 (L2) Enable Azure AD Identity Protection sign-in risk policies (Manual)", "Profile_applicability": " E5 Level 2", "Description": "Microsoft Entra ID Protection sign-in risk detects risks in real-time and offline. A risky sign-in is an indicator for a sign-in attempt that might not have been performed by the legitimate owner of a user account. Note: While Identity Protection also provides two risk policies with limited conditions, Microsoft highly recommends setting up risk-based policies in Conditional Access as opposed to the \"legacy method\" for the following benefits: \u2022 Enhanced diagnostic data \u2022 Report-only mode integration \u2022 Graph API support \u2022 Use more Conditional Access attributes like sign-in frequency in the policy", "Rationale": "Turning on the sign-in risk policy ensures that suspicious sign-ins are challenged for multi-factor authentication.", "Impact": "When the policy triggers, the user will need MFA to access the account. In the case of a user who hasn't registered MFA on their account, they would be blocked from accessing their account. It is therefore recommended that the MFA registration policy be configured for all users who are a part of the Sign-in Risk policy.", "Audit": {"General Audit Instructions": "To ensure Sign-In a risk policy is enabled1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Ensure that a policy exist with the following characteristics and is set to Ono Under Users or workload identities choose All users \no Under Cloud apps or actions choose All cloud apps \no Under Conditions choose Sign-in risk then Yes ensuring High and \nMedium are selected. \no Under Access Controls select Grant then in the right pane click Grant \naccess then select Require multifactor authentication. \no Under Session select Sign-in Frequency is set to Every time."}, "Remediation": {"General Remediation Instructions": "To configure a Sign-In risk policy, use the following steps1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Create a new policy by selecting New policy. \n4. Set the following conditions within the policy. \no Under Users or workload identities choose All users \no Under Cloud apps or actions choose All cloud apps \no Under Conditions choose Sign-in risk then Yes and check the risk level \nboxes High and Medium \no Under Access Controls select Grant then in the right pane click Grant \naccess then select Require multifactor authentication. \no Under Session select Sign-in Frequency and set to Every time. \n5. Click Select \n6. You may opt to begin in a state of Report Only as you step through \nimplementation however, the policy will need to be set to On to be in effect. \n7. Click Create. \nNOTE: for more information regarding risk levels refer to Microsoft's Identity Protection \n& Risk Doc \nReferences1. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/howto-\nidentity-protection-risk-feedback \n2. https://learn.microsoft.com/en-us/azure/active-directory/identity-\nprotection/concept-identity-protection-risks \nCIS ControlsControls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n13.3 Deploy a Network Intrusion Detection Solution \n \nDeploy a network intrusion detection solution on enterprise assets, where \nappropriate. Example implementations include the use of a Network Intrusion \nDetection System (NIDS) or equivalent cloud service provider (CSP) service. \n \n\u25cf \n\u25cf \nv7 \n16.13 Alert on Account Login Behavior Deviation \n \nAlert when users deviate from normal login behavior, such as time-of-day, \nworkstation location and duration. \n \n \n\u25cf"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.2.2.8", "Rule": "5.2.2.8 (L1) Ensure admin center access is limited to administrative roles (Manual)", "Profile_applicability": " E3 Level 1", "Description": "When a Conditional Access policy targets the Microsoft Admin Portals cloud app, the policy is enforced for tokens issued to application IDs of the following Microsoft administrative portals: \u2022 Azure portal \u2022 Exchange admin center \u2022 Microsoft 365 admin center \u2022 Microsoft 365 Defender portal \u2022 Microsoft Entra admin center \u2022 Microsoft Intune admin center \u2022 Microsoft Purview compliance portal \u2022 Power Platform admin center \u2022 SharePoint admin center \u2022 Microsoft Teams admin center Microsoft Admin Portals should be restricted to specific pre-determined administrative roles.", "Rationale": "By default, users can sign into the various portals but are restricted by what they can view. Blocking sign-in to Microsoft Admin Portals enhances security of sensitive data by restricting access to privileged users. This mitigates potential exposure due to administrative errors or software vulnerabilities introduced by a CSP, as well as acting as a defense in depth measure against security breaches.", "Impact": "PIM functionality will be impacted unless non-privileged users are first assigned to a permanent group or role that is excluded from this policy. When attempting to checkout a role in the Entra ID PIM area they will receive the message \"You don't have access to this Your sign-in was successful but you don't have permission to access this resource.\"", "Audit": {"To audit using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Inspect and identify existing policies for the parameters belowo \nUsers set to Include All Users Users > Exclude Verify Guest or external users and Users and groups \ncontain only a group of PIM eligible users. Users > Exclude Verify Directory Roles only contains administrative \nroles. See below for details on roles. Target resources Cloud apps Includes Select apps Microsoft Admin \nPortals. Grant is equal to Block Access Enable policy is set to On \n4. If any of these conditions are not met, then the audit fails. \nDirectory Roles and Exclusions \n \nIn Directory roles > Exclude the role Global Administrator at a minimum should be \nselected to avoid I.T. being locked out. The organization should pre-determine roles in \nthe exclusion list as there is not a one size fits all. Auditors and system administrators \nshould exercise due diligence balancing operation while exercising least privilege. As \nthe size of the organization increases so will the number of roles being utilized. \n \nA an example starting list of Administrator roles can be found under Additional \nInformation \n \nNote: In order for PIM to function a group of users eligible for PIM roles must be \nexcluded from the policy."}, "Remediation": {"To remediate using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection > Conditional Access select Policies. \n3. Click New Policy and then name the policy. \n4. Select Users > Include > All Users \n5. Select Users > Exclude > Directory roles and select only administrative roles \nand a group of PIM eligible users. \n6. Select Target resources select Cloud apps > Select apps then select Microsoft \nAdmin Portals on the right. \n7. Confirm by clicking Select. \n8. Select Grant > Block access and click Select. \n9. Ensure Enable Policy is On or Report-only then click Create. \nWarning: Exclude Global Administrator at a minimum to avoid being locked out. \nReport-only is a good option to use when testing any Conditional Access policy for the \nfirst time. \n \nNote: In order for PIM to function a group of users eligible for PIM roles must be \nexcluded from the policy."}, "Default_value": "No - Non-administrators can access the Microsoft admin portals. References: 1. https://learn.microsoft.com/en-us/entra/identity/conditional-access/concept-conditional-access-cloud-apps#microsoft-admin-portals", "pdf": "m365"}, {"Rule_number": "5.2.3.1", "Rule": "5.2.3.1 (L1) Ensure Microsoft Authenticator is configured to protect against MFA fatigue (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Microsoft has released additional settings to enhance the configuration of the Microsoft Authenticator application. These settings provide additional information and context to users who receive MFA passwordless and push requests, such as geographic location the request came from, the requesting application and requiring a number match. Ensure the following are Enabled. \u2022 Require number matching for push notifications  \u2022 Show application name in push and passwordless notifications  \u2022 Show geographic location in push and passwordless notifications  NOTE: On February 27, 2023 Microsoft started enforcing number matching tenant-wide for all users using Microsoft Authenticator.", "Rationale": "As the use of strong authentication has become more widespread, attackers have started to exploit the tendency of users to experience \"MFA fatigue.\" This occurs when users are repeatedly asked to provide additional forms of identification, leading them to eventually approve requests without fully verifying the source. To counteract this, number matching can be employed to ensure the security of the authentication process. With this method, users are prompted to confirm a number displayed on their original device and enter it into the device being used for MFA. Additionally, other information such as geolocation and application details are displayed to enhance the end user's awareness. Among these 3 options, number matching provides the strongest net security gain.", "Impact": "Additional interaction will be required by end users using number matching as opposed to simply pressing \"Approve\" for login attempts.", "Audit": {"To audit using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click to expand Protection > Authentication methods select Policies. \n3. Under Method select Microsoft Authenticator. \n4. Under Enable and Target verify the setting is set to Enable. \n5. In the Include tab ensure All users is selected. \n6. In the Exclude tab ensure only valid groups are present (i.e. Break Glass \naccounts). \n7. Select Configure \n8. Verify the following Microsoft Authenticator settingso \nRequire number matching for push notifications Status is set to \nEnabled, Target All users Show application name in push and passwordless notifications is set \nto Enabled, Target All users Show geographic location in push and passwordless notifications is \nset to Enabled, Target All users \n9. In each setting select Exclude and verify only groups are present (i.e. Break \nGlass accounts)."}, "Remediation": {"To remediate using the UI": "1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click to expand Protection > Authentication methods select Policies. \n3. Select Microsoft Authenticator \n4. Under Enable and Target ensure the setting is set to Enable. \n5. Select Configure \n6. Set the following Microsoft Authenticator settingso \nRequire number matching for push notifications Status is set to \nEnabled, Target All users Show application name in push and passwordless notifications is set \nto Enabled, Target All users Show geographic location in push and passwordless notifications is \nset to Enabled, Target All users \nNote: Valid groups such as break glass accounts can be excluded per organization \npolicy."}, "Default_value": "Microsoft-managed", "pdf": "m365"}, {"Rule_number": "5.2.3.2", "Rule": "5.2.3.2 (L1) Ensure custom banned passwords lists are used (Manual)", "Profile_applicability": " E3 Level 1", "Description": "With Entra Password Protection, default global banned password lists are automatically applied to all users in an Entra ID tenant. To support business and security needs, custom banned password lists can be defined. When users change or reset their passwords, these banned password lists are checked to enforce the use of strong passwords. A custom banned password list should include some of the following examples: \u2022 Brand names \u2022 Product names \u2022 Locations, such as company headquarters \u2022 Company-specific internal terms \u2022 Abbreviations that have specific company meaning", "Rationale": "Creating a new password can be difficult regardless of one's technical background. It is common to look around one's environment for suggestions when building a password, however, this may include picking words specific to the organization as inspiration for a password. An adversary may employ what is called a 'mangler' to create permutations of these specific words in an attempt to crack passwords or hashes making it easier to reach their goal.", "Impact": "If a custom banned password list includes too many common dictionary words, or short words that are part of compound words, then perfectly secure passwords may be blocked. The organization should consider a balance between security and usability when creating a list.", "Audit": {"General Audit Instructions": "Ensure a custom banned password list is in place1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Protection > Authentication methods \n3. Select Password protection \n4. Verify Enforce custom list is set to Yes \n5. Verify Custom banned password list contains entries specific to the organization \nor matches a pre-determined list."}, "Remediation": {"General Remediation Instructions": "Create a custom banned password list1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Protection > Authentication methods \n3. Select Password protection \n4. Set Enforce custom list to Yes \n5. In Custom banned password list create a list using suggestions outlined in this \ndocument. \n6. Click Save \nNOTE: Below is a list of examples that can be used as a starting place. The references \nsection contains more suggestions. \n\u2022Brand names \n\u2022Product names \n\u2022Locations, such as company headquarters \n\u2022Company-specific internal terms \n\u2022Abbreviations that have specific company meaning \nReferences1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/concept-\npassword-ban-bad#custom-banned-password-list \n2. https://learn.microsoft.com/en-us/azure/active-directory/authentication/tutorial-\nconfigure-custom-password-protection"}, "Default_value": "Microsoft-managed", "pdf": "m365"}, {"Rule_number": "5.2.3.3", "Rule": "5.2.3.3 (L1) Ensure password protection is enabled for on-prem Active Directory (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Microsoft Entra Password Protection provides a global and custom banned password list. A password change request fails if there's a match in these banned password list. To protect on-premises Active Directory Domain Services (AD DS) environment, install and configure Entra Password Protection. Note: This recommendation applies to Hybrid deployments only and will have no impact unless working with on-premises Active Directory.", "Rationale": "This feature protects an organization by prohibiting the use of weak or leaked passwords. In addition, organizations can create custom banned password lists to prevent their users from using easily guessed passwords that are specific to their industry. Deploying this feature to Active Directory will strengthen the passwords that are used in the environment.", "Impact": "The potential impact associated with implementation of this setting is dependent upon the existing password policies in place in the environment. For environments that have strong password policies in place, the impact will be minimal. For organizations that do not have strong password policies in place, implementation of Microsoft Entra Password Protection may require users to change passwords and adhere to more stringent requirements than they have been accustomed to.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection select Authentication methods. \n3. Select Password protection and ensure that Enable password protection on \nWindows Server Active Directory is set to Yes and that Mode is set to Enforced."}, "Remediation": {"To remediate using the UI": "\n\u2022 \nDownload and install the Azure AD Password Proxies and DC Agents from the \nfollowing location: https://www.microsoft.com/download/details.aspx?id=57071 \nAfter installed follow the steps below. 1.Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection select Authentication methods. \n3. Select Password protection and set Enable password protection on Windows \nServer Active Directory to Yes and Mode to Enforced."}, "Default_value": "Enable - Yes Mode - Audit References: 1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-password-ban-bad-on-premises-operations", "pdf": "m365"}, {"Rule_number": "5.2.3.4", "Rule": "5.2.3.4 (L1) Ensure all member users are 'MFA capable' (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Microsoft defines Multifactor authentication capable as being registered and enabled for a strong authentication method. The method must also be allowed by the authentication methods policy. Ensure all member users are MFA capable.", "Rationale": "Multifactor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Users who are not MFA Capable have never registered a strong authentication method for multifactor authentication that is within policy and may not be using MFA. This could be a result of having never signed in, exclusion from a Conditional Access (CA) policy requiring MFA, or a CA policy does not exist. Reviewing this list of users will help identify possible lapses in policy or procedure.", "Impact": "When using the UI audit method guest users will appear in the report and unless the organization is applying MFA rules to guests then they will need to be manually filtered. Accounts that provide on-premises directory synchronization also appear in these reports.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection select Authentication methods. \n3. Select User registration details. \n4. Set the filter option Multifactor authentication capable to Not Capable. \n5. Review the non-guest users in this list. \n6. Excluding any exceptions users found in this report may require remediation.", "To audit using PowerShell": "1. Connect to Graph using Connect-MgGraph -Scopes \n\"UserAuthenticationMethod.Read.All,AuditLog.Read.All\" \n2. Run the followingGet-MgReportAuthenticationMethodUserRegistrationDetail ` \n    -Filter \"IsMfaCapable eq false and UserType eq 'Member'\" | \n        ft UserPrincipalName,IsMfaCapable,IsAdmin \n3. Ensure IsMfaCapable is set to True. \n4. Excluding any exceptions users found in this report may require remediation. \nNote: The CA rule must be in place for a successful deployment of Multifactor \nAuthentication. This policy is outlined in the conditional access section 5.2.2 \n \nNote 2: Possible exceptions include on-premises synchronization accounts."}, "Remediation": {"General Remediation Instructions": "Remediation steps will depend on the status of the personnel in question or \nconfiguration of Conditional Access policies and will not be covered in detail. \nAdministrators should review each user identified on a case-by-case basis using the \nconditions below. \n \nUser has never signed on\n\u2022 \nEmployment status should be reviewed, and appropriate action taken on the user \naccount's roles, licensing and enablement. \nConditional Access policy applicability\n\u2022 \nEnsure a CA policy is in place requiring all users to use MFA. \n\u2022Ensure the user is not excluded from the CA MFA policy. \n\u2022Ensure the policy's state is set to On. \n\u2022Use What if to determine applicable CA policies. (Protection > Conditional \nAccess > Policies) \n\u2022Review the user account in Sign-in logs. Under the Activity Details pane \nclick the Conditional Access tab to view applied policies. \nNote: Conditional Access is covered step by step in section 5.2.2 \nReferences1. https://learn.microsoft.com/en-\nus/powershell/module/microsoft.graph.reports/update-\nmgreportauthenticationmethoduserregistrationdetail?view=graph-powershell-\n1.0#-ismfacapable \n2. https://learn.microsoft.com/en-us/entra/identity/monitoring-health/how-to-view-\napplied-conditional-access-policies \n3. https://learn.microsoft.com/en-us/entra/identity/conditional-access/what-if-tool \n4. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-\nauthentication-methods-activity"}, "Default_value": "Enable - Yes Mode - Audit References: 1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-password-ban-bad-on-premises-operations", "pdf": "m365"}, {"Rule_number": "5.2.4.1", "Rule": "5.2.4.1 (L1) Ensure 'Self service password reset enabled' is set to 'All' (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Enabling self-service password reset allows users to reset their own passwords in Entra ID. When users sign in to Microsoft 365, they will be prompted to enter additional contact information that will help them reset their password in the future. If combined registration is enabled additional information, outside of multi-factor, will not be needed. NOTE: Effective Oct. 1st, 2022, Microsoft will begin to enable combined registration for all users in Entra ID tenants created before August 15th, 2020. Tenants created after this date are enabled with combined registration by default.", "Rationale": "Users will no longer need to engage the helpdesk for password resets, and the password reset mechanism will automatically block common, easily guessable passwords.", "Impact": "Users will be required to provide additional contact information to enroll in self-service password reset. Additionally, minor user education may be required for users that are used to calling a help desk for assistance with password resets. NOTE: This is unavailable if using Entra Connect / Sync in a hybrid environment.", "Audit": {"General Audit Instructions": "Ensure self-service password reset is enabled1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection > Password reset select Properties. \n3. Ensure Self service password reset enabled is set to All"}, "Remediation": {"General Remediation Instructions": "To enable self-service password reset1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection > Password reset select Properties. \n3. Set Self service password reset enabled to All"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.2.4.2", "Rule": "5.2.4.2 (L1) Ensure the self-service password reset activity report is reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "The Microsoft 365 platform allows users to reset their password in the event they forget it. The self-service password reset activity report logs each time a user successfully resets their password this way. The self-service password reset activity report should be reviewed at least weekly.", "Rationale": "An attacker will commonly compromise an account, then change the password to something they control and can manage. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To review the self-service password reset activity report: 1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. 2. Click to expand Protection > Password reset select Audit logs. 3. Review the list of users who have reset their passwords by setting the Date to Last 7 days and Service to Self-service Password Management References: 1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-sspr-reporting 2. https://learn.microsoft.com/en-us/azure/active-directory/authentication/troubleshoot-sspr", "Impact": "Users will be required to provide additional contact information to enroll in self-service password reset. Additionally, minor user education may be required for users that are used to calling a help desk for assistance with password resets. NOTE: This is unavailable if using Entra Connect / Sync in a hybrid environment.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review the self-service password reset activity report1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Protection > Password reset select Audit logs. \n3. Review the list of users who have reset their passwords by setting the Date to \nLast 7 days and Service to Self-service Password Management \nReferences1. https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-\nsspr-reporting \n2. https://learn.microsoft.com/en-us/azure/active-\ndirectory/authentication/troubleshoot-sspr"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.2.6.1", "Rule": "5.2.6.1 (L1) Ensure the Azure AD 'Risky sign-ins' report is reviewed at least weekly (Manual)", "Profile_applicability": " E5 Level 1", "Description": "This report contains records of accounts that have had activity that could indicate they are compromised, such as accounts that have: \u2022 Successfully signed in after multiple failures, which is an indication that the accounts have cracked passwords. \u2022 Signed in to tenant from a client IP address that has been recognized by Microsoft as an anonymous proxy IP address (such as a TOR network). \u2022 Successful sign-ins from users where two sign-ins appeared to originate from different regions and the time between sign-ins makes it impossible for the user to have traveled between those regions.", "Rationale": "Reviewing this report on a regular basis allows for identification and remediation of compromised accounts. Audit: To verify the report is being reviewed at least weekly, confirm that the necessary procedures are in place and being followed. Remediation: To review the 'Risky sign-ins' report: 1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. 2. Click expand Protection select Risky activities. 3. Under Report click on Risky sign-ins. 4. Review by Risk level (aggregate). References: 1. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/overview-identity-protection 2. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/howto-identity-protection-remediate-unblock", "Impact": "Users will be required to provide additional contact information to enroll in self-service password reset. Additionally, minor user education may be required for users that are used to calling a help desk for assistance with password resets. NOTE: This is unavailable if using Entra Connect / Sync in a hybrid environment.", "Audit": {"General Audit Instructions": "To verify the report is being reviewed at least weekly, confirm that the necessary \nprocedures are in place and being followed."}, "Remediation": {"General Remediation Instructions": "To review the 'Risky sign-ins' report1. Navigate to the Microsoft Entra admin center https://entra.microsoft.com. \n2. Click expand Protection select Risky activities. \n3. Under Report click on Risky sign-ins. \n4. Review by Risk level (aggregate). \nReferences1. https://learn.microsoft.com/en-us/azure/active-directory/identity-\nprotection/overview-identity-protection \n2. https://learn.microsoft.com/en-us/azure/active-directory/identity-protection/howto-\nidentity-protection-remediate-unblock"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.3.1", "Rule": "5.3.1 (L2) Ensure 'Privileged Identity Management' is used to manage roles (Manual)", "Profile_applicability": " E5 Level 2", "Description": "Microsoft Entra Privileged Identity Management can be used to audit roles, allow just in time activation of roles and allow for periodic role attestation. Organizations should remove permanent members from privileged Office 365 roles and instead make them eligible, through a JIT activation workflow.", "Rationale": "Organizations want to minimize the number of people who have access to secure information or resources, because that reduces the chance of a malicious actor getting that access, or an authorized user inadvertently impacting a sensitive resource. However, users still need to carry out privileged operations in Entra ID. Organizations can give users just-in-time (JIT) privileged access to roles. There is a need for oversight for what those users are doing with their administrator privileges. PIM helps to mitigate the risk of excessive, unnecessary, or misused access rights.", "Impact": "Implementation of Just in Time privileged access is likely to necessitate changes to administrator routine. Administrators will only be granted access to administrative roles when required. When administrators request role activation, they will need to document the reason for requiring role access, anticipated time required to have the access, and to reauthenticate to enable role access.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity Governance select Privileged Identity Management. \n3. Select Microsoft Entra Roles. \n4. Select Roles beneath Manage. \n5. Inspect at a minimum the following sensitive roles to ensure the members are \nEligible and not PermanentApplication Administrator \nAuthentication Administrator \nBilling Administrator \nCloud Application Administrator \nCloud Device Administrator \nCompliance Administrator \nCustomer LockBox Access Approver \nDevice Administrators \nExchange Administrators \nGlobal Administrators \nHelpDesk Administrator \nInformation Protection Administrator \nIntune Service Administrator \nKaizala Administrator \nLicense Administrator \nPassword Administrator \nPowerBI Service Administrator \nPrivileged Authentication Administrator \nPrivileged Role Administrator \nSecurity Administrator \nSharePoint Service Administrator \nSkype for Business Administrator \nTeams Service Administrator \nUser Administrator"}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/. \n2. Click to expand Identity Governance select Privileged Identity Management. \n3. Select Microsoft Entra Roles. \n4. Select Roles beneath Manage. \n5. Inspect at a minimum the following sensitive roles. For each of the members that \nhave an ASSIGNMENT TYPE of Permanent, click on the ... and choose Make \neligibleApplication Administrator \nAuthentication Administrator \nBilling Administrator \nCloud Application Administrator \nCloud Device Administrator \nCompliance Administrator \nCustomer LockBox Access Approver \nDevice Administrators \nExchange Administrators \nGlobal Administrators \nHelpDesk Administrator \nInformation Protection Administrator \nIntune Service Administrator \nKaizala Administrator \nLicense Administrator \nPassword Administrator \nPowerBI Service Administrator \nPrivileged Authentication Administrator \nPrivileged Role Administrator \nSecurity Administrator \nSharePoint Service Administrator \nSkype for Business Administrator \nTeams Service Administrator \nUser Administrator"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "5.3.2", "Rule": "5.3.2 (L1) Ensure 'Access reviews' for Guest Users are configured (Manual)", "Profile_applicability": " E5 Level 1", "Description": "Access reviews enable administrators to establish an efficient automated process for reviewing group memberships, access to enterprise applications, and role assignments. These reviews can be scheduled to recur regularly, with flexible options for delegating the task of reviewing membership to different members of the organization. Ensure Access reviews for Guest Users are configured to be performed no less frequently than monthly.", "Rationale": "Access to groups and applications for guests can change over time. If a guest user's access to a particular folder goes unnoticed, they may unintentionally gain access to sensitive data if a member adds new files or data to the folder or application. Access reviews can help reduce the risks associated with outdated assignments by requiring a member of the organization to conduct the reviews. Furthermore, these reviews can enable a fail-closed mechanism to remove access to the subject if the reviewer does not respond to the review.", "Impact": "Access reviews that are ignored may cause guest users to lose access to resources temporarily.", "Audit": {"General Audit Instructions": "Verify an access review for Guest Users is in place1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity Governance and select Access reviews \n3. Inspect the access reviews, and ensure an access review is created with the \nfollowing criteriao \nOverview: Scope is set to Guest users only and status is Active Reviewers: Ensure appropriate reviewer(s) are designated. Settings > General: Mail notifications and Reminders are set to Enable Reviewers: Require reason on approval is set to Enable Scheduling: Frequency is Monthly or more frequent. When completed: Auto apply results to resource is set to Enable When completed: If reviewers don't respond is set to Remove access"}, "Remediation": {"Create an access review for Guest Users:": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity Governance and select Access reviews \n3. Click New access review. \n4. Select what to review choose Teams + Groups. \n5. Review Scope set to All Microsoft 365 groups with guest users, do not \nexclude groups. \n6. Scope set to Guest users only then click Next: Reviews. \n7. Select reviewers an appropriate user that is NOT the guest user themselves. \n8. Duration (in days) at most 3. \n9. Review recurrence is Monthly or more frequent. \n10. \nEnd is set to Never, then click Next: Settings. \n11. \nCheck Auto apply results to resource. \n12. \nSet If reviewers don't respond to Remove access. \n13. \nCheck the following: Justification required, E-mail notifications, \nReminders. \n14. \nClick Next: Review + Create and finally click Create."}, "Default_value": "By default access reviews are not configured. References: 1. https://learn.microsoft.com/en-us/azure/active-directory/governance/create-access-review 2. https://learn.microsoft.com/en-us/azure/active-directory/governance/access-reviews-overview", "pdf": "m365"}, {"Rule_number": "5.3.3", "Rule": "5.3.3 (L1) Ensure 'Access reviews' for high privileged Azure AD roles are configured (Manual)", "Profile_applicability": " E5 Level 1", "Description": "Access reviews enable administrators to establish an efficient automated process for reviewing group memberships, access to enterprise applications, and role assignments. These reviews can be scheduled to recur regularly, with flexible options for delegating the task of reviewing membership to different members of the organization. Ensure Access reviews for high privileged Entra ID roles are done no less frequently than weekly. These reviews should include at a minimum the roles listed below: \u2022 Global Administrator \u2022 Exchange Administrator \u2022 SharePoint Administrator \u2022 Teams Administrator \u2022 Security Administrator NOTE: An access review is created for each role selected after completing the process.", "Rationale": "Regular review of critical high privileged roles in Entra ID will help identify role drift, or potential malicious activity. This will enable the practice and application of \"separation of duties\" where even non-privileged users like security auditors can be assigned to review assigned roles in an organization. Furthermore, if configured these reviews can enable a fail-closed mechanism to remove access to the subject if the reviewer does not respond to the review.", "Impact": "Access reviews that are ignored may cause guest users to lose access to resources temporarily.", "Audit": {"General Audit Instructions": "Verify access reviews for high privileged roles is in place1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity Governance and select Privileged Identity \nManagement \n3. Select Microsoft Entra Roles under Manage \n4. Select Access reviews \n5. Ensure there are access reviews configured for each high privileged roles and \neach meets the criteria laid out belowo \nScope - Everyone Status - Active Reviewers - Role reviewers should be designated personnel. Preferably \nnot a self-review. Mail notifications - Enable Reminders - Enable Require reason on approval - Enable Frequency - Monthly or more frequent Duration (in days) - 4 at most Auto apply results to resource - Enable If reviewers don't respond - No change \nAny remaining settings are discretionary. \n \nNOTE: Reviewers will have the ability to revoke roles should be trusted individuals who \nunderstand the impact of the access reviews. The principal of separation of duties \nshould be considered so that no one administrator is reviewing their own access levels. \n \nNOTE2: The setting If reviewers don't respond is recommended to be set to Remove \naccess due to the potential of all Global Administrators being unassigned if the review is \nnot addressed."}, "Remediation": {"Create an access review for high privileged roles:": "1. Navigate to Microsoft Entra admin center https://entra.microsoft.com/ \n2. Click to expand Identity Governance and select Privileged Identity \nManagement \n3. Select Microsoft Entra Roles under Manage \n4. Select Access reviews and click New access review. \n5. Provide a name and description. \n6. Frequency set to Weekly or more frequent. \n7. Duration (in days) is set to at most 3. \n8. End set to Never. \n9. Role select these roles: Global Administrator,Exchange \nAdministrator,SharePoint Administrator,Teams Administrator,Security \nAdministrator \n10. \nAssignment type set to All active and eligible assignments. \n11. \nReviewers set to Selected user(s) or group(s) \n12. \nSelect reviewers are member(s) responsible for this type of review. \n13. \nAuto apply results to resource set to Enable \n14. \nIf reviewers don't respond is set to No change \n15. \nShow recommendations set to Enable \n16. \nRequire reason or approval set to Enable \n17. \nMail notifications set to Enable \n18. \nReminders set to Enable \n19. \nClick Start to save the review. \nNOTE: Reviewers will have the ability to revoke roles should be trusted individuals who \nunderstand the impact of the access reviews. The principle of separation of duties \nshould be considered so that no one administrator is reviewing their own access levels."}, "Default_value": "By default access reviews are not configured. References: 1. https://learn.microsoft.com/en-us/azure/active-directory/privileged-identity-management/pim-create-azure-ad-roles-and-resource-roles-review 2. https://learn.microsoft.com/en-us/azure/active-directory/governance/access-reviews-overview", "pdf": "m365"}, {"Rule_number": "6.1.1", "Rule": "6.1.1 (L1) Ensure 'AuditDisabled' organizationally is set to 'False' (Automated)", "Profile_applicability": " E3 Level 1", "Description": "The value False indicates that mailbox auditing on by default is turned on for the organization. Mailbox auditing on by default in the organization overrides the mailbox auditing settings on individual mailboxes. For example, if mailbox auditing is turned off for a mailbox (the AuditEnabled property on the mailbox is False), the default mailbox actions are still audited for the mailbox, because mailbox auditing on by default is turned on for the organization. Turning off mailbox auditing on by default ($true) has the following results: \u2022 Mailbox auditing is turned off for your organization. \u2022 From the time you turn off mailbox auditing on by default, no mailbox actions are audited, even if mailbox auditing is enabled on a mailbox (the AuditEnabled property on the mailbox is True). \u2022 Mailbox auditing isn't turned on for new mailboxes and setting the AuditEnabled property on a new or existing mailbox to True is ignored. \u2022 Any mailbox audit bypass association settings (configured by using the Set-MailboxAuditBypassAssociation cmdlet) are ignored. \u2022 Existing mailbox audit records are retained until the audit log age limit for the record expires. The recommended state for this setting is False at the organization level. This will enable auditing and enforce the default.", "Rationale": "Enforcing the default ensures auditing was not turned off intentionally or accidentally. Auditing mailbox actions will allow forensics and IR teams to trace various malicious activities that can generate TTPs caused by inbox access and tampering. NOTE: Without advanced auditing (E5 function) the logs are limited to 90 days.", "Impact": "None - this is the default behavior as of 2019.", "Audit": {"General Audit Instructions": "Ensure mailbox auditing is enabled by default at the organizational level1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-OrganizationConfig | Format-List AuditDisabled \n3. Ensure AuditDisabled is set to False."}, "Remediation": {"Enable mailbox auditing at the organizational level:": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandSet-OrganizationConfig -AuditDisabled $false"}, "Default_value": "False References: 1. https://learn.microsoft.com/en-us/microsoft-365/compliance/audit-mailboxes?view=o365-worldwide 2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-organizationconfig?view=exchange-ps#-auditdisabled", "pdf": "m365"}, {"Rule_number": "6.1.2", "Rule": "6.1.2 (L1) Ensure mailbox auditing for E3 users is Enabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Mailbox audit logging is turned on by default in all organizations. This effort started in January 2019, and means that certain actions performed by mailbox owners, delegates, and admins are automatically logged. The corresponding mailbox audit records are available for admins to search in the mailbox audit log. Mailboxes and shared mailboxes have actions assigned to them individually in order to audit the data the organization determines valuable at the mailbox level. The recommended state is AuditEnabled to True on all user mailboxes along with additional audit actions beyond the Microsoft defaults. Note: Due to some differences in defaults for audit actions this recommendation is specific to users assigned an E3 license only.", "Rationale": "Whether it is for regulatory compliance or for tracking unauthorized configuration changes in Microsoft 365, enabling mailbox auditing, and ensuring the proper mailbox actions are accounted for allows for Microsoft 365 teams to run security operations, forensics or general investigations on mailbox activities. The following mailbox types ignore the organizational default and must have AuditEnabled set to True at the mailbox level in order to capture relevant audit data. \u2022 Resource Mailboxes \u2022 Public Folder Mailboxes \u2022 DiscoverySearch Mailbox Note: Without advanced auditing (E5 function) the logs are limited to 90 days.", "Impact": "None - this is the default behavior.", "Audit": {"General Audit Instructions": "To manually verify mailbox auditing is enabled and configured for all mailboxes1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell script$MailAudit = Get-EXOMailbox -PropertySets Audit -ResultSize Unlimited |  \n    Select-Object UserPrincipalName, AuditEnabled, AuditAdmin, AuditDelegate, \nAuditOwner \n \n$MailAudit | Export-Csv -Path C:\\CIS\\AuditSettings.csv -NoTypeInformation \n3. Analyze the output and verify AuditEnabled is set to True and all audit actions \nare included in what is defined in the script in the remediation section. \nOptionally, this more comprehensive script can assess each user mailbox1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following script:"}, "Remediation": {"General Remediation Instructions": "To enable mailbox auditing for all user mailboxes using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell script$AuditAdmin = @( \n    \"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\", \n    \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \"SoftDelete\", \"Update\", \n    \"UpdateCalendarDelegation\", \"UpdateFolderPermissions\", \"UpdateInboxRules\" \n) \n \n$AuditDelegate = @( \n    \"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",  \n    \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \"SoftDelete\", \"Update\", \n    \"UpdateFolderPermissions\", \"UpdateInboxRules\" \n) \n \n$AuditOwner = @( \n    \"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\", \n    \"MoveToDeletedItems\", \"SoftDelete\", \"Update\", \"UpdateCalendarDelegation\", \n    \"UpdateFolderPermissions\", \"UpdateInboxRules\" \n) \n \n \n$MBX = Get-EXOMailbox -ResultSize Unlimited | Where-Object { \n$_.RecipientTypeDetails -eq \"UserMailbox\" } \n$MBX | Set-Mailbox -AuditEnabled $true ` \n-AuditLogAgeLimit 90 -AuditAdmin $AuditAdmin -AuditDelegate $AuditDelegate ` \n-AuditOwner $AuditOwner"}, "Default_value": "AuditEnabled: True for all mailboxes except below: \u2022 Resource Mailboxes \u2022 Public Folder Mailboxes \u2022 DiscoverySearch Mailbox AuditAdmin: ApplyRecord, Create, HardDelete, MoveToDeletedItems, SendAs, SendOnBehalf, SoftDelete, Update, UpdateCalendarDelegation, UpdateFolderPermissions, UpdateInboxRules AuditDelegate: ApplyRecord, Create, HardDelete, MoveToDeletedItems, SendAs, SendOnBehalf, SoftDelete, Update, UpdateFolderPermissions, UpdateInboxRules AuditOwner: ApplyRecord, HardDelete, MoveToDeletedItems, SoftDelete, Update, UpdateCalendarDelegation, UpdateFolderPermissions, UpdateInboxRules", "pdf": "m365"}, {"Rule_number": "6.1.3", "Rule": "6.1.3 (L1) Ensure mailbox auditing for E5 users is Enabled (Automated)", "Profile_applicability": " E5 Level 1", "Description": "Mailbox audit logging is turned on by default in all organizations. This effort started in January 2019, and means that certain actions performed by mailbox owners, delegates, and admins are automatically logged. The corresponding mailbox audit records are available for admins to search in the mailbox audit log. Mailboxes and shared mailboxes have actions assigned to them individually in order to audit the data the organization determines valuable at the mailbox level. The recommended state is AuditEnabled to True on all user mailboxes along with additional audit actions beyond the Microsoft defaults. Note: Due to some differences in defaults for audit actions this recommendation is specific to users assigned an E5 license, or auditing addon license, only.", "Rationale": "Whether it is for regulatory compliance or for tracking unauthorized configuration changes in Microsoft 365, enabling mailbox auditing and ensuring the proper mailbox actions are accounted for allows for Microsoft 365 teams to run security operations, forensics or general investigations on mailbox activities. The following mailbox types ignore the organizational default and must have AuditEnabled set to True at the mailbox level in order to capture relevant audit data. \u2022 Resource Mailboxes \u2022 Public Folder Mailboxes \u2022 DiscoverySearch Mailbox NOTE: Without advanced auditing (E5 function) the logs are limited to 90 days.", "Impact": "None - this is the default behavior.", "Audit": {"General Audit Instructions": "To manually verify mailbox auditing is enabled and configured for all mailboxes1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell script$MailAudit = Get-EXOMailbox -PropertySets Audit -ResultSize Unlimited |  \n    Select-Object UserPrincipalName, AuditEnabled, AuditAdmin, AuditDelegate, \nAuditOwner \n \n$MailAudit | Export-Csv -Path C:\\CIS\\AuditSettings.csv -NoTypeInformation \n3. Analyze the output and verify AuditEnabled is set to True and all audit actions \nare included in what is defined in the script in the remediation section. \nOptionally, this more comprehensive script can assess each user mailbox1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following script:"}, "Remediation": {"General Remediation Instructions": "To enable mailbox auditing for all user mailboxes using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell script$AuditAdmin = @( \n    \"ApplyRecord\", \"Copy\", \"Create\", \"FolderBind\", \"HardDelete\", \n    \"MailItemsAccessed\", \"Move\", \"MoveToDeletedItems\", \"SendAs\",  \n    \"SendOnBehalf\", \"Send\", \"SoftDelete\", \"Update\", \n\"UpdateCalendarDelegation\", \n    \"UpdateFolderPermissions\", \"UpdateInboxRules\" \n) \n \n$AuditDelegate = @( \n    \"ApplyRecord\", \"Create\", \"FolderBind\", \"HardDelete\", \"Move\",  \n    \"MailItemsAccessed\", \"MoveToDeletedItems\", \"SendAs\", \"SendOnBehalf\", \n    \"SoftDelete\", \"Update\", \"UpdateFolderPermissions\", \"UpdateInboxRules\" \n) \n \n$AuditOwner = @( \n    \"ApplyRecord\", \"Create\", \"HardDelete\", \"MailboxLogin\", \"Move\", \n    \"MailItemsAccessed\", \"MoveToDeletedItems\", \"Send\", \"SoftDelete\", \n\"Update\", \n    \"UpdateCalendarDelegation\", \"UpdateFolderPermissions\", \"UpdateInboxRules\" \n) \n \n \n$MBX = Get-EXOMailbox -ResultSize Unlimited | Where-Object { \n$_.RecipientTypeDetails -eq \"UserMailbox\" } \n$MBX | Set-Mailbox -AuditEnabled $true ` \n-AuditLogAgeLimit 180 -AuditAdmin $AuditAdmin -AuditDelegate $AuditDelegate ` \n-AuditOwner $AuditOwner \nNote: When running this script mailboxes without an E5 or Azure Audit Premium license \napplied will generate an error as they are not licensed for the additional actions which \ncome default with E5."}, "Default_value": "AuditEnabled: True for all mailboxes except below: \u2022 Resource Mailboxes \u2022 Public Folder Mailboxes \u2022 DiscoverySearch Mailbox AuditAdmin: ApplyRecord, Create, HardDelete, MoveToDeletedItems, SendAs, SendOnBehalf, SoftDelete, Update, UpdateCalendarDelegation, UpdateFolderPermissions, UpdateInboxRules AuditDelegate: ApplyRecord, Create, HardDelete, MoveToDeletedItems, SendAs, SendOnBehalf, SoftDelete, Update, UpdateFolderPermissions, UpdateInboxRules AuditOwner: ApplyRecord, HardDelete, MoveToDeletedItems, SoftDelete, Update, UpdateCalendarDelegation, UpdateFolderPermissions, UpdateInboxRules", "pdf": "m365"}, {"Rule_number": "6.1.4", "Rule": "6.1.4 (L1) Ensure 'AuditBypassEnabled' is not enabled on mailboxes (Manual)", "Profile_applicability": " E3 Level 1", "Description": "When configuring a user or computer account to bypass mailbox audit logging, the system will not record any access, or actions performed by the said user or computer account on any mailbox. Administratively this was introduced to reduce the volume of entries in the mailbox audit logs on trusted user or computer accounts. Ensure AuditBypassEnabled is not enabled on accounts without a written exception.", "Rationale": "If a mailbox audit bypass association is added for an account, the account can access any mailbox in the organization to which it has been assigned access permissions, without generating any mailbox audit logging entries for such access or recording any actions taken, such as message deletions. Enabling this parameter, whether intentionally or unintentionally, could allow insiders or malicious actors to conceal their activity on specific mailboxes. Ensuring proper logging of user actions and mailbox operations in the audit log will enable comprehensive incident response and forensics.", "Impact": "None - this is the default behavior.", "Audit": {"General Audit Instructions": "Ensure Audit Bypass is not enabled using PowerShell1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell command$MBX = Get-MailboxAuditBypassAssociation -ResultSize unlimited \n$MBX | where {$_.AuditBypassEnabled -eq $true} | Format-Table \nName,AuditBypassEnabled \n3. If nothing is returned, then there are no accounts with Audit Bypass enabled."}, "Remediation": {"Disable Audit Bypass on all mailboxes using PowerShell:": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. The following example PowerShell script will disable AuditBypass for all \nmailboxes which currently have it enabled# Get mailboxes with AuditBypassEnabled set to $true \n$MBXAudit = Get-MailboxAuditBypassAssociation -ResultSize unlimited | Where-\nObject { $_.AuditBypassEnabled -eq $true } \n \nforeach ($mailbox in $MBXAudit) { \n    $mailboxName = $mailbox.Name \n    Set-MailboxAuditBypassAssociation -Identity $mailboxName -\nAuditBypassEnabled $false \n    Write-Host \"Audit Bypass disabled for mailbox Identity: $mailboxName\" -\nForegroundColor Green \n}"}, "Default_value": "AuditBypassEnabled False References: 1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-mailboxauditbypassassociation?view=exchange-ps", "pdf": "m365"}, {"Rule_number": "6.2.1", "Rule": "6.2.1 (L1) Ensure all forms of mail forwarding are blocked and/or disabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Exchange Online offers several methods of managing the flow of email messages. These are Remote domain, Transport Rules, and Anti-spam outbound policies. These methods work together to provide comprehensive coverage for potential automatic forwarding channels: \u2022 Outlook forwarding using inbox rules. \u2022 Outlook forwarding configured using OOF rule. \u2022 OWA forwarding setting (ForwardingSmtpAddress). \u2022 Forwarding set by the admin using EAC (ForwardingAddress). \u2022 Forwarding using Power Automate / Flow. Ensure a Transport rule and Anti-spam outbound policy are used to block mail forwarding. NOTE: Any exclusions should be implemented based on organizational policy.", "Rationale": "Attackers often create these rules to exfiltrate data from your tenancy, this could be accomplished via access to an end-user account or otherwise. An insider could also use one of these methods as a secondary channel to exfiltrate sensitive data.", "Impact": "Care should be taken before implementation to ensure there is no business need for case-by-case auto-forwarding. Disabling auto-forwarding to remote domains will affect all users and in an organization. Any exclusions should be implemented based on organizational policy.", "Audit": {"To audit using PowerShell": "1. Connect to Exchange online using Connect-ExchangeOnline. \n2. Run the following PowerShell command to review the Transport Rules that are \nredirecting emailGet-TransportRule | Where-Object {$_.RedirectMessageTo -ne $null} | ft \nName,RedirectMessageTo \n3. Verify that none of the addresses listed belong to external domains outside of the \norganization. If nothing returns then there are no transport rules set to redirect \nmessages. \nSTEP 2: Anti-spam outbound policy \n \nEnsure an anti-spam outbound policy is properly configured using the UI1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Expand E-mail & collaboration then select Policies & rules. \n3. Select Threat policies > Anti-spam. \n4. Inspect Anti-spam outbound policy (default) and ensure Automatic \nforwarding is set to Off - Forwarding is disabled \n5. Inspect any additional custom outbound policies and ensure Automatic \nforwarding is set to Off - Forwarding is disabled, in accordance with the \norganization's exclusion policies."}, "Remediation": {"To alter the mail transport rules so they do not forward email to external domains \nusing the UI:": "1. Select Exchange to open the Exchange admin center. \n2. Select Mail Flow then Rules. \n3. For each rule that redirects email to external domains, select the rule and click \nthe 'Delete' icon.", "To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandRemove-TransportRule {RuleName} \nSTEP 2: Anti-spam outbound policy \n \nTo configure an anti-spam outbound policy using the UI1. Navigate to Microsoft 365 Defender https://security.microsoft.com/ \n2. Expand E-mail & collaboration then select Policies & rules. \n3. Select Threat policies > Anti-spam. \n4. Select Anti-spam outbound policy (default) \n5. Click Edit protection settings \n6. Set Automatic forwarding rules dropdown to Off - Forwarding is disabled \nand click Save \n7. Repeat steps 4-6 for any additional higher priority, custom policies."}, "Default_value": "AuditBypassEnabled False References: 1. https://learn.microsoft.com/en-us/powershell/module/exchange/get-mailboxauditbypassassociation?view=exchange-ps", "pdf": "m365"}, {"Rule_number": "6.2.2", "Rule": "6.2.2 (L1) Ensure mail transport rules do not whitelist specific domains (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Mail flow rules (transport rules) in Exchange Online are used to identify and take action on messages that flow through the organization.", "Rationale": "Whitelisting domains in transport rules bypasses regular malware and phishing scanning, which can enable an attacker to launch attacks against your users from a safe haven domain.", "Impact": "Care should be taken before implementation to ensure there is no business need for case-by-case whitelisting. Removing all whitelisted domains could affect incoming mail flow to an organization although modern systems sending legitimate mail should have no issue with this.", "Audit": {"General Audit Instructions": "Ensure mail transport rules do not whitelist specific domains1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.. \n2. Click to expand Mail Flow and then select Rules. \n3. Review the rules and verify that none of them whitelist any specific domains. \nTo verify that mail transport rules do not whitelist any domains using PowerShell1. Connect to Exchange online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-TransportRule | Where-Object {($_.setscl -eq -1 -and $_.SenderDomainIs -\nne $null)}  | ft Name,SenderDomainIs"}, "Remediation": {"To alter the mail transport rules so they do not whitelist any specific domains:": "1. Navigate to Exchange admin center https://admin.exchange.microsoft.com.. \n2. Click to expand Mail Flow and then select Rules. \n3. For each rule that whitelists specific domains, select the rule and click the \n'Delete' icon.", "To remove mail transport rules using PowerShell:": "1. Connect to Exchange online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandRemove-TransportRule {RuleName} \n3. Verify the rules no longer exists. \nGet-TransportRule | Where-Object {($_.setscl -eq -1 -and $_.SenderDomainIs -\nne $null)}  | ft Name,SenderDomainIs \nReferences1. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/configuration-best-practices \n2. https://learn.microsoft.com/en-us/exchange/security-and-compliance/mail-flow-\nrules/mail-flow-rules \nCIS ControlsControls Version \nControl \nIG 1 IG 2 \nIG 3 \nv8 \n0.0 Explicitly Not Mapped \n \nExplicitly Not Mapped"}, "Default_value": "", "pdf": "m365"}, {"Rule_number": "6.2.3", "Rule": "6.2.3 (L1) Ensure email from external senders is identified (Automated)", "Profile_applicability": " E3 Level 1", "Description": "External callouts provide a native experience to identify emails from senders outside the organization. This is achieved by presenting a new tag on emails called \"External\" (the string is localized based on the client language setting) and exposing related user interface at the top of the message reading view to see and verify the real sender's email address. Once this feature is enabled via PowerShell, it might take 24-48 hours for users to start seeing the External sender tag in email messages received from external sources (outside of your organization), providing their Outlook version supports it. The recommended state is ExternalInOutlook set to Enabled True Note: Mail flow rules are often used by Exchange administrators to accomplish the External email tagging by appending a tag to the front of a subject line. There are limitations to this outlined here. The preferred method in the CIS Benchmark is to use the native experience.", "Rationale": "Tagging emails from external senders helps to inform end users about the origin of the email. This can allow them to proceed with more caution and make informed decisions when it comes to identifying spam or phishing emails. Note: Existing emails in a user's inbox from external senders are not tagged retroactively.", "Impact": "Mail flow rules using external tagging will need to be disabled before enabling this to avoid duplicate [External] tags. The Outlook desktop client is the last to receive this update and the feature is only available for certain versions see below: Outlook for Windows: Update 4/26/23: External Tag view in Outlook for Windows (matching other clients) released to production for Current Channel and Monthly Enterprise Channel in Version 2211 for builds 15831.20190 and higher. We anticipate the External tag to reach Semi-Annual Preview Channel with Version 2308 on the September 12th 2023 public update and reach Semi-Annual Enterprise Channel with Version 2308 with the January 9th 2024 public update.", "Audit": {"General Audit Instructions": "To verify external sender tagging using PowerShell1. Connect to Exchange online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-ExternalInOutlook \n3. For each identity verify Enabled is set to True and the AllowList only contains \nemail addresses the organization has permitted to bypass external tagging."}, "Remediation": {"General Remediation Instructions": "To enable external tagging using PowerShell1. Connect to Exchange online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandSet-ExternalInOutlook -Enabled $true"}, "Default_value": "Disabled (False) References: 1. https://techcommunity.microsoft.com/t5/exchange-team-blog/native-external-sender-callouts-on-email-in-outlook/ba-p/2250098 2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-externalinoutlook?view=exchange-ps", "pdf": "m365"}, {"Rule_number": "6.3.1", "Rule": "6.3.1 (L2) Ensure users installing Outlook add-ins is not allowed (Automated)", "Profile_applicability": " E3 Level 2", "Description": "Specify the administrators and users who can install and manage add-ins for Outlook in Exchange Online By default, users can install add-ins in their Microsoft Outlook Desktop client, allowing data access within the client application.", "Rationale": "Attackers exploit vulnerable or custom add-ins to access user data. Disabling user-installed add-ins in Microsoft Outlook reduces this threat surface.", "Impact": "Implementing this change will impact both end users and administrators. End users will be unable to integrate third-party applications they desire, and administrators may receive requests to grant permission for necessary third-party apps.", "Audit": {"To audit using the UI": "1. Navigate to Exchange admin center https://admin.exchange.microsoft.com. \n2. Click to expand Roles select User roles. \n3. Select Default Role Assignment Policy. \n4. In the properties pane on the right click on Manage permissions. \n5. Under Other roles verify My Custom Apps, My Marketplace Apps and My \nReadWriteMailboxApps are unchecked.", "To audit using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following commandGet-EXOMailbox | Select-Object -Unique RoleAssignmentPolicy |  \nForEach-Object {  \n    Get-RoleAssignmentPolicy -Identity $_.RoleAssignmentPolicy |  \n    Where-Object {$_.AssignedRoles -like \"*Apps*\"} \n} | Select-Object Identity, @{Name=\"AssignedRoles\"; Expression={ \n    Get-Mailbox | Select-Object -Unique RoleAssignmentPolicy |  \n    ForEach-Object {  \n        Get-RoleAssignmentPolicy -Identity $_.RoleAssignmentPolicy |  \n        Select-Object -ExpandProperty AssignedRoles |  \n        Where-Object {$_ -like \"*Apps*\"} \n    } \n}} \n3. Verify My Custom Apps, My Marketplace Apps and My ReadWriteMailboxApps are \nnot present. \nNote: As of the current release the manage permissions link no longer displays \nanything when a user assigned the Global Reader role clicks on it. Global Readers as \nan alternative can inspect the Roles column or use the PowerShell method to perform \nthe audit."}, "Remediation": {"To remediate using the UI": "1. Navigate to Exchange admin center https://admin.exchange.microsoft.com. \n2. Click to expand Roles select User roles. \n3. Select Default Role Assignment Policy. \n4. In the properties pane on the right click on Manage permissions. \n5. Under Other roles uncheck My Custom Apps, My Marketplace Apps and My \nReadWriteMailboxApps. \n6. Click Save changes.", "To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following command$policy = \"Role Assignment Policy - Prevent Add-ins\" \n$roles = \"MyTextMessaging\", \"MyDistributionGroups\", ` \n         \"MyMailSubscriptions\", \"MyBaseOptions\", \"MyVoiceMail\", ` \n         \"MyProfileInformation\", \"MyContactInformation\", \n\"MyRetentionPolicies\", ` \n         \"MyDistributionGroupMembership\" \n \nNew-RoleAssignmentPolicy -Name $policy -Roles $roles \nSet-RoleAssignmentPolicy -id $policy -IsDefault \n \n# Assign new policy to all mailboxes \nGet-EXOMailbox -ResultSize Unlimited | Set-Mailbox -RoleAssignmentPolicy \n$policy \nIf you have other Role Assignment Policies modify the last line to filter out your \ncustom policies"}, "Default_value": "UI - My Custom Apps, My Marketplace Apps, and My ReadWriteMailboxApps are checked PowerShell - My Custom Apps My Marketplace Apps and My ReadWriteMailboxApps are assigned References: 1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/add-ins-for-outlook/specify-who-can-install-and-manage-add-ins?source=recommendations 2. https://learn.microsoft.com/en-us/exchange/permissions-exo/role-assignment-policies", "pdf": "m365"}, {"Rule_number": "6.4.1", "Rule": "6.4.1 (L1) Ensure mail forwarding rules are reviewed at least weekly (Manual)", "Profile_applicability": " E3 Level 1", "Description": "The Exchange Online environment can be configured in a way that allows for automatic forwarding of e-mail. This can be done using Transport Rules in the Admin Center, Auto Forwarding per mailbox, and client-based rules in Outlook. Administrators and users both are given several methods to automatically and quickly send e-mails outside of your organization.", "Rationale": "Reviewing mail forwarding rules will provide the Messaging Administrator with insight into possible attempts to exfiltrate data from the organization. Weekly review helps create a recognition of baseline, legitimate activity of users. This will aid in helping identify the more malicious activity of bad actors when/if they choose to use this side-channel.", "Impact": "There is no impact to reviewing these reports.", "Audit": {"General Audit Instructions": "To verify mail forwarding rules are being reviewed at least weekly, confirm that the \nnecessary procedures are in place and being followed by the assigned employee."}, "Remediation": {"General Remediation Instructions": "To review mail forwarding rules1. Navigate to Exchange admin center https://admin.exchange.microsoft.com. \n2. Expand Reports then select Mail flow. \n3. Click on Auto forwarded messages report. \n4. Review. \nNote: Mail flow reports cannot be viewed from the Classic Exchange Admin Center"}, "Default_value": "UI - My Custom Apps, My Marketplace Apps, and My ReadWriteMailboxApps are checked PowerShell - My Custom Apps My Marketplace Apps and My ReadWriteMailboxApps are assigned References: 1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/add-ins-for-outlook/specify-who-can-install-and-manage-add-ins?source=recommendations 2. https://learn.microsoft.com/en-us/exchange/permissions-exo/role-assignment-policies", "pdf": "m365"}, {"Rule_number": "6.5.1", "Rule": "6.5.1 (L1) Ensure modern authentication for Exchange Online is enabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Modern authentication in Microsoft 365 enables authentication features like multifactor authentication (MFA) using smart cards, certificate-based authentication (CBA), and third-party SAML identity providers. When you enable modern authentication in Exchange Online, Outlook 2016 and Outlook 2013 use modern authentication to log in to Microsoft 365 mailboxes. When you disable modern authentication in Exchange Online, Outlook 2016 and Outlook 2013 use basic authentication to log in to Microsoft 365 mailboxes. When users initially configure certain email clients, like Outlook 2013 and Outlook 2016, they may be required to authenticate using enhanced authentication mechanisms, such as multifactor authentication. Other Outlook clients that are available in Microsoft 365 (for example, Outlook Mobile and Outlook for Mac 2016) always use modern authentication to log in to Microsoft 365 mailboxes.", "Rationale": "Strong authentication controls, such as the use of multifactor authentication, may be circumvented if basic authentication is used by Exchange Online email clients such as Outlook 2016 and Outlook 2013. Enabling modern authentication for Exchange Online ensures strong authentication mechanisms are used when establishing sessions between email clients and Exchange Online.", "Impact": "Users of older email clients, such as Outlook 2013 and Outlook 2016, will no longer be able to authenticate to Exchange using Basic Authentication, which will necessitate migration to modern authentication practices.", "Audit": {"To audit using PowerShell": "1. Run the Microsoft Exchange Online PowerShell Module. \n2. Connect to Exchange Online using Connect-ExchangeOnline. \n3. Run the following PowerShell commandGet-OrganizationConfig | Format-Table -Auto Name, OAuth* \n4. Verify OAuth2ClientProfileEnabled is True."}, "Remediation": {"To remediate using PowerShell": "1. Run the Microsoft Exchange Online PowerShell Module. \n2. Connect to Exchange Online using Connect-ExchangeOnline. \n3. Run the following PowerShell commandSet-OrganizationConfig -OAuth2ClientProfileEnabled $True"}, "Default_value": "True References: 1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online", "pdf": "m365"}, {"Rule_number": "6.5.2", "Rule": "6.5.2 (L1) Ensure MailTips are enabled for end users (Automated)", "Profile_applicability": " E3 Level 1", "Description": "MailTips are informative messages displayed to users while they're composing a message. While a new message is open and being composed, Exchange analyzes the message (including recipients). If a potential problem is detected, the user is notified with a MailTip prior to sending the message. Using the information in the MailTip, the user can adjust the message to avoid undesirable situations or non-delivery reports (also known as NDRs or bounce messages).", "Rationale": "Setting up MailTips gives a visual aid to users when they send emails to large groups of recipients or send emails to recipients not within the tenant.", "Impact": "Not applicable.", "Audit": {"To audit using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-OrganizationConfig | fl MailTips* \n3. Verify the values for MailTipsAllTipsEnabled, \nMailTipsExternalRecipientsTipsEnabled, and MailTipsGroupMetricsEnabled \nare set to True and MailTipsLargeAudienceThreshold is set to an acceptable \nvalue; 25 is the default value."}, "Remediation": {"To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell command$TipsParams = @{ \n    MailTipsAllTipsEnabled                 = $true \n    MailTipsExternalRecipientsTipsEnabled  = $true \n    MailTipsGroupMetricsEnabled            = $true \n    MailTipsLargeAudienceThreshold         = '25' \n} \n \nSet-OrganizationConfig @TipsParams"}, "Default_value": "MailTipsAllTipsEnabled: True MailTipsExternalRecipientsTipsEnabled: False MailTipsGroupMetricsEnabled: True MailTipsLargeAudienceThreshold: 25 References: 1. https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/mailtips/mailtips 2. https://learn.microsoft.com/en-us/powershell/module/exchange/set-organizationconfig?view=exchange-ps", "pdf": "m365"}, {"Rule_number": "6.5.3", "Rule": "6.5.3 (L2) Ensure additional storage providers are restricted in Outlook on the web (Automated)", "Profile_applicability": " E3 Level 2", "Description": "This setting allows users to open certain external files while working in Outlook on the web. If allowed, keep in mind that Microsoft doesn't control the use terms or privacy policies of those third-party services. Ensure AdditionalStorageProvidersAvailable are restricted.", "Rationale": "By default additional storage providers are allowed in Office on the Web (such as Box, Dropbox, Facebook, Google Drive, OneDrive Personal, etc.). This could lead to information leakage and additional risk of infection from organizational non-trusted storage providers. Restricting this will inherently reduce risk as it will narrow opportunities for infection and data leakage.", "Impact": "Impact associated with this change is highly dependent upon current practices in the tenant. If users do not use other storage providers, then minimal impact is likely. However, if users do regularly utilize providers outside of the tenant this will affect their ability to continue to do so.", "Audit": {"To audit using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandGet-OwaMailboxPolicy | Format-Table Name, AdditionalStorageProvidersAvailable \n3. Verify that the value returned is False."}, "Remediation": {"To remediate using PowerShell": "1. Connect to Exchange Online using Connect-ExchangeOnline. \n2. Run the following PowerShell commandSet-OwaMailboxPolicy -Identity OwaMailboxPolicy-Default -\nAdditionalStorageProvidersAvailable $false"}, "Default_value": "Additional Storage Providers - True References: 1. https://learn.microsoft.com/en-us/powershell/module/exchange/set-owamailboxpolicy?view=exchange-ps 2. https://support.microsoft.com/en-us/topic/3rd-party-cloud-storage-services-supported-by-office-apps-fce12782-eccc-4cf5-8f4b-d1ebec513f72", "pdf": "m365"}, {"Rule_number": "7.2.1", "Rule": "7.2.1 (L1) Ensure modern authentication for SharePoint applications is required (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Modern authentication in Microsoft 365 enables authentication features like multifactor authentication (MFA) using smart cards, certificate-based authentication (CBA), and third-party SAML identity providers.", "Rationale": "Strong authentication controls, such as the use of multifactor authentication, may be circumvented if basic authentication is used by SharePoint applications. Requiring modern authentication for SharePoint applications ensures strong authentication mechanisms are used when establishing sessions between these applications, SharePoint, and connecting users.", "Impact": "Implementation of modern authentication for SharePoint will require users to authenticate to SharePoint using modern authentication. This may cause a minor impact to typical user behavior. This may also prevent third-party apps from accessing SharePoint Online resources. Also, this will also block apps using the SharePointOnlineCredentials class to access SharePoint Online resources.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint. \n2. Click to expand Policies select Access control. \n3. Select Apps that don't use modern authentication and ensure that it is set to \nBlock access.", "To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService -Url https://tenant-\nadmin.sharepoint.com replacing tenant with your value. \n2. Run the following SharePoint Online PowerShell commandGet-SPOTenant | ft LegacyAuthProtocolsEnabled \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint. \n2. Click to expand Policies select Access control. \n3. Select Apps that don't use modern authentication. \n4. Select the radio button for Block access. \n5. Click Save.", "To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService -Url https://tenant-\nadmin.sharepoint.com replacing tenant with your value. \n2. Run the following SharePoint Online PowerShell commandSet-SPOTenant -LegacyAuthProtocolsEnabled $false"}, "Default_value": "True (Apps that don't use modern authentication are allowed) References: 1. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-spotenant?view=sharepoint-ps", "pdf": "m365"}, {"Rule_number": "7.2.2", "Rule": "7.2.2 (L1) Ensure SharePoint and OneDrive integration with Azure AD B2B is enabled (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Entra ID B2B provides authentication and management of guests. Authentication happens via one-time passcode when they don't already have a work or school account or a Microsoft account. Integration with SharePoint and OneDrive allows for more granular control of how guest user accounts are managed in the organization's AAD, unifying a similar guest experience already deployed in other Microsoft 365 services such as Teams. Note: Global Reader role currently can't access SharePoint using PowerShell.", "Rationale": "External users assigned guest accounts will be subject to Entra ID access policies, such as multi-factor authentication. This provides a way to manage guest identities and control access to SharePoint and OneDrive resources. Without this integration, files can be shared without account registration, making it more challenging to audit and manage who has access to the organization's data.", "Impact": "B2B collaboration is used with other Entra services so should not be new or unusual. Microsoft also has made the experience seamless when turning on integration on SharePoint sites that already have active files shared with guest users. The referenced Microsoft article on the subject has more details on this.", "Audit": {"To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService \n2. Run the following commandGet-SPOTenant | ft EnableAzureADB2BIntegration \n3. Ensure the returned value is True."}, "Remediation": {"To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService \n2. Run the following commandSet-SPOTenant -EnableAzureADB2BIntegration $true"}, "Default_value": "False References: 1. https://learn.microsoft.com/en-us/sharepoint/sharepoint-azureb2b-integration#enabling-the-integration 2. https://learn.microsoft.com/en-us/azure/active-directory/external-identities/what-is-b2b 3. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-spotenant?view=sharepoint-ps", "pdf": "m365"}, {"Rule_number": "7.2.3", "Rule": "7.2.3 (L1) Ensure external content sharing is restricted (Automated)", "Profile_applicability": " E3 Level 1", "Description": "The external sharing settings govern sharing for the organization overall. Each site has its own sharing setting that can be set independently, though it must be at the same or more restrictive setting as the organization. The new and existing guests option requires people who have received invitations to sign in with their work or school account (if their organization uses Microsoft 365) or a Microsoft account, or to provide a code to verify their identity. Users can share with guests already in your organization's directory, and they can send invitations to people who will be added to the directory if they sign in. The recommended state is New and existing guests or less permissive.", "Rationale": "Forcing guest authentication on the organization's tenant enables the implementation of controls and oversight over external file sharing. When a guest is registered with the organization, they now have an identity which can be accounted for. This identity can also have other restrictions applied to it through group membership and conditional access rules.", "Impact": "When using B2B integration, Entra ID external collaboration settings, such as guest invite settings and collaboration restrictions apply.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Locate the External sharing section. \n4. Under SharePoint, ensure the slider bar is set to New and existing guests or a \nless permissive level.", "To audit using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletGet-SPOTenant | fl SharingCapability \n3. Ensure SharingCapability is set to one of the following valueso Value1: ExternalUserSharingOnly \no Value2: ExistingExternalUserSharingOnly \no Value3: Disabled"}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Locate the External sharing section. \n4. Under SharePoint, move the slider bar to New and existing guests or a less \npermissive level. \no OneDrive will also be moved to the same level and can never be more \npermissive than SharePoint.", "To remediate using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdlet to establish the minimum recommended stateSet-SPOTenant -SharingCapability ExternalUserSharingOnly \nNote: Other acceptable values for this parameter that are more restrictive includeDisabled and ExistingExternalUserSharingOnly."}, "Default_value": "Anyone (ExternalUserAndGuestSharing)", "pdf": "m365"}, {"Rule_number": "7.2.4", "Rule": "7.2.4 (L2) Ensure OneDrive content sharing is restricted (Automated)", "Profile_applicability": " E3 Level 2", "Description": "This setting governs the global permissiveness of OneDrive content sharing in the organization. OneDrive content sharing can be restricted independent of SharePoint but can never be more permissive than the level established with SharePoint. The recommended state is Only people in your organization.", "Rationale": "OneDrive, designed for end-user cloud storage, inherently provides less oversight and control compared to SharePoint, which often involves additional content overseers or site administrators. This autonomy can lead to potential risks such as inadvertent sharing of privileged information by end users. Restricting external OneDrive sharing will require users to transfer content to SharePoint folders first which have those tighter controls.", "Impact": "Users will be required to take additional steps to share OneDrive content or use other official channels.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Locate the External sharing section. \n4. Under OneDrive, ensure the slider bar is set to Only people in your \norganization.", "To audit using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletGet-SPOTenant | fl OneDriveSharingCapability \n3. Ensure the returned value is Disabled. \nAlternative audit method using PowerShell1. Connect to SharePoint Online. \n2. Use one of the following methods# Replace [tenant] with your tenant id \nGet-SPOSite -Identity https://[tenant]-my.sharepoint.com/ | fl \nUrl,SharingCapability \n \n# Or run this to filter to the specific site without supplying the tenant \nname. \n$OneDriveSite = Get-SPOSite -Filter { Url -like \"*-my.sharepoint.com/\" } \nGet-SPOSite -Identity $OneDriveSite | fl Url,SharingCapability \n2. Ensure the returned value for SharingCapability is Disabled \nNote: As of March 2024, using Get-SPOSite with Where-Object or filtering against the \nentire site and then returning the SharingCapability parameter can result in a different \nvalue as opposed to running the cmdlet specifically against the OneDrive specific site \nusing the -Identity switch as shown in the example. \nNote 2: The parameter OneDriveSharingCapability may not be yet fully available in all \ntenants. It is demonstrated in official Microsoft documentation as linked in the \nreferences section but not in the Set-SPOTenant cmdlet itself. If the parameter is \nunavailable, then either use the UI method or alternative PowerShell audit method."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Locate the External sharing section. \n4. Under OneDrive, set the slider bar to Only people in your organization.", "To remediate using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletSet-SPOTenant -OneDriveSharingCapability Disabled \nAlternative remediation method using PowerShell1. Connect to SharePoint Online. \n2. Run one of the following# Replace [tenant] with your tenant id \nSet-SPOSite -Identity https://[tenant]-my.sharepoint.com/ -SharingCapability \nDisabled \n \n# Or run this to filter to the specific site without supplying the tenant \nname. \n$OneDriveSite = Get-SPOSite -Filter { Url -like \"*-my.sharepoint.com/\" } \nSet-SPOSite -Identity $OneDriveSite -SharingCapability Disabled"}, "Default_value": "Anyone (ExternalUserAndGuestSharing) References: 1. https://learn.microsoft.com/en-us/sharepoint/dev/embedded/concepts/app-concepts/sharing-and-perm#container-partition", "pdf": "m365"}, {"Rule_number": "7.2.5", "Rule": "7.2.5 (L2) Ensure that SharePoint guest users cannot share items they don't own (Automated)", "Profile_applicability": " E3 Level 2", "Description": "SharePoint gives users the ability to share files, folders, and site collections. Internal users can share with external collaborators, and with the right permissions could share to other external parties.", "Rationale": "Sharing and collaboration are key; however, file, folder, or site collection owners should have the authority over what external users get shared with to prevent unauthorized disclosures of information.", "Impact": "The impact associated with this change is highly dependent upon current practices. If users do not regularly share with external parties, then minimal impact is likely. However, if users do regularly share with guests/externally, minimum impacts could occur as those external users will be unable to 're-share' content.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies then select Sharing. \n3. Expand More external sharing settings, verify that Allow guests to share \nitems they don't own is unchecked.", "To audit using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following SharePoint Online PowerShell commandGet-SPOTenant | ft PreventExternalUsersFromResharing \n3. Ensure the returned value is True."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies then select Sharing. \n3. Expand More external sharing settings, uncheck Allow guests to share \nitems they don't own. \n4. Click Save.", "To remediate using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following SharePoint Online PowerShell commandSet-SPOTenant -PreventExternalUsersFromResharing $True"}, "Default_value": "Checked (False) References: 1. https://learn.microsoft.com/en-us/sharepoint/turn-external-sharing-on-or-off 2. https://learn.microsoft.com/en-us/sharepoint/external-sharing-overview", "pdf": "m365"}, {"Rule_number": "7.2.6", "Rule": "7.2.6 (L2) Ensure SharePoint external sharing is managed through domain whitelist/blacklists (Automated)", "Profile_applicability": " E3 Level 2", "Description": "Control sharing of documents to external domains by either blocking domains or only allowing sharing with specific named domains.", "Rationale": "Attackers will often attempt to expose sensitive information to external entities through sharing, and restricting the domains that users can share documents with will reduce that surface area.", "Impact": "Enabling this feature will prevent users from sharing documents with domains outside of the organization unless allowed.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Expand Policies then click Sharing. \n3. Expand More external sharing settings and confirm that Limit external \nsharing by domain is checked. \n4. Verify that an accurate list of allowed domains is listed.", "To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService. \n2. Run the following PowerShell commandGet-SPOTenant | fl SharingDomainRestrictionMode,SharingAllowedDomainList \n3. Ensure that SharingDomainRestrictionMode is set to AllowList and \nSharingAllowedDomainList contains domains trusted by the organization for \nexternal sharing."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint. \n2. Expand Policies then click Sharing. \n3. Expand More external sharing settings and check Limit external sharing \nby domain. \n4. Select Add domains to add a list of approved domains. \n5. Click Save at the bottom of the page.", "To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService. \n2. Run the following PowerShell commandSet-SPOTenant -SharingDomainRestrictionMode AllowList -\nSharingAllowedDomainList \"domain1.com domain2.com\""}, "Default_value": "Limit external sharing by domain is unchecked SharingDomainRestrictionMode: None SharingDomainRestrictionMode: <Undefined>", "pdf": "m365"}, {"Rule_number": "7.2.7", "Rule": "7.2.7 (L1) Ensure link sharing is restricted in SharePoint and OneDrive (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This setting sets the default link type that a user will see when sharing content in OneDrive or SharePoint. It does not restrict or exclude any other options. The recommended state is Specific people (only the people the user specifies)", "Rationale": "By defaulting to specific people, the user will first need to consider whether or not the content being shared should be accessible by the entire organization versus select individuals. This aids in reinforcing the concept of least privilege. Audit: To audit using the UI: 1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint 2. Click to expand Policies > Sharing. 3. Scroll to File and folder links. 4. Ensure that the setting Choose the type of link that's selected by default when users share files and folders in SharePoint and OneDrive is set to Specific people (only the people the user specifies) To audit using PowerShell: 1. Connect to SharePoint Online using Connect-SPOService. 2. Run the following PowerShell command: Get-SPOTenant | fl DefaultSharingLinkType 3. Ensure the returned value is Direct.", "Impact": "Enabling this feature will prevent users from sharing documents with domains outside of the organization unless allowed.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to File and folder links. \n4. Ensure that the setting Choose the type of link that's selected by default \nwhen users share files and folders in SharePoint and OneDrive is set to \nSpecific people (only the people the user specifies)", "To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService. \n2. Run the following PowerShell commandGet-SPOTenant | fl DefaultSharingLinkType \n3. Ensure the returned value is Direct."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to File and folder links. \n4. Set Choose the type of link that's selected by default when users share \nfiles and folders in SharePoint and OneDrive to Specific people (only the \npeople the user specifies)", "To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService. \n2. Run the following PowerShell commandSet-SPOTenant -DefaultSharingLinkType Direct"}, "Default_value": "Only people in your organization (Internal) References: 1. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-spotenant?view=sharepoint-ps", "pdf": "m365"}, {"Rule_number": "7.2.8", "Rule": "7.2.8 (L2) Ensure external sharing is restricted by security group (Manual)", "Profile_applicability": " E3 Level 2", "Description": "External sharing of content can be restricted to specific security groups. This setting is global, applies to sharing in both SharePoint and OneDrive and cannot be set at the site level in SharePoint. The recommended state is Enabled or Checked. Note: Users in these security groups must be allowed to invite guests in the guest invite settings in Microsoft Entra. Identity > External Identities > External collaboration settings", "Rationale": "Organizations wishing to create tighter security controls for external sharing can set this to enforce role-based access control by using security groups already defined in Microsoft Entra.", "Impact": "OneDrive will also be governed by this and there is no granular control at the SharePoint site level.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to and expand More external sharing settings. \n4. Ensure the followingo Verify Allow only users in specific security groups to share \nexternally is checked \no Verify Manage security groups is defined and accordance with company \nprocedure."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to and expand More external sharing settings. \n4. Set the followingo Check Allow only users in specific security groups to share \nexternally \no Define Manage security groups in accordance with company procedure."}, "Default_value": "Unchecked/Undefined References: 1. https://learn.microsoft.com/en-us/sharepoint/manage-security-groups", "pdf": "m365"}, {"Rule_number": "7.2.9", "Rule": "7.2.9 (L1) Ensure guest access to a site or OneDrive will expire automatically (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting configures the expiration time for each guest that is invited to the SharePoint site or with whom users share individual files and folders with. The recommended state is 30 or less.", "Rationale": "This setting ensures that guests who no longer need access to the site or link no longer have access after a set period of time. Allowing guest access for an indefinite amount of time could lead to loss of data confidentiality and oversight. Note: Guest membership applies at the Microsoft 365 group level. Guests who have permission to view a SharePoint site or use a sharing link may also have access to a Microsoft Teams team or security group.", "Impact": "Site collection administrators will have to renew access to guests who still need access after 30 days. They will receive an e-mail notification once per week about guest access that is about to expire. Note: The guest expiration policy only applies to guests who use sharing links or guests who have direct permissions to a SharePoint site after the guest policy is enabled. The guest policy does not apply to guest users that have pre-existing permissions or access through a sharing link before the guest expiration policy is applied.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to and expand More external sharing settings. \n4. Ensure Guest access to a site or OneDrive will expire automatically \nafter this many days is checked and set to 30 or less.", "To audit using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletGet-SPOTenant | fl ExternalUserExpirationRequired,ExternalUserExpireInDays \n3. Ensure the following values are returnedo ExternalUserExpirationRequired is True. \no ExternalUserExpireInDays is 30 or less."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to and expand More external sharing settings. \n4. Set Guest access to a site or OneDrive will expire automatically after \nthis many days to 30", "To remediate using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletSet-SPOTenant -ExternalUserExpireInDays 30 -ExternalUserExpirationRequired \n$True"}, "Default_value": "ExternalUserExpirationRequired $false ExternalUserExpireInDays 60 days", "pdf": "m365"}, {"Rule_number": "7.2.10", "Rule": "7.2.10 (L1) Ensure reauthentication with verification code is restricted (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This setting configures if guests who use a verification code to access the site or links are required to reauthenticate after a set number of days. The recommended state is 15 or less.", "Rationale": "By increasing the frequency of times guests need to reauthenticate this ensures guest user access to data is not prolonged beyond an acceptable amount of time.", "Impact": "Guests who use Microsoft 365 in their organization can sign in using their work or school account to access the site or document. After the one-time passcode for verification has been entered for the first time, guests will authenticate with their work or school account and have a guest account created in the host's organization. Note: If OneDrive and SharePoint integration with Entra ID B2B is enabled as per the CIS Benchmark the one-time-passcode experience will be replaced. Please visit Secure external sharing in SharePoint - SharePoint in Microsoft 365 | Microsoft Learn for more information.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to and expand More external sharing settings. \n4. Ensure People who use a verification code must reauthenticate after this \nmany days is set to 15 or less.", "To audit using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletGet-SPOTenant | fl EmailAttestationRequired,EmailAttestationReAuthDays \n3. Ensure the following values are returnedo EmailAttestationRequired True \no EmailAttestationReAuthDays 15 or less days."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click to expand Policies > Sharing. \n3. Scroll to and expand More external sharing settings. \n4. Set People who use a verification code must reauthenticate after this \nmany days to 15 or less.", "To remediate using PowerShell": "1. Connect to SharePoint Online service using Connect-SPOService. \n2. Run the following cmdletSet-SPOTenant -EmailAttestationRequired $true -EmailAttestationReAuthDays 15"}, "Default_value": "EmailAttestationRequired : False EmailAttestationReAuthDays : 30", "pdf": "m365"}, {"Rule_number": "7.3.1", "Rule": "7.3.1 (L2) Ensure Office 365 SharePoint infected files are disallowed for download (Automated)", "Profile_applicability": " E5 Level 2", "Description": "By default, SharePoint online allows files that Defender for Office 365 has detected as infected to be downloaded.", "Rationale": "Defender for Office 365 for SharePoint, OneDrive, and Microsoft Teams protects your organization from inadvertently sharing malicious files. When an infected file is detected that file is blocked so that no one can open, copy, move, or share it until further actions are taken by the organization's security team.", "Impact": "The only potential impact associated with implementation of this setting is potential inconvenience associated with the small percentage of false positive detections that may occur.", "Audit": {"To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService -Url https://tenant-\nadmin.sharepoint.com, replacing \"tenant\" with the appropriate value. \n2. Run the following PowerShell commandGet-SPOTenant | Select-Object DisallowInfectedFileDownload \n3. Ensure the value for DisallowInfectedFileDownload is set to True. \nNote: According to Microsoft, SharePoint cannot be accessed through PowerShell by \nusers with the Global Reader role. For further information, please refer to the reference \nsection."}, "Remediation": {"To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService -Url https://tenant-\nadmin.sharepoint.com, replacing \"tenant\" with the appropriate value. \n2. Run the following PowerShell command to set the recommended valueSet-SPOTenant \u2013DisallowInfectedFileDownload $true \nNote: The Global Reader role cannot access SharePoint using PowerShell according to \nMicrosoft. See the reference section for more information."}, "Default_value": "False References: 1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/safe-attachments-for-spo-odfb-teams-configure?view=o365-worldwide 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-malware-protection-for-spo-odfb-teams-about?view=o365-worldwide 3. https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#global-reader", "pdf": "m365"}, {"Rule_number": "7.3.2", "Rule": "7.3.2 (L2) Ensure OneDrive sync is restricted for unmanaged devices (Automated)", "Profile_applicability": " E3 Level 2", "Description": "Microsoft OneDrive allows users to sign in their cloud tenant account and begin syncing select folders or the entire contents of OneDrive to a local computer. By default, this includes any computer with OneDrive already installed, whether it is Azure Domain Joined or Active Directory Domain joined. The recommended state for this setting is Allow syncing only on computers joined to specific domains Enabled: Specify the AD domain GUID(s)", "Rationale": "Unmanaged devices pose a risk, since their security cannot be verified through existing security policies, brokers or endpoint protection. Allowing users to sync data to these devices takes that data out of the control of the organization. This increases the risk of the data either being intentionally or accidentally leaked. Note: This setting is only applicable to Active Directory domains when operating in a hybrid configuration. It does not apply to Entra ID domains. If there are devices which are only Entra ID joined, consider using a Conditional Access Policy instead.", "Impact": "Enabling this feature will prevent users from using the OneDrive for Business Sync client on devices that are not joined to the domains that were defined.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click Settings followed by OneDrive - Sync \n3. Verify that Allow syncing only on computers joined to specific domains is \nchecked. \n4. Verify that the Active Directory domain GUIDS are listed in the box. \no Use the Get-ADDomain PowerShell command on the on-premises server to \nobtain the GUID for each on-premises domain.", "To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService -Url https://tenant-\nadmin.sharepoint.com, replacing \"tenant\" with the appropriate value. \n2. Run the following PowerShell commandGet-SPOTenantSyncClientRestriction | fl \nTenantRestrictionEnabled,AllowedDomainList \n3. Ensure TenantRestrictionEnabled is set to True and AllowedDomainList \ncontains the trusted domains GUIDs from the on premises environment."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Click Settings then select OneDrive - Sync. \n3. Check the Allow syncing only on computers joined to specific domains. \n4. Use the Get-ADDomain PowerShell command on the on-premises server to obtain \nthe GUID for each on-premises domain. \n5. Click Save.", "To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService \n2. Run the following PowerShell command and provide the DomainGuids from the \nGet-AADomain commandSet-SPOTenantSyncClientRestriction -Enable -DomainGuids \"786548DD-877B-4760-\nA749-6B1EFBC1190A; 877564FF-877B-4760-A749-6B1EFBC1190A\" \nNote: Utilize the -BlockMacSync:$true parameter if you are not using conditional \naccess to ensure Macs cannot sync."}, "Default_value": "False References: 1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/safe-attachments-for-spo-odfb-teams-configure?view=o365-worldwide 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/anti-malware-protection-for-spo-odfb-teams-about?view=o365-worldwide 3. https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#global-reader", "pdf": "m365"}, {"Rule_number": "7.3.3", "Rule": "7.3.3 (L1) Ensure custom script execution is restricted on personal sites (Manual)", "Profile_applicability": " E3 Level 1", "Description": "This setting controls custom script execution on OneDrive or user-created sites. Custom scripts can allow users to change the look, feel and behavior of sites and pages. Every script that runs in a SharePoint page (whether it's an HTML page in a document library or a JavaScript in a Script Editor Web Part) always runs in the context of the user visiting the page and the SharePoint application. This means: \u2022 Scripts have access to everything the user has access to. \u2022 Scripts can access content across several Microsoft 365 services and even beyond with Microsoft Graph integration. The recommended state is Prevent users from running custom script on personal sites and Prevent users from running custom script on self-service created sites", "Rationale": "Custom scripts could contain malicious instructions unknown to the user or administrator. When users are allowed to run custom script, the organization can no longer enforce governance, scope the capabilities of inserted code, block specific parts of code, or block all custom code that has been deployed. If scripting is allowed the following things can't be audited: \u2022 What code has been inserted \u2022 Where the code has been inserted \u2022 Who inserted the code Note: Microsoft recommends using the SharePoint Framework instead of custom scripts.", "Impact": "None - this is the default behavior.", "Audit": {"To audit using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Select Settings. \n3. At the bottom of the page click the classic settings page hyperlink. \n4. Scroll to locate the Custom Script section. On the right ensure the followingo Verify Prevent users from running custom script on personal sites is \nset. \no Verify Prevent users from running custom script on self-service \ncreated sites is set."}, "Remediation": {"To remediate using the UI": "1. Navigate to SharePoint admin center https://admin.microsoft.com/sharepoint \n2. Select Settings. \n3. At the bottom of the page click the classic settings page hyperlink. \n4. Scroll to locate the Custom Script section. On the right set the followingo Select Prevent users from running custom script on personal sites. \no Select Prevent users from running custom script on self-service \ncreated sites."}, "Default_value": "Selected Prevent users from running custom script on personal sites Selected Prevent users from running custom script on self-service created sites References: 1. https://learn.microsoft.com/en-us/sharepoint/allow-or-prevent-custom-script 2. https://learn.microsoft.com/en-us/sharepoint/security-considerations-of-allowing-custom-script 3. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-sposite?view=sharepoint-ps", "pdf": "m365"}, {"Rule_number": "7.3.4", "Rule": "7.3.4 (L1) Ensure custom script execution is restricted on site collections (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This setting controls custom script execution on a particular site (previously called \"site collection\"). Custom scripts can allow users to change the look, feel and behavior of sites and pages. Every script that runs in a SharePoint page (whether it's an HTML page in a document library or a JavaScript in a Script Editor Web Part) always runs in the context of the user visiting the page and the SharePoint application. This means: \u2022 Scripts have access to everything the user has access to. \u2022 Scripts can access content across several Microsoft 365 services and even beyond with Microsoft Graph integration. The recommended state is DenyAddAndCustomizePages set to $true.", "Rationale": "Custom scripts could contain malicious instructions unknown to the user or administrator. When users are allowed to run custom script, the organization can no longer enforce governance, scope the capabilities of inserted code, block specific parts of code, or block all custom code that has been deployed. If scripting is allowed the following things can't be audited: \u2022 What code has been inserted \u2022 Where the code has been inserted \u2022 Who inserted the code Note: Microsoft recommends using the SharePoint Framework instead of custom scripts.", "Impact": "None - this is the default behavior.", "Audit": {"To audit using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService. \n2. Run the following PowerShell command to show non-compliant resultsGet-SPOSite | Where-Object { $_.DenyAddAndCustomizePages -eq \"Disabled\" ` \n    -and $_.Url -notlike \"*-my.sharepoint.com/\" } | \n    ft Title, Url, DenyAddAndCustomizePages \n3. Ensure the returned value is for DenyAddAndCustomizePages is Enabled for each \nsite. \nNote: The property DenyAddAndCustomizePages cannot be set on the MySite host, which \nis displayed with a URL like https://tenant id-my.sharepoint.com/"}, "Remediation": {"To remediate using PowerShell": "1. Connect to SharePoint Online using Connect-SPOService. \n2. Edit the below and run for each site as needf8edSet-SPOSite -Identity <SiteUrl> -DenyAddAndCustomizePages $true \nNote: The property DenyAddAndCustomizePages cannot be set on the MySite host, which \nis displayed with a URL like https://tenant id-my.sharepoint.com/"}, "Default_value": "DenyAddAndCustomizePages $true or Enabled References: 1. https://learn.microsoft.com/en-us/sharepoint/allow-or-prevent-custom-script 2. https://learn.microsoft.com/en-us/sharepoint/security-considerations-of-allowing-custom-script 3. https://learn.microsoft.com/en-us/powershell/module/sharepoint-online/set-sposite?view=sharepoint-ps", "pdf": "m365"}, {"Rule_number": "8.1.1", "Rule": "8.1.1 (L2) Ensure external file sharing in Teams is enabled for only approved cloud storage services (Automated)", "Profile_applicability": " E3 Level 2", "Description": "Microsoft Teams enables collaboration via file sharing. This file sharing is conducted within Teams, using SharePoint Online, by default; however, third-party cloud services are allowed as well. Note: Skype for business is deprecated as of July 31, 2021 although these settings may still be valid for a period of time. See the link in the references section for more information.", "Rationale": "Ensuring that only authorized cloud storage providers are accessible from Teams will help to dissuade the use of non-approved storage providers.", "Impact": "The impact associated with this change is highly dependent upon current practices in the tenant. If users do not use other storage providers, then minimal impact is likely. However, if users do regularly utilize providers outside of the tenant this will affect their ability to continue to do so.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Teams select Teams settings. \n3. Under files verify that only authorized cloud storage options are set to On and all \nothers Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams \n2. Run the following to verify the recommended stateGet-CsTeamsClientConfiguration | fl \nAllowDropbox,AllowBox,AllowGoogleDrive,AllowShareFile,AllowEgnyte \n3. Verify that only authorized providers are set to True and all others False."}, "Remediation": {"General Remediation Instructions": "To set external file sharing in Teams1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Teams select Teams settings. \n3. Set any unauthorized providers to Off. \nTo set cloud sharing options using PowerShell1. Connect to Teams PowerShell using Connect-MicrosoftTeams \n2. Run the following PowerShell command to disable external providers that are not \nauthorized. (the example disables Citrix Files, DropBox, Box, Google Drive and \nEgnyte) \n$storageParams = @{ \n    AllowGoogleDrive = $false \n    AllowShareFile = $false \n    AllowBox = $false \n    AllowDropBox = $false \n    AllowEgnyte = $false \n} \n \nSet-CsTeamsClientConfiguration @storageParams"}, "Default_value": "AllowDropBox : True AllowBox : True AllowGoogleDrive : True AllowShareFile : True AllowEgnyte : True References: 1. https://learn.microsoft.com/en-us/microsoft-365/enterprise/manage-skype-for-business-online-with-microsoft-365-powershell?view=o365-worldwide", "pdf": "m365"}, {"Rule_number": "8.1.2", "Rule": "8.1.2 (L1) Ensure users can't send emails to a channel email address (Automated)", "Profile_applicability": " E3 Level 1", "Description": "Teams channel email addresses are an optional feature that allows users to email the Teams channel directly.", "Rationale": "Channel email addresses are not under the tenant\u2019s domain and organizations do not have control over the security settings for this email address. An attacker could email channels directly if they discover the channel email address.", "Impact": "Users will not be able to email the channel directly.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Teams select Teams settings. \n3. Under email integration verify that Users can send emails to a channel email \naddress is Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsClientConfiguration -Identity Global | fl AllowEmailIntoChannel \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Teams select Teams settings. \n3. Under email integration set Users can send emails to a channel email \naddress to Off.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsClientConfiguration -Identity Global -AllowEmailIntoChannel $false"}, "Default_value": "On (True) References: 1. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/step-by-step-guides/reducing-attack-surface-in-microsoft-teams?view=o365-worldwide#restricting-channel-email-messages-to-approved-domains 2. https://learn.microsoft.com/en-us/powershell/module/skype/set-csteamsclientconfiguration?view=skype-ps", "pdf": "m365"}, {"Rule_number": "8.2.1", "Rule": "8.2.1 (L1) Ensure 'external access' is restricted in the Teams admin center (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting controls chat with external unmanaged Skype and Teams users. Users in the organization will not be searchable by unmanaged Skype or Teams users and will have to initiate all communications with unmanaged users. Note: As of December 2021, the default for Teams external communication is set to 'People in my organization can communicate with Teams users whose accounts aren't managed by an organization.' Note #2: Skype for business is deprecated as of July 31, 2021, although these settings may still be valid for a period of time. See the link in the reference section for more information.", "Rationale": "Allowing users to communicate with Skype or Teams users outside of an organization presents a potential security threat as external users can interact with organization users over Skype for Business or Teams. While legitimate, productivity-improving scenarios exist, they are outweighed by the risk of data loss, phishing, and social engineering attacks against organization users via Teams. Some real-world attacks and exploits delivered via Teams over external access channels include: \u2022 DarkGate malware \u2022 Social engineering / Phishing attacks by \"Midnight Blizzard\" \u2022 GIFShell \u2022 Username enumeration", "Impact": "The impact of disabling external access to Teams and Skype for an organization is highly dependent on current usage practices. If users infrequently communicate with external parties using these channels, the impact is likely to be minimal. However, if users regularly use Teams and Skype for client communication, the impact could be significant. Therefore, before disabling external access, users should be notified, and alternate communication mechanisms should be identified to ensure continuity of communication. Note: Chat with external unmanaged Teams users isn't available in GCC, GCC High, or DOD deployments, or in private cloud environments.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com/. \n2. Click to expand Users select External access. \n3. Under Teams and Skype for Business users in external organizations \nensure Block all external domains \no If the organization's policy allows select Allow only specific external \ndomains and add the allowed domains names. \n4. Under Teams accounts not managed by an organization ensure the slider is set \nto Off. \n5. Under Skype users ensure the slider is set to Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams \n2. Run the following commandGet-CsTenantFederationConfiguration | fl \nAllowTeamsConsumer,AllowPublicUsers,AllowFederatedUsers,AllowedDomains \n\u2022State: AllowTeamsConsumer is False \n\u2022State: AllowPublicUsers is False \n\u2022State: AllowFederatedUsers is False OR, \n\u2022If: AllowFederatedUsers is True then ensure AllowedDomains contains authorized \ndomain names."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com/. \n2. Click to expand Users select External access. \n3. Under Teams and Skype for Business users in external organizations \nSelect Block all external domains \no If the organization's policy allows select any allowed external domains. \n4. Under Teams accounts not managed by an organization move the slider to Off. \n5. Under Skype users move the slider is to Off. \n6. Click Save.", "To remediate using PowerShell": "\n\u2022 \nConnect to Teams PowerShell using Connect-MicrosoftTeams \n\u2022Run the following commandSet-CsTenantFederationConfiguration -AllowTeamsConsumer False -\nAllowPublicUsers False -AllowFederatedUsers $false \n\u2022To allow only specific external domains run these commands replacing the \nexample domains with approved domainsSet-CsTenantFederationConfiguration -AllowTeamsConsumer $false -\nAllowPublicUsers $false -AllowFederatedUsers $true \n$list = New-Object Collections.Generic.List[String] \n$list.add(\"contoso.com\") \n$list.add(\"fabrikam.com\") \nSet-CsTenantFederationConfiguration -AllowedDomainsAsAList $list"}, "Default_value": "\u2022 AllowTeamsConsumer : True  \u2022 AllowPublicUsers : True  \u2022 AllowFederatedUsers : True  \u2022 AllowedDomains : AllowAllKnownDomains", "pdf": "m365"}, {"Rule_number": "8.4.1", "Rule": "8.4.1 (L1) Ensure app permission policies are configured (Manual)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting controls which class of apps are available for users to install.", "Rationale": "Allowing users to install third-party or unverified apps poses a potential risk of introducing malicious software to the environment.", "Impact": "Users will only be able to install approved classes of apps.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Teams apps select Manage apps. \n3. In the upper right click Actions > Org-wide app settings. \n4. For Microsoft apps verify that Let users install and use available apps by \ndefault is On or less permissive. \n5. For Third-party apps verify Let users install and use available apps by \ndefault is Off. \n6. For Custom apps verify Let users install and use available apps by default \nis Off. \n7. For Custom apps verify Upload custom apps for personal use is Off. \nNote: The Global Reader role is not able to view the Teams apps blade, Teams \nAdministrator or higher is required."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Teams apps select Manage apps. \n3. In the upper right click Actions > Org-wide app settings. \n4. For Microsoft apps set Let users install and use available apps by \ndefault to On or less permissive. \n5. For Third-party apps set Let users install and use available apps by \ndefault to Off. \n6. For Custom apps set Let users install and use available apps by default to \nOff. \n7. For Custom apps set Upload custom apps for personal use to Off."}, "Default_value": "Microsoft apps: On Third-party apps: On Custom apps: On References: 1. https://learn.microsoft.com/en-us/microsoftteams/app-centric-management 2. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/step-by-step-guides/reducing-attack-surface-in-microsoft-teams?view=o365-worldwide#disabling-third-party--custom-apps", "pdf": "m365"}, {"Rule_number": "8.5.1", "Rule": "8.5.1 (L2) Ensure anonymous users can't join a meeting (Automated)", "Profile_applicability": " E3 Level 2", "Description": "This policy setting can prevent anyone other than invited attendees (people directly invited by the organizer, or to whom an invitation was forwarded) from bypassing the lobby and entering the meeting. For more information on how to setup a sensitive meeting, please visit Configure Teams meetings with protection for sensitive data - Microsoft Teams: https://learn.microsoft.com/en-us/MicrosoftTeams/configure-meetings-sensitive-protection", "Rationale": "For meetings that could contain sensitive information, it is best to allow the meeting organizer to vet anyone not directly sent an invite before admitting them to the meeting. This will also prevent the anonymous user from using the meeting link to have meetings at unscheduled times. Note: Those companies that don't normally operate at a Level 2 environment, but do deal with sensitive information, may want to consider this policy setting.", "Impact": "Individuals who were not sent or forwarded a meeting invite will not be able to join the meeting automatically.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby verify that Anonymous users can join a meeting is \nset to Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl \nAllowAnonymousUsersToJoinMeeting \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default) \n4. Under meeting join & lobby set Anonymous users can join a meeting to Off.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -AllowAnonymousUsersToJoinMeeting \n$false"}, "Default_value": "On (True) References: 1. https://learn.microsoft.com/en-us/MicrosoftTeams/configure-meetings-sensitive-protection", "pdf": "m365"}, {"Rule_number": "8.5.2", "Rule": "8.5.2 (L1) Ensure anonymous users and dial-in callers can't start a meeting (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting controls if an anonymous participant can start a Microsoft Teams meeting without someone in attendance. Anonymous users and dial-in callers must wait in the lobby until the meeting is started by someone in the organization or an external user from a trusted organization. Anonymous participants are classified as: \u2022 Participants who are not logged in to Teams with a work or school account. \u2022 Participants from non-trusted organizations (as configured in external access). \u2022 Participants from organizations where there is not mutual trust. Note: This setting only applies when Who can bypass the lobby is set to Everyone. If the anonymous users can join a meeting organization-level setting or meeting policy is Off, this setting only applies to dial-in callers.", "Rationale": "Not allowing anonymous participants to automatically join a meeting reduces the risk of meeting spamming.", "Impact": "Anonymous participants will not be able to start a Microsoft Teams meeting.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby verify that Anonymous users and dial-in callers \ncan start a meeting is set to Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl \nAllowAnonymousUsersToStartMeeting \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby set Anonymous users and dial-in callers can \nstart a meeting to Off.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -AllowAnonymousUsersToStartMeeting \n$false"}, "Default_value": "Off (False) References: 1. https://learn.microsoft.com/en-us/microsoftteams/anonymous-users-in-meetings 2. https://learn.microsoft.com/en-US/microsoftteams/who-can-bypass-meeting-lobby?WT.mc_id=TeamsAdminCenterCSH#overview-of-lobby-settings-and-policies", "pdf": "m365"}, {"Rule_number": "8.5.3", "Rule": "8.5.3 (L1) Ensure only people in my org can bypass the lobby (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting controls who can join a meeting directly and who must wait in the lobby until they're admitted by an organizer, co-organizer, or presenter of the meeting.", "Rationale": "For meetings that could contain sensitive information, it is best to allow the meeting organizer to vet anyone not directly sent an invite before admitting them to the meeting. This will also prevent the anonymous user from using the meeting link to have meetings at unscheduled times.", "Impact": "Individuals who are not part of the organization will have to wait in the lobby until they're admitted by an organizer, co-organizer, or presenter of the meeting. Any individual who dials into the meeting regardless of status will also have to wait in the lobby. This includes internal users who are considered unauthenticated when dialing in.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby verify Who can bypass the lobby is set to People in \nmy org.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl AutoAdmittedUsers \n3. Ensure the returned value is EveryoneInCompanyExcludingGuests"}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby set Who can bypass the lobby to People in my org.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -AutoAdmittedUsers \n\"EveryoneInCompanyExcludingGuests\""}, "Default_value": "People in my org and guests (EveryoneInCompany) References: 1. https://learn.microsoft.com/en-US/microsoftteams/who-can-bypass-meeting-lobby?WT.mc_id=TeamsAdminCenterCSH 2. https://learn.microsoft.com/en-us/powershell/module/skype/set-csteamsmeetingpolicy?view=skype-ps", "pdf": "m365"}, {"Rule_number": "8.5.4", "Rule": "8.5.4 (L1) Ensure users dialing in can't bypass the lobby (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting controls if users who dial in by phone can join the meeting directly or must wait in the lobby. Admittance to the meeting from the lobby is authorized by the meeting organizer, co-organizer, or presenter of the meeting.", "Rationale": "For meetings that could contain sensitive information, it is best to allow the meeting organizer to vet anyone not directly from the organization.", "Impact": "Individuals who are dialing in to the meeting must wait in the lobby until a meeting organizer, co-organizer, or presenter admits them.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby verify that People dialing in can bypass the lobby \nis set to Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl AllowPSTNUsersToBypassLobby \n3. Ensure the value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting join & lobby set People dialing in can bypass the lobby to \nOff.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -AllowPSTNUsersToBypassLobby $false"}, "Default_value": "Off (False) References: 1. https://learn.microsoft.com/en-US/microsoftteams/who-can-bypass-meeting-lobby?WT.mc_id=TeamsAdminCenterCSH#choose-who-can-bypass-the-lobby-in-meetings-hosted-by-your-organization 2. https://learn.microsoft.com/en-us/powershell/module/skype/set-csteamsmeetingpolicy?view=skype-ps", "pdf": "m365"}, {"Rule_number": "8.5.5", "Rule": "8.5.5 (L2) Ensure meeting chat does not allow anonymous users (Automated)", "Profile_applicability": " E3 Level 2", "Description": "This policy setting controls who has access to read and write chat messages during a meeting.", "Rationale": "Ensuring that only authorized individuals can read and write chat messages during a meeting reduces the risk that a malicious user can inadvertently show content that is not appropriate or view sensitive information.", "Impact": "Only authorized individuals will be able to read and write chat messages during a meeting.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting engagement verify that Meeting chat is set to On for everyone \nbut anonymous users.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl MeetingChatEnabledType \n3. Ensure the returned value is EnabledExceptAnonymous."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting engagement set Meeting chat to On for everyone but \nanonymous users.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -MeetingChatEnabledType \n\"EnabledExceptAnonymous\""}, "Default_value": "On for everyone (Enabled) References: 1. https://learn.microsoft.com/en-us/powershell/module/skype/set-csteamsmeetingpolicy?view=skype-ps#-meetingchatenabledtype", "pdf": "m365"}, {"Rule_number": "8.5.6", "Rule": "8.5.6 (L2) Ensure only organizers and co-organizers can present (Automated)", "Profile_applicability": " E3 Level 2", "Description": "This policy setting controls who can present in a Teams meeting. Note: Organizers and co-organizers can change this setting when the meeting is set up.", "Rationale": "Ensuring that only authorized individuals are able to present reduces the risk that a malicious user can inadvertently show content that is not appropriate.", "Impact": "Only organizers and co-organizers will be able to present without being granted permission.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under content sharing verify Who can present is set to Only organizers and co-\norganizers.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl DesignatedPresenterRoleMode \n3. Ensure the returned value is OrganizerOnlyUserOverride."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under content sharing set Who can present to Only organizers and co-\norganizers.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -DesignatedPresenterRoleMode \n\"OrganizerOnlyUserOverride\""}, "Default_value": "Everyone (EveryoneUserOverride) References: 1. https://learn.microsoft.com/en-US/microsoftteams/meeting-who-present-request-control 2. https://learn.microsoft.com/en-us/microsoftteams/meeting-who-present-request-control#manage-who-can-present 3. https://learn.microsoft.com/en-us/microsoft-365/security/office-365-security/step-by-step-guides/reducing-attack-surface-in-microsoft-teams?view=o365-worldwide#configure-meeting-settings-restrict-presenters 4. https://learn.microsoft.com/en-us/powershell/module/skype/set-csteamsmeetingpolicy?view=skype-ps", "pdf": "m365"}, {"Rule_number": "8.5.7", "Rule": "8.5.7 (L1) Ensure external participants can't give or request control (Automated)", "Profile_applicability": " E3 Level 1", "Description": "This policy setting allows control of who can present in meetings and who can request control of the presentation while a meeting is underway.", "Rationale": "Ensuring that only authorized individuals and not external participants are able to present and request control reduces the risk that a malicious user can inadvertently show content that is not appropriate. External participants are categorized as follows: external users, guests, and anonymous users.", "Impact": "External participants will not be able to present or request control during the meeting. Warning: This setting also affects webinars. Note: At this time, to give and take control of shared content during a meeting, both parties must be using the Teams desktop client. Control isn't supported when either party is running Teams in a browser.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under content sharing verify that External participants can give or request \ncontrol is Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl \nAllowExternalParticipantGiveRequestControl \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under content sharing set External participants can give or request \ncontrol to Off.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -\nAllowExternalParticipantGiveRequestControl $false"}, "Default_value": "Off (False) References: 1. https://learn.microsoft.com/en-us/microsoftteams/meeting-who-present-request-control 2. https://learn.microsoft.com/en-us/powershell/module/skype/set-csteamsmeetingpolicy?view=skype-ps", "pdf": "m365"}, {"Rule_number": "8.5.8", "Rule": "8.5.8 (L2) Ensure external meeting chat is off (Automated)", "Profile_applicability": " E3 Level 2", "Description": "This meeting policy setting controls whether users can read or write messages in external meeting chats with untrusted organizations. If an external organization is on the list of trusted organizations this setting will be ignored.", "Rationale": "Restricting access to chat in meetings hosted by external organizations limits the opportunity for an exploit like GIFShell or DarkGate malware from being delivered to users.", "Impact": "When joining external meetings users will be unable to read or write chat messages in Teams meetings with organizations that they don't have a trust relationship with. This will completely remove the chat functionality in meetings. From an I.T. perspective both the upkeep of adding new organizations to the trusted list and the decision-making process behind whether to trust or not trust an external partner will increase time expenditures.", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting engagement verify that External meeting chat is set to Off.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to verify the recommended stateGet-CsTeamsMeetingPolicy -Identity Global | fl \nAllowExternalNonTrustedMeetingChat \n3. Ensure the returned value is False."}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Meetings select Meeting policies. \n3. Click Global (Org-wide default). \n4. Under meeting engagement set External meeting chat to Off.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Run the following command to set the recommended stateSet-CsTeamsMeetingPolicy -Identity Global -AllowExternalNonTrustedMeetingChat \n$false"}, "Default_value": "On(True) References: 1. https://learn.microsoft.com/en-US/microsoftteams/settings-policies-reference?WT.mc_id=TeamsAdminCenterCSH#meeting-engagement", "pdf": "m365"}, {"Rule_number": "8.6.1", "Rule": "8.6.1 (L1) Ensure users can report security concerns in Teams (Automated)", "Profile_applicability": " E3 Level 1", "Description": "User reporting settings allow a user to report a message as malicious for further analysis. This recommendation is composed of 3 different settings and all be configured to pass: \u2022 In the Teams admin center: On by default and controls whether users are able to report messages from Teams. When this setting is turned off, users can't report messages within Teams, so the corresponding setting in the Microsoft 365 Defender portal is irrelevant. \u2022 In the Microsoft 365 Defender portal: On by default for new tenants. Existing tenants need to enable it. If user reporting of messages is turned on in the Teams admin center, it also needs to be turned on the Defender portal for user reported messages to show up correctly on the User reported tab on the Submissions page. \u2022 Defender - Report message destinations: This applies to more than just Microsoft Teams and allows for an organization to keep their reports contained. Due to how the parameters are configured on the backend it is included in this assessment as a requirement.", "Rationale": "Users will be able to more quickly and systematically alert administrators of suspicious malicious messages within Teams. The content of these messages may be sensitive in nature and therefore should be kept within the organization and not shared with Microsoft without first consulting company policy. Note: \u2022 The reported message remains visible to the user in the Teams client. \u2022 Users can report the same message multiple times. \u2022 The message sender isn't notified that messages were reported.", "Impact": "Enabling message reporting has an impact beyond just addressing security concerns. When users of the platform report a message, the content could include messages that are threatening or harassing in nature, possibly stemming from colleagues. Due to this the security staff responsible for reviewing and acting on these reports should be equipped with the skills to discern and appropriately direct such messages to the relevant departments, such as Human Resources (HR).", "Audit": {"To audit using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Messaging select Messaging policies. \n3. Click Global (Org-wide default). \n4. Ensure Report a security concern is On. \n5. Next, navigate to Microsoft 365 Defender https://security.microsoft.com/ \n6. Click on Settings > Email & collaboration > User reported settings. \n7. Scroll to Microsoft Teams. \n8. Ensure Monitor reported messages in Microsoft Teams is checked. \n9. Ensure Send reported messages to: is set to My reporting mailbox only with \nreport email addresses defined for authorized staff.", "To audit using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Connect to Exchange Online PowerShell using Connect-ExchangeOnline. \n3. Run the following cmdlet for to assess TeamsGet-CsTeamsMessagingPolicy -Identity Global | fl \nAllowSecurityEndUserReporting \n4. Ensure the value returned is True. \n5. Run this cmdlet to assess DefenderGet-ReportSubmissionPolicy | fl Report* \n6. Ensure the output matches the following values with organization specific email \naddressesReportJunkToCustomizedAddress               : True \nReportNotJunkToCustomizedAddress            : True \nReportPhishToCustomizedAddress              : True \nReportJunkAddresses                         : {SOC@contoso.com} \nReportNotJunkAddresses                      : {SOC@contoso.com} \nReportPhishAddresses                        : {SOC@contoso.com} \nReportChatMessageEnabled                    : False \nReportChatMessageToCustomizedAddressEnabled : True"}, "Remediation": {"To remediate using the UI": "1. Navigate to Microsoft Teams admin center https://admin.teams.microsoft.com. \n2. Click to expand Messaging select Messaging policies. \n3. Click Global (Org-wide default). \n4. Set Report a security concern to On. \n5. Next, navigate to Microsoft 365 Defender https://security.microsoft.com/ \n6. Click on Settings > Email & collaboration > User reported settings. \n7. Scroll to Microsoft Teams. \n8. Check Monitor reported messages in Microsoft Teams and Save. \n9. Set Send reported messages to: to My reporting mailbox only with reports \nconfigured to be sent to authorized staff.", "To remediate using PowerShell": "1. Connect to Teams PowerShell using Connect-MicrosoftTeams. \n2. Connect to Exchange Online PowerShell using Connect-ExchangeOnline. \n3. Run the following cmdletSet-CsTeamsMessagingPolicy -Identity Global -AllowSecurityEndUserReporting \n$true \n4. To configure the Defender reporting policies, edit and run this script$usersub = \"userreportedmessages@fabrikam.com\" # Change this. \n \n$params = @{ \n    Identity                         = \"DefaultReportSubmissionPolicy\" \n    EnableReportToMicrosoft          = $false \n    ReportChatMessageEnabled         = $false \n    ReportChatMessageToCustomizedAddressEnabled = $true \n    ReportJunkToCustomizedAddress    = $true \n    ReportNotJunkToCustomizedAddress = $true \n    ReportPhishToCustomizedAddress   = $true \n    ReportJunkAddresses              = $usersub \n    ReportNotJunkAddresses           = $usersub \n    ReportPhishAddresses             = $usersub \n} \n \nSet-ReportSubmissionPolicy @params \n \nNew-ReportSubmissionRule -Name DefaultReportSubmissionRule -\nReportSubmissionPolicy DefaultReportSubmissionPolicy -SentTo $usersub"}, "Default_value": "On (True) Report message destination: Microsoft Only", "pdf": "m365"}, {"Rule_number": "9.1.1", "Rule": "9.1.1 (L1) Ensure guest user access is restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "This setting allows business-to-business (B2B) guests access to Microsoft Fabric, and contents that they have permissions to. With the setting turned off, B2B guest users receive an error when trying to access Power BI. The recommended state is Enabled for a subset of the organization or Disabled.", "Rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Azure that are new or assigned guest status from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.", "Impact": "Security groups will need to be more closely tended to and monitored.", "Audit": {"General Audit Instructions": "Ensure guest user access is restricted1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Ensure that Guest users can access Microsoft Fabric adheres to one of these \nstateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Remediation": {"General Remediation Instructions": "Restrict guest user access1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Set Guest users can access Microsoft Fabric to one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Default_value": "Enabled for Entire Organization References: 1. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing", "pdf": "m365"}, {"Rule_number": "9.1.2", "Rule": "9.1.2 (L1) Ensure external user invitations are restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "This setting helps organizations choose whether new external users can be invited to the organization through Power BI sharing, permissions, and subscription experiences. This setting only controls the ability to invite through Power BI. The recommended state is Enabled for a subset of the organization or Disabled. Note: To invite external users to the organization, the user must also have the Microsoft Entra Guest Inviter role.", "Rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Azure that are new or assigned guest status from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.", "Impact": "Guest user invitations will be limited to only specific employees.", "Audit": {"General Audit Instructions": "Ensure external user invitations are restricted1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Ensure that Users can invite guest users to collaborate through item \nsharing and permissions adheres to one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Remediation": {"General Remediation Instructions": "Restrict external user invitations1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Set Users can invite guest users to collaborate through item sharing and \npermissions to one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Default_value": "Enabled for the entire organization References: 1. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing 2. https://learn.microsoft.com/en-us/power-bi/enterprise/service-admin-azure-ad-b2b#invite-guest-users", "pdf": "m365"}, {"Rule_number": "9.1.3", "Rule": "9.1.3 (L1) Ensure guest access to content is restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "This setting allows Microsoft Entra B2B guest users to have full access to the browsing experience using the left-hand navigation pane in the organization. Guest users who have been assigned workspace roles or specific item permissions will continue to have those roles and/or permissions, even if this setting is disabled. The recommended state is Enabled for a subset of the organization or Disabled.", "Rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Entra that are new or assigned guest status from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.", "Impact": "Security groups will need to be more closely tended to and monitored.", "Audit": {"General Audit Instructions": "Ensure guest user content access is restricted1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Ensure that Guest users can browse and access Fabric content adheres to \none of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Remediation": {"General Remediation Instructions": "Restrict guest user content access1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Set Guest users can browse and access Fabric content to one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Default_value": "Disabled References: 1. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing", "pdf": "m365"}, {"Rule_number": "9.1.4", "Rule": "9.1.4 (L1) Ensure 'Publish to web' is restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Power BI enables users to share reports and materials directly on the internet from both the application's desktop version and its web user interface. This functionality generates a publicly reachable web link that doesn't necessitate authentication or the need to be an AAD user in order to access and view it. The recommended state is Enabled for a subset of the organization or Disabled.", "Rationale": "When using Publish to Web anyone on the Internet can view a published report or visual. Viewing requires no authentication. It includes viewing detail-level data that your reports aggregate. By disabling the feature, restricting access to certain users and allowing existing embed codes organizations can mitigate the exposure of confidential or proprietary information.", "Impact": "Depending on the organization's utilization administrators may experience more overhead managing embed codes, and requests.", "Audit": {"General Audit Instructions": "Ensure Publish to web is restricted1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Ensure that Publish to web adheres to one of these stateso State 1: Disabled \no State 2: Enabled with Choose how embed codes work set to Only allow \nexisting codes AND Specific security groups selected and defined \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Remediation": {"General Remediation Instructions": "Restrict Publish to web1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Set Publish to web to one of these stateso State 1: Disabled \no State 2: Enabled with Choose how embed codes work set to Only allow \nexisting codes AND Specific security groups selected and defined \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Default_value": "Enabled for the entire organization Only allow existing codes References: 1. https://learn.microsoft.com/en-us/power-bi/collaborate-share/service-publish-to-web 2. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing#publish-to-web", "pdf": "m365"}, {"Rule_number": "9.1.5", "Rule": "9.1.5 (L2) Ensure 'Interact with and share R and Python' visuals is 'Disabled' (Manual)", "Profile_applicability": " E3 Level 2", "Description": "Power BI allows the integration of R and Python scripts directly into visuals. This feature allows data visualizations by incorporating custom calculations, statistical analyses, machine learning models, and more using R or Python scripts. Custom visuals can be created by embedding them directly into Power BI reports. Users can then interact with these visuals and see the results of the custom code within the Power BI interface.", "Rationale": "Disabling this feature can reduce the attack surface by preventing potential malicious code execution leading to data breaches, or unauthorized access. The potential for sensitive or confidential data being leaked to unintended users is also increased with the use of scripts.", "Impact": "Use of R and Python scripting will require exceptions for developers, along with more stringent code review.", "Audit": {"General Audit Instructions": "Ensure the recommended state is configured1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to R and Python visuals settings. \n4. Ensure that Interact with and share R and Python visuals is Disabled"}, "Remediation": {"General Remediation Instructions": "Configure the recommended state1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to R and Python visuals settings. \n4. Set Interact with and share R and Python visuals to Disabled"}, "Default_value": "Enabled", "pdf": "m365"}, {"Rule_number": "9.1.6", "Rule": "9.1.6 (L1) Ensure 'Allow users to apply sensitivity labels for content' is 'Enabled' (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Information protection tenant settings help to protect sensitive information in the Power BI tenant. Allowing and applying sensitivity labels to content ensures that information is only seen and accessed by the appropriate users. The recommended state is Enabled or Enabled for a subset of the organization. Note: Sensitivity labels and protection are only applied to files exported to Excel, PowerPoint, or PDF files, that are controlled by \"Export to Excel\" and \"Export reports as PowerPoint presentation or PDF documents\" settings. All other export and sharing options do not support the application of sensitivity labels and protection. Note 2: There are some prerequisite steps that need to be completed in order to fully utilize labeling. See here.", "Rationale": "Establishing data classifications and affixing labels to data at creation enables organizations to discern the data's criticality, sensitivity, and value. This initial identification enables the implementation of appropriate protective measures, utilizing technologies like Data Loss Prevention (DLP) to avert inadvertent exposure and enforcing access controls to safeguard against unauthorized access. This practice can also promote user awareness and responsibility in regard to the nature of the data they interact with. Which in turn can foster awareness in other areas of data management across the organization.", "Impact": "Additional license requirements like Power BI Pro are required, as outlined in the Licensed and requirements page linked in the description and references sections.", "Audit": {"General Audit Instructions": "Ensure sensitivity labels are Enabled1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Information protection. \n4. Ensure that Allow users to apply sensitivity labels for content adheres to \none of these stateso State 1: Enabled \no State 2: Enabled with Specific security groups selected and defined."}, "Remediation": {"Enable sensitivity labels:": "1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Information protection. \n4. Set Allow users to apply sensitivity labels for content to one of these \nstateso State 1: Enabled \no State 2: Enabled with Specific security groups selected and defined."}, "Default_value": "Disabled References: 1. https://learn.microsoft.com/en-us/power-bi/enterprise/service-security-enable-data-sensitivity-labels 2. https://learn.microsoft.com/en-us/power-bi/enterprise/service-security-dlp-policies-for-power-bi-overview 3. https://learn.microsoft.com/en-us/power-bi/enterprise/service-security-enable-data-sensitivity-labels#licensing-and-requirements", "pdf": "m365"}, {"Rule_number": "9.1.7", "Rule": "9.1.7 (L1) Ensure shareable links are restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Creating a shareable link allows a user to create a link to a report or dashboard, then add that link to an email or another messaging application. There are 3 options that can be selected when creating a shareable link: \u2022 People in your organization \u2022 People with existing access \u2022 Specific people This setting solely deals with restrictions to People in the organization. External users by default are not included in any of these categories, and therefore cannot use any of these links regardless of the state of this setting. The recommended state is Enabled for a subset of the organization or Disabled.", "Rationale": "While external users are unable to utilize shareable links, disabling or restricting this feature ensures that a user cannot generate a link accessible by individuals within the same organization who lack the necessary clearance to the shared data. For example, a member of Human Resources intends to share sensitive information with a particular employee or another colleague within their department. The owner would be prompted to specify either People with existing access or Specific people when generating the link requiring the person clicking the link to pass a first layer access control list. This measure along with proper file and folder permissions can help prevent unintended access and potential information leakage.", "Impact": "If the setting is Enabled then only specific people in the organization would be allowed to create general links viewable by the entire organization.", "Audit": {"General Audit Instructions": "Ensure shareable links are restricted1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Ensure that Allow shareable links to grant access to everyone in your \norganization adheres to one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Remediation": {"General Remediation Instructions": "Restrict shareable links1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Set Allow shareable links to grant access to everyone in your \norganization to one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Default_value": "Enabled for Entire Organization References: 1. https://learn.microsoft.com/en-us/power-bi/collaborate-share/service-share-dashboards?wt.mc_id=powerbi_inproduct_sharedialog#link-settings 2. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing", "pdf": "m365"}, {"Rule_number": "9.1.8", "Rule": "9.1.8 (L1) Ensure enabling of external data sharing is restricted (Manual)", "Profile_applicability": " E3 Level 1", "Description": "Power BI admins can specify which users or user groups can share datasets externally with guests from a different tenant through the in-place mechanism. Disabling this setting prevents any user from sharing datasets externally by restricting the ability of users to turn on external sharing for datasets they own or manage. The recommended state is Enabled for a subset of the organization or Disabled.", "Rationale": "Establishing and enforcing a dedicated security group prevents unauthorized access to Microsoft Fabric for guests collaborating in Azure that are new or from other applications. This upholds the principle of least privilege and uses role-based access control (RBAC). These security groups can also be used for tasks like conditional access, enhancing risk management and user accountability across the organization.", "Impact": "Security groups will need to be more closely tended to and monitored.", "Audit": {"General Audit Instructions": "Ensure external data sharing is restricted1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Ensure that Allow specific users to turn on external data sharing adheres \nto one of these stateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Remediation": {"General Remediation Instructions": "Restrict external data sharing1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Export and Sharing settings. \n4. Set Allow specific users to turn on external data sharing to one of these \nstateso State 1: Disabled \no State 2: Enabled with Specific security groups selected and defined. \nImportant: If the organization doesn't actively use this feature it is recommended to \nkeep it Disabled."}, "Default_value": "Enabled for the entire organization References: 1. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing", "pdf": "m365"}, {"Rule_number": "9.1.9", "Rule": "9.1.9 (L1) Ensure 'Block ResourceKey Authentication' is 'Enabled' (Manual)", "Profile_applicability": " E3 Level 1", "Description": "This setting blocks the use of resource key based authentication. The Block ResourceKey Authentication setting applies to streaming and PUSH datasets. If blocked users will not be allowed send data to streaming and PUSH datasets using the API with a resource key. The recommended state is Enabled.", "Rationale": "Resource keys are a form of authentication that allows users to access Power BI resources (such as reports, dashboards, and datasets) without requiring individual user accounts. While convenient, this method bypasses the organization's centralized identity and access management controls. Enabling ensures that access to Power BI resources is tied to the organization's authentication mechanisms, providing a more secure and controlled environment.", "Impact": "Developers will need to request a special exception in order to use this feature.", "Audit": {"General Audit Instructions": "Ensure ResourceKey Authentication is Enabled1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Developer settings. \n4. Ensure that Block ResourceKey Authentication is Enabled"}, "Remediation": {"General Remediation Instructions": "Ensure ResourceKey Authentication is Enabled1. Navigate to Microsoft Fabric https://app.powerbi.com/admin-portal \n2. Select Tenant settings. \n3. Scroll to Developer settings. \n4. Set Block ResourceKey Authentication to Enabled"}, "Default_value": "Enabled for the entire organization References: 1. https://learn.microsoft.com/en-us/power-bi/admin/service-admin-portal-export-sharing", "pdf": "m365"}, {"Rule_number": "1.1.1", "Rule": "1.1.1 Ensure Security Defaults is enabled on Microsoft Entra ID (Manual)", "Profile_applicability": " Level 1", "Description": "Security defaults in Microsoft Entra ID make it easier to be secure and help protect your organization. Security defaults contain preconfigured security settings for common attacks. Security defaults is available to everyone. The goal is to ensure that all organizations have a basic level of security enabled at no extra cost. You may turn on security defaults in the Azure portal.", "Rationale": "Security defaults provide secure default settings that we manage on behalf of organizations to keep customers safe until they are ready to manage their own identity security settings. For example, doing the following: \u2022 Requiring all users and admins to register for MFA. \u2022 Challenging users with MFA - when necessary, based on factors such as location, device, role, and task. \u2022 Disabling authentication from legacy authentication clients, which can\u2019t do MFA.", "Impact": "This recommendation should be implemented initially and then may be overridden by other service/product specific CIS Benchmarks. Administrators should also be aware that certain configurations in Microsoft Entra ID may impact other Microsoft services such as Microsoft 365.", "Audit": {"From Azure Portal": "To ensure security defaults is enabled in your directory1. From Azure Home select the Portal Menu. \n2. Browse to\u202fMicrosoft Entra ID\u202f>\u202fProperties. \n3. Select Manage security defaults. \n4. Verify the Enable security defaults toggle is Enabled."}, "Remediation": {"From Azure Portal": "To enable security defaults in your directory1. From Azure Home select the Portal Menu. \n2. Browse to\u202fMicrosoft Entra ID\u202f>\u202fProperties \n3. Select Manage security defaults \n4. Set the Enable security defaults to Enabled \n5. Select Save"}, "Default_value": "If your tenant was created on or after October 22, 2019, security defaults may already be enabled in your tenant. References: 1. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/concept-fundamentals-security-defaults 2. https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-security-defaults/ba-p/1061414 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-2-protect-identity-and-authentication-systems Additional Information: This recommendation differs from the Microsoft 365 Benchmark. This is because the potential impact associated with disabling Security Defaults is dependent upon the security settings implemented in the environment. It is recommended that organizations disabling Security Defaults implement appropriate security settings to replace the settings configured by Security Defaults.", "pdf": "azure"}, {"Rule_number": "1.1.2", "Rule": "1.1.2 Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all Privileged Users (Manual)", "Profile_applicability": " Level 1", "Description": "Enable multi-factor authentication for all roles, groups, and users that have write access or permissions to Azure resources. These include custom created objects or built-in roles such as; \u2022 Service Co-Administrators \u2022 Subscription Owners \u2022 Contributors", "Rationale": "Multi-factor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Multi-factor authentication provides additional assurance that the individual attempting to gain access is who they claim to be. With multi-factor authentication, an attacker would need to compromise at least two different authentication mechanisms, increasing the difficulty of compromise and thus reducing the risk.", "Impact": "Users would require two forms of authentication before any access is granted. Additional administrative time will be required for managing dual forms of authentication when enabling multi-factor authentication.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all noted users", "From REST API": "For Every Subscription, For Every Tenant \nStep 1: Identify Users with Administrative Access"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Check the box next to each noted user \n7. Click Enable under quick steps in the right-hand panel \n8. Click enable multi-factor auth \n9. Click close \nOther Options within Azure Portal \nFollow Microsoft Azure documentation and enable multi-factor authentication in your \nenvironment. \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-\nazure-mfa \nEnabling and configuring MFA with conditional access policy is a multi-step process. \nHere are some additional resources on the process within Entra ID to enable multi-\nfactor authentication for users within your subscriptions with conditional access policy. \nhttps://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-\nconditional-access-policy-admin-mfa \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-\ngetstarted#enable-multi-factor-authentication-with-conditional-access \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-\nmfasettings"}, "Default_value": "By default, multi-factor authentication is disabled for all users. References: 1. https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication 2. https://stackoverflow.com/questions/41156206/azure-active-directory-premium-mfa-attributes-via-graph-api 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-4-authenticate-server-and-services Additional Information: Please note that at the time of writing, there is no API, Azure CLI or Powershell mechanism available to programmatically conduct security assessment or remediation for this recommendation. The only option is MSOL.", "pdf": "azure"}, {"Rule_number": "1.1.3", "Rule": "1.1.3 Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all Non-Privileged Users (Manual)", "Profile_applicability": " Level 2", "Description": "Enable multi-factor authentication for all non-privileged users.", "Rationale": "Multi-factor authentication requires an individual to present a minimum of two separate forms of authentication before access is granted. Multi-factor authentication provides additional assurance that the individual attempting to gain access is who they claim to be. With multi-factor authentication, an attacker would need to compromise at least two different authentication mechanisms, increasing the difficulty of compromise and thus reducing the risk.", "Impact": "Users would require two forms of authentication before any access is granted. Also, this requires an overhead for managing dual forms of authentication.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Check the box next to each noted user \n7. Click Enable under quick steps in the right-hand panel \n8. Click enable multi-factor auth \n9. Click close", "From REST API": "For Every Subscription, For Every Tenant \nStep 1: Identify Users with non-administrative Access 1.List All Users Using Microsoft Graph APIGET https://graph.microsoft.com/v1.0/users \nCapture id and corresponding userPrincipalName ($uid, $userPrincipalName)"}, "Remediation": {"General Remediation Instructions": "Follow Microsoft Azure documentation and enable multi-factor authentication in your \nenvironment. \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-\nazure-mfa \nEnabling and configuring MFA is a multi-step process. Here are some additional \nresources on the process within Microsoft Entra IDhttps://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-\naccess-policy-admin-mfa \nhttps://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\ngetstarted#enable-multi-factor-authentication-with-conditional-access \nhttps://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-mfasettings"}, "Default_value": "By default, multi-factor authentication is disabled for all users. References: 1. https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication 2. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-userstates 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-4-authenticate-server-and-services", "pdf": "azure"}, {"Rule_number": "1.1.4", "Rule": "1.1.4 Ensure that 'Allow users to remember multi-factor authentication on devices they trust' is Disabled (Manual)", "Profile_applicability": " Level 1", "Description": "Do not allow users to remember multi-factor authentication on devices.", "Rationale": "Remembering Multi-Factor Authentication (MFA) for devices and browsers allows users to have the option to bypass MFA for a set number of days after performing a successful sign-in using MFA. This can enhance usability by minimizing the number of times a user may need to perform two-step verification on the same device. However, if an account or device is compromised, remembering MFA for trusted devices may affect security. Hence, it is recommended that users not be allowed to bypass MFA.", "Impact": "For every login attempt, the user will be required to perform multi-factor authentication.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click the Per-user MFA button on the top bar \n5. Click on service settings \n6. Ensure that Allow users to remember multi-factor authentication on \ndevices they trust is not enabled"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click the Per-user MFA button on the top bar \n5. Click on service settings \n6. Uncheck the box next to Allow users to remember multi-factor \nauthentication on devices they trust"}, "Default_value": "By default, multi-factor authentication is disabled for all users. References: 1. https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-authentication 2. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-userstates 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-4-authenticate-server-and-services", "pdf": "azure"}, {"Rule_number": "1.2.1", "Rule": "1.2.1 Ensure Trusted Locations Are Defined (Manual)", "Profile_applicability": " Level 1", "Description": "Microsoft Entra ID Conditional Access allows an organization to configure Named locations and configure whether those locations are trusted or untrusted. These settings provide organizations the means to specify Geographical locations for use in conditional access policies, or define actual IP addresses and IP ranges and whether or not those IP addresses and/or ranges are trusted by the organization.", "Rationale": "Defining trusted source IP addresses or ranges helps organizations create and enforce Conditional Access policies around those trusted or untrusted IP addresses and ranges. Users authenticating from trusted IP addresses and/or ranges may have less access restrictions or access requirements when compared to users that try to authenticate to Microsoft Entra ID from untrusted locations or untrusted source IP addresses/ranges.", "Impact": "When configuring Named locations, the organization can create locations using Geographical location data or by defining source IP addresses or ranges. Configuring Named locations using a Country location does not provide the organization the ability to mark those locations as trusted, and any Conditional Access policy relying on those Countries location setting will not be able to use the All trusted locations setting within the Conditional Access policy. They instead will have to rely on the Select locations setting. This may add additional resource requirements when configuring, and will require thorough organizational testing. In general, Conditional Access policies may completely prevent users from authenticating to Microsoft Entra ID, and thorough testing is recommended. To avoid complete lockout, a 'Break Glass' account with full Global Administrator rights is recommended in the event all other administrators are locked out of authenticating to Microsoft Entra ID. This 'Break Glass' account should be excluded from Conditional Access Policies and should be configured with the longest pass phrase feasible. This account should only be used in the event of an emergency and complete administrator lockout.", "Audit": {"From Azure Portal": "1. In the Azure Portal, navigate to Microsoft Entra ID Conditional Access \n2. Click on Manage \n3. Click on Named Locations"}, "Remediation": {"From Azure Portal": "1. Navigate to the Microsoft Entra ID Conditional Access Blade \n2. Click on the Named locations blade \n3. Within the Named locations blade, click on IP ranges location \n4. Enter a name for this location setting in the Name text box \n5. Click on the + sign \n6. Add an IP Address Range in CIDR notation inside the text box that appears \n7. Click on the Add button \n8. Repeat steps 5 through 7 for each IP Range that needs to be added \n9. If the information entered are trusted ranges, select the Mark as trusted \nlocation check box \n10. \nOnce finished, click on Create \nFrom PowerShell \nCreate a new trusted IP-based Named location policy \n[System.Collections.Generic.List`1[Microsoft.Open.MSGraph.Model.IpRange]]$ipR\nanges = @() \n$ipRanges.Add(\"<first IP range in CIDR notation>\") \n$ipRanges.Add(\"<second IP range in CIDR notation>\") \n$ipRanges.Add(\"<third IP range in CIDR notation>\") \nNew-AzureADMSNamedLocationPolicy -OdataType \n\"#microsoft.graph.ipNamedLocation\" -DisplayName \"<name of IP Named location \npolicy> -IsTrusted $true -IpRanges $ipRanges \nSet an existing IP-based Named location policy to trusted \nSet-AzureADMSNamedLocationPolicy -PolicyId \"<ID of the policy>\" -OdataType \n\"#microsoft.graph.ipNamedLocation\" -IsTrusted $true"}, "Default_value": "By default, no locations are configured under the Named locations blade within the Microsoft Entra ID Conditional Access blade.", "pdf": "azure"}, {"Rule_number": "1.2.2", "Rule": "1.2.2 Ensure that an exclusionary Geographic Access Policy is considered (Manual)", "Profile_applicability": " Level 1", "Description": "CAUTION: If these policies are created without first auditing and testing the result, misconfiguration can potentially lock out administrators or create undesired access issues. Conditional Access Policies can be used to block access from geographic locations that are deemed out-of-scope for your organization or application. The scope and variables for this policy should be carefully examined and defined.", "Rationale": "Conditional Access, when used as a deny list for the tenant or subscription, is able to prevent ingress or egress of traffic to countries that are outside of the scope of interest (e.g.: customers, suppliers) or jurisdiction of an organization. This is an effective way to prevent unnecessary and long-lasting exposure to international threats such as APTs.", "Impact": "Microsoft Entra ID P1 or P2 is required. Limiting access geographically will deny access to users that are traveling or working remotely in a different part of the world. A point-to-site or site to site tunnel such as a VPN is recommended to address exceptions to geographic access policies.", "Audit": {"From Azure Portal": "1. From Azure Home open the Portal menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit, theno Under Assignments, Review the Users and Groups for the personnel the \npolicy will apply to \no Under Assignments, Review the Cloud apps or actions for the systems \nthe policy will apply to \no Under Conditions, Review the Include locations for those that should be \nblocked"}, "Remediation": {"From Azure Portal": "Part 1 of 2 - Create the policy and enable it in Report-only mode. 1.From Azure Home open the portal menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Click the + New policy button, then5. Provide a name for the policy. \n6. Under Assignments, select Users or workload identities theno Under Include, select All users \no Under Exclude, check Users and groups and only select emergency \naccess accounts and service accounts (NOTE: Service accounts are \nexcluded here because service accounts are non-interactive and cannot \ncomplete MFA) \n7. Under Assignments, select Cloud apps or actions theno Under Include, select All cloud apps \no Leave Exclude blank unless you have a well defined exception \n8. Under Conditions, select Locations theno Select Include, then add entries for locations for those that should be \nblocked \no Select Exclude, then add entries for those that should be allowed \n(IMPORTANT: Ensure that all Trusted Locations are in the Exclude list.)"}, "Default_value": "By default, no locations are configured under the Named locations blade within the Microsoft Entra ID Conditional Access blade.", "pdf": "azure"}, {"Rule_number": "1.2.3", "Rule": "1.2.3 Ensure that A Multi-factor Authentication Policy Exists for Administrative Groups (Manual)", "Profile_applicability": " Level 1", "Description": "For designated users, they will be prompted to use their multi-factor authentication (MFA) process on login.", "Rationale": "Enabling multi-factor authentication is a recommended setting to limit the use of Administrative accounts to authenticated personnel.", "Impact": "There is an increased cost, as Conditional Access policies require Microsoft Entra ID P1. Similarly, MFA may require additional overhead to maintain. There is also a potential scenario in which the multi-factor authentication method can be lost, and administrative users are no longer able to log in. For this scenario, there should be an emergency access account. Please see References for creating this.", "Audit": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. Be certain the emergency access account is not in the list. \n6. View under Exclude to determine which Users and groups to whom the policy is \nnot applied."}, "Remediation": {"From Azure Portal": "1. From Azure Home open the Portal Menu in top left, and select Microsoft Entra \nID. \n2. Select Security. \n3. Select Conditional Access. \n4. Click + New policy."}, "Default_value": "This policy does not exist by default.", "pdf": "azure"}, {"Rule_number": "1.2.4", "Rule": "1.2.4 Ensure that A Multi-factor Authentication Policy Exists for All Users (Manual)", "Profile_applicability": " Level 1", "Description": "For designated users, they will be prompted to use their multi-factor authentication (MFA) process on logins.", "Rationale": "Enabling multi-factor authentication is a recommended setting to limit the potential of accounts being compromised and limiting access to authenticated personnel.", "Impact": "There is an increased cost, as Conditional Access policies require Microsoft Entra ID P1 or P2. Similarly, this may require additional overhead to maintain if users lose access to their MFA.", "Audit": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied."}, "Remediation": {"From Azure Portal": "1. From Azure Home open Portal menu in the top left, and select Microsoft Entra \nID. \n2. Select Security. \n3. Select Conditional Access. \n4. Click + New policy. \n5. Enter a name for the policy. \n6. Select Users or workload identities."}, "Default_value": "By default, MFA is not enabled for any administrative accounts. References: 1. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-admin-mfa 2. https://docs.microsoft.com/en-us/azure/active-directory/roles/security-emergency-access 3. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/troubleshoot-conditional-access-what-if 4. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-insights-reporting 5. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/plan-conditional-access 6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-7-restrict-resource-access-based-on--conditions Additional Information: These policies should be tested by using the What If tool in the References. Setting these can and will create issues with logging in for users until they use an MFA device linked to their accounts. Further testing can also be done via the insights and reporting resource in References which monitors Azure sign ins.", "pdf": "azure"}, {"Rule_number": "1.2.5", "Rule": "1.2.5 Ensure Multi-factor Authentication is Required for Risky Sign-ins (Manual)", "Profile_applicability": " Level 1", "Description": "For designated users, they will be prompted to use their multi-factor authentication (MFA) process on login.", "Rationale": "Enabling multi-factor authentication is a recommended setting to limit the potential of accounts being compromised and limiting access to authenticated personnel.", "Impact": "There is an increased cost, as Conditional Access policies require Microsoft Entra ID P1 or P2. Similarly, they may require additional overhead to maintain if users lose access to their MFA.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied."}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security \n3. Select Conditional Access. \n4. Click + New policy. \n5. Enter a name for the policy. \n6. Select Users or workload identities."}, "Default_value": "MFA is not enabled by default. References: 1. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa 2. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/troubleshoot-conditional-access-what-if 3. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-insights-reporting 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-7-restrict-resource-access-based-on--conditions Additional Information: These policies should be tested by using the What If tool in the References. Setting these can and will create issues with logging in for users until they use an MFA device linked to their accounts. Further testing can also be done via the insights and reporting resource the in References which monitors Azure sign ins.", "pdf": "azure"}, {"Rule_number": "1.2.6", "Rule": "1.2.6 Ensure Multifactor Authentication is Required for Windows Azure Service Management API (Manual)", "Profile_applicability": " Level 1", "Description": "This recommendation ensures that users accessing the Windows Azure Service Management API (i.e. Azure Powershell, Azure CLI, Azure Resource Manager API, etc.) are required to use multifactor authentication (MFA) credentials when accessing resources through the Windows Azure Service Management API.", "Rationale": "Administrative access to the Windows Azure Service Management API should be secured with a higher level of scrutiny to authenticating mechanisms. Enabling multifactor authentication is recommended to reduce the potential for abuse of Administrative actions, and to prevent intruders or compromised admin credentials from changing administrative settings. IMPORTANT: While this recommendation allows exceptions to specific Users or Groups, they should be very carefully tracked and reviewed for necessity on a regular interval through an Access Review process. It is important that this rule be built to include \"All Users\" to ensure that all users not specifically excepted will be required to use MFA to access the Azure Service Management API.", "Impact": "Conditional Access policies require Microsoft Entra ID P1 or P2 licenses. Similarly, they may require additional overhead to maintain if users lose access to their MFA. Any users or groups which are granted an exception to this policy should be carefully tracked, be granted only minimal necessary privileges, and conditional access exceptions should be regularly reviewed or investigated.", "Audit": {"From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected."}, "Remediation": {"From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. Click Security in the Entra ID blade. \n3. Click Conditional Access in the Security blade. \n4. Click Policies in the Conditional Access blade. \n5. Click + New policy. \n6. Enter a name for the policy. \n7. Click the blue text under Users. \n8. Under Include, select All users. \n9. Under Exclude, check Users and groups. \n10. \nSelect users or groups to be exempted from this policy (e.g. break-glass \nemergency accounts, and non-interactive service accounts) then click the Select \nbutton. \n11. \nClick the blue text under Target Resources. \n12. \nUnder Include, click the Select apps radio button. \n13. \nClick the blue text under Select. \n14. \nCheck the box next to Windows Azure Service Management APIs then click the \nSelect button. \n15. \nClick the blue text under Grant. \n16. \nUnder Grant access check the box for Require multifactor authentication \nthen click the Select button. \n17. \nBefore creating, set Enable policy to Report-only. \n18. \nClick Create. \nAfter testing the policy in report-only mode, update the Enable policy setting from \nReport-only to On."}, "Default_value": "MFA is not enabled by default for administrative actions.", "pdf": "azure"}, {"Rule_number": "1.2.7", "Rule": "1.2.7 Ensure Multifactor Authentication is Required to access Microsoft Admin Portals (Manual)", "Profile_applicability": " Level 1", "Description": "This recommendation ensures that users accessing Microsoft Admin Portals (i.e. Microsoft 365 Admin, Microsoft 365 Defender, Exchange Admin Center, Azure Portal, etc.) are required to use multifactor authentication (MFA) credentials when logging into an Admin Portal.", "Rationale": "Administrative Portals for Microsoft Azure should be secured with a higher level of scrutiny to authenticating mechanisms. Enabling multifactor authentication is recommended to reduce the potential for abuse of Administrative actions, and to prevent intruders or compromised admin credentials from changing administrative settings. IMPORTANT: While this recommendation allows exceptions to specific Users or Groups, they should be very carefully tracked and reviewed for necessity on a regular interval through an Access Review process. It is important that this rule be built to include \"All Users\" to ensure that all users not specifically excepted will be required to use MFA to access Admin Portals.", "Impact": "Conditional Access policies require Microsoft Entra ID P1 or P2 licenses. Similarly, they may require additional overhead to maintain if users lose access to their MFA. Any users or groups which are granted an exception to this policy should be carefully tracked, be granted only minimal necessary privileges, and conditional access exceptions should be reviewed or investigated.", "Audit": {"From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected."}, "Remediation": {"From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. Click Security in the Entra ID blade. \n3. Click Conditional Access in the Security blade. \n4. Click Policies in the Conditional Access blade. \n5. Click + New policy. \n6. Enter a name for the policy. \n7. Click the blue text under Users. \n8. Under Include, select All users. \n9. Under Exclude, check Users and groups. \n10. \nSelect users or groups to be exempted from this policy (e.g. break-glass \nemergency accounts, and non-interactive service accounts) then click the Select \nbutton. \n11. \nClick the blue text under Target Resources. \n12. \nUnder Include, click the Select apps radio button. \n13. \nClick the blue text under Select. \n14. \nCheck the box next to Microsoft Admin Portals then click the Select button. \n15. \nClick the blue text under Grant. \n16. \nUnder Grant access check the box for Require multifactor authentication \nthen click the Select button. \n17. \nBefore creating, set Enable policy to Report-only. \n18. \nClick Create. \nAfter testing the policy in report-only mode, update the Enable policy setting from \nReport-only to On."}, "Default_value": "MFA is not enabled by default for administrative actions.", "pdf": "azure"}, {"Rule_number": "1.3", "Rule": "1.3 Ensure that 'Restrict non-admin users from creating tenants' is set to 'Yes' (Manual)", "Profile_applicability": " Level 1", "Description": "Require administrators or appropriately delegated users to create new tenants.", "Rationale": "It is recommended to only allow an administrator to create new tenants. This prevent users from creating new Microsoft Entra ID or Azure AD B2C tenants and ensures that only authorized users are able to do so.", "Impact": "Enforcing this setting will ensure that only authorized users are able to create new tenants.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Restrict non-admin users from creating tenants is set to Yes \nFrom PowerShell \nImport-Module Microsoft.Graph.Identity.SignIns  \nConnect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'  \nGet-MgPolicyAuthorizationPolicy | Select-Object -ExpandProperty \nDefaultUserRolePermissions | Format-List \nReview the \"DefaultUserRolePermissions\" section of the output. Ensure that \nAllowedToCreateTenants is not \"True\"."}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings"}, "Default_value": "MFA is not enabled by default for administrative actions.", "pdf": "azure"}, {"Rule_number": "1.4", "Rule": "1.4 Ensure Guest Users Are Reviewed on a Regular Basis (Manual)", "Profile_applicability": " Level 1", "Description": "Microsoft Entra ID is extended to include Azure AD B2B collaboration, allowing you to invite people from outside your organization to be guest users in your cloud account and sign in with their own work, school, or social identities. Guest users allow you to share your company's applications and services with users from any other organization, while maintaining control over your own corporate data. Work with external partners, large or small, even if they don't have Azure AD or an IT department. A simple invitation and redemption process lets partners use their own credentials to access your company's resources as a guest user. Guest users in every subscription should be review on a regular basis to ensure that inactive and unneeded accounts are removed.", "Rationale": "Guest users in the Microsoft Entra ID are generally required for collaboration purposes in Office 365, and may also be required for Azure functions in enterprises with multiple Azure tenants. Guest users are typically added outside your employee on-boarding/off-boarding process and could potentially be overlooked indefinitely, leading to a potential vulnerability. To prevent this, guest users should be reviewed on a regular basis. During this audit, guest users should also be determined to not have administrative privileges.", "Impact": "Before removing guest users, determine their use and scope. Like removing any user, there may be unforeseen consequences to systems if it is deleted.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click on Add filter \n5. Select User type \n6. Select Guest from the Value dropdown \n7. Click Apply \n8. Audit the listed guest users"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click on Add filter \n5. Select User type \n6. Select Guest from the Value dropdown \n7. Click Apply \n8. Delete all Guest users that are no longer required or are inactive", "From Azure CLI": "Before deleting the user, set it to inactive using the ID from the Audit Procedure to \ndetermine if there are any dependent systems. \naz ad user update --id <exampleaccountid@domain.com> --account-enabled \n{false} \nAfter determining that there are no dependent systems delete the user. \nRemove-AzureADUser -ObjectId <exampleaccountid@domain.com>"}, "Default_value": "", "pdf": "azure"}, {"Rule_number": "1.5", "Rule": "1.5 Ensure That 'Number of methods required to reset' is set to '2' (Manual)", "Profile_applicability": " Level 1", "Description": "Ensures that two alternate forms of identification are provided before allowing a password reset.", "Rationale": "A Self-service Password Reset (SSPR) through Azure Multi-factor Authentication (MFA) ensures the user's identity is confirmed using two separate methods of identification. With multiple methods set, an attacker would have to compromise both methods before they could maliciously reset a user's password.", "Impact": "There may be administrative overhead, as users who lose access to their secondary authentication methods will need an administrator with permissions to remove it. There will also need to be organization-wide security policies and training to teach administrators to verify the identity of the requesting user so that social engineering can not render this setting useless.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Authentication methods \n6. Ensure that Number of methods required to reset is set to 2"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Authentication methods \n6. Set the Number of methods required to reset to 2"}, "Default_value": "By default no guest users are created. References: 1. https://docs.microsoft.com/en-us/azure/active-directory/b2b/user-properties 2. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/add-users-azure-active-directory#delete-a-user 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-4-review-and-reconcile-user-access-regularly 4. https://www.microsoft.com/en-us/security/business/identity-access-management/azure-ad-pricing 5. https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-manage-inactive-user-accounts 6. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-users-restore Additional Information: It is good practice to use a dynamic security group to manage guest users. To create the dynamic security group: 1. Navigate to the 'Microsoft Entra ID' blade in the Azure Portal 2. Select the 'Groups' item 3. Create new 4. Type of 'dynamic' 5. Use the following dynamic selection rule. \"(user.userType -eq \"Guest\")\" 6. Once the group has been created, select access reviews option and create a new access review with a period of monthly and send to relevant administrators for review.", "pdf": "azure"}, {"Rule_number": "1.6", "Rule": "1.6 Ensure that a Custom Bad Password List is set to 'Enforce' for your Organization (Manual)", "Profile_applicability": " Level 1", "Description": "Microsoft Azure provides a Global Banned Password policy that applies to Azure administrative and normal user accounts. This is not applied to user accounts that are synced from an on-premise Active Directory unless Microsoft Entra ID Connect is used and you enable EnforceCloudPasswordPolicyForPasswordSyncedUsers. Please see the list in default values on the specifics of this policy. To further password security, it is recommended to further define a custom banned password policy.", "Rationale": "Enabling this gives your organization further customization on what secure passwords are allowed. Setting a bad password list enables your organization to fine-tune its password policy further, depending on your needs. Removing easy-to-guess passwords increases the security of access to your Azure resources.", "Impact": "Increasing needed password complexity might increase overhead on administration of user accounts. Licensing requirement for Global Banned Password List and Custom Banned Password list requires Microsoft Entra ID P1 or P2. On-premises Active Directory Domain Services users that are not synchronized to Microsoft Entra ID also benefit from Microsoft Entra ID Password Protection based on existing licensing for synchronized users.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID. \n3. Select 'Security'. \n4. Under Manage, select Authentication Methods. \n5. Select Password Protection. \n6. Ensure Enforce custom list is set to Yes. \n7. Scroll through the list to view the enforced passwords."}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Security. \n4. Under Manage, select Authentication Methods. \n5. Select Password Protection. \n6. Set the Enforce custom list option to Yes. \n7. Double click the custom banned password list to add a string."}, "Default_value": "By default the custom bad password list is not 'Enabled'. Organizational-specific terms can be added to the custom banned password list, such as the following examples: \u2022 Brand names \u2022 Product names \u2022 Locations, such as company headquarters \u2022 Company-specific internal terms \u2022 Abbreviations that have specific company meaning \u2022 Months and weekdays with your company's local languages The default Azure bad password policy is already applied to your resources which applies the following basic requirements: Characters allowed: \u2022 Uppercase characters (A - Z) \u2022 Lowercase characters (a - z) \u2022 Numbers (0 - 9) \u2022 Symbols: \u2022 @ # $ % ^ & * - _ ! + = [ ] { } | \\ : ' , . ? / ` ~ \" ( ) ; < > \u2022 blank space Characters not allowed: \u2022 Unicode characters \u2022 Password length Passwords require \u2022 A minimum of eight characters \u2022 A maximum of 256 characters Password complexity: Passwords require three out of four of the following categories: \u2022 Uppercase characters \u2022 Lowercase characters", "pdf": "azure"}, {"Rule_number": "1.7", "Rule": "1.7 Ensure that 'Number of days before users are asked to re-confirm their authentication information' is not set to '0' (Manual)", "Profile_applicability": " Level 1", "Description": "Ensure that the number of days before users are asked to re-confirm their authentication information is not set to 0.", "Rationale": "This setting is necessary if you have setup 'Require users to register when signing in option'. If authentication re-confirmation is disabled, registered users will never be prompted to re-confirm their existing authentication information. If the authentication information for a user changes, such as a phone number or email, then the password reset information for that user reverts to the previously registered authentication information.", "Impact": "Users will be prompted for their multifactor authentication at the duration set here.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Registration \n6. Ensure that Number of days before users are asked to re-confirm their \nauthentication information is not set to 0"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Registration \n6. Set the Number of days before users are asked to re-confirm their \nauthentication information to your organization-defined frequency."}, "Default_value": "By default the custom bad password list is not 'Enabled'. Organizational-specific terms can be added to the custom banned password list, such as the following examples: \u2022 Brand names \u2022 Product names \u2022 Locations, such as company headquarters \u2022 Company-specific internal terms \u2022 Abbreviations that have specific company meaning \u2022 Months and weekdays with your company's local languages The default Azure bad password policy is already applied to your resources which applies the following basic requirements: Characters allowed: \u2022 Uppercase characters (A - Z) \u2022 Lowercase characters (a - z) \u2022 Numbers (0 - 9) \u2022 Symbols: \u2022 @ # $ % ^ & * - _ ! + = [ ] { } | \\ : ' , . ? / ` ~ \" ( ) ; < > \u2022 blank space Characters not allowed: \u2022 Unicode characters \u2022 Password length Passwords require \u2022 A minimum of eight characters \u2022 A maximum of 256 characters Password complexity: Passwords require three out of four of the following categories: \u2022 Uppercase characters \u2022 Lowercase characters", "pdf": "azure"}, {"Rule_number": "1.8", "Rule": "1.8 Ensure that 'Notify users on password resets?' is set to 'Yes' (Manual)", "Profile_applicability": " Level 1", "Description": "Ensure that users are notified on their primary and secondary emails on password resets.", "Rationale": "User notification on password reset is a proactive way of confirming password reset activity. It helps the user to recognize unauthorized password reset activities.", "Impact": "Users will receive emails alerting them to password changes to both their primary and secondary emails.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Go to Password reset \n5. Under Manage, select Notifications \n6. Ensure that Notify users on password resets? is set to Yes"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select Password reset \n5. Under Manage, select Notifications \n6. Set Notify users on password resets? to Yes"}, "Default_value": "By default, Notify users on password resets? is set to \"Yes\".", "pdf": "azure"}, {"Rule_number": "1.9", "Rule": "1.9 Ensure That 'Notify all admins when other admins reset their password?' is set to 'Yes' (Manual)", "Profile_applicability": " Level 1", "Description": "Ensure that all Global Administrators are notified if any other administrator resets their password.", "Rationale": "Global Administrator accounts are sensitive. Any password reset activity notification, when sent to all Global Administrators, ensures that all Global administrators can passively confirm if such a reset is a common pattern within their group. For example, if all Global Administrators change their password every 30 days, any password reset activity before that may require administrator(s) to evaluate any unusual activity and confirm its origin.", "Impact": "All Global Administrators will receive a notification from Azure every time a password is reset. This is useful for auditing procedures to confirm that there are no out of the ordinary password resets for Global Administrators. There is additional overhead, however, in the time required for Global Administrators to audit the notifications. This setting is only useful if all Global Administrators pay attention to the notifications, and audit each one.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select Password reset \n5. Under Manage, select Notifications \n6. Ensure that notify all admins when other admins reset their password? is \nset to Yes"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID"}, "Default_value": "By default, Notify users on password resets? is set to \"Yes\".", "pdf": "azure"}, {"Rule_number": "1.10", "Rule": "1.10 Ensure `User consent for applications` is set to `Do not allow user consent` (Manual)", "Profile_applicability": " Level 1", "Description": "Require administrators to provide consent for applications before use.", "Rationale": "If Microsoft Entra ID is running as an identity provider for third-party applications, permissions and consent should be limited to administrators or pre-approved. Malicious applications may attempt to exfiltrate data or abuse privileged user accounts.", "Impact": "Enforcing this setting may create additional requests that administrators need to review.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Ensure User consent for applications is set to Do not allow user consent \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings"}, "Default_value": "By default, Notify all admins when other admins reset their password? is set to \"No\". References: 1. https://docs.microsoft.com/en-us/azure/active-directory/active-directory-passwords-how-it-works#notifications 2. https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-sspr-deployment 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 5. https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-sspr#set-up-notifications-and-customizations", "pdf": "azure"}, {"Rule_number": "1.11", "Rule": "1.11 Ensure \u2018User consent for applications\u2019 Is Set To \u2018Allow for Verified Publishers\u2019 (Manual)", "Profile_applicability": " Level 2", "Description": "Allow users to provide consent for selected permissions when a request is coming from a verified publisher.", "Rationale": "If Microsoft Entra ID is running as an identity provider for third-party applications, permissions and consent should be limited to administrators or pre-approved. Malicious applications may attempt to exfiltrate data or abuse privileged user accounts.", "Impact": "Enforcing this setting may create additional requests that administrators need to review.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Under User consent for applications, ensure Allow user consent for apps \nfrom verified publishers, for selected permissions is selected \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications"}, "Default_value": "By default, Users consent for applications is set to Allow user consent for apps. References: 1. https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx 2. https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/configure-user-consent#configure-user-consent-to-applications 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy", "pdf": "azure"}, {"Rule_number": "1.12", "Rule": "1.12 Ensure that 'Users can add gallery apps to My Apps' is set to 'No' (Manual)", "Profile_applicability": " Level 1", "Description": "Require administrators to provide consent for the apps before use.", "Rationale": "Unless Microsoft Entra ID is running as an identity provider for third-party applications, do not allow users to use their identity outside of your cloud environment. User profiles contain private information such as phone numbers and email addresses which could then be sold off to other third parties without requiring any further consent from the user.", "Impact": "Can cause additional requests to administrators that need to be fulfilled quite often.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Enterprise applications \n4. Select User settings \n5. Ensure that Users can add gallery apps to My Apps is set to No"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Enterprise applications \n4. Select User settings \n5. Set Users can add gallery apps to My Apps to No"}, "Default_value": "By default, Users can add gallery apps to My Apps is set to No.", "pdf": "azure"}, {"Rule_number": "1.13", "Rule": "1.13 Ensure That \u2018Users Can Register Applications\u2019 Is Set to \u2018No\u2019 (Manual)", "Profile_applicability": " Level 1", "Description": "Require administrators or appropriately delegated users to register third-party applications.", "Rationale": "It is recommended to only allow an administrator to register custom-developed applications. This ensures that the application undergoes a formal security review and approval process prior to exposing Microsoft Entra ID data. Certain users like developers or other high-request users may also be delegated permissions to prevent them from waiting on an administrative user. Your organization should review your policies and decide your needs.", "Impact": "Enforcing this setting will create additional requests for approval that will need to be addressed by an administrator. If permissions are delegated, a user may approve a malevolent third party application, potentially giving it access to your data.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Users can register applications is set to No \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToCreateLOBAppsEnabled \nCommand should return UsersPermissionToCreateLOBAppsEnabled with the value of \nFalse"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Set Users can register applications to No \nFrom PowerShell \nConnect-MsolService \nSet-MsolCompanyInformation -UsersPermissionToCreateLOBAppsEnabled $False"}, "Default_value": "By default, Users can register applications is set to \"Yes\". References: 1. https://docs.microsoft.com/en-us/azure/active-directory/roles/delegate-app-roles#restrict-who-can-create-applications 2. https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-how-applications-are-added#who-has-permission-to-add-applications-to-my-azure-ad-instance 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 5. https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-consent-for-applications-using-office-365-apis/ 6. https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx 7. https://docs.microsoft.com/en-us/powershell/module/msonline/get-msolcompanyinformation?view=azureadps-1.0 8. https://docs.microsoft.com/en-us/powershell/module/msonline/set-msolcompanysettings?view=azureadps-1.0", "pdf": "azure"}, {"Rule_number": "1.14", "Rule": "1.14 Ensure That 'Guest users access restrictions' is set to 'Guest user access is restricted to properties and memberships of their own directory objects' (Manual)", "Profile_applicability": " Level 1", "Description": "Limit guest user permissions.", "Rationale": "Limiting guest access ensures that guest accounts do not have permission for certain directory tasks, such as enumerating users, groups or other directory resources, and cannot be assigned to administrative roles in your directory. Guest access has three levels of restriction. 1. Guest users have the same access as members (most inclusive), 2. Guest users have limited access to properties and memberships of directory objects (default value), 3. Guest user access is restricted to properties and memberships of their own directory objects (most restrictive). The recommended option is the 3rd, most restrictive: \"Guest user access is restricted to their own directory object\".", "Impact": "This may create additional requests for permissions to access resources that administrators will need to approve. According to https://learn.microsoft.com/en-us/azure/active-directory/enterprise-users/users-restrict-guest-permissions#services-currently-not-supported Service without current support might have compatibility issues with the new guest restriction setting. \u2022 Forms \u2022 Project \u2022 Yammer \u2022 Planner in SharePoint", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest user access, ensure that Guest user access restrictions is set \nto Guest user access is restricted to properties and memberships of \ntheir own directory objects \nFrom PowerShell 1.Enter the following Get-AzureADMSAuthorizationPolicy \nWhich will give a result likeId                                                : authorizationPolicy \nOdataType                                         Description                                       : Used to manage \nauthorization related settings across the company. \nDisplayName                                       : Authorization Policy \nEnabledPreviewFeatures                            : {} \nGuestUserRoleId                                   10dae51f-b6af-4016-8d66-\n8c2a99b929b3 \nPermissionGrantPolicyIdsAssignedToDefaultUserRole : {user-default-legacy} \nIf the GuestUserRoleID property does not equal 2af84b1e-32c8-42b7-82bc-\ndaa82404023b then it is not set to most restrictive."}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest user access, change Guest user access restrictions to be Guest \nuser access is restricted to properties and memberships of their own \ndirectory objects \nFrom PowerShell 1.From a PowerShell session enter Set-AzureADMSAuthorizationPolicy -\nGuestUserRoleId '2af84b1e-32c8-42b7-82bc-daa82404023b' \n2. Check that the setting was applied by entering Get-\nAzureADMSAuthorizationPolicy \n3. Make certain that the GuestUserRoleId is equal to the earlier entered value of \n2af84b1e-32c8-42b7-82bc-daa82404023b."}, "Default_value": "By default, Users can register applications is set to \"Yes\". References: 1. https://docs.microsoft.com/en-us/azure/active-directory/roles/delegate-app-roles#restrict-who-can-create-applications 2. https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-how-applications-are-added#who-has-permission-to-add-applications-to-my-azure-ad-instance 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 5. https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-consent-for-applications-using-office-365-apis/ 6. https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx 7. https://docs.microsoft.com/en-us/powershell/module/msonline/get-msolcompanyinformation?view=azureadps-1.0 8. https://docs.microsoft.com/en-us/powershell/module/msonline/set-msolcompanysettings?view=azureadps-1.0", "pdf": "azure"}, {"Rule_number": "1.15", "Rule": "1.15 Ensure that 'Guest invite restrictions' is set to \"Only users assigned to specific admin roles can invite guest users\" (Manual)", "Profile_applicability": " Level 2", "Description": "Restrict invitations to users with specific administrative roles only.", "Rationale": "Restricting invitations to users with specific administrator roles ensures that only authorized accounts have access to cloud resources. This helps to maintain \"Need to Know\" permissions and prevents inadvertent access to data. By default the setting Guest invite restrictions is set to Anyone in the organization can invite guest users including guests and non-admins. This would allow anyone within the organization to invite guests and non-admins to the tenant, posing a security risk.", "Impact": "With the option of Only users assigned to specific admin roles can invite guest users selected, users with specific admin roles will be in charge of sending invitations to the external users, requiring additional overhead by them to manage user accounts. This will mean coordinating with other departments as they are onboarding new users.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4.  \nExternal collaboration settings \n5. Under Guest invite settings, for Guest invite restrictions, ensure that that \nOnly users assigned to specific admin roles can invite guest users is \nselected \nNote: This setting has 4 levels of restriction, which include\n\u2022 \nAnyone in the organization can invite guest users including guests and non-\nadmins (most inclusive), \n\u2022Member users and users assigned to specific admin roles can invite guest users \nincluding guests with member permissions,"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest invite settings, for Guest invite restrictions, ensure that Only \nusers assigned to specific admin roles can invite guest users is selected"}, "Default_value": "By default, Guest invite restrictions is set to Anyone in the organization can invite guest users including guests and non-admins References: 1. https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-delegate-invitations 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-3-manage-lifecycle-of-identities-and-entitlements", "pdf": "azure"}, {"Rule_number": "1.16", "Rule": "1.16 Ensure That 'Restrict access to Microsoft Entra admin center' is Set to 'Yes' (Manual)", "Profile_applicability": " Level 1", "Description": "Restrict access to the Microsoft Entra ID administration center to administrators only. NOTE: This only affects access to the Entra ID administrator's web portal. This setting does not prohibit privileged users from using other methods such as Rest API or Powershell to obtain sensitive information from Microsoft Entra ID.", "Rationale": "The Microsoft Entra ID administrative center has sensitive data and permission settings. All non-administrators should be prohibited from accessing any Microsoft Entra ID data in the administration center to avoid exposure.", "Impact": "All administrative tasks will need to be done by Administrators, causing additional overhead in management of users and resources.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select User settings \n5. Ensure that Restrict access to Microsoft Entra admin center is set to Yes"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select User settings \n5. Set Restrict access to Microsoft Entra admin center to Yes"}, "Default_value": "By default, Restrict access to Microsoft Entra admin center is set to No", "pdf": "azure"}, {"Rule_number": "1.17", "Rule": "1.17 Ensure that 'Restrict user ability to access groups features in the Access Pane' is Set to 'Yes' (Manual)", "Profile_applicability": " Level 2", "Description": "Restrict access to group web interface in the Access Panel portal.", "Rationale": "Self-service group management enables users to create and manage security groups or Office 365 groups in Microsoft Entra ID. Unless a business requires this day-to-day delegation for some users, self-service group management should be disabled. Any user can access the Access Panel, where they can reset their passwords, view their information, etc. By default, users are also allowed to access the Group feature, which shows groups, members, related resources (SharePoint URL, Group email address, Yammer URL, and Teams URL). By setting this feature to 'Yes', users will no longer have access to the web interface, but still have access to the data using the API. This is useful to prevent non-technical users from enumerating groups-related information, but technical users will still be able to access this information using APIs.", "Impact": "Setting to Yes could create administrative overhead by customers seeking certain group memberships that will have to be manually managed by administrators with appropriate permissions.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Restrict user ability to access groups features in My Groups \nis set to Yes"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups"}, "Default_value": "By default, Restrict access to Microsoft Entra admin center is set to No", "pdf": "azure"}, {"Rule_number": "1.18", "Rule": "1.18 Ensure that 'Users can create security groups in Azure portals, API or PowerShell' is set to 'No' (Manual)", "Profile_applicability": " Level 2", "Description": "Restrict security group creation to administrators only.", "Rationale": "When creating security groups is enabled, all users in the directory are allowed to create new security groups and add members to those groups. Unless a business requires this day-to-day delegation, security group creation should be restricted to administrators only.", "Impact": "Enabling this setting could create a number of requests that would need to be managed by an administrator.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Users can create security groups in Azure portals, API or \nPowerShell is set to No"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Set Users can create security groups in Azure portals, API or PowerShell \nto No"}, "Default_value": "By default, Restrict user ability to access groups features in the Access Pane is set to No References: 1. https://docs.microsoft.com/en-us/azure/active-directory/active-directory-accessmanagement-self-service-group-management 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-3-manage-lifecycle-of-identities-and-entitlements 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy", "pdf": "azure"}, {"Rule_number": "1.19", "Rule": "1.19 Ensure that 'Owners can manage group membership requests in the Access Panel' is set to 'No' (Manual)", "Profile_applicability": " Level 2", "Description": "Restrict security group management to administrators only.", "Rationale": "Restricting security group management to administrators only prohibits users from making changes to security groups. This ensures that security groups are appropriately managed and their management is not delegated to non-administrators.", "Impact": "Group Membership for user accounts will need to be handled by Admins and cause administrative overhead.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Ensure that Owners can manage group membership requests in the Access \nPanel is set to No"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Set Owners can manage group membership requests in the Access Panel to No"}, "Default_value": "By default, Owners can manage group membership requests in the Access Panel is set to No.", "pdf": "azure"}, {"Rule_number": "1.20", "Rule": "1.20 Ensure that 'Users can create Microsoft 365 groups in Azure portals, API or PowerShell' is set to 'No' (Manual)", "Profile_applicability": " Level 2", "Description": "Restrict Microsoft 365 group creation to administrators only.", "Rationale": "Restricting Microsoft 365 group creation to administrators only ensures that creation of Microsoft 365 groups is controlled by the administrator. Appropriate groups should be created and managed by the administrator and group creation rights should not be delegated to any other user.", "Impact": "Enabling this setting could create a number of requests that would need to be managed by an administrator.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in setting \n5. Ensure that Users can create Microsoft 365 groups in Azure portals, API \nor PowerShell is set to No"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Set Users can create Microsoft 365 groups in Azure portals, API or \nPowerShell to No"}, "Default_value": "By default, Owners can manage group membership requests in the Access Panel is set to No.", "pdf": "azure"}, {"Rule_number": "1.21", "Rule": "1.21 Ensure that 'Require Multi-Factor Authentication to register or join devices with Microsoft Entra ID' is set to 'Yes' (Manual)", "Profile_applicability": " Level 1", "Description": "Joining or registering devices to Microsoft Entra ID should require Multi-factor authentication.", "Rationale": "Multi-factor authentication is recommended when adding devices to Microsoft Entra ID. When set to Yes, users who are adding devices from the internet must first use the second method of authentication before their device is successfully added to the directory. This ensures that rogue devices are not added to the domain using a compromised user account. Note: Some Microsoft documentation suggests to use conditional access policies for joining a domain from certain whitelisted networks or devices. Even with these in place, using Multi-Factor Authentication is still recommended, as it creates a process for review before joining the domain.", "Impact": "A slight impact of additional overhead, as Administrators will now have to approve every access to the domain.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Devices \n4. Select Device settings \n5. Ensure that Require Multi-Factor Authentication to register or join \ndevices with Microsoft Entra is set to Yes"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Devices \n4. Select Device settings"}, "Default_value": "By default, Users can create Microsoft 365 groups in Azure portals, API or PowerShell is set to Yes. References: 1. https://whitepages.unlimitedviz.com/2017/01/disable-office-365-groups-2/ 2. https://support.office.com/en-us/article/Control-who-can-create-Office-365-Groups-4c46c8cb-17d0-44b5-9776-005fced8e618 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-3-manage-lifecycle-of-identities-and-entitlements", "pdf": "azure"}, {"Rule_number": "1.22", "Rule": "1.22 Ensure That No Custom Subscription Administrator Roles Exist (Automated)", "Profile_applicability": " Level 1", "Description": "The principle of least privilege should be followed and only necessary privileges should be assigned instead of allowing full administrative access.", "Rationale": "Classic subscription admin roles offer basic access management and include Account Administrator, Service Administrator, and Co-Administrators. It is recommended the least necessary permissions be given initially. Permissions can be added as needed by the account holder. This ensures the account holder cannot perform actions which were not intended.", "Impact": "Subscriptions will need to be handled by Administrators with permissions.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Subscriptions. \n3. Select Access control (IAM). \n4. Select Roles. \n5. Click Type and select CustomRole from the drop down menu. \n6. Select View next to a role. \n7. Select JSON. \n8. Check for assignableScopes set to the subscription, and actions set to *. \n9. Repeat steps 6-8 for each custom role.", "From Azure CLI": "List custom rolesaz role definition list --custom-role-only True \nCheck for entries with assignableScope of the subscription, and an action of *"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Subscriptions. \n3. Select Access control (IAM). \n4. Select Roles. \n5. Click Type and select CustomRole from the drop down menu. \n6. Check the box next to each role which grants subscription administrator \nprivileges. \n7. Select Remove. \n8. Select Yes.", "From Azure CLI": "List custom rolesaz role definition list --custom-role-only True \nCheck for entries with assignableScope of the subscription, and an action of *.", "To remove a violating role:": "az role definition delete --name <role name> \nNote that any role assignments must be removed before a custom role can be deleted. \nEnsure impact is assessed before deleting a custom role granting subscription \nadministrator privileges."}, "Default_value": "By default, no custom owner roles are created.", "pdf": "azure"}, {"Rule_number": "1.23", "Rule": "1.23 Ensure a Custom Role is Assigned Permissions for Administering Resource Locks (Manual)", "Profile_applicability": " Level 2", "Description": "Resource locking is a powerful protection mechanism that can prevent inadvertent modification/deletion of resources within Azure subscriptions/Resource Groups and is a recommended NIST configuration.", "Rationale": "Given the resource lock functionality is outside of standard Role Based Access Control(RBAC), it would be prudent to create a resource lock administrator role to prevent inadvertent unlocking of resources.", "Impact": "By adding this role, specific permissions may be granted for managing just resource locks rather than needing to provide the wide Owner or User Access Administrator role, reducing the risk of the user being able to do unintentional damage.", "Audit": {"From Azure Portal": "1. In the Azure portal, open a subscription or resource group where you want to \nview assigned roles. \n2. Select Access control (IAM) \n3. Select Roles \n4. Search for the custom role named <role_name> Ex. from remediation Resource \nLock Administrator \n5. Ensure that the role is assigned to the appropriate users."}, "Remediation": {"From Azure Portal": "1. In the Azure portal, open a subscription or resource group where you want the \ncustom role to be assigned. \n2. Select Access control (IAM). \n3. Click Add. \n4. Select Add custom role. \n5. In the Custom Role Name field enter Resource Lock Administrator. \n6. In the Description field enter Can Administer Resource Locks."}, "Default_value": "By default, no custom owner roles are created.", "pdf": "azure"}, {"Rule_number": "1.24", "Rule": "1.24 Ensure That `Subscription leaving Microsoft Entra ID directory` and `Subscription entering Microsoft Entra ID directory` Is Set To \u2018Permit No One\u2019 (Manual)", "Profile_applicability": " Level 2", "Description": "Users who are set as subscription owners are able to make administrative changes to the subscriptions and move them into and out of Microsoft Entra ID.", "Rationale": "Permissions to move subscriptions in and out of Microsoft Entra ID directory must only be given to appropriate administrative personnel. A subscription that is moved into an Microsoft Entra ID directory may be within a folder to which other users have elevated permissions. This prevents loss of data or unapproved changes of the objects within by potential bad actors.", "Impact": "Subscriptions will need to have these settings turned off to be moved.", "Audit": {"From Azure Portal": "1. From the Azure Portal Home select the portal menu \n2. Select Subscriptions \n3. In the Advanced options drop-down menu, select Manage Policies \n4. Ensure Subscription leaving Microsoft Entra ID directory and \nSubscription entering Microsoft Entra ID directory are set to Permit no \none"}, "Remediation": {"From Azure Portal": "1. From the Azure Portal Home select the portal menu \n2. Select Subscriptions \n3. In the Advanced options drop-down menu, select Manage Policies \n4. Under Subscription leaving Microsoft Entra ID directory and Subscription \nentering Microsoft Entra ID directory select Permit no one"}, "Default_value": "", "pdf": "azure"}, {"Rule_number": "1.25", "Rule": "1.25 Ensure fewer than 5 users have global administrator assignment (Manual)", "Profile_applicability": " Level 1", "Description": "This recommendation aims to maintain a balance between security and operational efficiency by ensuring that a minimum of 2 and a maximum of 4 users are assigned the Global Administrator role in Microsoft Entra ID. Having at least two Global Administrators ensures redundancy, while limiting the number to four reduces the risk of excessive privileged access.", "Rationale": "The Global Administrator role has extensive privileges across all services in Microsoft Entra ID. The Global Administrator role should never be used in regular daily activities; administrators should have a regular user account for daily activities, and a separate account for administrative responsibilities. Limiting the number of Global Administrators helps mitigate the risk of unauthorized access, reduces the potential impact of human error, and aligns with the principle of least privilege to reduce the attack surface of an Azure tenant. Conversely, having at least two Global Administrators ensures that administrative functions can be performed without interruption in case of unavailability of a single admin.", "Impact": "Implementing this recommendation may require changes in administrative workflows or the redistribution of roles and responsibilities. Adequate training and awareness should be provided to all Global Administrators.", "Audit": {"General Audit Instructions": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Roles and Administrators \n4. Select Global Administrator \n5. Ensure less than 5 users are actively assigned the role. \n6. Ensure that at least 2 users are actively assigned the role."}, "Remediation": {"General Remediation Instructions": "If more 4 users are assigned1. Remove Global Administrator role for users which do not or no longer require the \nrole."}, "Default_value": "By default Subscription leaving Microsoft Entra ID directory and Subscription entering Microsoft Entra ID directory are set to Allow everyone (default) References: 1. https://docs.microsoft.com/en-us/azure/cost-management-billing/manage/manage-azure-subscription-policy 2. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-how-subscriptions-associated-directory 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-2-protect-identity-and-authentication-systems", "pdf": "azure"}, {"Rule_number": "2.1.1", "Rule": "2.1.1 Ensure That Microsoft Defender for Servers Is Set to 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for Servers enables threat detection for Servers, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for Servers allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).", "Impact": "Turning on Microsoft Defender for Servers in Microsoft Defender for Cloud incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Servers Status is set to On.", "From Azure CLI": "Run the following commandaz security pricing show -n VirtualMachines --query pricingTier \nIf the tenant is licensed and enabled, the output should indicate Standard", "From PowerShell \nRun the following command:": "Get-AzSecurityPricing -Name 'VirtualMachines' |Select-Object Name,PricingTier \nIf the tenant is licensed and enabled, the -PricingTier parameter will indicate Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Set Server Status to On \n6. Select Save", "From Azure CLI": "Run the following commandaz security pricing create -n VirtualMachines --tier 'standard' \nFrom PowerShell \nRun the following commandSet-AzSecurityPricing -Name 'VirtualMachines' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-endpoint-security#es-1-use-endpoint-detection-and-response-edr", "pdf": "azure"}, {"Rule_number": "2.1.2", "Rule": "2.1.2 Ensure That Microsoft Defender for App Services Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for App Service enables threat detection for App Service, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for App Service allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).", "Impact": "Turning on Microsoft Defender for App Service incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5.", "Ensure Status is On for App Service \nFrom Azure CLI \nRun the following command:": "az security pricing show -n AppServices \nEnsure -PricingTier is set to Standard", "From PowerShell \nRun the following command:": "Get-AzSecurityPricing -Name 'AppServices' |Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Set App Service Status to On \n6. Select Save", "From Azure CLI": "Run the following commandaz security pricing create -n Appservices --tier 'standard' \nFrom PowerShell \nRun the following commandSet-AzSecurityPricing -Name \"AppServices\" -PricingTier \"Standard\""}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.3", "Rule": "2.1.3 Ensure That Microsoft Defender for (Managed Instance) Azure SQL Databases Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for Azure SQL Databases enables threat detection for Managed Instance Azure SQL databases, providing threat intelligence, anomaly detection, and behavior analytics in Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for Azure SQL Databases allows for greater defense-in-depth, includes functionality for discovering and classifying sensitive data, surfacing and mitigating potential database vulnerabilities, and detecting anomalous activities that could indicate a threat to your database.", "Impact": "Turning on Microsoft Defender for Azure SQL Databases incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Azure SQL Databases is set to On.", "From Azure CLI": "Run the following commandaz security pricing show -n SqlServers \nEnsure -PricingTier is set to Standard", "From PowerShell \nRun the following command:": "Get-AzSecurityPricing -Name 'SqlServers' | Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Set the radio button next to Azure SQL Databases to On. \n7. Select Continue. \n8. Select Save.", "From Azure CLI": "Run the following commandaz security pricing create -n SqlServers --tier 'standard' \nFrom PowerShell \nRun the following commandSet-AzSecurityPricing -Name 'SqlServers' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-2-monitor-anomalies-and-threats-targeting-sensitive-data", "pdf": "azure"}, {"Rule_number": "2.1.4", "Rule": "2.1.4 Ensure That Microsoft Defender for SQL Servers on Machines Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for SQL servers on machines enables threat detection for SQL servers on machines, providing threat intelligence, anomaly detection, and behavior analytics in Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for SQL servers on machines allows for greater defense-in-depth, functionality for discovering and classifying sensitive data, surfacing and mitigating potential database vulnerabilities, and detecting anomalous activities that could indicate a threat to your database.", "Impact": "Turning on Microsoft Defender for SQL servers on machines incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to SQL servers on machines is set to On.", "From Azure CLI": "", "Ensure Defender for SQL is licensed with the following command:": "az security pricing show -n SqlServerVirtualMachines \nEnsure the 'PricingTier' is set to 'Standard'", "From PowerShell \nRun the following command:": "Get-AzSecurityPricing -Name 'SqlServerVirtualMachines' | Select-Object \nName,PricingTier \nEnsure the 'PricingTier' is set to 'Standard'"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Set the radio button next to SQL servers on machines to On. \n7. Select Continue. \n8. Select Save.", "From Azure CLI": "Run the following commandaz security pricing create -n SqlServerVirtualMachines --tier 'standard' \nFrom PowerShell \nRun the following commandSet-AzSecurityPricing -Name 'SqlServerVirtualMachines' -PricingTier \n'Standard'"}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-usage 2. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing", "pdf": "azure"}, {"Rule_number": "2.1.5", "Rule": "2.1.5 Ensure That Microsoft Defender for Open-Source Relational Databases Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for Open-source relational databases enables threat detection for Open-source relational databases, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for Open-source relational databases allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).", "Impact": "Turning on Microsoft Defender for Open-source relational databases incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Open-source relational databases is set to On.", "From Azure CLI": "Run the following commandaz security pricing show -n OpenSourceRelationalDatabases --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing | Where-Object {$_.Name -eq \n'OpenSourceRelationalDatabases'} | Select-Object Name, PricingTier \nEnsure output for Name PricingTier is OpenSourceRelationalDatabases Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Set the radio button next to Open-source relational databases to On. \n7. Select Continue. \n8. Select Save.", "From Azure CLI": "Run the following commandaz security pricing create -n 'OpenSourceRelationalDatabases' --tier \n'standard' \nFrom PowerShell \nUse the below command to enable Standard pricing tier for Open-source relational \ndatabases \nset-azsecuritypricing -name \"OpenSourceRelationalDatabases\" -pricingtier \n\"Standard\""}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 3. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-2-monitor-anomalies-and-threats-targeting-sensitive-data 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.6", "Rule": "2.1.6 Ensure That Microsoft Defender for Azure Cosmos DB Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Microsoft Defender for Azure Cosmos DB scans all incoming network requests for threats to your Azure Cosmos DB resources.", "Rationale": "In scanning Azure Cosmos DB requests within a subscription, requests are compared to a heuristic list of potential security threats. These threats could be a result of a security breach within your services, thus scanning for them could prevent a potential security threat from being introduced.", "Impact": "Enabling Microsoft Defender for Azure Cosmos DB requires enabling Microsoft Defender for your subscription. Both will incur additional charges.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. On the Database row click on Select types > 6. Ensure the radio button next to Azure Cosmos DB is set to On.", "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n CosmosDbs --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'CosmosDbs' | Select-Object Name,PricingTier  \nEnsure output of -PricingTier is Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. On the Database row click on Select types >. \n6. Set the radio button next to Azure Cosmos DB to On. \n7. Click Continue. \n8. Click Save.", "From Azure CLI": "Run the following commandaz security pricing create -n 'CosmosDbs' --tier 'standard' \nFrom PowerShell \nUse the below command to enable Standard pricing tier for Azure Cosmos DB \nSet-AzSecurityPricing -Name 'CosmosDbs' -PricingTier 'Standard"}, "Default_value": "By default, Microsoft Defender for Azure Cosmos DB is not enabled. References: 1. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ 2. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-security 3. https://docs.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview 4. https://docs.microsoft.com/en-us/security/benchmark/azure/baselines/cosmos-db-security-baseline 5. https://docs.microsoft.com/en-us/azure/defender-for-cloud/quickstart-enable-database-protections 6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.7", "Rule": "2.1.7 Ensure That Microsoft Defender for Storage Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for Storage enables threat detection for Storage, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for Storage allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).", "Impact": "Turning on Microsoft Defender for Storage incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Ensure Status is set to On for Storage.", "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n StorageAccounts \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'StorageAccounts' | Select-Object \nName,PricingTier \nEnsure output for Name PricingTier is StorageAccounts Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Set Status to On for Storage. \n6. Select Save.", "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing create -n StorageAccounts --tier 'standard' \n \nFrom PowerShell \nSet-AzSecurityPricing -Name 'StorageAccounts' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.8", "Rule": "2.1.8 Ensure That Microsoft Defender for Containers Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for Containers enables threat detection for Container Registries including Kubernetes, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud. The following services will be enabled for container instances: \u2022 Defender agent in Azure \u2022 Azure Policy for Kubernetes \u2022 Agentless discovery for Kubernetes \u2022 Agentless container vulnerability assessment", "Rationale": "Enabling Microsoft Defender for Container Registries allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).", "Impact": "Turning on Microsoft Defender for Containers incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings. \n3. Click on the subscription name. \n4. Select Defender plans. \n5. Ensure On is set under Status for Containers.", "From Azure CLI": "Ensure the output of the commands below indicates Standard pricing. \nFor legacy Defender for Container Registries instancesaz security pricing show --name \"ContainerRegistry\" --query pricingTier \nFor new Defender for Containers instancesaz security pricing show --name \"Containers\" --query pricingTier"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings. \n3. Click on the subscription name. \n4. Select Defender plans. \n5. Set Status to On for Containers. \n6. Click Save.", "From Azure CLI": "(Note: 'ContainerRegistry' has been deprecated and is replaced by 'Containers') \nUse the below command to enable Standard pricing tier for Containers. \naz security pricing create -n 'Containers' --tier 'standard' \nFrom PowerShell \n(Note: 'ContainerRegistry' has been deprecated and is replaced by 'Containers') \nUse the below command to enable Standard pricing tier for Containers. \nSet-AzSecurityPricing -Name 'Containers' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender for Containers is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list", "pdf": "azure"}, {"Rule_number": "2.1.9", "Rule": "2.1.9 Ensure That Microsoft Defender for Key Vault Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Turning on Microsoft Defender for Key Vault enables threat detection for Key Vault, providing threat intelligence, anomaly detection, and behavior analytics in the Microsoft Defender for Cloud.", "Rationale": "Enabling Microsoft Defender for Key Vault allows for greater defense-in-depth, with threat detection provided by the Microsoft Security Response Center (MSRC).", "Impact": "Turning on Microsoft Defender for Key Vault incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Key Vault.", "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'KeyVaults' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'KeyVaults' | Select-Object Name,PricingTier \nEnsure output for PricingTier is Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Select On under Status for Key Vault. \n6. Select Save.", "From Azure CLI": "", "Enable Standard pricing tier for Key Vault:": "Set-AzSecurityPricing -Name 'KeyVaults' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender plan is off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-capabilities 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update 4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-azsecuritypricing 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.10", "Rule": "2.1.10 [LEGACY] Ensure That Microsoft Defender for DNS Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "[NOTE: As of August 1, customers with an existing subscription to Defender for DNS can continue to use the service, but new subscribers will receive alerts about suspicious DNS activity as part of Defender for Servers P2.] Microsoft Defender for DNS scans all network traffic exiting from within a subscription.", "Rationale": "DNS lookups within a subscription are scanned and compared to a dynamic list of websites that might be potential security threats. These threats could be a result of a security breach within your services, thus scanning for them could prevent a potential security threat from being introduced.", "Impact": "Enabling Microsoft Defender for DNS requires enabling Microsoft Defender for your subscription. Both will incur additional charges, with Defender for DNS being a small amount per million queries.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for DNS.", "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'DNS' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing --Name 'DNS' | Select-Object Name,PricingTier \nEnsure output of PricingTier is Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Select On under Status for DNS. \n6. Select Save.", "From Powershell": "", "Enable Standard pricing tier for DNS:": "Set-AzSecurityPricing -Name 'DNS' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender for DNS is not enabled. References: 1. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ 2. https://docs.microsoft.com/en-us/security/benchmark/azure/baselines/dns-security-baseline 3. https://docs.microsoft.com/en-us/azure/defender-for-cloud/defender-for-dns-alerts 4. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-security 5. https://docs.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview 6. https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-network-security#ns-10-ensure-domain-name-system-dns-security 7. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.11", "Rule": "2.1.11 Ensure That Microsoft Defender for Resource Manager Is Set To 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Microsoft Defender for Resource Manager scans incoming administrative requests to change your infrastructure from both CLI and the Azure portal.", "Rationale": "Scanning resource requests lets you be alerted every time there is suspicious activity in order to prevent a security threat from being introduced.", "Impact": "Enabling Microsoft Defender for Resource Manager requires enabling Microsoft Defender for your subscription. Both will incur additional charges.", "Audit": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Resource Manager.", "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'Arm' --query 'PricingTier'", "From Azure PowerShell": "Get-AzSecurityPricing -Name 'Arm' | Select-Object Name,PricingTier \nEnsure the output of PricingTier is Standard"}, "Remediation": {"From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Select On under Status for Resource Manager. \n6. Select `Save.", "From Azure CLI": "Use the below command to enable Standard pricing tier for Defender for Resource \nManager \naz security pricing create -n 'Arm' --tier 'Standard' \nFrom PowerShell \nUse the below command to enable Standard pricing tier for Defender for Resource \nManager \nSet-AzSecurityPricing -Name 'Arm' -PricingTier 'Standard'"}, "Default_value": "By default, Microsoft Defender for Resource Manager is not enabled. References: 1. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-security 2. https://docs.microsoft.com/en-us/azure/defender-for-cloud/defender-for-resource-manager-introduction 3. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ 4. https://docs.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-1-enable-threat-detection-capabilities", "pdf": "azure"}, {"Rule_number": "2.1.12", "Rule": "2.1.12 Ensure that Microsoft Defender Recommendation for 'Apply system updates' status is 'Completed' (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure that the latest OS patches for all virtual machines are applied.", "Rationale": "Windows and Linux virtual machines should be kept updated to: \u2022 Address a specific bug or flaw \u2022 Improve an OS or application\u2019s general stability \u2022 Fix a security vulnerability Microsoft Defender for Cloud retrieves a list of available security and critical updates from Windows Update or Windows Server Update Services (WSUS), depending on which service is configured on a Windows VM. The security center also checks for the latest updates in Linux systems. If a VM is missing a system update, the security center will recommend system updates be applied.", "Impact": "Running Microsoft Defender for Cloud incurs additional charges for each resource monitored. Please see attached reference for exact charges per hour.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then the Recommendations blade \n4. Ensure that there are no recommendations for Apply system updates \nAlternatively, you can employ your own patch assessment and management tool to \nperiodically assess, report and install the required security patches for your OS."}, "Remediation": {"General Remediation Instructions": "Follow Microsoft Azure documentation to apply security patches from the security \ncenter. Alternatively, you can employ your own patch assessment and management tool \nto periodically assess, report, and install the required security patches for your OS."}, "Default_value": "By default, patches are not automatically deployed. References: 1. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities 2. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ 3. https://docs.microsoft.com/en-us/azure/defender-for-cloud/deploy-vulnerability-assessment-vm", "pdf": "azure"}, {"Rule_number": "2.1.13", "Rule": "2.1.13 Ensure that Microsoft Cloud Security Benchmark policies are not set to 'Disabled' (Manual)", "Profile_applicability": " Level 1", "Description": "The Microsoft Cloud Security Benchmark (or \"MCSB\") is an Azure Policy Initiative containing many security policies to evaluate resource configuration against best practice recommendations. If a policy in the MCSB is set with effect type Disabled, it is not evaluated and may prevent administrators from being informed of valuable security recommendations.", "Rationale": "A security policy defines the desired configuration of resources in your environment and helps ensure compliance with company or regulatory security requirements. The MCSB Policy Initiative a set of security recommendations based on best practices and is associated with every subscription by default. When a policy \"Effect\" is set to Audit, policies in the MCSB ensure that Defender for Cloud evaluates relevant resources for supported recommendations. To ensure that policies within the MCSB are not being missed when the Policy Initiative is evaluated, none of the policies should have an Effect of Disabled.", "Impact": "Policies within the MCSB default to an effect of Audit and will evaluate - but not enforce - policy recommendations. Ensuring these policies are set to Audit simply ensures that the evaluation occurs to allow administrators to understand where an improvement may be possible. Administrators will need to determine if the recommendations are relevant and desirable for their environment, then manually take action to resolve the status if desired.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select the appropriate Subscription \n5. Click on Security Policy in the left column. \n6. Click on Microsoft Cloud Security Benchmark \n7. Click Add Filter and select Effect \n8. Check the Disabled box to search for all disabled policies \n9. Click Apply"}, "Remediation": {"From Azure Portal": "Part A - List all disabled policies 1.From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select the appropriate Subscription \n5. Click on Security Policy in the left column. \n6. Click on Microsoft Cloud Security Benchmark \n7. Click Add Filter and select Effect \n8. Check the Disabled box to search for all disabled policies \n9. Click Apply \nPart B - Remediate Policy Effect \nFor each policy that remains in the list1. Click the blue ellipses ... to the right of the policy name \n2. Click Manage effect and parameters \n3. Under Policy Effect, select the Audit radio button \n4. Click Save \n5. Click Refresh \nRepeat \"Part B - Remediate Policy Effect\" until no more policies are listed."}, "Default_value": "By default, the MCSB policy initiative is associated to all subscriptions and most policies will have an effect of Audit. Some policies will have a default effect of Disabled. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-policies 2. https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-transparent-data-encryption 3. https://msdn.microsoft.com/en-us/library/mt704062.aspx 4. https://msdn.microsoft.com/en-us/library/mt704063.aspx 5. https://docs.microsoft.com/en-us/rest/api/policy/policy-assignments/get 6. https://docs.microsoft.com/en-us/rest/api/policy/policy-assignments/create 7. https://docs.microsoft.com/en-in/azure/security-center/tutorial-security-policy", "pdf": "azure"}, {"Rule_number": "2.1.14", "Rule": "2.1.14 Ensure that Auto provisioning of 'Log Analytics agent for Azure VMs' is Set to 'On' (Automated)", "Profile_applicability": " Level 1", "Description": "Enable automatic provisioning of the monitoring agent to collect security data.", "Rationale": "When Log Analytics agent for Azure VMs is turned on, Microsoft Defender for Cloud provisions the Microsoft Monitoring Agent on all existing supported Azure virtual machines and any new ones that are created. The Microsoft Monitoring Agent scans for various security-related configurations and events such as system updates, OS vulnerabilities, endpoint protection, and provides alerts. Audit: From Azure Portal 1. From Azure Home select the Portal Menu 2. Select Microsoft Defender for Cloud 3. Then Environment Settings 4. Select a subscription 5. Click on Settings & Monitoring 6. Ensure that Log Analytics agent/Azure Monitor agent is set to On Repeat the above for any additional subscriptions. From Azure CLI Ensure the output of the below command is On az account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/<subscriptionID>/providers/Microsoft.Security/autoProvisioningSettings?api-version=2017-08-01-preview' | jq '.|.value[] | select(.name==\"default\")'|jq '.properties.autoProvision' Using PowerShell Connect-AzAccount Get-AzSecurityAutoProvisioningSetting | Select-Object Name, AutoProvision Ensure output for Id Name AutoProvision is /subscriptions//providers/Microsoft.Security/autoProvisioningSettings/default default On", "Impact": "Policies within the MCSB default to an effect of Audit and will evaluate - but not enforce - policy recommendations. Ensuring these policies are set to Audit simply ensures that the evaluation occurs to allow administrators to understand where an improvement may be possible. Administrators will need to determine if the recommendations are relevant and desirable for their environment, then manually take action to resolve the status if desired.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Log Analytics agent/Azure Monitor agent is set to On \nRepeat the above for any additional subscriptions.", "From Azure CLI": "Ensure the output of the below command is On \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/<subscriptionID>/providers/Microso\nft.Security/autoProvisioningSettings?api-version=2017-08-01-preview' | jq \n'.|.value[] | select(.name==\"default\")'|jq '.properties.autoProvision' \nUsing PowerShell \nConnect-AzAccount \nGet-AzSecurityAutoProvisioningSetting | Select-Object Name, AutoProvision \nEnsure output for Id Name AutoProvision is \n/subscriptions//providers/Microsoft.Security/autoProvisioningSettings/default \ndefault On"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Log Analytics agent for Azure VMs is set to On \nRepeat the above for any additional subscriptions.", "From Azure CLI": "Use the below command to set Automatic provisioning of monitoring agent to On. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/subscriptionID/providers/Microsoft\n.Security/autoProvisioningSettings/default?api-version=2017-08-01-preview -\nd@\"input.json\"' \nWhere input.json contains the Request body json data as mentioned below. \n   { \n  \"id\"\"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/autoProvi\nsioningSettings/default\", \n  \"name\": \"default\", \n  \"type\": \"Microsoft.Security/autoProvisioningSettings\", \n  \"properties\": { \n    \"autoProvision\": \"On\" \n  } \n}"}, "Default_value": "By default, Automatic provisioning of monitoring agent is set to On.", "pdf": "azure"}, {"Rule_number": "2.1.15", "Rule": "2.1.15 Ensure that Auto provisioning of 'Vulnerability assessment for machines' is Set to 'On' (Manual)", "Profile_applicability": " Level 2", "Description": "Enable automatic provisioning of vulnerability assessment for machines on both Azure and hybrid (Arc enabled) machines.", "Rationale": "Vulnerability assessment for machines scans for various security-related configurations and events such as system updates, OS vulnerabilities, and endpoint protection, then produces alerts on threat and vulnerability findings.", "Impact": "Additional licensing is required and configuration of Azure Arc introduces complexity beyond this recommendation.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Vulnerability assessment for machines is set to On \nRepeat the above for any additional subscriptions."}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Vulnerability assessment for machines is set to On \nRepeat the above for any additional subscriptions."}, "Default_value": "By default, Automatic provisioning of monitoring agent is set to On.", "pdf": "azure"}, {"Rule_number": "2.1.16", "Rule": "2.1.16 Ensure that Auto provisioning of 'Microsoft Defender for Containers components' is Set to 'On' (Automated)", "Profile_applicability": " Level 2", "Description": "Enable automatic provisioning of the Microsoft Defender for Containers components.", "Rationale": "As with any compute resource, Container environments require hardening and run-time protection to ensure safe operations and detection of threats and vulnerabilities.", "Impact": "Microsoft Defender for Containers will require additional licensing.", "Audit": {"From Azure Portal": "1. From the Azure Portal Home page, select Microsoft Defender for Cloud \n2. Under Management select Environment Settings \n3. Select a subscription \n4. Ensure that Containers is set to On \nRepeat the above for any additional subscriptions.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID1c988dd6-ade4-430f-a608-2a3e5b0a6d38 - Name: 'Microsoft \nDefender for Containers should be enabled'"}, "Remediation": {"From Azure Portal": "1. From the Azure Portal Home page, select Microsoft Defender for Cloud \n2. Under Management, select Environment Settings \n3. Select a subscription \n4. Set Containers to On"}, "Default_value": "By default, Automatic provisioning of monitoring agent is set to Off. References: 1. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-data-collection?tabs=autoprovision-va 2. https://msdn.microsoft.com/en-us/library/mt704062.aspx 3. https://msdn.microsoft.com/en-us/library/mt704063.aspx 4. https://docs.microsoft.com/en-us/rest/api/securitycenter/autoprovisioningsettings/list 5. https://docs.microsoft.com/en-us/rest/api/securitycenter/autoprovisioningsettings/create 6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-5-perform-vulnerability-assessments Additional Information: While this feature is generally available as of publication, it is not yet available for Azure Government tenants.", "pdf": "azure"}, {"Rule_number": "2.1.17", "Rule": "2.1.17 Ensure That 'All users with the following roles' is set to 'Owner' (Automated)", "Profile_applicability": " Level 1", "Description": "Enable security alert emails to subscription owners.", "Rationale": "Enabling security alert emails to subscription owners ensures that they receive security alert emails from Microsoft. This ensures that they are aware of any potential security issues and can mitigate the risk in a timely fashion. Audit: From Azure Portal 1. From Azure Home select the Portal Menu 2. Select Microsoft Defender for Cloud 3. Then Environment Settings 4. Click on the appropriate Management Group, Subscription, or Workspace 5. Click on Email notifications 6. Ensure that All users with the following roles is set to Owner From Azure CLI Ensure the command below returns state of On and that Owner appears in roles. az account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/$0/providers/Microsoft.Security/securityContacts?api-version=2020-01-01-preview'| jq '.[] | select(.name==\"default\").properties.notificationsByRole' Remediation: From Azure Portal 1. From Azure Home select the Portal Menu 2. Select Microsoft Defender for Cloud 3. Click on Environment Settings 4. Click on the appropriate Management Group, Subscription, or Workspace 5. Click on Email notifications 6. In the drop down of the All users with the following roles field select Owner 7. Click Save", "Impact": "Microsoft Defender for Containers will require additional licensing.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that All users with the following roles is set to Owner", "From Azure CLI": "Ensure the command below returns state of On and that Owner appears in roles. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview'| jq '.[] | \nselect(.name==\"default\").properties.notificationsByRole'"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. In the drop down of the All users with the following roles field select Owner \n7. Click Save"}, "Default_value": "By default, Microsoft Defender for Containers is disabled. If Defender for Containers is enabled from the Microsoft Defender for Cloud portal, auto provisioning will be enabled. References: 1. https://docs.microsoft.com/en-us/azure/defender-for-cloud/defender-for-containers-introduction 2. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-data-collection?tabs=autoprovision-containers 3. https://msdn.microsoft.com/en-us/library/mt704062.aspx 4. https://msdn.microsoft.com/en-us/library/mt704063.aspx 5. https://docs.microsoft.com/en-us/rest/api/securitycenter/autoprovisioningsettings/list 6. https://docs.microsoft.com/en-us/rest/api/securitycenter/autoprovisioningsettings/create 7. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-incident-response#ir-2-preparation---setup-incident-notification", "pdf": "azure"}, {"Rule_number": "2.1.18", "Rule": "2.1.18 Ensure 'Additional email addresses' is Configured with a Security Contact Email (Automated)", "Profile_applicability": " Level 1", "Description": "Microsoft Defender for Cloud emails the subscription owners whenever a high-severity alert is triggered for their subscription. You should provide a security contact email address as an additional email address.", "Rationale": "Microsoft Defender for Cloud emails the Subscription Owner to notify them about security alerts. Adding your Security Contact's email address to the 'Additional email addresses' field ensures that your organization's Security Team is included in these alerts. This ensures that the proper people are aware of any potential compromise in order to mitigate the risk in a timely fashion. Audit: From Azure Portal 1. From Azure Home select the Portal Menu. 2. Select Microsoft Defender for Cloud 3. Click on Environment Settings 4. Click on the appropriate Management Group, Subscription, or Workspace 5. Click on Email notifications 6. Ensure that a valid security contact email address is listed in the Additional email addresses field From Azure CLI Ensure the output of the below command is set not empty and is set with appropriate email ids. az account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/$0/providers/Microsoft.Security/securityContacts?api-version=2020-01-01-preview' | jq '.|.[] | select(.name==\"default\")'|jq '.properties.emails'", "Impact": "Microsoft Defender for Containers will require additional licensing.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that a valid security contact email address is listed in the Additional \nemail addresses field", "From Azure CLI": "Ensure the output of the below command is set not empty and is set with appropriate \nemail ids. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.emails'"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Enter a valid security contact email address (or multiple addresses separated by \ncommas) in the Additional email addresses field \n7. Click Save", "From Azure CLI": "Use the below command to set Security contact emails to On. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts/default?api-version=2020-01-01-preview -d@\"input.json\"' \nWhere input.json contains the data below, replacing validEmailAddress with a single \nemail address or multiple comma-separated email addresses    { \n      \"id\"\"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/securityC\nontacts/default\", \n      \"name\": \"default\", \n      \"type\": \"Microsoft.Security/securityContacts\", \n      \"properties\": { \n        \"email\": \"<validEmailAddress>\", \n        \"alertNotifications\": \"On\", \n        \"alertsToAdmins\": \"On\" \n      } \n    }"}, "Default_value": "By default, there are no additional email addresses entered.", "pdf": "azure"}, {"Rule_number": "2.1.19", "Rule": "2.1.19 Ensure That 'Notify about alerts with the following severity' is Set to 'High' (Automated)", "Profile_applicability": " Level 1", "Description": "Enables emailing security alerts to the subscription owner or other designated security contact.", "Rationale": "Enabling security alert emails ensures that security alert emails are received from Microsoft. This ensures that the right people are aware of any potential security issues and are able to mitigate the risk. Audit: From Azure Portal 1. From Azure Home select the Portal Menu 2. Select Microsoft Defender for Cloud 3. Click on Environment Settings 4. Click on the appropriate Management Group, Subscription, or Workspace 5. Click on Email notifications 6. Ensure that the Notify about alerts with the following severity (or higher): setting is checked and set to High From Azure CLI Ensure the output of below command is set to true, enter your Subscription ID at the $0 between /subscriptions/<$0>/providers. az account get-access-token --query \"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 bash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: application/json\" https://management.azure.com/subscriptions/$0/providers/Microsoft.Security/securityContacts?api-version=2020-01-01-preview' | jq '.|.[] | select(.name==\"default\")'|jq '.properties.alertNotifications'", "Impact": "Microsoft Defender for Containers will require additional licensing.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that the Notify about alerts with the following severity (or \nhigher): setting is checked and set to High", "From Azure CLI": "Ensure the output of below command is set to true, enter your Subscription ID at the $0 \nbetween /subscriptions/<$0>/providers. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.alertNotifications'"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Under Notification types, check the check box next to Notify about alerts \nwith the following severity (or higher): and select High from the drop \ndown menu \n7. Click Save", "From Azure CLI": "Use the below command to set Send email notification for high severity alerts \nto On. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/<$0>/providers/Microsoft.Security/\nsecurityContacts/default1?api-version=2017-08-01-preview -d@\"input.json\"' \nWhere input.json contains the data below, replacing validEmailAddress with a single \nemail address or multiple comma-separated email addresses       { \n      \"id\"\"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/securityC\nontacts/default1\", \n      \"name\": \"default1\", \n      \"type\": \"Microsoft.Security/securityContacts\", \n      \"properties\": { \n        \"email\": \"<validEmailAddress>\", \n        \"alertNotifications\": \"On\", \n        \"alertsToAdmins\": \"On\" \n      }"}, "Default_value": "By default, there are no additional email addresses entered.", "pdf": "azure"}, {"Rule_number": "2.1.20", "Rule": "2.1.20 Ensure that Microsoft Defender for Cloud Apps integration with Microsoft Defender for Cloud is Selected (Manual)", "Profile_applicability": " Level 2", "Description": "This integration setting enables Microsoft Defender for Cloud Apps (formerly 'Microsoft Cloud App Security' or 'MCAS' - see additional info) to communicate with Microsoft Defender for Cloud.", "Rationale": "Microsoft Defender for Cloud offers an additional layer of protection by using Azure Resource Manager events, which is considered to be the control plane for Azure. By analyzing the Azure Resource Manager records, Microsoft Defender for Cloud detects unusual or potentially harmful operations in the Azure subscription environment. Several of the preceding analytics are powered by Microsoft Defender for Cloud Apps. To benefit from these analytics, subscription must have a Cloud App Security license. Microsoft Defender for Cloud Apps works only with Standard Tier subscriptions.", "Impact": "Microsoft Defender for Cloud Apps works with Standard pricing tier Subscription. Choosing the Standard pricing tier of Microsoft Defender for Cloud incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade \n6. Ensure setting Allow Microsoft Defender for Cloud Apps to access my data \nis selected.", "From Azure CLI": "Ensure the output of the below command is True"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Microsoft Defender for Cloud. \n3. Select Environment Settings blade. \n4. Select the subscription. \n5. Select Integrations. \n6. Check Allow Microsoft Defender for Cloud Apps to access my data. \n7. Select Save.", "From Azure CLI": "Use the below command to enable Standard pricing tier for Storage Accounts \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/<subscription_ID>/providers/Micros\noft.Security/settings/MCAS?api-version=2021-06-01 -d@\"input.json\"' \nWhere input.json contains the Request body json data as mentioned below."}, "Default_value": "By default, Notify about alerts with the following severity (or higher): is set to High. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-provide-security-contact-details 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/securitycontacts/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/security-contacts 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-incident-response#ir-2-preparation---setup-incident-notification Additional Information: Excluding any entries in the input.json properties block disables the specific setting by default. This recommendation has been updated to reflect recent changes to Microsoft REST APIs for getting and updating security contact information.", "pdf": "azure"}, {"Rule_number": "2.1.21", "Rule": "2.1.21 Ensure that Microsoft Defender for Endpoint integration with Microsoft Defender for Cloud is selected (Manual)", "Profile_applicability": " Level 2", "Description": "This integration setting enables Microsoft Defender for Endpoint (formerly 'Advanced Threat Protection' or 'ATP' or 'WDATP' - see additional info) to communicate with Microsoft Defender for Cloud. IMPORTANT: When enabling integration between DfE & DfC it needs to be taken into account that this will have some side effects that may be undesirable. 1. For server 2019 & above if defender is installed (default for these server SKU's) this will trigger a deployment of the new unified agent and link to any of the extended configuration in the Defender portal. 2. If the new unified agent is required for server SKU's of Win 2016 or Linux and lower there is additional integration that needs to be switched on and agents need to be aligned.", "Rationale": "Microsoft Defender for Endpoint integration brings comprehensive Endpoint Detection and Response (EDR) capabilities within Microsoft Defender for Cloud. This integration helps to spot abnormalities, as well as detect and respond to advanced attacks on endpoints monitored by Microsoft Defender for Cloud. MDE works only with Standard Tier subscriptions.", "Impact": "Microsoft Defender for Endpoint works with Standard pricing tier Subscription. Choosing the Standard pricing tier of Microsoft Defender for Cloud incurs an additional cost per resource.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade"}, "Remediation": {"From Azure Console": "1. From Azure Home select the Portal Menu. \n2. Go to Microsoft Defender for Cloud. \n3. Select Environment Settings blade. \n4. Select the subscription. \n5. Select Integrations. \n6. Check Allow Microsoft Defender for Endpoint to access my data. \n7. Select Save.", "From Azure CLI": "Use the below command to enable Standard pricing tier for Storage Accounts"}, "Default_value": "With Cloud App Security license, these alerts are enabled by default. References: 1. https://docs.microsoft.com/en-in/azure/security-center/security-center-alerts-service-layer#azure-management-layer-azure-resource-manager-preview 2. https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/list 3. https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/update 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-9-secure-user-access-to--existing-applications Additional Information: NOTE: \"Microsoft Defender for Cloud Apps\" (\"MDCA\") is formerly known as \"Microsoft Cloud App Security\" (\"MCAS\"). There are a number of places (e.g. Azure CLI) where the \"MCAS\" acronym is still used within Azure.", "pdf": "azure"}, {"Rule_number": "2.1.22", "Rule": "2.1.22 Ensure that Microsoft Defender External Attack Surface Monitoring (EASM) is enabled (Manual)", "Profile_applicability": " Level 2", "Description": "An organization's attack surface is the collection of assets with a public network identifier or URI that an external threat actor can see or access from outside your cloud. It is the set of points on the boundary of a system, a system element, system component, or an environment where an attacker can try to enter, cause an effect on, or extract data from, that system, system element, system component, or environment. The larger the attack surface, the harder it is to protect. This tool can be configured to scan your organization's online infrastructure such as specified domains, hosts, CIDR blocks, and SSL certificates, and store them in an Inventory. Inventory items can be added, reviewed, approved, and removed, and may contain enrichments (\"insights\") and additional information collected from the tool's different scan engines and open-source intelligence sources. A Defender EASM workspace will generate an Inventory of publicly exposed assets by crawling and scanning the internet using Seeds you provide when setting up the tool. Seeds can be FQDNs, IP CIDR blocks, and WHOIS records. Defender EASM will generate Insights within 24-48 hours after Seeds are provided, and these insights include vulnerability data (CVEs), ports and protocols, and weak or expired SSL certificates that could be used by an attacker for reconnaisance or exploitation. Results are classified High/Medium/Low and some of them include proposed mitigations.", "Rationale": "This tool can monitor the externally exposed resources of an organization, provide valuable insights, and export these findings in a variety of formats (including CSV) for use in vulnerability management operations and red/purple team exercises.", "Impact": "Microsoft Defender EASM workspaces are currently available as Azure Resources with a 30-day free trial period but can quickly accrue significant charges. The costs are calculated daily as (Number of \"billable\" inventory items) x (item cost per day; approximately: $0.017). Estimated cost is not provided within the tool, and users are strongly advised to contact their Microsoft sales representative for pricing and set a calendar reminder for the end of the trial period.", "Audit": {"General Audit Instructions": "To view Defender EASM workspaces created for your Subscriptions, search for EASM \nin the Azure Portal using the search box."}, "Remediation": {"General Remediation Instructions": "To begin remediation, a Microsoft Defender EASM workspace must be created. The \nresources and inventory items added to this workspace will depend on your \nenvironment."}, "Default_value": "Microsoft Defender EASM is an optional, paid Azure Resource that must be created and configured inside a Subscription and Resource Group. References: 1. https://learn.microsoft.com/en-us/azure/external-attack-surface-management/ 2. https://learn.microsoft.com/en-us/azure/external-attack-surface-management/deploying-the-defender-easm-azure-resource?source=recommendations 3. https://www.microsoft.com/en-us/security/blog/2022/08/02/microsoft-announces-new-solutions-for-threat-intelligence-and-attack-surface-management/ Additional Information: Microsoft added its Defender for External Attack Surface management (EASM) offering to Azure following its 2022 acquisition of EASM SaaS tool company RiskIQ.", "pdf": "azure"}, {"Rule_number": "2.2.1", "Rule": "2.2.1 Ensure That Microsoft Defender for IoT Hub Is Set To 'On' (Manual)", "Profile_applicability": " Level 2", "Description": "Microsoft Defender for IoT acts as a central security hub for IoT devices within your organization.", "Rationale": "IoT devices are very rarely patched and can be potential attack vectors for enterprise networks. Updating their network configuration to use a central security hub allows for detection of these breaches.", "Impact": "Enabling Microsoft Defender for IoT will incur additional charges dependent on the level of usage.", "Audit": {"From Azure Portal": "1. Go to IoT Hub. \n2. Select a IoT Hub to validate. \n3. Select Overview in Defender for IoT. \n4. The Threat prevention and Threat detection screen will appear, if Defender for \nIoT is Enabled."}, "Remediation": {"From Azure Portal": "1. Go to IoT Hub. \n2. Select a IoT Hub to validate. \n3. Select Overview in Defender for IoT. \n4. Click on Secure your IoT solution, and complete the onboarding."}, "Default_value": "By default, Microsoft Defender for IoT is not enabled. References: 1. https://azure.microsoft.com/en-us/services/iot-defender/#overview", "pdf": "azure"}, {"Rule_number": "3.1", "Rule": "3.1 Ensure that 'Secure transfer required' is set to 'Enabled' (Automated)", "Profile_applicability": " Level 1", "Description": "Enable data encryption in transit.", "Rationale": "The secure transfer option enhances the security of a storage account by only allowing requests to the storage account by a secure connection. For example, when calling REST APIs to access storage accounts, the connection must use HTTPS. Any requests using HTTP will be rejected when 'secure transfer required' is enabled. When using the Azure files service, connection without encryption will fail, including scenarios using SMB 2.1, SMB 3.0 without encryption, and some flavors of the Linux SMB client. Because Azure storage doesn\u2019t support HTTPS for custom domain names, this option is not applied when using a custom domain name. Audit: From Azure Portal 1. Go to Storage Accounts 2. For each storage account, go to Configuration 3. Ensure that Secure transfer required is set to Enabled From Azure CLI Use the below command to ensure the Secure transfer required is enabled for all the Storage Accounts by ensuring the output contains true for each of the Storage Accounts. az storage account list --query \"[*].[name,enableHttpsTrafficOnly]\" From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \u2022 Policy ID: 404c3081-a854-4457-ae30-26a93ef643f9 - Name: 'Secure transfer to storage accounts should be enabled'", "Impact": "Enabling Microsoft Defender for IoT will incur additional charges dependent on the level of usage.", "Audit": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, go to Configuration \n3. Ensure that Secure transfer required is set to Enabled", "From Azure CLI": "Use the below command to ensure the Secure transfer required is enabled for all the \nStorage Accounts by ensuring the output contains true for each of the Storage \nAccounts. \naz storage account list --query \"[*].[name,enableHttpsTrafficOnly]\"", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 404c3081-a854-4457-ae30-26a93ef643f9 - Name: 'Secure transfer to \nstorage accounts should be enabled'"}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, go to Configuration \n3. Set Secure transfer required to Enabled", "From Azure CLI": "Use the below command to enable Secure transfer required for a Storage Account \naz storage account update --name <storageAccountName> --resource-group \n<resourceGroupName> --https-only true"}, "Default_value": "By default, Secure transfer required is set to Disabled. References: 1. https://docs.microsoft.com/en-us/azure/storage/blobs/security-recommendations#encryption-in-transit 2. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-latest#az_storage_account_list 3. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-latest#az_storage_account_update 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit", "pdf": "azure"}, {"Rule_number": "3.2", "Rule": "3.2 Ensure that \u2018Enable Infrastructure Encryption\u2019 for Each Storage Account in Azure Storage is Set to \u2018enabled\u2019 (Automated)", "Profile_applicability": " Level 2", "Description": "Enabling encryption at the hardware level on top of the default software encryption for Storage Accounts accessing Azure storage solutions.", "Rationale": "Azure Storage automatically encrypts all data in a storage account at the network level using 256-bit AES encryption, which is one of the strongest, FIPS 140-2-compliant block ciphers available. Customers who require higher levels of assurance that their data is secure can also enable 256-bit AES encryption at the Azure Storage infrastructure level for double encryption. Double encryption of Azure Storage data protects against a scenario where one of the encryption algorithms or keys may be compromised. Similarly, data is encrypted even before network transmission and in all backups. In this scenario, the additional layer of encryption continues to protect your data. For the most secure implementation of key based encryption, it is recommended to use a Customer Managed asymmetric RSA 2048 Key in Azure Key Vault.", "Impact": "The read and write speeds to the storage will be impacted if both default encryption and Infrastructure Encryption are checked, as a secondary form of encryption requires more resource overhead for the cryptography of information. This performance impact should be considered in an analysis for justifying use of the feature in your environment. Customer-managed keys are recommended for the most secure implementation, leading to overhead of key management. The key will also need to be backed up in a secure location, as loss of the key will mean loss of the information in the storage.", "Audit": {"From Azure Portal": "select the portal menu in the top left. \n2. Select Storage Accounts. \n3. Click on each storage account within each resource group you wish to audit. \n4. In the overview, under Security, ensure Infrastructure encryption is set to \nEnabled."}, "Remediation": {"From Azure Portal": "1. During Storage Account creation, in the Encryption tab, check the box next to \nEnable infrastructure encryption.", "From Azure CLI": "Replace the information within <> with appropriate valuesaz storage account create \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --location <location> \\ \n    --sku Standard_RAGRS \\ \n    --kind StorageV2 \\ \n    --require-infrastructure-encryption \nFrom PowerShell \nReplace the information within <> with appropriate valuesNew-AzStorageAccount -ResourceGroupName <resource_group> ` \n    -AccountName <storage-account> ` \n    -Location <location> ` \n    -SkuName \"Standard_RAGRS\" ` \n    -Kind StorageV2 ` \n    -RequireInfrastructureEncryption"}, "Default_value": "By default, Secure transfer required is set to Disabled. References: 1. https://docs.microsoft.com/en-us/azure/storage/blobs/security-recommendations#encryption-in-transit 2. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-latest#az_storage_account_list 3. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-latest#az_storage_account_update 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit", "pdf": "azure"}, {"Rule_number": "3.3", "Rule": "3.3 Ensure that 'Enable key rotation reminders' is enabled for each Storage Account (Manual)", "Profile_applicability": " Level 1", "Description": "Access Keys authenticate application access requests to data contained in Storage Accounts. A periodic rotation of these keys is recommended to ensure that potentially compromised keys cannot result in a long-term exploitable credential. The \"Rotation Reminder\" is an automatic reminder feature for a manual procedure.", "Rationale": "Reminders such as those generated by this recommendation will help maintain a regular and healthy cadence for activities which improve the overall efficacy of a security program. Cryptographic key rotation periods will vary depending on your organization's security requirements and the type of data which is being stored in the Storage Account. For example, PCI DSS mandates that cryptographic keys be replaced or rotated 'regularly,' and advises that keys for static data stores be rotated every 'few months.' For the purposes of this recommendation, 90 days will prescribed for the reminder. Review and adjustment of the 90 day period is recommended, and may even be necessary. Your organization's security requirements should dictate the appropriate setting.", "Impact": "This recommendation only creates a periodic reminder to regenerate access keys. Regenerating access keys can affect services in Azure as well as the organization's applications that are dependent on the storage account. All clients that use the access key to access the storage account must be updated to use the new key.", "Audit": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Click Set rotation reminder \nIf the checkbox for Enable key rotation reminders is already checked, that Storage \nAccount is compliant. Review the Remind me every field for a desirable periodic setting \nthat fits your security program's needs."}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account that is not compliant, go to Access keys \n3. Click Set rotation reminder \n4. Check Enable key rotation reminders \n5. In the Send reminders field select Custom, then set the Remind me every field to \n90 and the period drop down to Days. \n6. Click Save", "From Powershell": "$rgName = <resource group name for the storage> \n$accountName = <storage account name> \n$account = Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName \nif ($account.KeyCreationTime.Key1 -eq $null -or $account.KeyCreationTime.Key2 \n-eq $null){ \n \nWrite-output (\"You must regenerate both keys at least once before \nsetting expiration policy\") \n} else { \n \n$account = Set-AzStorageAccount -ResourceGroupName $rgName -Name \n$accountName -KeyExpirationPeriodInDay 90 \n} \n$account.KeyPolicy.KeyExpirationPeriodInDays"}, "Default_value": "By default, Key rotation reminders is not configured.", "pdf": "azure"}, {"Rule_number": "3.4", "Rule": "3.4 Ensure that Storage Account Access Keys are Periodically Regenerated (Manual)", "Profile_applicability": " Level 1", "Description": "For increased security, regenerate storage account access keys periodically.", "Rationale": "When a storage account is created, Azure generates two 512-bit storage access keys which are used for authentication when the storage account is accessed. Rotating these keys periodically ensures that any inadvertent access or exposure does not result from the compromise of these keys. Cryptographic key rotation periods will vary depending on your organization's security requirements and the type of data which is being stored in the Storage Account. For example, PCI DSS mandates that cryptographic keys be replaced or rotated 'regularly,' and advises that keys for static data stores be rotated every 'few months.' For the purposes of this recommendation, 90 days will prescribed for the reminder. Review and adjustment of the 90 day period is recommended, and may even be necessary. Your organization's security requirements should dictate the appropriate setting.", "Impact": "Regenerating access keys can affect services in Azure as well as the organization's applications that are dependent on the storage account. All clients who use the access key to access the storage account must be updated to use the new key.", "Audit": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Review the date in the Last rotated field for each key. \nIf the Last rotated field indicates value greater than 90 day [or greater than your \norganization's period of validity], the key should be rotated.", "From Azure CLI": "1. Get a list of storage accounts"}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account with outdated keys, go to Access keys \n3. Click Rotate key next to the outdated key, then click Yes to the prompt confirming \nthat you want to regenerate the access key. \nAfter Azure regenerates the Access Key, you can confirm that Access keys reflects a \nLast rotated date of (0 days ago)."}, "Default_value": "By default, access keys are not regenerated periodically. References: 1. https://docs.microsoft.com/en-us/azure/storage/common/storage-create-storage-account#regenerate-storage-access-keys 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-access#pa-1-separate-and-limit-highly-privilegedadministrative-users 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-2-protect-identity-and-authentication-systems 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-6-define-and-implement-identity-and-privileged-access-strategy 5. https://www.pcidssguide.com/pci-dss-key-rotation-requirements/ 6. https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt1r5.pdf", "pdf": "azure"}, {"Rule_number": "3.5", "Rule": "3.5 Ensure Storage Logging is Enabled for Queue Service for 'Read', 'Write', and 'Delete' requests (Automated)", "Profile_applicability": " Level 2", "Description": "The Storage Queue service stores messages that may be read by any client who has access to the storage account. A queue can contain an unlimited number of messages, each of which can be up to 64KB in size using version 2011-08-18 or newer. Storage Logging happens server-side and allows details for both successful and failed requests to be recorded in the storage account. These logs allow users to see the details of read, write, and delete operations against the queues. Storage Logging log entries contain the following information about individual requests: Timing information such as start time, end-to-end latency, and server latency, authentication details, concurrency information, and the sizes of the request and response messages.", "Rationale": "Storage Analytics logs contain detailed information about successful and failed requests to a storage service. This information can be used to monitor individual requests and to diagnose issues with a storage service. Requests are logged on a best-effort basis. Storage Analytics logging is not enabled by default for your storage account.", "Impact": "Enabling this setting can have a high impact on the cost of the log analytics service and data storage used by logging more data per each request. Do not enable this without determining your need for this level of logging, and do not forget to check in on data usage and projected cost. Some users have seen their logging costs increase from $10 per month to $10,000 per month.", "Audit": {"From Azure Portal": "1. Go to Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the queue tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logs section and that they are sent to the correct destination."}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the queue tab indented below the storage account. \n5. Click + Add diagnostic setting. \n6. Select StorageRead, StorageWrite and StorageDelete options under the Logs \nsection to enable Storage Logging for Queue service. \n7. Select a destination for your logs to be sent to.", "From Azure CLI": "Use the below command to enable the Storage Logging for Queue service. \naz storage logging update --account-name <storageAccountName> --account-key \n<storageAccountKey> --services q --log rwd --retention 90"}, "Default_value": "By default storage account queue services are not logged. References: 1. https://docs.microsoft.com/en-us/rest/api/storageservices/about-storage-analytics-logging 2. https://docs.microsoft.com/en-us/cli/azure/storage/logging?view=azure-cli-latest 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-4-enable-network-logging-for-security-investigation 4. https://docs.microsoft.com/en-us/azure/storage/queues/monitor-queue-storage?tabs=azure-portal", "pdf": "azure"}, {"Rule_number": "3.6", "Rule": "3.6 Ensure that Shared Access Signature Tokens Expire Within an Hour (Manual)", "Profile_applicability": " Level 1", "Description": "Expire shared access signature tokens within an hour.", "Rationale": "A shared access signature (SAS) is a URI that grants restricted access rights to Azure Storage resources. A shared access signature can be provided to clients who should not be trusted with the storage account key but for whom it may be necessary to delegate access to certain storage account resources. Providing a shared access signature URI to these clients allows them access to a resource for a specified period of time. This time should be set as low as possible and preferably no longer than an hour. Audit: Currently, SAS token expiration times cannot be audited. Until Microsoft makes token expiration time a setting rather than a token creation parameter, this recommendation would require a manual verification. Remediation: When generating shared access signature tokens, use start and end time such that it falls within an hour. From Azure Portal 1. Go to Storage Accounts 2. For each storage account, go to Shared access signature 3. Set Start and expiry date/time within an hour Default Value: By default, expiration for shared access signature is set to 8 hours. References: 1. https://docs.microsoft.com/en-us/rest/api/storageservices/delegating-access-with-a-shared-access-signature 2. https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview", "Impact": "Enabling this setting can have a high impact on the cost of the log analytics service and data storage used by logging more data per each request. Do not enable this without determining your need for this level of logging, and do not forget to check in on data usage and projected cost. Some users have seen their logging costs increase from $10 per month to $10,000 per month.", "Audit": {"General Audit Instructions": "Currently, SAS token expiration times cannot be audited. Until Microsoft makes token \nexpiration time a setting rather than a token creation parameter, this recommendation \nwould require a manual verification."}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, go to Shared access signature \n3. Set Start and expiry date/time within an hour"}, "Default_value": "By default, expiration for shared access signature is set to 8 hours. References: 1. https://docs.microsoft.com/en-us/rest/api/storageservices/delegating-access-with-a-shared-access-signature 2. https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview", "pdf": "azure"}, {"Rule_number": "3.7", "Rule": "3.7 Ensure that 'Public Network Access' is `Disabled' for storage accounts (Automated)", "Profile_applicability": " Level 1", "Description": "Disallowing public network access for a storage account overrides the public access settings for individual containers in that storage account for Azure Resource Manager Deployment Model storage accounts. Azure Storage accounts that use the classic deployment model will be retired on August 31, 2024.", "Rationale": "The default network configuration for a storage account permits a user with appropriate permissions to configure public network access to containers and blobs in a storage account. Keep in mind that public access to a container is always turned off by default and must be explicitly configured to permit anonymous requests. It grants read-only access to these resources without sharing the account key, and without requiring a shared access signature. It is recommended not to provide public network access to storage accounts until, and unless, it is strongly desired. A shared access signature token or Azure AD RBAC should be used for providing controlled and timed access to blob containers.", "Impact": "Access will have to be managed using shared access signatures or via Azure AD RBAC.", "Audit": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, under the Security + networking section, click \nNetworking \n3. Ensure the Public Network Access setting is set to Disabled.", "From Azure CLI": "Ensure publicNetworkAccess is Disabled \naz storage account show --name <storage-account> --resource-group <resource-\ngroup> --query \"{publicNetworkAccess:publicNetworkAccess}\" \nFrom PowerShell \nFor each Storage Account, ensure PublicNetworkAccess is Disabled"}, "Remediation": {"From Azure Portal": "First, follow Microsoft documentation and create shared access signature tokens for \nyour blob containers. Then, 1.Go to Storage Accounts \n2. For each storage account, under the Security + networking section, click \nNetworking \n3. Set Public Network Access to Disabled.", "From Azure CLI": "Set 'Public Network Access' to Disabled on the storage account \naz storage account update --name <storage-account> --resource-group \n<resource-group> --public-network-access Disabled \nFrom PowerShell \nFor each Storage Account, run the following to set the PublicNetworkAccess setting to \nDisabled \nSet-AzStorageAccount -ResourceGroupName <resource group name> -Name <storage \naccount name> -PublicNetworkAccess Disabled"}, "Default_value": "By default, Public Network Access is set to Enabled from all networks for the Storage Account. References: 1. https://docs.microsoft.com/en-us/azure/storage/blobs/storage-manage-access-to-resources 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-strategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-duties-strategy", "pdf": "azure"}, {"Rule_number": "3.8", "Rule": "3.8 Ensure Default Network Access Rule for Storage Accounts is Set to Deny (Automated)", "Profile_applicability": " Level 1", "Description": "Restricting default network access helps to provide a new layer of security, since storage accounts accept connections from clients on any network. To limit access to selected networks, the default action must be changed.", "Rationale": "Storage accounts should be configured to deny access to traffic from all networks (including internet traffic). Access can be granted to traffic from specific Azure Virtual networks, allowing a secure network boundary for specific applications to be built. Access can also be granted to public internet IP address ranges to enable connections from specific internet or on-premises clients. When network rules are configured, only applications from allowed networks can access a storage account. When calling from an allowed network, applications continue to require proper authorization (a valid access key or SAS token) to access the storage account.", "Impact": "All allowed networks will need to be whitelisted on each specific network, creating administrative overhead. This may result in loss of network connectivity, so do not turn on for critical resources during business hours.", "Audit": {"From Azure Console": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade. \n3. Click the Firewalls and virtual networks heading. \n4. Ensure that Allow access from All networks is not selected.", "From Azure CLI": "Ensure defaultAction is not set to Allow. \n    az storage account list --query '[*].networkRuleSet' \nFrom PowerShell"}, "Remediation": {"From Azure Console": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click the Firewalls and virtual networks heading. \n4. Ensure that you have elected to allow access from Selected networks \n5. Add rules to allow traffic from specific network. \n6. Click Save to apply your changes.", "From Azure CLI": "Use the below command to update default-action to Deny. \n    az storage account update --name <StorageAccountName> --resource-group \n<resourceGroupName> --default-action Deny"}, "Default_value": "By default, Storage Accounts will accept connections from clients on any network. References: 1. https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security", "pdf": "azure"}, {"Rule_number": "3.9", "Rule": "3.9 Ensure 'Allow Azure services on the trusted services list to access this storage account' is Enabled for Storage Account Access (Automated)", "Profile_applicability": " Level 2", "Description": "Some Azure services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Azure services to bypass the network rules. These services will then use strong authentication to access the storage account. If the Allow trusted Azure services exception is enabled, the following services are granted access to the storage account: Azure Backup, Azure Site Recovery, Azure DevTest Labs, Azure Event Grid, Azure Event Hubs, Azure Networking, Azure Monitor, and Azure SQL Data Warehouse (when registered in the subscription).", "Rationale": "Turning on firewall rules for storage account will block access to incoming requests for data, including from other Azure services. We can re-enable this functionality by enabling \"Trusted Azure Services\" through networking exceptions.", "Impact": "This creates authentication credentials for services that need access to storage resources so that services will no longer need to communicate via network request. There may be a temporary loss of communication as you set each Storage Account. It is recommended to not do this on mission-critical resources during business hours.", "Audit": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click on the Firewalls and virtual networks heading. \n4. Ensure that Enabled from selected virtual networks and IP addresses is \nselected. \n5. Ensure that Allow Azure services on the trusted services list to access \nthis storage account is checked in Exceptions.", "From Azure CLI": "Ensure bypass contains AzureServices"}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click on the Firewalls and virtual networks heading. \n4. Ensure that Enabled from selected virtual networks and IP addresses is \nselected. \n5. Under the 'Exceptions' label, enable check box for Allow Azure services on the \ntrusted services list to access this storage account. \n6. Click Save to apply your changes.", "From Azure CLI": "Use the below command to update Azure services. \naz storage account update --name <StorageAccountName> --resource-group \n<resourceGroupName> --bypass AzureServices"}, "Default_value": "By default, Storage Accounts will accept connections from clients on any network. References: 1. https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security", "pdf": "azure"}, {"Rule_number": "3.10", "Rule": "3.10 Ensure Private Endpoints are used to access Storage Accounts (Automated)", "Profile_applicability": " Level 1", "Description": "Use private endpoints for your Azure Storage accounts to allow clients and services to securely access data located over a network via an encrypted Private Link. To do this, the private endpoint uses an IP address from the VNet for each service. Network traffic between disparate services securely traverses encrypted over the VNet. This VNet can also link addressing space, extending your network and accessing resources on it. Similarly, it can be a tunnel through public networks to connect remote infrastructures together. This creates further security through segmenting network traffic and preventing outside sources from accessing it.", "Rationale": "Securing traffic between services through encryption protects the data from easy interception and reading.", "Impact": "There is no cost in deploying VNets between Azure resources. If improperly implemented, it may result in loss of critical network traffic.", "Audit": {"From Azure Portal": "1. Open the Storage Accounts blade. \n2. For each listed Storage Account, perform the following check3. Under the Security + networking heading, click on Networking. \n4. Click on the Private Endpoint Connections tab at the top of the networking \nwindow. \n5. Ensure that for each VNet that the Storage Account must be accessed from, a \nunique Private Endpoint is deployed and the Connection State for each Private \nEndpoint is Approved \nRepeat the procedure for each Storage Account."}, "Remediation": {"From Azure Portal": "1. Open the Storage Accounts blade \n2. For each listed Storage Account, perform the following3. Under the Security + networking heading, click on Networking \n4. Click on the Private Endpoint Connections tab at the top of the networking \nwindow \n5. Click the +Private endpoint button \n6. In the 1 - Basics tab/stepo  \nEnter a name that will be easily recognizable as associated with the \nStorage Account (Note: The \"Network Interface Name\" will be \nautomatically completed, but you can customize it if needed.) \no Ensure that the Region matches the region of the Storage Account \no Click Next \n7. In the 2 - Resource tab/step:"}, "Default_value": "By default, Storage Accounts will accept connections from clients on any network. References: 1. https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security", "pdf": "azure"}, {"Rule_number": "3.11", "Rule": "3.11 Ensure Soft Delete is Enabled for Azure Containers and Blob Storage (Automated)", "Profile_applicability": " Level 1", "Description": "The Azure Storage blobs contain data like ePHI or Financial, which can be secret or personal. Data that is erroneously modified or deleted by an application or other storage account user will cause data loss or unavailability. It is recommended that both Azure Containers with attached Blob Storage and standalone containers with Blob Storage be made recoverable by enabling the soft delete configuration. This is to save and recover data when blobs or blob snapshots are deleted.", "Rationale": "Containers and Blob Storage data can be incorrectly deleted. An attacker/malicious user may do this deliberately in order to cause disruption. Deleting an Azure Storage blob causes immediate data loss. Enabling this configuration for Azure storage ensures that even if blobs/data were deleted from the storage account, Blobs/data objects are recoverable for a particular time which is set in the \"Retention policies,\" ranging from 7 days to 365 days.", "Impact": "Additional storage costs may be incurred as snapshots are retained.", "Audit": {"From Azure Portal": "1. From the Azure home page, open the hamburger menu in the top left or click on \nthe arrow pointing right with 'More services' underneath. \n2. Select Storage. \n3. Select Storage Accounts. \n4. For each Storage Account, navigate to Data protection in the left scroll column. \n5. Ensure that soft delete is checked for both blobs and containers. Also check if \nthe retention period is a sufficient length for your organization.", "From Azure CLI": "Blob Storage: Ensure that the output of the below command contains enabled status as \ntrue and days is not empty or null \naz storage blob service-properties delete-policy show --account-name \n<StorageAccountName> --account-key <accountkey>"}, "Remediation": {"From Azure Portal": "1. From the Azure home page, open the hamburger menu in the top left or click on \nthe arrow pointing right with 'More services' underneath. \n2. Select Storage. \n3. Select Storage Accounts. \n4. For each Storage Account, navigate to Data protection in the left scroll column. \n5. Check soft delete for both blobs and containers. Set the retention period to a \nsufficient length for your organization.", "From Azure CLI": "Update blob storage retention days in below command \naz storage blob service-properties delete-policy update --days-retained \n<RetentionDaysValue> --account-name <StorageAccountName> --account-key \n<AccountKey> --enable true \nUpdate container retention with the below command \naz storage account blob-service-properties update \n    --enable-container-delete-retention true \n    --container-delete-retention-days <days> \n    --account-name <storage-account> \n    --resource-group <resource_group> \n    --account-key <AccountKey>"}, "Default_value": "When a new storage account is created, soft delete for containers and blob storage is by default disabled.", "pdf": "azure"}, {"Rule_number": "3.12", "Rule": "3.12 Ensure Storage for Critical Data are Encrypted with Customer Managed Keys (CMK) (Manual)", "Profile_applicability": " Level 2", "Description": "Enable sensitive data encryption at rest using Customer Managed Keys (CMK) rather than Microsoft Managed keys.", "Rationale": "By default, data in the storage account is encrypted using Microsoft Managed Keys at rest. All Azure Storage resources are encrypted, including blobs, disks, files, queues, and tables. All object metadata is also encrypted. If you want to control and manage this encryption key yourself, however, you can specify a customer-managed key. That key is used to protect and control access to the key that encrypts your data. You can also choose to automatically update the key version used for Azure Storage encryption whenever a new version is available in the associated Key Vault.", "Impact": "If the key expires by setting the 'activation date' and 'expiration date', the user must rotate the key manually. Using Customer Managed Keys may also incur additional man-hour requirements to create, store, manage, and protect the keys as needed.", "Audit": {"From Azure Console": "1. Go to Storage Accounts \n2. For each storage account, go to Encryption \n3. Ensure that Encryption type is set to Customer Managed Keys \nFrom PowerShell \nConnect-AzAccount \nSet-AzContext -Subscription <subscription id> \nGet-AzStorageAccount |Select-Object -ExpandProperty Encryption \nPowerShell Results - Non-Compliant \n... \nKeySource                       : Microsoft.Storage \n..."}, "Remediation": {"From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, go to Encryption \n3. Set Customer Managed Keys \n4. Select the Encryption key and enter the appropriate setting value \n5. Click Save"}, "Default_value": "By default, Encryption type is set to Microsoft Managed Keys. References: 1. https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption 2. https://docs.microsoft.com/en-us/azure/security/fundamentals/data-encryption-best-practices#protect-data-at-rest 3. https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption#azure-storage-encryption-versus-disk-encryption 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-when-required", "pdf": "azure"}, {"Rule_number": "3.13", "Rule": "3.13 Ensure Storage logging is Enabled for Blob Service for 'Read', 'Write', and 'Delete' requests (Automated)", "Profile_applicability": " Level 2", "Description": "The Storage Blob service provides scalable, cost-efficient object storage in the cloud. Storage Logging happens server-side and allows details for both successful and failed requests to be recorded in the storage account. These logs allow users to see the details of read, write, and delete operations against the blobs. Storage Logging log entries contain the following information about individual requests: timing information such as start time, end-to-end latency, and server latency; authentication details; concurrency information; and the sizes of the request and response messages.", "Rationale": "Storage Analytics logs contain detailed information about successful and failed requests to a storage service. This information can be used to monitor each individual request to a storage service for increased security or diagnostics. Requests are logged on a best-effort basis. Storage Analytics logging is not enabled by default for your storage account.", "Impact": "Being a level 2, enabling this setting can have a high impact on the cost of data storage used for logging more data per each request. Do not enable this without determining your need for this level of logging or forget to check in on data usage and projected cost.", "Audit": {"From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'blob' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination.", "From Azure CLI": "Ensure the below command's output contains properties delete, read and write set to \ntrue."}, "Remediation": {"From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'blob' tab indented below the storage account. \n5. Click '+ Add diagnostic setting'. \n6. Select StorageRead, StorageWrite and StorageDelete options under the Logging \nsection to enable Storage Logging for Blob service. \n7. Select a destination for your logs to be sent to.", "From Azure CLI": "Use the below command to enable the Storage Logging for Blob service. \naz storage logging update --account-name <storageAccountName> --account-key \n<storageAccountKey> --services b --log rwd --retention 90"}, "Default_value": "By default, storage account blob service logging is disabled for read, write, and delete operations. References: 1. https://docs.microsoft.com/en-us/rest/api/storageservices/about-storage-analytics-logging 2. https://docs.microsoft.com/en-us/cli/azure/storage/logging?view=azure-cli-latest 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation Additional Information: We cannot practically generalize detailed audit log requirements for every blob due to their nature and intent. This recommendation may be applicable to storage account blob service where the security is paramount.", "pdf": "azure"}, {"Rule_number": "3.14", "Rule": "3.14 Ensure Storage Logging is Enabled for Table Service for 'Read', 'Write', and 'Delete' Requests (Automated)", "Profile_applicability": " Level 2", "Description": "Azure Table storage is a service that stores structured NoSQL data in the cloud, providing a key/attribute store with a schema-less design. Storage Logging happens server-side and allows details for both successful and failed requests to be recorded in the storage account. These logs allow users to see the details of read, write, and delete operations against the tables. Storage Logging log entries contain the following information about individual requests: timing information such as start time, end-to-end latency, and server latency; authentication details; concurrency information; and the sizes of the request and response messages.", "Rationale": "Storage Analytics logs contain detailed information about successful and failed requests to a storage service. This information can be used to monitor each individual request to a storage service for increased security or diagnostics. Requests are logged on a best-effort basis. Storage Analytics logging is not enabled by default for your storage account.", "Impact": "Being a level 2, enabling this setting can have a high impact on the cost of data storage used for logging more data per each request. Do not enable this without determining your need for this level of logging or forget to check in on data usage and projected cost.", "Audit": {"From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'table' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination."}, "Remediation": {"From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'table' tab indented below the storage account. \n5. Click '+ Add diagnostic setting'. \n6. Select StorageRead, StorageWrite and StorageDelete options under the Logging \nsection to enable Storage Logging for Table service. \n7. Select a destination for your logs to be sent to.", "From Azure CLI": "Use the below command to enable the Storage Logging for Table service. \naz storage logging update --account-name <storageAccountName> --account-key \n<storageAccountKey> --services t --log rwd --retention 90"}, "Default_value": "By default, storage account table service logging is disabled for read, write, an delete operations References: 1. https://docs.microsoft.com/en-us/rest/api/storageservices/about-storage-analytics-logging 2. https://docs.microsoft.com/en-us/cli/azure/storage/logging?view=azure-cli-latest 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "3.15", "Rule": "3.15 Ensure the \"Minimum TLS version\" for storage accounts is set to \"Version 1.2\" (Automated)", "Profile_applicability": " Level 1", "Description": "In some cases, Azure Storage sets the minimum TLS version to be version 1.0 by default. TLS 1.0 is a legacy version and has known vulnerabilities. This minimum TLS version can be configured to be later protocols such as TLS 1.2.", "Rationale": "TLS 1.0 has known vulnerabilities and has been replaced by later versions of the TLS protocol. Continued use of this legacy protocol affects the security of data in transit.", "Impact": "When set to TLS 1.2 all requests must leverage this version of the protocol. Applications leveraging legacy versions of the protocol will fail.", "Audit": {"From Azure Console": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Storage Accounts \n3. Click on each Storage Account \n4. Under Setting section, Click on Configuration \n5. Ensure that the minimum TLS version is set to be Version 1.2", "From Azure CLI": "Get a list of all storage accounts and their resource groups \naz storage account list | jq '.[] | {name, resourceGroup}' \nThen query the minimumTLSVersion field \naz storage account show \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --query minimumTlsVersion \\ \n    --output tsv", "From Azure PowerShell": "To get the minimum TLS version, run the following command(Get-AzStorageAccount -Name <STORAGEACCOUNTNAME>  -ResourceGroupName \n<RESOURCEGROUPNAME>).MinimumTlsVersion"}, "Remediation": {"From Azure Console": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Storage Accounts \n3. Click on each Storage Account \n4. Under Setting section, Click on Configuration \n5. Set the minimum TLS version to be Version 1.2", "From Azure CLI": "az storage account update \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --min-tls-version TLS1_2", "From Azure PowerShell": "To set the minimum TLS version, run the following commandSet-AzStorageAccount -AccountName <STORAGEACCOUNTNAME> ` \n                     -ResourceGroupName <RESOURCEGROUPNAME> ` \n                     -MinimumTlsVersion TLS1_2"}, "Default_value": "If a storage account is created through the portal, the MinimumTlsVersion property for that storage account will be set to TLS 1.2. If a storage account is created through PowerShell or CLI, the MinimumTlsVersion property for that storage account will not be set, and defaults to TLS 1.0. References: 1. https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-configure-minimum-version?tabs=portal 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit", "pdf": "azure"}, {"Rule_number": "3.16", "Rule": "3.16 Ensure 'Cross Tenant Replication' is not enabled (Automated)", "Profile_applicability": " Level 1", "Description": "Cross Tenant Replication in Azure allows data to be replicated across multiple Azure tenants. While this feature can be beneficial for data sharing and availability, it also poses a significant security risk if not properly managed. Unauthorized data access, data leakage, and compliance violations are potential risks. Disabling Cross Tenant Replication ensures that data is not inadvertently replicated across different tenant boundaries without explicit authorization.", "Rationale": "Disabling Cross Tenant Replication minimizes the risk of unauthorized data access and ensures that data governance policies are strictly adhered to. This control is especially critical for organizations with stringent data security and privacy requirements, as it prevents the accidental sharing of sensitive information.", "Impact": "Disabling Cross Tenant Replication may affect data availability and sharing across different Azure tenants. Ensure that this change aligns with your organizational data sharing and availability requirements.", "Audit": {"From Azure Portal": "Login to the Azure Portal using https://portal.azure.com 1.Navigate to Storage Accounts \n2. For each storage account, on the left blade under Data Management, click on \nObject replication \n3. Select Advanced settings \n4. Make sure Allow cross-tenant replication is not checked", "From Azure CLI": "az storage account list --query \"[*].[name,allowCrossTenantReplication]\" \nThe value of false should be returned for each storage account listed."}, "Remediation": {"From Azure Portal": "1. Navigate to Storage Accounts \n2. For each storage account, on the left blade under Data Management, click on \nObject replication \n3. Click on Advanced settings and untick Allow cross-tenant replication \n4. Click on OK", "From Azure CLI": "Replace the information within <> with appropriate valuesaz storage account update --name <storageAccountName> --resource-group \n<resourceGroupName> --allow-cross-tenant-replication false"}, "Default_value": "For new storage accounts created after Dec 15, 2023 cross tenant replication is not enabled. References: 1. https://learn.microsoft.com/en-us/azure/storage/blobs/object-replication-prevent-cross-tenant-policies?tabs=portal", "pdf": "azure"}, {"Rule_number": "3.17", "Rule": "3.17 Ensure that `Allow Blob Anonymous Access` is set to `Disabled` (Automated)", "Profile_applicability": " Level 1", "Description": "The Azure Storage setting \u2018Allow Blob Anonymous Access\u2019 (aka \"allowBlobPublicAccess\") controls whether anonymous access is allowed for blob data in a storage account. When this property is set to True, it enables public read access to blob data, which can be convenient for sharing data but may carry security risks. When set to False, it disallows public access to blob data, providing a more secure storage environment.", "Rationale": "If \"Allow Blob Anonymous Access\" is enabled, blobs can be accessed by adding the blob name to the URL to see the contents. An attacker can enumerate a blob using methods, such as brute force, and access them. Exfiltration of data by brute force enumeration of items from a storage account may occur if this setting is set to 'Enabled'.", "Impact": "Additional consideration may be required for exceptional circumstances where elements of a storage account require public accessibility. In these circumstances, it is highly recommended that all data stored in the public facing storage account be reviewed for sensitive or potentially compromising data, and that sensitive or compromising data is never stored in these storage accounts.", "Audit": {"From Azure Portal": "1. Open the Storage Accounts blade \n2. Click on a Storage Account \n3. In the storage account menu pane, under the Settings section, click \nConfiguration. \n4. Under Allow Blob Anonymous Access ensure that the selected setting is \nDisabled. \nRepeat these steps for each Storage Account."}, "Remediation": {"From Azure Portal": "1. Open the Storage Accounts blade \n2. Click on a Storage Account \n3. In the storage account menu pane, under the Settings section, click \nConfiguration. \n4. Under Allow Blob Anonymous Access, select Disabled. \nRepeat these steps for each Storage Account.", "From Powershell": "For every storage account in scope, run the following$storageAccount = Get-AzStorageAccount -ResourceGroupName \n\"<yourResourceGroup>\" -Name \"<yourStorageAccountName>\" \n$storageAccount.AllowBlobPublicAccess = $false \nSet-AzStorageAccount -InputObject $storageAccount"}, "Default_value": "Disabled References: 1. https://learn.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent?tabs=portal 2. https://learn.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent?source=recommendations&tabs=portal 3. Classic Storage Accounts: https://learn.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent-classic?tabs=portal", "pdf": "azure"}, {"Rule_number": "4.1.1", "Rule": "4.1.1 Ensure that 'Auditing' is set to 'On' (Automated)", "Profile_applicability": " Level 1", "Description": "Enable auditing on SQL Servers.", "Rationale": "The Azure platform allows a SQL server to be created as a service. Enabling auditing at the server level ensures that all existing and newly created databases on the SQL server instance are audited. Auditing policy applied on the SQL database does not override auditing policy and settings applied on the particular SQL server where the database is hosted. Auditing tracks database events and writes them to an audit log in the Azure storage account. It also helps to maintain regulatory compliance, understand database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations. Audit: From Azure Portal 1. Go to SQL servers 2. For each server instance 3. Click on Auditing 4. Ensure that Enable Azure SQL Auditing is set to On From PowerShell Get the list of all SQL Servers Get-AzSqlServer For each Server Get-AzSqlServerAudit -ResourceGroupName <ResourceGroupName> -ServerName <SQLServerName> Ensure that BlobStorageTargetState, EventHubTargetState, or LogAnalyticsTargetState is set to Enabled.  From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \u2022 Policy ID: a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9 - Name: 'Auditing on SQL server should be enabled'", "Impact": "Additional consideration may be required for exceptional circumstances where elements of a storage account require public accessibility. In these circumstances, it is highly recommended that all data stored in the public facing storage account be reviewed for sensitive or potentially compromising data, and that sensitive or compromising data is never stored in these storage accounts.", "Audit": {"From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. Ensure that Enable Azure SQL Auditing is set to On \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <ResourceGroupName> -ServerName \n<SQLServerName> \nEnsure that BlobStorageTargetState, EventHubTargetState, or \nLogAnalyticsTargetState is set to Enabled.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9 - Name: 'Auditing on SQL \nserver should be enabled'"}, "Remediation": {"From Azure Portal": "1. Go to SQL servers \n2. Select the SQL server instance \n3. Under Security, click Auditing \n4. Click the toggle next to Enable Azure SQL Auditing \n5. Select an Audit log destination \n6. Click Save \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server, enable auditing and set the retention for at least 90 days. \nLog Analytics Example \nSet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<SQL Server name> -RetentionInDays <Number of Days to retain the audit logs, \nshould be 90days minimum> -LogAnalyticsTargetState Enabled -\nWorkspaceResourceId \"/subscriptions/<subscription \nID>/resourceGroups/insights-\nintegration/providers/Microsoft.OperationalInsights/workspaces/<workspace \nname> \nEvent Hub Example \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -EventHubTargetState Enabled -EventHubName  \n    \"<Event Hub name>\" -EventHubAuthorizationRuleResourceId \"<Event Hub \nAuthorization Rule Resource ID>\" \nBlob Storage Example* \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -BlobStorageTargetState Enabled  \n    -StorageAccountResourceId \n\"/subscriptions/<subscription_ID>/resourceGroups/<Resource_Group>/providers/M\nicrosoft.Stora \n    ge/storageAccounts/<Storage Account name>\""}, "Default_value": "By default, Enable Azure SQL Auditing is set to Off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-auditing-on-sql-servers 2. https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/get-azurermsqlserverauditing?view=azurermps-5.2.0", "pdf": "azure"}, {"Rule_number": "4.1.2", "Rule": "4.1.2 Ensure no Azure SQL Databases allow ingress from 0.0.0.0/0 (ANY IP) (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure that no SQL Databases allow ingress from 0.0.0.0/0 (ANY IP).", "Rationale": "Azure SQL Server includes a firewall to block access to unauthorized connections. More granular IP addresses can be defined by referencing the range of addresses available from specific datacenters. By default, for a SQL server, a Firewall exists with StartIp of 0.0.0.0 and EndIP of 0.0.0.0 allowing access to all the Azure services. Additionally, a custom rule can be set up with StartIp of 0.0.0.0 and EndIP of 255.255.255.255 allowing access from ANY IP over the Internet. In order to reduce the potential attack surface for a SQL server, firewall rules should be defined with more granular IP addresses by referencing the range of addresses available from specific datacenters.", "Impact": "Disabling Allow Azure services and resources to access this server will break all connections to SQL server and Hosted Databases unless custom IP specific rules are added in Firewall Policy.", "Audit": {"From Azure Portal": "1. Go to SQL servers \n2. For each SQL server \n3. Click on Networking \n4. Ensure that Allow Azure services and resources to access this server is \nUnchecked \n5. Ensure that no firewall rule exists with \n\u2022Start IP of 0.0.0.0 \n\u2022or other combinations which allows access to wider public IP ranges"}, "Remediation": {"From Azure Portal": "1. Go to SQL servers \n2. For each SQL server \n3. Click on Networking \n4. Uncheck the checkbox for Allow Azure services and resources to access this \nserver \n5. Set firewall rules to limit access to only authorized connections"}, "Default_value": "By default, Enable Azure SQL Auditing is set to Off. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-auditing-on-sql-servers 2. https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/get-azurermsqlserverauditing?view=azurermps-5.2.0", "pdf": "azure"}, {"Rule_number": "4.1.3", "Rule": "4.1.3 Ensure SQL server's Transparent Data Encryption (TDE) protector is encrypted with Customer-managed key (Automated)", "Profile_applicability": " Level 2", "Description": "Transparent Data Encryption (TDE) with Customer-managed key support provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. With TDE, data is encrypted at rest with a symmetric key (called the database encryption key) stored in the database or data warehouse distribution. To protect this data encryption key (DEK) in the past, only a certificate that the Azure SQL Service managed could be used. Now, with Customer-managed key support for TDE, the DEK can be protected with an asymmetric key that is stored in the Azure Key Vault. The Azure Key Vault is a highly available and scalable cloud-based key store which offers central key management, leverages FIPS 140-2 Level 2 validated hardware security modules (HSMs), and allows separation of management of keys and data for additional security. Based on business needs or criticality of data/databases hosted on a SQL server, it is recommended that the TDE protector is encrypted by a key that is managed by the data owner (Customer-managed key).", "Rationale": "Customer-managed key support for Transparent Data Encryption (TDE) allows user control of TDE encryption keys and restricts who can access them and when. Azure Key Vault, Azure\u2019s cloud-based external key management system, is the first key management service where TDE has integrated support for Customer-managed keys. With Customer-managed key support, the database encryption key is protected by an asymmetric key stored in the Key Vault. The asymmetric key is set at the server level and inherited by all databases under that server.", "Impact": "Once TDE protector is encrypted with a Customer-managed key, it transfers entire responsibility of respective key management on to you, and hence you should be more careful about doing any operations on the particular key in order to keep data from corresponding SQL server and Databases hosted accessible. When deploying Customer Managed Keys, it is prudent to ensure that you also deploy an automated toolset for managing these keys (this should include discovery and key rotation), and Keys should be stored in an HSM or hardware backed keystore, such as Azure Key Vault.", "Audit": {"From Azure Portal": "1. Go to SQL servers \nFor the desired server instance \n2. Click On Transparent data encryption \n3. Ensure that Customer-managed key is selected \n4. Ensure Make selected key the default TDE protector is checked", "From Azure CLI": "az account get-access-token --query \n\"{subscripton:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Typeapplication/json\" \nhttps://management.azure.com/subscriptions/$0/resourceGroups/{resourceGroupNa\nme}/providers/Microsoft.Sql/servers/{serverName}/encryptionProtector?api-\nversion=2015-05-01-preview' \nEnsure the output of the command contains properties \nkind set to azurekeyvault \nserverKeyType set to AzureKeyVault \nuri is not null \n \nFrom PowerShell \nGet-AzSqlServerTransparentDataEncryptionProtector -ServerName <ServerName> -\nResourceGroupName <ResourceGroupName> \nEnsure the output of the command contains properties \nType set to AzureKeyVault \nServerKeyVaultKeyName set to KeyVaultName_KeyName_KeyIdentifierVersion \nKeyId set to KeyIdentifier", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 0a370ff3-6cab-4e85-8995-295fd854c5b8 - Name: 'SQL servers \nshould use customer-managed keys to encrypt data at rest' \n\u2022Policy ID: ac01ad65-10e5-46df-bdd9-6b0cad13e1d2 - Name: 'SQL managed \ninstances should use customer-managed keys to encrypt data at rest'"}, "Remediation": {"From Azure Console": "1. Go to SQL servers \nFor the desired server instance \n2. Click On Transparent data encryption \n3. Set Transparent data encryption to Customer-managed key \n4. Browse through your key vaults to Select an existing key or create a new key in \nthe Azure Key Vault. \n5. Check Make selected key the default TDE protector", "From Azure CLI": "Use the below command to encrypt SQL server's TDE protector with a Customer-\nmanaged key \naz sql server tde-key set --resource-group <resourceName> --server \n<dbServerName> --server-key-type {AzureKeyVault} --kid <keyIdentifier> \n \nFrom PowerShell \nUse the below command to encrypt SQL server's TDE protector with a Customer-\nmanaged Key Vault key \nSet-AzSqlServerTransparentDataEncryptionProtector -Type AzureKeyVault -KeyId \n<KeyIdentifier> -ServerName <ServerName> -ResourceGroupName \n<ResourceGroupName> \nSelect Y when prompted"}, "Default_value": "By Default, Microsoft managed TDE protector is enabled for a SQL server. References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption-byok-azure-sql 2. https://azure.microsoft.com/en-in/blog/preview-sql-transparent-data-encryption-tde-with-bring-your-own-key-support/ 3. https://winterdom.com/2017/09/07/azure-sql-tde-protector-keyvault 4. https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-data-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-when-required 5. https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts 6. https://docs.microsoft.com/en-us/cli/azure/sql/server/tde-key?view=azure-cli-latest", "pdf": "azure"}, {"Rule_number": "4.1.4", "Rule": "4.1.4 Ensure that Microsoft Entra authentication is Configured for SQL Servers (Automated)", "Profile_applicability": " Level 1", "Description": "Use Microsoft Entra authentication for authentication with SQL Database to manage credentials in a single place.", "Rationale": "Microsoft Entra authentication is a mechanism to connect to Microsoft Azure SQL Database and SQL Data Warehouse by using identities in the Microsoft Entra ID directory. With Entra ID authentication, identities of database users and other Microsoft services can be managed in one central location. Central ID management provides a single place to manage database users and simplifies permission management. \u2022 It provides an alternative to SQL Server authentication. \u2022 Helps stop the proliferation of user identities across database servers. \u2022 Allows password rotation in a single place. \u2022 Customers can manage database permissions using external (Entra ID) groups. \u2022 It can eliminate storing passwords by enabling integrated Windows authentication and other forms of authentication supported by Microsoft Entra. \u2022 Entra ID authentication uses contained database users to authenticate identities at the database level. \u2022 Entra ID supports token-based authentication for applications connecting to SQL Database. \u2022 Entra ID authentication supports ADFS (domain federation) or native user/password authentication for a local Active Directory without domain synchronization. \u2022 Entra ID supports connections from SQL Server Management Studio that use Active Directory Universal Authentication, which includes Multi-Factor Authentication (MFA). MFA includes strong authentication with a range of easy verification options \u2014 phone call, text message, smart cards with pin, or mobile app notification.", "Impact": "This will create administrative overhead with user account and permission management. For further security on these administrative accounts, you may want to consider licensing which supports features like Multi Factor Authentication.", "Audit": {"From Azure Portal": "1. Go to SQL servers \n2. For each SQL server, click on Microsoft Entra admin under the Settings section \n3.", "Ensure that a value has been set for Admin Name under the Microsoft Entra \nadmin section \nFrom Azure CLI \nTo list SQL Server Admins on a specific server:": "az sql server ad-admin list --resource-group <resource-group> --server \n<server>From PowerShell \nPrint a list of all SQL Servers to find which one you want to audit \nGet-AzSqlServer \nAudit a list of Administrators on a Specific Server \nGet-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName <resource \ngroup name> -ServerName <server name> \nEnsure Output shows DisplayName set to AD account.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID1f314764-cb73-4fc9-b863-8eca98ac36e9 - Name: 'An Azure Active \nDirectory administrator should be provisioned for SQL servers'"}, "Remediation": {"From Azure Portal": "1. Go to SQL servers \n2. For each SQL server, click on Microsoft Entra admin \n3. Click on Set admin \n4. Select an admin \n5. Click Save", "From Azure CLI": "az ad user show --id  \nFor each Server, set AD Admin \naz sql server ad-admin create --resource-group <resource group name> --server \n<server name> --display-name <display name> --object-id <object id of user>"}, "Default_value": "By Default, Microsoft managed TDE protector is enabled for a SQL server. References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption-byok-azure-sql 2. https://azure.microsoft.com/en-in/blog/preview-sql-transparent-data-encryption-tde-with-bring-your-own-key-support/ 3. https://winterdom.com/2017/09/07/azure-sql-tde-protector-keyvault 4. https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-data-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-when-required 5. https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts 6. https://docs.microsoft.com/en-us/cli/azure/sql/server/tde-key?view=azure-cli-latest", "pdf": "azure"}, {"Rule_number": "4.1.5", "Rule": "4.1.5 Ensure that 'Data encryption' is set to 'On' on a SQL Database (Automated)", "Profile_applicability": " Level 1", "Description": "Enable Transparent Data Encryption on every SQL server.", "Rationale": "Azure SQL Database transparent data encryption helps protect against the threat of malicious activity by performing real-time encryption and decryption of the database, associated backups, and transaction log files at rest without requiring changes to the application. Audit: From Azure Portal 1. Go to SQL databases 2. For each DB instance 3. Click on Transparent data encryption 4. Ensure that Data encryption is set to On From Azure CLI Ensure the output of the below command is Enabled az sql db tde show --resource-group <resourceGroup> --server <dbServerName> --database <dbName> --query status  From PowerShell Get a list of SQL Servers. Get-AzSqlServer For each server, list the databases. Get-AzSqlDatabase -ServerName <SQL Server Name> -ResourceGroupName <Resource Group Name> For each database not listed as a Master database, check for Transparent Data Encryption. Get-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group Name> -ServerName <SQL Server Name> -DatabaseName <Database Name> Make sure DataEncryption is Enabled for each database except the Master database.", "Impact": "This will create administrative overhead with user account and permission management. For further security on these administrative accounts, you may want to consider licensing which supports features like Multi Factor Authentication.", "Audit": {"From Azure Portal": "1. Go to SQL databases \n2. For each DB instance \n3. Click on Transparent data encryption \n4. Ensure that Data encryption is set to On", "From Azure CLI": "Ensure the output of the below command is Enabled \naz sql db tde show --resource-group <resourceGroup> --server <dbServerName> -\n-database <dbName> --query status \n \nFrom PowerShell \nGet a list of SQL Servers. \nGet-AzSqlServer \nFor each server, list the databases. \nGet-AzSqlDatabase -ServerName <SQL Server Name> -ResourceGroupName <Resource \nGroup Name> \nFor each database not listed as a Master database, check for Transparent Data \nEncryption. \nGet-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group \nName> -ServerName <SQL Server Name> -DatabaseName <Database Name> \nMake sure DataEncryption is Enabled for each database except the Master database."}, "Remediation": {"From Azure Portal": "1. Go to SQL databases \n2. For each DB instance \n3. Click on Transparent data encryption \n4. Set Data encryption to On", "From Azure CLI": "Use the below command to enable Transparent data encryption for SQL DB instance. \naz sql db tde set --resource-group <resourceGroup> --server <dbServerName> --\ndatabase <dbName> --status Enabled \nFrom PowerShell \nUse the below command to enable Transparent data encryption for SQL DB instance. \nSet-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group \nName> -ServerName <SQL Server Name> -DatabaseName <Database Name> -State \n'Enabled' \nNote\n\u2022 \nTDE cannot be used to encrypt the logical master database in SQL Database. \nThe master database contains objects that are needed to perform the TDE \noperations on the user databases. \n\u2022Azure Portal does not show master databases per SQL server. However, \nCLI/API responses will show master databases."}, "Default_value": "By default, Data encryption is set to On. References: 1. https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption-with-azure-sql-database 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-4-enable-data-at-rest-encryption-by-default", "pdf": "azure"}, {"Rule_number": "4.1.6", "Rule": "4.1.6 Ensure that 'Auditing' Retention is 'greater than 90 days' (Automated)", "Profile_applicability": " Level 1", "Description": "SQL Server Audit Retention should be configured to be greater than 90 days.", "Rationale": "Audit Logs can be used to check for anomalies and give insight into suspected breaches or misuse of information and access. Audit: From Azure Portal 1. Go to SQL servers 2. For each server instance 3. Click on Auditing 4. If storage is selected, expand Advanced properties 5. Ensure Retention (days) setting is greater than 90 days or 0 for unlimited retention. From PowerShell Get the list of all SQL Servers Get-AzSqlServer For each Server Get-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName <server name> Ensure that RetentionInDays is set to more than 90 Note: If the SQL server is set with LogAnalyticsTargetState setting set to Enabled, run the following additional command. Get-AzOperationalInsightsWorkspace | Where-Object {$_.ResourceId -eq <SQL Server WorkSpaceResourceId>} Ensure that RetentionInDays is set to more than 90", "Impact": "This will create administrative overhead with user account and permission management. For further security on these administrative accounts, you may want to consider licensing which supports features like Multi Factor Authentication.", "Audit": {"From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. If storage is selected, expand Advanced properties \n5. Ensure Retention (days) setting is greater than 90 days or 0 for unlimited \nretention. \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<server name>", "Ensure that RetentionInDays is set to more than 90 \nNote:": "If the SQL server is set with LogAnalyticsTargetState setting set to Enabled, run \nthe following additional command. \nGet-AzOperationalInsightsWorkspace | Where-Object {$_.ResourceId -eq <SQL \nServer WorkSpaceResourceId>} \nEnsure that RetentionInDays is set to more than 90"}, "Remediation": {"From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. If storage is selected, expand Advanced properties \n5. Set the Retention (days) setting greater than 90 days or 0 for unlimited \nretention. \n6. Select Save \nFrom PowerShell \nFor each Server, set retention policy to more than 90 days \nLog Analytics Example \nSet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<SQL Server name> -RetentionInDays <Number of Days to retain the audit logs, \nshould be more than 90 days> -LogAnalyticsTargetState Enabled -\nWorkspaceResourceId \"/subscriptions/<subscription \nID>/resourceGroups/insights-\nintegration/providers/Microsoft.OperationalInsights/workspaces/<workspace \nname> \nEvent Hub Example \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -EventHubTargetState Enabled -EventHubName  \n    \"<Event Hub name>\" -EventHubAuthorizationRuleResourceId \"<Event Hub \nAuthorization Rule Resource ID>\" \nBlob Storage Example* \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -BlobStorageTargetState Enabled  \n    -StorageAccountResourceId \n\"/subscriptions/<subscription_ID>/resourceGroups/<Resource_Group>/providers/M\nicrosoft.Stora \n    ge/storageAccounts/<Storage Account name>\""}, "Default_value": "By default, SQL Server audit storage is disabled.", "pdf": "azure"}, {"Rule_number": "4.3.1", "Rule": "4.3.1 Ensure 'Enforce SSL connection' is set to 'ENABLED' for PostgreSQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Enable SSL connection on PostgreSQL Servers.", "Rationale": "SSL connectivity helps to provide a new layer of security by connecting database server to client applications using Secure Sockets Layer (SSL). Enforcing SSL connections between database server and client applications helps protect against \"man in the middle\" attacks by encrypting the data stream between the server and application. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com 2. Go to Azure Database for PostgreSQL server 3. For each database, click on Connection security 4. In SSL settings, ensure Enforce SSL connection is set to ENABLED. From Azure CLI Ensure the output of the below command returns Enabled. az postgres server show --resource-group myresourcegroup --name <resourceGroupName> --query sslEnforcement  From PowerShell Ensure the output of the below command returns Enabled. Get-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName <ServerName> | Select-Object SslEnforcement  From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "This will create administrative overhead with user account and permission management. For further security on these administrative accounts, you may want to consider licensing which supports features like Multi Factor Authentication.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for PostgreSQL server \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED.", "From Azure CLI": "Ensure the output of the below command returns Enabled. \naz postgres server show --resource-group myresourcegroup --name \n<resourceGroupName> --query sslEnforcement \n \nFrom PowerShell \nEnsure the output of the below command returns Enabled. \nGet-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName \n<ServerName> | Select-Object SslEnforcement", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for PostgreSQL server \n3. For each database, click on Connection security \n4. In SSL settings, click on ENABLED to enforce SSL connections \n5. Click Save", "From Azure CLI": "Use the below command to enforce ssl connection for PostgreSQL Database. \naz postgres server update --resource-group <resourceGroupName> --name \n<serverName> --ssl-enforcement Enabled \nFrom PowerShell \nUpdate-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName \n<ServerName> -SslEnforcement Enabled"}, "Default_value": "By default, secure connectivity is enforced, but some application frameworks may not enable it during deployment. References: 1. https://docs.microsoft.com/en-us/azure/postgresql/concepts-ssl-connection-security 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-4-enable-data-at-rest-encryption-by-default 3. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-azpostgresqlserver?view=azps-9.2.0#example-2-get-postgresql-server-by-resource-group-and-server-name 4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-azpostgresqlserver?view=azps-9.2.0#example-1-update-postgresql-server-by-resource-group-and-server-name", "pdf": "azure"}, {"Rule_number": "4.3.2", "Rule": "4.3.2 Ensure Server Parameter 'log_checkpoints' is set to 'ON' for PostgreSQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Enable log_checkpoints on PostgreSQL Servers.", "Rationale": "Enabling log_checkpoints helps the PostgreSQL Database to Log each checkpoint in turn generates query and error logs. However, access to transaction logs is not supported. Query and error logs can be used to identify, troubleshoot, and repair configuration errors and sub-optimal performance. Audit: From Azure Portal 1. From Azure Home select the Portal Menu. 2. Go to Azure Database for PostgreSQL servers. 3. For each database, click on Server parameters. 4. Search for log_checkpoints. 5. Ensure that value is set to ON. From Azure CLI Ensure value is set to ON az postgres server configuration show  --resource-group <resourceGroupName> --server-name <serverName> --name log_checkpoints  From PowerShell Ensure value is set to ON Get-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -ServerName <ServerName> -Name log_checkpoints  From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "This will create administrative overhead with user account and permission management. For further security on these administrative accounts, you may want to consider licensing which supports features like Multi Factor Authentication.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_checkpoints. \n5. Ensure that value is set to ON.", "From Azure CLI": "Ensure value is set to ON \naz postgres server configuration show  --resource-group <resourceGroupName> -\n-server-name <serverName> --name log_checkpoints \n \nFrom PowerShell \nEnsure value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_checkpoints", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_checkpoints. \n5. Click ON and save.", "From Azure CLI": "Use the below command to update log_checkpoints configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_checkpoints --value on \nFrom PowerShell \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_checkpoints -Value on"}, "Default_value": "By default log_checkpoints is enabled (set to on). References: 1. https://docs.microsoft.com/en-us/rest/api/postgresql/singleserver/configurations/list-by-server 2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-parameters-using-portal 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 4. https://learn.microsoft.com/en-us/azure/postgresql/single-server/concepts-server-logs#configure-logging 5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-azpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-configuration-by-name 6. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-azpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-configuration-by-name", "pdf": "azure"}, {"Rule_number": "4.3.3", "Rule": "4.3.3 Ensure server parameter 'log_connections' is set to 'ON' for PostgreSQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Enable log_connections on PostgreSQL Servers.", "Rationale": "Enabling log_connections helps PostgreSQL Database to log attempted connection to the server, as well as successful completion of client authentication. Log data can be used to identify, troubleshoot, and repair configuration errors and suboptimal performance. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com. 2. Go to Azure Database for PostgreSQL servers. 3. For each database, click on Server parameters. 4. Search for log_connections. 5. Ensure that value is set to ON. From Azure CLI Ensure log_connections value is set to ON az postgres server configuration show --resource-group <resourceGroupName> --server-name <serverName> --name log_connections  From PowerShell Ensure log_connections value is set to ON Get-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -ServerName <ServerName> -Name log_connections  From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "This will create administrative overhead with user account and permission management. For further security on these administrative accounts, you may want to consider licensing which supports features like Multi Factor Authentication.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_connections. \n5. Ensure that value is set to ON.", "From Azure CLI": "Ensure log_connections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_connections \n \nFrom PowerShell \nEnsure log_connections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_connections", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_connections. \n5. Click ON and save.", "From Azure CLI": "Use the below command to update log_connections configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_connections --value on \nFrom PowerShell \nUse the below command to update log_connections configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_connections -Value on"}, "Default_value": "By default log_connections is enabled (set to on). References: 1. https://docs.microsoft.com/en-us/rest/api/postgresql/configurations/listbyserver 2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-parameters-using-portal 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-azpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-configuration-by-name 5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-azpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-configuration-by-name", "pdf": "azure"}, {"Rule_number": "4.3.4", "Rule": "4.3.4 Ensure server parameter 'log_disconnections' is set to 'ON' for PostgreSQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Enable log_disconnections on PostgreSQL Servers.", "Rationale": "Enabling log_disconnections helps PostgreSQL Database to Logs end of a session, including duration, which in turn generates query and error logs. Query and error logs can be used to identify, troubleshoot, and repair configuration errors and sub-optimal performance.", "Impact": "Enabling this setting will enable a log of all disconnections. If this is enabled for a high traffic server, the log may grow exponentially.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Go to Azure Database for PostgreSQL servers \n3. For each database, click on Server parameters \n4. Search for log_disconnections. \n5. Ensure that value is set to ON.", "From Azure CLI": "Ensure log_disconnections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_disconnections \nFrom PowerShell \nEnsure log_disconnections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_disconnections", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Go to Azure Database for PostgreSQL servers \n3. For each database, click on Server parameters \n4. Search for log_disconnections. \n5. Click ON and save.", "From Azure CLI": "Use the below command to update log_disconnections configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_disconnections --value on \nFrom PowerShell \nUse the below command to update log_disconnections configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_disconnections -Value on"}, "Default_value": "By default log_disconnections is disabled (set to off). References: 1. https://docs.microsoft.com/en-us/rest/api/postgresql/singleserver/configurations/list-by-server 2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-parameters-using-portal 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-azpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-configuration-by-name 5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-azpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-configuration-by-name", "pdf": "azure"}, {"Rule_number": "4.3.5", "Rule": "4.3.5 Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Enable connection_throttling on PostgreSQL Servers.", "Rationale": "Enabling connection_throttling helps the PostgreSQL Database to Set the verbosity of logged messages. This in turn generates query and error logs with respect to concurrent connections that could lead to a successful Denial of Service (DoS) attack by exhausting connection resources. A system can also fail or be degraded by an overload of legitimate users. Query and error logs can be used to identify, troubleshoot, and repair configuration errors and sub-optimal performance. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com. 2. Go to Azure Database for PostgreSQL servers. 3. For each database, click on Server parameters. 4. Search for connection_throttling. 5. Ensure that value is set to ON. From Azure CLI Ensure connection_throttling value is set to ON az postgres server configuration show --resource-group <resourceGroupName> --server-name <serverName> --name connection_throttling From PowerShell Ensure connection_throttling value is set to ON Get-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -ServerName <ServerName> -Name connection_throttling From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \u2022 Policy ID: 5345bb39-67dc-4960-a1bf-427e16b9a0bd - Name: 'Connection throttling should be enabled for PostgreSQL database servers'", "Impact": "Enabling this setting will enable a log of all disconnections. If this is enabled for a high traffic server, the log may grow exponentially.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for connection_throttling. \n5. Ensure that value is set to ON.", "From Azure CLI": "Ensure connection_throttling value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name connection_throttling \nFrom PowerShell \nEnsure connection_throttling value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name connection_throttling", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 5345bb39-67dc-4960-a1bf-427e16b9a0bd - Name: 'Connection \nthrottling should be enabled for PostgreSQL database servers'"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for connection_throttling. \n5. Click ON and save.", "From Azure CLI": "Use the below command to update connection_throttling configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name connection_throttling --value on \nFrom PowerShell \nUse the below command to update connection_throttling configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name connection_throttling -Value on"}, "Default_value": "By default, connection_throttling is enabled (set to on). References: 1. https://docs.microsoft.com/en-us/rest/api/postgresql/singleserver/configurations/list-by-server 2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-parameters-using-portal 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-azpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-configuration-by-name 5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-azpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-configuration-by-name", "pdf": "azure"}, {"Rule_number": "4.3.6", "Rule": "4.3.6 Ensure Server Parameter 'log_retention_days' is greater than 3 days for PostgreSQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure log_retention_days on PostgreSQL Servers is set to an appropriate value.", "Rationale": "Configuring log_retention_days determines the duration in days that Azure Database for PostgreSQL retains log files. Query and error logs can be used to identify, troubleshoot, and repair configuration errors and sub-optimal performance.", "Impact": "Configuring this setting will result in logs being retained for the specified number of days. If this is configured on a high traffic server, the log may grow quickly to occupy a large amount of disk space. In this case you may want to set this to a lower number.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_retention_days. \n5. Ensure that the value is between 4 and 7 (inclusive).", "From Azure CLI": "Ensure log_retention_days value is greater than 3. \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_retention_days", "From Powershell": "Ensure log_retention_days value is greater than 3. \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_retention_days"}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_retention_days. \n5. Input a value between 4 and 7 (inclusive) and click Save.", "From Azure CLI": "Use the below command to update log_retention_days configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_retention_days --value <4-7>", "From Powershell": "Use the below command to update log_retention_days configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_retention_days -Value <4-7>"}, "Default_value": "By default log_retention_days is set to 3. References: 1. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-parameters-using-portal 2. https://docs.microsoft.com/en-us/rest/api/postgresql/singleserver/configurations/list-by-server 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-6-configure-log-storage-retention 4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-azpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-configuration-by-name", "pdf": "azure"}, {"Rule_number": "4.3.7", "Rule": "4.3.7 Ensure 'Allow access to Azure services' for PostgreSQL Database Server is disabled (Automated)", "Profile_applicability": " Level 1", "Description": "Disable access from Azure services to PostgreSQL Database Server.", "Rationale": "If access from Azure services is enabled, the server's firewall will accept connections from all Azure resources, including resources not in your subscription. This is usually not a desired configuration. Instead, set up firewall rules to allow access from specific network ranges or VNET rules to allow access from specific virtual networks. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com. 2. Go to Azure Database for PostgreSQL servers. 3. For each database, click on Connection security. 4. Under Firewall rules, ensure Allow access to Azure services is set to No. From Azure CLI Ensure the output of the below command does not include a rule with the name AllowAllWindowsAzureIps or \"startIpAddress\": \"0.0.0.0\" or \"endIpAddress\": \"0.0.0.0\", az postgres server firewall-rule list --resource-group <resourceGroupName>  --server <serverName> From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \u2022 Policy ID: b52376f7-9612-48a1-81cd-1ffe4b61032c - Name: 'Public network access should be disabled for PostgreSQL servers' \u2022 Policy ID: 5e1de0e3-42cb-4ebc-a86d-61d0c619ca48 - Name: 'Public network access should be disabled for PostgreSQL flexible servers'", "Impact": "Configuring this setting will result in logs being retained for the specified number of days. If this is configured on a high traffic server, the log may grow quickly to occupy a large amount of disk space. In this case you may want to set this to a lower number.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Connection security. \n4. Under Firewall rules, ensure Allow access to Azure services is set to No.", "From Azure CLI": "Ensure the output of the below command does not include a rule with the name \nAllowAllWindowsAzureIps or \"startIpAddress\": \"0.0.0.0\" or \"endIpAddress\": \"0.0.0.0\", \naz postgres server firewall-rule list --resource-group <resourceGroupName>  -\n-server <serverName>", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: b52376f7-9612-48a1-81cd-1ffe4b61032c - Name: 'Public network \naccess should be disabled for PostgreSQL servers' \n\u2022Policy ID: 5e1de0e3-42cb-4ebc-a86d-61d0c619ca48 - Name: 'Public network \naccess should be disabled for PostgreSQL flexible servers'"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Connection security. \n4. Under Firewall rules, set Allow access to Azure services to No. \n5. Click Save.", "From Azure CLI": "Use the below command to delete the AllowAllWindowsAzureIps rule for PostgreSQL \nDatabase. \naz postgres server firewall-rule delete --name AllowAllWindowsAzureIps  --\nresource-group <resourceGroupName> --server-name <serverName>"}, "Default_value": "The Azure Postgres firewall is set to block all access by default. References: 1. https://docs.microsoft.com/en-us/azure/postgresql/concepts-firewall-rules 2. https://docs.microsoft.com/en-us/azure/postgresql/howto-manage-firewall-using-cli 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-1-establish-network-segmentation-boundaries 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-6-deploy-web-application-firewall", "pdf": "azure"}, {"Rule_number": "4.3.8", "Rule": "4.3.8 Ensure 'Infrastructure double encryption' for PostgreSQL Database Server is 'Enabled' (Automated)", "Profile_applicability": " Level 1", "Description": "Azure Database for PostgreSQL servers should be created with 'infrastructure double encryption' enabled.", "Rationale": "If Double Encryption is enabled, another layer of encryption is implemented at the hardware level before the storage or network level. Information will be encrypted before it is even accessed, preventing both interception of data in motion if the network layer encryption is broken and data at rest in system resources such as memory or processor cache. Encryption will also be in place for any backups taken of the database, so the key will secure access the data in all forms. For the most secure implementation of key based encryption, it is recommended to use a Customer Managed asymmetric RSA 2048 Key in Azure Key Vault.", "Impact": "The read and write speeds to the database will be impacted if both default encryption and Infrastructure Encryption are checked, as a secondary form of encryption requires more resource overhead for the cryptography of information. This cost is justified for information security. Customer managed keys are recommended for the most secure implementation, leading to overhead of key management. The key will also need to be backed up in a secure location, as loss of the key will mean loss of the information in the database.", "Audit": {"From Azure Portal": "1. From Azure Home, click on more services. \n2. Click on Databases. \n3. Click on Azure Database for PostgreSQL servers. \n4. Select the database by clicking on its name. \n5. Under Security, click Data encryption. \n6. Ensure that 'Infrastructure encryption enabled' is displayed and is 'checked'.", "From Azure CLI": "1. Enter the command"}, "Remediation": {"From Azure Portal": "1. Go through the normal process of database creation. \n2. On step 2 titled 'Additional settings' ensure that 'Infrastructure double encryption \nenabled' is 'checked'. \n3. Acknowledge that you understand this will impact database performance. \n4. Finish database creation as normal.", "From Azure CLI": "az postgres server create --resource-group <resourcegroup> --name \n<servername>  --location <location> --admin-user <adminusername> --admin-\npassword <server_admin_password> --sku-name GP_Gen4_2 --version 11 --\ninfrastructure-encryption Enabled"}, "Default_value": "By Default, Double Encryption is disabled. References: 1. https://docs.microsoft.com/en-us/azure/postgresql/howto-double-encryption 2. https://docs.microsoft.com/en-us/azure/postgresql/concepts-infrastructure-double-encryption 3. https://docs.microsoft.com/en-us/azure/postgresql/concepts-data-encryption-postgresql 4. https://docs.microsoft.com/en-us/azure/key-vault/keys/byok-specification 5. https://docs.microsoft.com/en-us/azure/postgresql/howto-double-encryption 6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-4-enable-data-at-rest-encryption-by-default", "pdf": "azure"}, {"Rule_number": "4.4.1", "Rule": "4.4.1 Ensure 'Enforce SSL connection' is set to 'Enabled' for Standard MySQL Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Enable SSL connection on MYSQL Servers.", "Rationale": "SSL connectivity helps to provide a new layer of security by connecting database server to client applications using Secure Sockets Layer (SSL). Enforcing SSL connections between database server and client applications helps protect against \"man in the middle\" attacks by encrypting the data stream between the server and application. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com 2. Go to Azure Database for MySQL servers 3. For each database, click on Connection security 4. In SSL settings, ensure Enforce SSL connection is set to ENABLED. From Azure CLI Ensure the output of the below command returns ENABLED.    az mysql server show --resource-group <resourceGroupName> --name <serverName> --query sslEnforcement  From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \u2022 Policy ID: e802a67a-daf5-4436-9ea6-f6d821dd0c5d - Name: 'Enforce SSL connection should be enabled for MySQL database servers'", "Impact": "The read and write speeds to the database will be impacted if both default encryption and Infrastructure Encryption are checked, as a secondary form of encryption requires more resource overhead for the cryptography of information. This cost is justified for information security. Customer managed keys are recommended for the most secure implementation, leading to overhead of key management. The key will also need to be backed up in a secure location, as loss of the key will mean loss of the information in the database.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL servers \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED.", "From Azure CLI": "Ensure the output of the below command returns ENABLED. \n   az mysql server show --resource-group <resourceGroupName> --name \n<serverName> --query sslEnforcement", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: e802a67a-daf5-4436-9ea6-f6d821dd0c5d - Name: 'Enforce SSL \nconnection should be enabled for MySQL database servers'"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL servers \n3. For each database, click on Connection security \n4. In SSL settings, click on ENABLED to Enforce SSL connections", "From Azure CLI": "Use the below command to set MYSQL Databases to Enforce SSL connection. \n    az mysql server update --resource-group <resourceGroupName> --name \n<serverName> --ssl-enforcement Enabled"}, "Default_value": "Azure Database for MySQL when provisioned through the Azure portal or CLI will require SSL connections by default. References: 1. https://docs.microsoft.com/en-us/azure/mysql/single-server/concepts-ssl-connection-security 2. https://docs.microsoft.com/en-us/azure/mysql/single-server/how-to-configure-ssl 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit", "pdf": "azure"}, {"Rule_number": "4.4.2", "Rule": "4.4.2 Ensure 'TLS Version' is set to 'TLSV1.2' (or higher) for MySQL flexible Database Server (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure TLS version on MySQL flexible servers is set to use TLS version 1.2 or higher.", "Rationale": "TLS connectivity helps to provide a new layer of security by connecting database server to client applications using Transport Layer Security (TLS). Enforcing TLS connections between database server and client applications helps protect against \"man in the middle\" attacks by encrypting the data stream between the server and application. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com 2. Go to Azure Database for MySQL flexible servers 3. For each database, click on Server parameters under Settings 4. In the search box, type in tls_version 5. Ensure tls_version is set to TLSV1.2 (or higher) From Azure CLI Ensure the output of the below command contains the key value pair \"values\": \"TLSV1.2\" (or higher). az mysql flexible-server parameter show --name tls_version --resource-group <resourceGroupName> --server-name <serverName> Example output:", "Impact": "The read and write speeds to the database will be impacted if both default encryption and Infrastructure Encryption are checked, as a secondary form of encryption requires more resource overhead for the cryptography of information. This cost is justified for information security. Customer managed keys are recommended for the most secure implementation, leading to overhead of key management. The key will also need to be backed up in a secure location, as loss of the key will mean loss of the information in the database.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL flexible servers \n3. For each database, click on Server parameters under Settings \n4. In the search box, type in tls_version \n5. Ensure tls_version is set to TLSV1.2 (or higher)", "From Azure CLI": "Ensure the output of the below command contains the key value pair \"values\"\"TLSV1.2\" (or higher). \naz mysql flexible-server parameter show --name tls_version --resource-group \n<resourceGroupName> --server-name <serverName> \nExample output:"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL flexible servers \n3. For each database, click on Server parameters under Settings \n4. In the search box, type in tls_version \n5. Click on the VALUE dropdown, and ensure only TLSV1.2 (or higher) is selected \nfor tls_version", "From Azure CLI": "Use the below command to set MYSQL flexible databases to used version 1.2 for the \ntls_version parameter. \n    az mysql flexible-server parameter set --name tls_version --resource-\ngroup <resourceGroupName> --server-name <serverName> --value TLSV1.2"}, "Default_value": "By default, TLS is set to v1.2 for MySQL Flexible servers.", "pdf": "azure"}, {"Rule_number": "4.4.3", "Rule": "4.4.3 Ensure server parameter 'audit_log_enabled' is set to 'ON' for MySQL Database Server (Manual)", "Profile_applicability": " Level 2", "Description": "Enable audit_log_enabled on MySQL Servers.", "Rationale": "Enabling audit_log_enabled helps MySQL Database to log items such as connection attempts to the server, DDL/DML access, and more. Log data can be used to identify, troubleshoot, and repair configuration errors and suboptimal performance.", "Impact": "There are further costs incurred for storage of logs. For high traffic databases these logs will be significant. Determine your organization's needs before enabling.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Select Azure Database for MySQL Servers \n3. For each database, under the Settings section in the sidebar, select Server \nparameters \n4. Ensure the audit_log_enabled parameter is set to ON"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Select Azure Database for MySQL Servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Update audit_log_enabled parameter to ON \n6. Under Monitoring, select Diagnostic settings. \n7. Select + Add diagnostic setting. \n8. Provide a diagnostic setting name. \n9. Under Categories, select MySQL Audit Logs. \n10. \nSpecify destination details. \n11. \nClick Save. \nIt may take up to 10 minutes for the logs to appear in the configured destination."}, "Default_value": "By default, TLS is set to v1.2 for MySQL Flexible servers.", "pdf": "azure"}, {"Rule_number": "4.4.4", "Rule": "4.4.4 Ensure server parameter 'audit_log_events' has 'CONNECTION' set for MySQL Database Server (Manual)", "Profile_applicability": " Level 2", "Description": "Set audit_log_enabled to include CONNECTION on MySQL Servers.", "Rationale": "Enabling CONNECTION helps MySQL Database to log items such as successful and failed connection attempts to the server. Log data can be used to identify, troubleshoot, and repair configuration errors and suboptimal performance.", "Impact": "There are further costs incurred for storage of logs. For high traffic databases these logs will be significant. Determine your organization's needs before enabling.", "Audit": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Azure Database for MySQL servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Ensure audit_log_enabled parameter is set to ON. \n6. Ensure audit_log_events parameter has CONNECTION checked."}, "Remediation": {"From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Azure Database for MySQL servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Update audit_log_enabled parameter to ON. \n6. Update audit_log_events parameter to have at least CONNECTION checked. \n7. Click Save. \n8. Under Monitoring, select Diagnostic settings. \n9. Select + Add diagnostic setting. \n10. \nProvide a diagnostic setting name. \n11. \nUnder Categories, select MySQL Audit Logs. \n12. \nSpecify destination details. \n13. \nClick Save."}, "Default_value": "audit_log_enabled is set to OFF by default References: 1. https://docs.microsoft.com/en-us/azure/mysql/single-server/how-to-configure-audit-logs-portal 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation Additional Information: There is also a CLI version: https://docs.microsoft.com/en-us/azure/mysql/single-server/how-to-configure-audit-logs-cli There are numerous settings and event types and it might be helpful to discuss which of these may be appropriate to have a separate check item for.", "pdf": "azure"}, {"Rule_number": "4.5.1", "Rule": "4.5.1 Ensure That 'Firewalls & Networks' Is Limited to Use Selected Networks Instead of All Networks (Automated)", "Profile_applicability": " Level 2", "Description": "Limiting your Cosmos DB to only communicate on whitelisted networks lowers its attack footprint.", "Rationale": "Selecting certain networks for your Cosmos DB to communicate restricts the number of networks including the internet that can interact with what is stored within the database.", "Impact": "Failure to whitelist the correct networks will result in a connection loss.", "Audit": {"From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade \n3. Select a Cosmos DB to audit. \n4. Select Networking. \n5. Under Public network access, ensure Selected networks is selected. \n6. Under Virtual networks, ensure appropriate virtual networks are configured.", "From Azure CLI": "Retrieve a list of all CosmosDB database namesaz cosmosdb list \nFor each database listed, run the following commandaz cosmosdb show <database id> \nFor each database, ensure that isVirtualNetworkFilterEnabled is set to true", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb - Name: 'Azure Cosmos DB \naccounts should have firewall rules'"}, "Remediation": {"From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select a Cosmos DB account to audit. \n4. Select Networking. \n5. Under Public network access, select Selected networks. \n6. Under Virtual networks, select + Add existing virtual network or + Add a \nnew virtual network. \n7. For existing networks, select subscription, virtual network, subnet and click Add. \nFor new networks, provide a name, update the default values if required, and \nclick Create. \n8. Click Save."}, "Default_value": "By default, Cosmos DBs are set to have access all networks. References: 1. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-endpoints 2. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-vnet-service-endpoint 3. https://docs.microsoft.com/en-us/cli/azure/cosmosdb?view=azure-cli-latest#az-cosmosdb-show 4. https://docs.microsoft.com/en-us/cli/azure/cosmosdb/database?view=azure-cli-latest#az-cosmosdb-database-list 5. https://docs.microsoft.com/en-us/powershell/module/az.cosmosdb/?view=azps-8.1.0 6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-2-secure-cloud-native-services-with-network-controls", "pdf": "azure"}, {"Rule_number": "4.5.2", "Rule": "4.5.2 Ensure That Private Endpoints Are Used Where Possible (Automated)", "Profile_applicability": " Level 2", "Description": "Private endpoints limit network traffic to approved sources.", "Rationale": "For sensitive data, private endpoints allow granular control of which services can communicate with Cosmos DB and ensure that this network traffic is private. You set this up on a case by case basis for each service you wish to be connected.", "Impact": "Only whitelisted services will have access to communicate with the Cosmos DB.", "Audit": {"From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select the Azure Cosmos DB account. \n4. Select Networking. \n5. Ensure Public network access is set to Selected networks. \n6. Ensure the listed networks are set appropriately. \n7. Select Private access. \n8. Ensure a private endpoint exists and Connection state is Approved.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 58440f8a-10c5-4151-bdce-dfbaad4a20b7 - Name: 'CosmosDB \naccounts should use private link'"}, "Remediation": {"From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select the Azure Cosmos DB account. \n4. Select Networking. \n5. Select Private access. \n6. Click + Private Endpoint. \n7. Provide a Name. \n8. Click Next. \n9. From the Resource type drop down, select \nMicrosoft.AzureCosmosDB/databaseAccounts. \n10. \nFrom the Resource drop down, select the Cosmos DB account. \n11. \nClick Next. \n12. \nProvide appropriate Virtual Network details. \n13. \nClick Next. \n14. \nProvide appropriate DNS details. \n15. \nClick Next. \n16. \nOptionally provide Tags. \n17. \nClick Next : Review + create. \n18. \nClick Create."}, "Default_value": "By default Cosmos DB does not have private endpoints enabled and its traffic is public to the network. References: 1. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-endpoints 2. https://docs.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-cosmosdb-portal 3. https://docs.microsoft.com/en-us/cli/azure/cosmosdb/private-endpoint-connection?view=azure-cli-latest 4. https://docs.microsoft.com/en-us/cli/azure/network/private-endpoint?view=azure-cli-latest#az-network-private-endpoint-create 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-2-secure-cloud-native-services-with-network-controls", "pdf": "azure"}, {"Rule_number": "4.5.3", "Rule": "4.5.3 Use Entra ID Client Authentication and Azure RBAC where possible. (Manual)", "Profile_applicability": " Level 1", "Description": "Cosmos DB can use tokens or Entra ID for client authentication which in turn will use Azure RBAC for authorization. Using Entra ID is significantly more secure because Entra ID handles the credentials and allows for MFA and centralized management, and the Azure RBAC better integrated with the rest of Azure.", "Rationale": "Entra ID client authentication is considerably more secure than token-based authentication because the tokens must be persistent at the client. Entra ID does not require this. Audit: From Powershell: $cosmosdbname = \"<your-cosmos-db-account-name>\" $resourcegroup = \"<your-resource-group-name>\" az cosmosdb show --name $cosmosdbname --resource-group $resourcegroup | ConvertFrom-Json In the resulting output, disableLocalAuth should be true Remediation: Map all the resources that currently access to the Azure Cosmos DB account with keys or access tokens. Create an Entra ID identity for each of these resources: \u2022 For Azure resources, you can create a managed identity. You may choose between system-assigned and user-assigned managed identities. \u2022 For non-Azure resources, create an Entra ID identity. Grant each Entra ID identity the minimum permission it requires. When possible, we recommend you use one of the 2 built-in role definitions: Cosmos DB Built-in Data Reader or Cosmos DB Built-in Data Contributor. Validate that the new resource is functioning correctly. After new permissions are granted to identities, it may take a few hours until they propagate. When all resources are working correctly with the new identities, continue to the next step.", "Impact": "Only whitelisted services will have access to communicate with the Cosmos DB.", "Audit": {"From Powershell": "$cosmosdbname = \"<your-cosmos-db-account-name>\" \n$resourcegroup = \"<your-resource-group-name>\" \naz cosmosdb show --name $cosmosdbname --resource-group $resourcegroup | \nConvertFrom-Json \nIn the resulting output, disableLocalAuth should be true"}, "Remediation": {"Create an Entra ID identity for each of these resources:": "\n\u2022 \nFor Azure resources, you can create a managed identity. You may choose \nbetween system-assigned and user-assigned managed identities. \n\u2022For non-Azure resources, create an Entra ID identity. Grant each Entra ID \nidentity the minimum permission it requires. When possible, we recommend you \nuse one of the 2 built-in role definitions: Cosmos DB Built-in Data Reader or \nCosmos DB Built-in Data Contributor. Validate that the new resource is \nfunctioning correctly. After new permissions are granted to identities, it may take \na few hours until they propagate. When all resources are working correctly with \nthe new identities, continue to the next step."}, "Default_value": "By default Cosmos DB does not have private endpoints enabled and its traffic is public to the network. References: 1. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-endpoints 2. https://docs.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-cosmosdb-portal 3. https://docs.microsoft.com/en-us/cli/azure/cosmosdb/private-endpoint-connection?view=azure-cli-latest 4. https://docs.microsoft.com/en-us/cli/azure/network/private-endpoint?view=azure-cli-latest#az-network-private-endpoint-create 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-2-secure-cloud-native-services-with-network-controls", "pdf": "azure"}, {"Rule_number": "5.1.1", "Rule": "5.1.1 Ensure that a 'Diagnostic Setting' exists for Subscription Activity Logs (Manual)", "Profile_applicability": " Level 1", "Description": "Enable Diagnostic settings for exporting activity logs. Diagnostic settings are available for each individual resource within a subscription. Settings should be configured for all appropriate resources for your environment.", "Rationale": "A diagnostic setting controls how a diagnostic log is exported. By default, logs are retained only for 90 days. Diagnostic settings should be defined so that logs can be exported and stored for a longer duration in order to analyze security activities within an Azure subscription. Audit: From Azure Portal To identify Diagnostic Settings on a subscription: 1. Go to Monitor 2. Click Activity Log 3. Click Export Activity Logs 4. Select a Subscription 5. Ensure a Diagnostic settings exists for the selected Subscription To identify Diagnostic Settings on specific resources: 1. Go to Monitor 2. Click Diagnostic settings 3. Ensure that Diagnostics status is enabled on all appropriate resources. From Azure CLI To identify Diagnostic Settings on a subscription: az monitor diagnostic-settings subscription list --subscription <subscription ID> To identify Diagnostic Settings on a resource az monitor diagnostic-settings list --resource <resource Id>  From PowerShell To identify Diagnostic Settings on a Subscription: Get-AzDiagnosticSetting -SubscriptionId <subscription ID> To identify Diagnostic Settings on a specific resource:", "Impact": "Only whitelisted services will have access to communicate with the Cosmos DB.", "Audit": {"From Azure Portal": "To identify Diagnostic Settings on a subscription1. Go to Monitor \n2. Click Activity Log \n3. Click Export Activity Logs \n4. Select a Subscription \n5.", "Ensure a Diagnostic settings exists for the selected Subscription \nTo identify Diagnostic Settings on specific resources:": "1. Go to Monitor \n2. Click Diagnostic settings \n3. Ensure that Diagnostics status is enabled on all appropriate resources.", "From Azure CLI": "To identify Diagnostic Settings on a subscriptionaz monitor diagnostic-settings subscription list --subscription <subscription \nID> \nTo identify Diagnostic Settings on a resource \naz monitor diagnostic-settings list --resource <resource Id>", "From PowerShell \nTo identify Diagnostic Settings on a Subscription:": "Get-AzDiagnosticSetting -SubscriptionId <subscription ID> \nTo identify Diagnostic Settings on a specific resource:"}, "Remediation": {"From Azure Portal": "To enable Diagnostic Settings on a Subscription1. Go to Monitor \n2. Click on Activity Log \n3. Click on Export Activity Logs \n4. Click + Add diagnostic setting \n5. Enter a Diagnostic setting name \n6. Select Categories for the diagnostic settings \n7. Select the appropriate Destination details (this may be Log Analytics, Storage \nAccount, Event Hub, or Partner solution) \n8. Click Save \nTo enable Diagnostic Settings on a specific resource1. Go to Monitor \n2. Click Diagnostic settings \n3. Click on the resource that has a diagnostics status of disabled \n4. Select Add Diagnostic Setting \n5. Enter a Diagnostic setting name \n6. Select the appropriate log, metric, and destination. (this may be Log Analytics, \nStorage Account, Event Hub, or Partner solution) \n7. Click save \nRepeat these step for all resources as needed.", "From Azure CLI": "To configure Diagnostic Settings on a Subscriptionaz monitor diagnostic-settings subscription create --subscription \n<subscription id> --name <diagnostic settings name> --location <location> <[-\n-event-hub <event hub ID> --event-hub-auth-rule <event hub auth rule ID>] [--\nstorage-account <storage account ID>] [--workspace <log analytics workspace \nID>] --logs \"<JSON encoded categories>\" (e.g. \n[{category:Security,enabled:true},{category:Administrative,enabled:true},{cat\negory:Alert,enabled:true},{category:Policy,enabled:true}]) \nTo configure Diagnostic Settings on a specific resource:"}, "Default_value": "The default is to use tokens/keys for client authentication. References: 1. https://learn.microsoft.com/en-us/azure/cosmos-db/role-based-access-control", "pdf": "azure"}, {"Rule_number": "5.1.2", "Rule": "5.1.2 Ensure Diagnostic Setting captures appropriate categories (Automated)", "Profile_applicability": " Level 1", "Description": "Prerequisite: A Diagnostic Setting must exist. If a Diagnostic Setting does not exist, the navigation and options within this recommendation will not be available. Please review the recommendation at the beginning of this subsection titled: \"Ensure that a 'Diagnostic Setting' exists.\" The diagnostic setting should be configured to log the appropriate activities from the control/management plane.", "Rationale": "A diagnostic setting controls how the diagnostic log is exported. Capturing the diagnostic setting categories for appropriate control/management plane activities allows proper alerting. Audit: From Azure Portal 1. Go to Azure Monitor 2. Click Activity log 3. Click on Export Activity Logs 4. Select the appropriate Subscription 5. If there is no Diagnostic Settings listed, generate a finding. 6. Otherwise, click on Edit Settings 7. Ensure that the following categories are checked: Administrative, Alert, Policy, and Security From Azure CLI Ensure the categories 'Administrative', 'Alert', 'Policy', and 'Security' set to: 'enabled: true' az monitor diagnostic-settings subscription list --subscription <subscription ID> From Powershell Ensure the categories Administrative, Alert, Policy, and Security are set to Enabled:True Get-AzSubscriptionDiagnosticSetting -Subscription <subscriptionID>", "Impact": "Only whitelisted services will have access to communicate with the Cosmos DB.", "Audit": {"From Azure Portal": "1. Go to Azure Monitor \n2. Click Activity log \n3. Click on Export Activity Logs \n4. Select the appropriate Subscription \n5. If there is no Diagnostic Settings listed, generate a finding. \n6. Otherwise, click on Edit Settings \n7.", "Ensure that the following categories are checked:": "Administrative, Alert, \nPolicy, and Security", "From Azure CLI": "Ensure the categories 'Administrative', 'Alert', 'Policy', and 'Security' set to'enabled: true' \naz monitor diagnostic-settings subscription list --subscription <subscription \nID>", "From Powershell": "Ensure the categories Administrative, Alert, Policy, and Security are set to Enabled:True \nGet-AzSubscriptionDiagnosticSetting -Subscription <subscriptionID>"}, "Remediation": {"From Azure Portal": "1. Go to Azure Monitor \n2. Click Activity log \n3. Click on Export Activity Logs \n4. Select the Subscription from the drop down menu \n5. Click on Add diagnostic setting \n6. Enter a name for your new Diagnostic Setting \n7. Check the following categories: Administrative, Alert, Policy, and Security \n8. Choose the destination details according to your organization's needs. \nFrom Az CLI \naz monitor diagnostic-settings subscription create --subscription \n<subscription id> --name <diagnostic settings name> --location <location> <[-\n-event-hub <event hub ID> --event-hub-auth-rule <event hub auth rule ID>] [--\nstorage-account <storage account ID>] [--workspace <log analytics workspace \nID>] --logs \n\"[{category:Security,enabled:true},{category:Administrative,enabled:true},{ca\ntegory:Alert,enabled:true},{category:Policy,enabled:true}]\" \nFrom PowerShell"}, "Default_value": "By default, diagnostic setting is not set.", "pdf": "azure"}, {"Rule_number": "5.1.3", "Rule": "5.1.3 Ensure the storage account containing the container with activity logs is encrypted with Customer Managed Key (CMK) (Automated)", "Profile_applicability": " Level 2", "Description": "Storage accounts with the activity log exports can be configured to use Customer Managed Keys (CMK).", "Rationale": "Configuring the storage account with the activity log export container to use CMKs provides additional confidentiality controls on log data, as a given user must have read permission on the corresponding storage account and must be granted decrypt permission by the CMK.", "Impact": "NOTE: You must have your key vault setup to utilize this. All Audit Logs will be encrypted with a key you provide. You will need to set up customer managed keys separately, and you will select which key to use via the instructions here. You will be responsible for the lifecycle of the keys, and will need to manually replace them at your own determined intervals to keep the data secure.", "Audit": {"From Azure Portal": "1. Go to Activity log \n2. Select Export \n3. Select Subscription \n4. In section Storage Account, note the name of the Storage account \n5. Close the Export Audit Logs blade. Close the Monitor - Activity Log blade. \n6. In right column, Click service Storage Accounts to access Storage account blade \n7. Click on the storage account name noted in step 4. This will open blade specific \nto that storage account \n8. Under Security + networking, click Encryption. \n9. Ensure Customer-managed keys is selected and Key URI is set.", "From Azure CLI": "1. Get storage account id configured with log profileaz monitor diagnostic-settings subscription list --subscription <subscription \nid> --query 'value[*].storageAccountId'"}, "Remediation": {"From Azure Portal": "1. Navigate to the Storage accounts blade. \n2. Click on the storage account. \n3. Under Security + networking, click Encryption. \n4. Next to Encryption type, select Customer-managed keys. \n5. Complete the steps to configure a customer-managed key for encryption of the \nstorage account.", "From Azure CLI": "az storage account update --name <name of the storage account> --resource-\ngroup <resource group for a storage account> --encryption-key-\nsource=Microsoft.Keyvault --encryption-key-vault <Key Vault URI> --\nencryption-key-name <KeyName> --encryption-key-version <Key Version>  \nFrom PowerShell \nSet-AzStorageAccount -ResourceGroupName <resource group name> -Name <storage \naccount name> -KeyvaultEncryption -KeyVaultUri <key vault URI> -KeyName <key \nname>"}, "Default_value": "When the diagnostic setting is created using Azure Portal, by default no categories are selected. References: 1. https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-settings 2. https://docs.microsoft.com/en-us/azure/azure-monitor/samples/resource-manager-diagnostic-settings 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 4. https://learn.microsoft.com/en-us/cli/azure/monitor/diagnostic-settings?view=azure-cli-latest 5. https://learn.microsoft.com/en-us/powershell/module/az.monitor/new-azsubscriptiondiagnosticsetting?view=azps-9.2.0", "pdf": "azure"}, {"Rule_number": "5.1.4", "Rule": "5.1.4 Ensure that logging for Azure Key Vault is 'Enabled' (Automated)", "Profile_applicability": " Level 1", "Description": "Enable AuditEvent logging for key vault instances to ensure interactions with key vaults are logged and available.", "Rationale": "Monitoring how and when key vaults are accessed, and by whom, enables an audit trail of interactions with confidential information, keys, and certificates managed by Azure Key Vault. Enabling logging for Key Vault saves information in a user provided destination of either an Azure storage account or Log Analytics workspace. The same destination can be used for collecting logs for multiple Key Vaults. Audit: From Azure Portal 1. Go to Key vaults. 2. For each Key vault. 3. Go to Diagnostic settings. 4. Click Edit setting. 5. Ensure that a destination is configured. 6. Under Category groups, ensure that audit and allLogs are checked. From Azure CLI List all key vaults az keyvault list For each keyvault id az monitor diagnostic-settings list --resource <id> Ensure that storageAccountId reflects your desired destination and that categoryGroup and enabled are set as follows in the sample outputs below.", "Impact": "NOTE: You must have your key vault setup to utilize this. All Audit Logs will be encrypted with a key you provide. You will need to set up customer managed keys separately, and you will select which key to use via the instructions here. You will be responsible for the lifecycle of the keys, and will need to manually replace them at your own determined intervals to keep the data secure.", "Audit": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault. \n3. Go to Diagnostic settings. \n4. Click Edit setting. \n5. Ensure that a destination is configured. \n6. Under Category groups, ensure that audit and allLogs are checked.", "From Azure CLI": "List all key vaults \naz keyvault list \nFor each keyvault id \naz monitor diagnostic-settings list --resource <id> \nEnsure that storageAccountId reflects your desired destination and that categoryGroup \nand enabled are set as follows in the sample outputs below."}, "Remediation": {"From Azure Portal": "1. Go to Key vaults. \n2. Select a Key vault. \n3. Select Diagnostic settings. \n4. Click Edit setting to update an existing diagnostic setting, or Add diagnostic \nsetting to create a new one. \n5. If creating a new diagnostic setting, provide a name. \n6. Configure an appropriate destination. \n7. Under Category groups, check audit and allLogs. \n8. Click Save.", "From Azure CLI": "To update an existing Diagnostic Settings"}, "Default_value": "By default, for a storage account keySource is set to Microsoft.Storage allowing encryption with vendor Managed key and not a Customer Managed Key. References: 1. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-when-required 2. https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-log?tabs=cli#managing-legacy-log-profiles", "pdf": "azure"}, {"Rule_number": "5.1.5", "Rule": "5.1.5 Ensure that Network Security Group Flow logs are captured and sent to Log Analytics (Manual)", "Profile_applicability": " Level 2", "Description": "Ensure that network flow logs are captured and fed into a central log analytics workspace.", "Rationale": "Network Flow Logs provide valuable insight into the flow of traffic around your network and feed into both Azure Monitor and Azure Sentinel (if in use), permitting the generation of visual flow diagrams to aid with analyzing for lateral movement, etc.", "Impact": "The impact of configuring NSG Flow logs is primarily one of cost and configuration. If deployed, it will create storage accounts that hold minimal amounts of data on a 5-day lifecycle before feeding to Log Analytics Workspace. This will increase the amount of data stored and used by Azure Monitor.", "Audit": {"From Azure Portal": "1. Navigate to Network Watcher. \n2. Select NSG flow logs \n3. For each log you wish to audit select it from this view.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 27960feb-a23c-4577-8d36-ef8b5f35e0be - Name: 'All flow log \nresources should be in enabled state' \n\u2022Policy ID: c251913d-7d24-4958-af87-478ed3b9ba41 - Name: 'Flow logs should \nbe configured for every network security group' \n\u2022Policy ID: 4c3c6c5f-0d47-4402-99b8-aa543dd8bcee - Name: 'Flow logs should \nbe configured for every virtual network'"}, "Remediation": {"From Azure Portal": "1. Navigate to Network Watcher. \n2. Select NSG flow logs. \n3. Select + Create. \n4. Select the desired Subscription. \n5. Select + Select NSG. \n6. Select a network security group. \n7. Click Confirm selection. \n8. Select or create a new Storage Account. \n9. Input the retention in days to retain the log. \n10. \nClick Next. \n11. \nUnder Configuration, select Version 2. \n12. \nIf rich analytics are required, select Enable Traffic Analytics, a processing \ninterval, and a Log Analytics Workspace. \n13. \nSelect Next. \n14. \nOptionally add Tags. \n15. \nSelect Review + create. \n16. \nSelect Create. \nWarning \nThe remediation policy creates remediation deployment and names them by \nconcatenating the subscription name and the resource group name. The MAXIMUM \npermitted length of a deployment name is 64 characters. Exceeding this will cause the \nremediation task to fail."}, "Default_value": "By default Network Security Group logs are not sent to Log Analytics. References: 1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-flow-logging-portal 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-4-enable-network-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.1.6", "Rule": "5.1.6 Ensure that logging for Azure AppService 'HTTP logs' is enabled (Manual)", "Profile_applicability": " Level 2", "Description": "Enable AppServiceHTTPLogs diagnostic log category for Azure App Service instances to ensure all http requests are captured and centrally logged.", "Rationale": "Capturing web requests can be important supporting information for security analysts performing monitoring and incident response activities. Once logging, these logs can be ingested into SIEM or other central aggregation point for the organization.", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Portal": "1. Go to App Services \nFor each App Service2. Go to Diagnostic Settings \n3. Ensure that 'HTTP logs' is configured to log to a destination aligned to your \nenvironments approach to log consumption (event hub, storage account, etc. \ndependent on what is consuming the logs such as SIEM or other log aggregation \nutility)."}, "Remediation": {"From Azure Portal": "1. Go to App Services \nFor each App Service2. Go to Diagnostic Settings \n3. Click Add Diagnostic Setting \n4. Check the checkbox next to 'HTTP logs'"}, "Default_value": "By default Network Security Group logs are not sent to Log Analytics. References: 1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-flow-logging-portal 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-4-enable-network-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.1", "Rule": "5.2.1 Ensure that Activity Log Alert exists for Create Policy Assignment (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Create Policy Assignment event.", "Rationale": "Monitoring for create policy assignment events gives insight into changes done in \"Azure policy - assignments\" and can reduce the time it takes to detect unsolicited changes. Audit: From Azure Portal 1. Navigate to the Monitor blade. 2. Click on Alerts. 3. In the Alerts window, click on Alert rules. 4. Ensure an alert rule exists where the Condition column contains Operation name=Microsoft.Authorization/policyAssignments/write. 5. Click on the Alert Name associated with the previous step. 6. Ensure the Condition panel displays the text Whenever the Activity Log has an event with Category='Administrative', Operation name='Create policy assignment' and does not filter on Level, Status or Caller. 7. Ensure the Actions panel displays an Action group is assigned to notify the appropriate personnel in your organization. From Azure CLI az monitor activity-log alert list --subscription <subscription ID> --query \"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" Look for Microsoft.Authorization/policyAssignments/write in the output. If it's missing, generate a finding. From PowerShell Get-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object {$_.ConditionAllOf.Equal -match \"Microsoft.Authorization/policyAssignments/write\"}|select-object Location,Name,Enabled,ResourceGroupName,ConditionAllOf If the output is empty, an alert rule for Create Policy Assignments is not configured.", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/write in the output. If it's \nmissing, generate a finding. \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nIf the output is empty, an alert rule for Create Policy Assignments is not configured."}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create policy assignment (Policy assignment). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Authorization/policyAssignments/write and \nlevel=<verbose | information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription ID> --action-group <action group ID>"}, "Default_value": "Not configured. References: 1. https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.2", "Rule": "5.2.2 Ensure that Activity Log Alert exists for Delete Policy Assignment (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Delete Policy Assignment event.", "Rationale": "Monitoring for delete policy assignment events gives insight into changes done in \"azure policy - assignments\" and can reduce the time it takes to detect unsolicited changes. Audit: From Azure Portal 1. Navigate to the Monitor blade. 2. Click on Alerts. 3. In the Alerts window, click on Alert rules. 4. Ensure an alert rule exists where the Condition column contains Operation name=Microsoft.Authorization/policyAssignments/delete. 5. Click on the Alert Name associated with the previous step. 6. Ensure the Condition panel displays the text Whenever the Activity Log has an event with Category='Administrative', Operation name='Delete policy assignment' and does not filter on Level, Status or Caller. 7. Ensure the Actions panel displays an Action group is assigned to notify the appropriate personnel in your organization. From Azure CLI az monitor activity-log alert list --subscription <subscription ID> --query \"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" Look for Microsoft.Authorization/policyAssignments/delete in the output From PowerShell Get-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object {$_.ConditionAllOf.Equal -match \"Microsoft.Authorization/policyAssignments/delete\"}|select-object Location,Name,Enabled,ResourceGroupName,ConditionAllOf From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete policy assignment (Policy assignment). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Authorization/policyAssignments/delete and \nlevel=<verbose | information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the conditions object \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Authorization/policyAssignments/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Action \nobject."}, "Default_value": "By default, no monitoring alerts are created. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 6. https://docs.microsoft.com/en-in/rest/api/policy/policy-assignments 7. https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-log", "pdf": "azure"}, {"Rule_number": "5.2.3", "Rule": "5.2.3 Ensure that Activity Log Alert exists for Create or Update Network Security Group (Automated)", "Profile_applicability": " Level 1", "Description": "Create an Activity Log Alert for the Create or Update Network Security Group event.", "Rationale": "Monitoring for Create or Update Network Security Group events gives insight into network access changes and may reduce the time it takes to detect suspicious activity. Audit: From Azure Portal 1. Navigate to the Monitor blade. 2. Click on Alerts. 3. In the Alerts window, click on Alert rules. 4. Ensure an alert rule exists where the Condition column contains Operation name=Microsoft.Network/networkSecurityGroups/write. 5. Click on the Alert Name associated with the previous step. 6. Ensure the Condition panel displays the text Whenever the Activity Log has an event with Category='Administrative', Operation name='Create or Update Network Security Group' and does not filter on Level, Status or Caller. 7. Ensure the Actions panel displays an Action group is assigned to notify the appropriate personnel in your organization. From Azure CLI az monitor activity-log alert list --subscription <subscription ID> --query \"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" Look for Microsoft.Network/networkSecurityGroups/write in the output From PowerShell Get-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object {$_.ConditionAllOf.Equal -match \"Microsoft.Network/networkSecurityGroups/write\"}|select-object Location,Name,Enabled,ResourceGroupName,ConditionAllOf From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Network Security Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create or Update Network Security Group (Network Security Group). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/networkSecurityGroups/write and level=verbose \n--scope \"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" \n--subscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Network/networkSecurityGroups/write -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject."}, "Default_value": "By default, no monitoring alerts are created. References: 1. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 2. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation 5. https://azure.microsoft.com/en-us/services/blueprints/ Additional Information: This log alert also applies for Azure Blueprints.", "pdf": "azure"}, {"Rule_number": "5.2.4", "Rule": "5.2.4 Ensure that Activity Log Alert exists for Delete Network Security Group (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Delete Network Security Group event.", "Rationale": "Monitoring for \"Delete Network Security Group\" events gives insight into network access changes and may reduce the time it takes to detect suspicious activity. Audit: From Azure Portal 1. Navigate to the Monitor blade. 2. Click on Alerts. 3. In the Alerts window, click on Alert rules. 4. Ensure an alert rule exists where the Condition column contains Operation name=Microsoft.Network/networkSecurityGroups/delete. 5. Click on the Alert Name associated with the previous step. 6. Ensure the Condition panel displays the text Whenever the Activity Log has an event with Category='Administrative', Operation name='Delete Network Security Group' and does not filter on Level, Status or Caller. 7. Ensure the Actions panel displays an Action group is assigned to notify the appropriate personnel in your organization. From Azure CLI az monitor activity-log alert list --subscription <subscription ID> --query \"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" Look for Microsoft.Network/networkSecurityGroups/delete in the output From PowerShell Get-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object {$_.ConditionAllOf.Equal -match \"Microsoft.Network/networkSecurityGroups/delete\"}|select-object Location,Name,Enabled,ResourceGroupName,ConditionAllOf From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Network \nSecurity Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete Network Security Group (Network Security Group). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/networkSecurityGroups/delete and \nlevel=<verbose | information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Network/networkSecurityGroups/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject."}, "Default_value": "By default, no monitoring alerts are created. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.5", "Rule": "5.2.5 Ensure that Activity Log Alert exists for Create or Update Security Solution (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Create or Update Security Solution event.", "Rationale": "Monitoring for Create or Update Security Solution events gives insight into changes to the active security solutions and may reduce the time it takes to detect suspicious activity. Audit: From Azure Portal 1. Navigate to the Monitor blade. 2. Click on Alerts. 3. In the Alerts window, click on Alert rules. 4. Ensure an alert rule exists where the Condition column contains Operation name=Microsoft.Security/securitySolutions/write. 5. Click on the Alert Name associated with the previous step. 6. Ensure the Condition panel displays the text Whenever the Activity Log has an event with Category='Administrative', Operation name='Create or Update Security Solutions' and does not filter on Level, Status or Caller. 7. Ensure the Actions panel displays an Action group is assigned to notify the appropriate personnel in your organization. From Azure CLI az monitor activity-log alert list --subscription <subscription Id> --query \"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" Look for Microsoft.Security/securitySolutions/write in the output From PowerShell Get-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object {$_.ConditionAllOf.Equal -match \"Microsoft.Security/securitySolutions/write\"}|select-object Location,Name,Enabled,ResourceGroupName,ConditionAllOf From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Security Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create or Update Security Solutions (Security Solutions). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Security/securitySolutions/write and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Security/securitySolutions/write -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject."}, "Default_value": "By default, no monitoring alerts are created. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.6", "Rule": "5.2.6 Ensure that Activity Log Alert exists for Delete Security Solution (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Delete Security Solution event.", "Rationale": "Monitoring for Delete Security Solution events gives insight into changes to the active security solutions and may reduce the time it takes to detect suspicious activity. Audit: From Azure Console 1. Navigate to the Monitor blade. 2. Click on Alerts. 3. In the Alerts window, click on Alert rules. 4. Ensure an alert rule exists where the Condition column contains Operation name=Microsoft.Security/securitySolutions/delete. 5. Click on the Alert Name associated with the previous step. 6. Ensure the Condition panel displays the text Whenever the Activity Log has an event with Category='Administrative', Operation name='Delete Security Solutions' and does not filter on Level, Status or Caller. 7. Ensure the Actions panel displays an Action group is assigned to notify the appropriate personnel in your organization. From Azure CLI az monitor activity-log alert list --subscription <subscription Id> --query \"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" Look for Microsoft.Security/securitySolutions/delete in the output From PowerShell Get-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object {$_.ConditionAllOf.Equal -match \"Microsoft.Security/securitySolutions/delete\"}|select-object Location,Name,Enabled,ResourceGroupName,ConditionAllOf From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "Log consumption and processing will incur additional cost.", "Audit": {"From Azure Console": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete \nSecurity Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Console": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete Security Solutions (Security Solutions). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Security/securitySolutions/delete and level=<verbose \n| information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Security/securitySolutions/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject."}, "Default_value": "By default, no monitoring alerts are created. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.7", "Rule": "5.2.7 Ensure that Activity Log Alert exists for Create or Update SQL Server Firewall Rule (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Create or Update SQL Server Firewall Rule event.", "Rationale": "Monitoring for Create or Update SQL Server Firewall Rule events gives insight into network access changes and may reduce the time it takes to detect suspicious activity.", "Impact": "There will be a substantial increase in log size if there are a large number of administrative actions on a server.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create/Update \nserver firewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create/Update server firewall rule (Server Firewall Rule). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Sql/servers/firewallRules/write and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>"}, "Default_value": "By default, no monitoring alerts are created. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.8", "Rule": "5.2.8 Ensure that Activity Log Alert exists for Delete SQL Server Firewall Rule (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the \"Delete SQL Server Firewall Rule.\"", "Rationale": "Monitoring for Delete SQL Server Firewall Rule events gives insight into SQL network access changes and may reduce the time it takes to detect suspicious activity.", "Impact": "There will be a substantial increase in log size if there are a large number of administrative actions on a server.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete server \nfirewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete server firewall rule (Server Firewall Rule). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Sql/servers/firewallRules/delete and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>"}, "Default_value": "By default, no monitoring alerts are created or active. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.9", "Rule": "5.2.9 Ensure that Activity Log Alert exists for Create or Update Public IP Address rule (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Create or Update Public IP Addresses rule.", "Rationale": "Monitoring for Create or Update Public IP Address events gives insight into network access changes and may reduce the time it takes to detect suspicious activity.", "Impact": "There will be a substantial increase in log size if there are a large number of administrative actions on a server.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Public Ip Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create or Update Public Ip Address (Public Ip Address). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/publicIPAddresses/write and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>"}, "Default_value": "By default, no monitoring alerts are created or active. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.2.10", "Rule": "5.2.10 Ensure that Activity Log Alert exists for Delete Public IP Address rule (Automated)", "Profile_applicability": " Level 1", "Description": "Create an activity log alert for the Delete Public IP Address rule.", "Rationale": "Monitoring for Delete Public IP Address events gives insight into network access changes and may reduce the time it takes to detect suspicious activity.", "Impact": "There will be a substantial increase in log size if there are a large number of administrative actions on a server.", "Audit": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Public \nIp Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.", "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"}, "Remediation": {"From Azure Portal": "1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete Public Ip Address (Public Ip Address). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create.", "From Azure CLI": "az monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/publicIPAddresses/delete and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>"}, "Default_value": "By default, no monitoring alerts are created or active. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.3.1", "Rule": "5.3.1 Ensure Application Insights are Configured (Automated)", "Profile_applicability": " Level 2", "Description": "Application Insights within Azure act as an Application Performance Monitoring solution providing valuable data into how well an application performs and additional information when performing incident response. The types of log data collected include application metrics, telemetry data, and application trace logging data providing organizations with detailed information about application activity and application transactions. Both data sets help organizations adopt a proactive and retroactive means to handle security and performance related metrics within their modern applications.", "Rationale": "Configuring Application Insights provides additional data not found elsewhere within Azure as part of a much larger logging and monitoring program within an organization's Information Security practice. The types and contents of these logs will act as both a potential cost saving measure (application performance) and a means to potentially confirm the source of a potential incident (trace logging). Metrics and Telemetry data provide organizations with a proactive approach to cost savings by monitoring an application's performance, while the trace logging data provides necessary details in a reactive incident response scenario by helping organizations identify the potential source of an incident within their application.", "Impact": "Because Application Insights relies on a Log Analytics Workspace, an organization will incur additional expenses when using this service.", "Audit": {"From Azure Portal": "1. Navigate to Application Insights \n2. Ensure an Application Insights service is configured and exists.", "From Azure CLI": "Note: The application-insights extension to Azure CLI is currently in Preview \nAdd the application-insights extension."}, "Remediation": {"From Azure Portal": "1. Navigate to Application Insights \n2. Under the Basics tab within the PROJECT DETAILS section, select the \nSubscription \n3. Select the Resource group \n4. Within the INSTANCE DETAILS, enter a Name \n5. Select a Region \n6. Next to Resource Mode, select Workspace-based \n7. Within the WORKSPACE DETAILS, select the Subscription for the log analytics \nworkspace \n8. Select the appropriate Log Analytics Workspace \n9. Click Next:Tags > 10. \nEnter the appropriate Tags as Name, Value pairs. \n11. \nClick Next:Review+Create \n12. \nClick Create", "From Azure CLI": "az monitor app-insights component create --app <app name> --resource-group \n<resource group name> --location <location> --kind \"web\" --retention-time \n<INT days to retain logs> --workspace <log analytics workspace ID> --\nsubscription <subscription ID> \nFrom PowerShell"}, "Default_value": "By default, no monitoring alerts are created or active. References: 1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement 2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log 3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate 4. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/listbysubscriptionid 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-3-enable-logging-for-security-investigation", "pdf": "azure"}, {"Rule_number": "5.4", "Rule": "5.4 Ensure that Azure Monitor Resource Logging is Enabled for All Services that Support it (Manual)", "Profile_applicability": " Level 1", "Description": "Resource Logs capture activity to the data access plane while the Activity log is a subscription-level log for the control plane. Resource-level diagnostic logs provide insight into operations that were performed within that resource itself; for example, reading or updating a secret from a Key Vault. Currently, 95 Azure resources support Azure Monitoring (See the more information section for a complete list), including Network Security Groups, Load Balancers, Key Vault, AD, Logic Apps, and CosmosDB. The content of these logs varies by resource type. A number of back-end services were not configured to log and store Resource Logs for certain activities or for a sufficient length. It is crucial that monitoring is correctly configured to log all relevant activities and retain those logs for a sufficient length of time. Given that the mean time to detection in an enterprise is 240 days, a minimum retention period of two years is recommended.", "Rationale": "A lack of monitoring reduces the visibility into the data plane, and therefore an organization's ability to detect reconnaissance, authorization attempts or other malicious activity. Unlike Activity Logs, Resource Logs are not enabled by default. Specifically, without monitoring it would be impossible to tell which entities had accessed a data store that was breached. In addition, alerts for failed attempts to access APIs for Web Services or Databases are only possible when logging is enabled.", "Impact": "Costs for monitoring varies with Log Volume. Not every resource needs to have logging enabled. It is important to determine the security classification of the data being processed by the given resource and adjust the logging based on which events need to be tracked. This is typically determined by governance and compliance requirements.", "Audit": {"From Azure Portal": "The specific steps for configuring resources within the Azure \nconsole vary depending on resource, but typically the steps are1. Go to the resource \n2. Click on Diagnostic settings \n3. In the blade that appears, click \"Add diagnostic setting\""}, "Remediation": {"From Azure Portal": "The specific steps for configuring resources within the Azure console vary depending on \nresource, but typically the steps are1. Go to the resource \n2. Click on Diagnostic settings \n3. In the blade that appears, click \"Add diagnostic setting\" \n4. Configure the diagnostic settings \n5. Click on Save", "From Azure CLI": "For each resource, run the following making sure to use a resource appropriate JSON \nencoded category for the --logs option. \naz monitor diagnostic-settings create --name <diagnostic settings name> --\nresource <resource ID> --logs \"[{category:<resource specific \ncategory>,enabled:true,rentention-policy:{enabled:true,days:180}}]\" --metrics \n\"[{category:AllMetrics,enabled:true,retention-\npolicy:{enabled:true,days:180}}]\" <[--event-hub <event hub ID> --event-hub-\nrule <event hub auth rule ID> | --storage-account <storage account ID> |--\nworkspace <log analytics workspace ID> | --marketplace-partner-id <full \nresource ID of third-party solution>]> \nFrom PowerShell \nCreate the log settings object \n$logSettings = @() \n$logSettings += New-AzDiagnosticSettingLogSettingsObject -Enabled $true -\nRetentionPolicyDay 180 -RetentionPolicyEnabled $true -Category <resource \nspecific category> \n$logSettings += New-AzDiagnosticSettingLogSettingsObject -Enabled $true -\nRetentionPolicyDay 180 -RetentionPolicyEnabled $true -Category <resource \nspecific category number 2> \nCreate the metric settings object"}, "Default_value": "Application Insights are not enabled by default. References: 1. https://learn.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview", "pdf": "azure"}, {"Rule_number": "5.5", "Rule": "5.5 Ensure that SKU Basic/Consumption is not used on artifacts that need to be monitored (Particularly for Production Workloads) (Manual)", "Profile_applicability": " Level 2", "Description": "The use of Basic or Free SKUs in Azure whilst cost effective have significant limitations in terms of what can be monitored and what support can be realized from Microsoft. Typically, these SKU\u2019s do not have a service SLA and Microsoft may refuse to provide support for them. Consequently Basic/Free SKUs should never be used for production workloads.", "Rationale": "Typically, production workloads need to be monitored and should have an SLA with Microsoft, using Basic SKUs for any deployed product will mean that that these capabilities do not exist. The following resource types should use standard SKUs as a minimum. \u2022 Public IP Addresses \u2022 Network Load Balancers \u2022 REDIS Cache \u2022 SQL PaaS Databases \u2022 VPN Gateways", "Impact": "The impact of enforcing Standard SKU's is twofold 1. There will be a cost increase 2. The monitoring and service level agreements will be available and will support the production service. All resources should be either tagged or in separate Management Groups/Subscriptions", "Audit": {"General Audit Instructions": "This needs to be audited by Azure Policy (one for each resource type) and denied for \neach artifact that is production."}, "Remediation": {"General Remediation Instructions": "Each artifact has its own process for upgrading from basic to standard SKU's and this \nshould be followed if required."}, "Default_value": "Policy should enforce standard SKUs for the following artifacts: \u2022 Public IP Addresses \u2022 Network Load Balancers \u2022 REDIS Cache \u2022 SQL PaaS Databases \u2022 VPN Gateways References: 1. https://azure.microsoft.com/en-us/support/plans 2. https://azure.microsoft.com/en-us/support/plans/response/", "pdf": "azure"}, {"Rule_number": "6.1", "Rule": "6.1 Ensure that RDP access from the Internet is evaluated and restricted (Automated)", "Profile_applicability": " Level 1", "Description": "Network security groups should be periodically evaluated for port misconfigurations. Where certain ports and protocols may be exposed to the Internet, they should be evaluated for necessity and restricted wherever they are not explicitly required.", "Rationale": "The potential security problem with using RDP over the Internet is that attackers can use various brute force techniques to gain access to Azure Virtual Machines. Once the attackers gain access, they can use a virtual machine as a launch point for compromising other machines on an Azure Virtual Network or even attack networked devices outside of Azure. Audit: From Azure Portal 1. For each VM, open the Networking blade 2. Verify that the INBOUND PORT RULES does not have a rule for RDP such as o port = 3389, o protocol = TCP OR ANY, o Source = Any OR Internet From Azure CLI List Network security groups with corresponding non-default Security rules: az network nsg list --query [*].[name,securityRules] Ensure that none of the NSGs have security rule as below \"access\" : \"Allow\" \"destinationPortRange\" : \"3389\" or \"*\" or \"[port range containing 3389]\" \"direction\" : \"Inbound\" \"protocol\" : \"TCP\" or \"*\" \"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \"any\"", "Impact": "The impact of enforcing Standard SKU's is twofold 1. There will be a cost increase 2. The monitoring and service level agreements will be available and will support the production service. All resources should be either tagged or in separate Management Groups/Subscriptions", "Audit": {"From Azure Portal": "1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for RDP such as \no port = 3389, \no protocol = TCP OR ANY, \no Source = Any OR Internet", "From Azure CLI": "List Network security groups with corresponding non-default Security rulesaz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"3389\" or \"*\" or \"[port range containing 3389]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""}, "Remediation": {"General Remediation Instructions": "Where RDP is not explicitly required and narrowly configured for resources attached to \nthe Network Security Group, Internet-level access to your Azure resources should be \nrestricted or eliminated. \nFor internal access to relevant resources, configure an encrypted network tunnel such \nasExpressRoute \nSite-to-site VPN \nPoint-to-site VPN"}, "Default_value": "By default, RDP access from internet is not enabled. References: 1. https://docs.microsoft.com/en-us/azure/security/azure-security-network-security-best-practices#disable-rdpssh-access-to-azure-virtual-machines 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-1-establish-network-segmentation-boundaries 3. Express Route: https://docs.microsoft.com/en-us/azure/expressroute/ 4. Site-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal 5. Point-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal", "pdf": "azure"}, {"Rule_number": "6.2", "Rule": "6.2 Ensure that SSH access from the Internet is evaluated and restricted (Automated)", "Profile_applicability": " Level 1", "Description": "Network security groups should be periodically evaluated for port misconfigurations. Where certain ports and protocols may be exposed to the Internet, they should be evaluated for necessity and restricted wherever they are not explicitly required.", "Rationale": "The potential security problem with using SSH over the Internet is that attackers can use various brute force techniques to gain access to Azure Virtual Machines. Once the attackers gain access, they can use a virtual machine as a launch point for compromising other machines on the Azure Virtual Network or even attack networked devices outside of Azure. Audit: From Azure Portal 1. Open the Networking blade for the specific Virtual machine in Azure portal 2. Verify that the INBOUND PORT RULES does not have a rule for SSH such as o port = 22, o protocol = TCP OR ANY, o Source = Any OR Internet From Azure CLI List Network security groups with corresponding non-default Security rules: az network nsg list --query [*].[name,securityRules] Ensure that none of the NSGs have security rule as below \"access\" : \"Allow\" \"destinationPortRange\" : \"22\" or \"*\" or \"[port range containing 22]\" \"direction\" : \"Inbound\" \"protocol\" : \"TCP\" or \"*\" \"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \"any\" From Azure Policy If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the associated Policy definition in Azure. If referencing a printed copy, you can search Policy IDs from this URL: https://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions", "Impact": "The impact of enforcing Standard SKU's is twofold 1. There will be a cost increase 2. The monitoring and service level agreements will be available and will support the production service. All resources should be either tagged or in separate Management Groups/Subscriptions", "Audit": {"From Azure Portal": "1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for SSH such as \no port = 22, \no protocol = TCP OR ANY, \no Source = Any OR Internet", "From Azure CLI": "List Network security groups with corresponding non-default Security rulesaz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"22\" or \"*\" or \"[port range containing 22]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\"", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"General Remediation Instructions": "Where SSH is not explicitly required and narrowly configured for resources attached to \nthe Network Security Group, Internet-level access to your Azure resources should be \nrestricted or eliminated. \nFor internal access to relevant resources, configure an encrypted network tunnel such \nasExpressRoute \nSite-to-site VPN \nPoint-to-site VPN"}, "Default_value": "By default, SSH access from internet is not enabled. References: 1. https://docs.microsoft.com/en-us/azure/security/azure-security-network-security-best-practices#disable-rdpssh-access-to-azure-virtual-machines 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-1-establish-network-segmentation-boundaries 3. Express Route: https://docs.microsoft.com/en-us/azure/expressroute/ 4. Site-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal 5. Point-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal", "pdf": "azure"}, {"Rule_number": "6.3", "Rule": "6.3 Ensure that UDP access from the Internet is evaluated and restricted (Automated)", "Profile_applicability": " Level 1", "Description": "Network security groups should be periodically evaluated for port misconfigurations. Where certain ports and protocols may be exposed to the Internet, they should be evaluated for necessity and restricted wherever they are not explicitly required.", "Rationale": "The potential security problem with broadly exposing UDP services over the Internet is that attackers can use DDoS amplification techniques to reflect spoofed UDP traffic from Azure Virtual Machines. The most common types of these attacks use exposed DNS, NTP, SSDP, SNMP, CLDAP and other UDP-based services as amplification sources for disrupting services of other machines on the Azure Virtual Network or even attack networked devices outside of Azure. Audit: From Azure Portal 1. Open the Networking blade for the specific Virtual machine in Azure portal 2. Verify that the INBOUND PORT RULES does not have a rule for UDP such as \u2022 protocol = UDP, \u2022 Source = Any OR Internet From Azure CLI List Network security groups with corresponding non-default Security rules: az network nsg list --query [*].[name,securityRules] Ensure that none of the NSGs have security rule as below \"access\" : \"Allow\" \"destinationPortRange\" : \"*\" or \"[port range containing 53, 123, 161, 389, 1900, or other vulnerable UDP-based services]\" \"direction\" : \"Inbound\" \"protocol\" : \"UDP\" \"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \"any\"", "Impact": "The impact of enforcing Standard SKU's is twofold 1. There will be a cost increase 2. The monitoring and service level agreements will be available and will support the production service. All resources should be either tagged or in separate Management Groups/Subscriptions", "Audit": {"From Azure Portal": "1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for UDP such as \n\u2022protocol = UDP, \n\u2022Source = Any OR Internet", "From Azure CLI": "List Network security groups with corresponding non-default Security rulesaz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"*\" or \"[port range containing 53, 123, 161, 389, \n1900, or other vulnerable UDP-based services]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"UDP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""}, "Remediation": {"General Remediation Instructions": "Where UDP is not explicitly required and narrowly configured for resources attached to \nthe Network Security Group, Internet-level access to your Azure resources should be \nrestricted or eliminated. \nFor internal access to relevant resources, configure an encrypted network tunnel such \nasExpressRoute \nSite-to-site VPN \nPoint-to-site VPN"}, "Default_value": "By default, UDP access from internet is not enabled. References: 1. https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices#secure-your-critical-azure-service-resources-to-only-your-virtual-networks 2. https://docs.microsoft.com/en-us/azure/security/fundamentals/ddos-best-practices 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-1-establish-network-segmentation-boundaries 4. ExpressRoute: https://docs.microsoft.com/en-us/azure/expressroute/ 5. Site-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal 6. Point-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal", "pdf": "azure"}, {"Rule_number": "6.4", "Rule": "6.4 Ensure that HTTP(S) access from the Internet is evaluated and restricted (Automated)", "Profile_applicability": " Level 1", "Description": "Network security groups should be periodically evaluated for port misconfigurations. Where certain ports and protocols may be exposed to the Internet, they should be evaluated for necessity and restricted wherever they are not explicitly required and narrowly configured.", "Rationale": "The potential security problem with using HTTP(S) over the Internet is that attackers can use various brute force techniques to gain access to Azure resources. Once the attackers gain access, they can use the resource as a launch point for compromising other resources within the Azure tenant. Audit: From Azure Portal 1. For each VM, open the Networking blade 2. Verify that the INBOUND PORT RULES does not have a rule for HTTP(S) such as o port = 80/ 443, o protocol = TCP, o Source = Any OR Internet From Azure CLI List Network security groups with corresponding non-default Security rules: az network nsg list --query [*].[name,securityRules] Ensure that none of the NSGs have security rule as below \"access\" : \"Allow\" \"destinationPortRange\" : \"80/443\" or \"*\" or \"[port range containing 80/443]\" \"direction\" : \"Inbound\" \"protocol\" : \"TCP\" \"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \"any\"", "Impact": "The impact of enforcing Standard SKU's is twofold 1. There will be a cost increase 2. The monitoring and service level agreements will be available and will support the production service. All resources should be either tagged or in separate Management Groups/Subscriptions", "Audit": {"From Azure Portal": "1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for HTTP(S) such \nas \no port = 80/ 443, \no protocol = TCP, \no Source = Any OR Internet", "From Azure CLI": "List Network security groups with corresponding non-default Security rulesaz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"80/443\" or \"*\" or \"[port range containing 80/443]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""}, "Remediation": {"From Azure Portal": "1. Go to Virtual machines. \n2. For each VM, open the Networking blade. \n3. Click on Inbound port rules. \n4. Delete the rule witho Port = 80/443 OR [port range containing 80/443] \no Protocol = TCP OR Any \no Source = Any (*) OR IP Addresses(0.0.0.0/0) OR Service Tag(Internet) \no Action = Allow", "From Azure CLI": "Run below command to list network security groupsaz network nsg list --subscription <subscription-id> --output table 1.For each network security group, run below command to list the rules associated \nwith the specified portaz network nsg rule list --resource-group <resource-group> --nsg-name \n<nsg-name> --query \"[?destinationPortRange=='80 or 443']\" \n2. Run the below command to delete the rule witho Port = 80/443 OR [port range containing 80/443] \no Protocol = TCP OR \"*\" \no Source = Any (*) OR IP Addresses(0.0.0.0/0) OR Service Tag(Internet) \no Action = Allow \naz network nsg rule delete --resource-group <resource-group> --nsg-name \n<nsg-name> --name <rule-name> \nReferences1. Express Route: https://docs.microsoft.com/en-us/azure/expressroute/ \n2. Site-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-site-to-site-resource-manager-portal \n3. Point-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-point-to-site-resource-manager-portal \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries"}, "Default_value": "By default, UDP access from internet is not enabled. References: 1. https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-practices#secure-your-critical-azure-service-resources-to-only-your-virtual-networks 2. https://docs.microsoft.com/en-us/azure/security/fundamentals/ddos-best-practices 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-1-establish-network-segmentation-boundaries 4. ExpressRoute: https://docs.microsoft.com/en-us/azure/expressroute/ 5. Site-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal 6. Point-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-howto-point-to-site-resource-manager-portal", "pdf": "azure"}, {"Rule_number": "6.5", "Rule": "6.5 Ensure that Network Security Group Flow Log retention period is 'greater than 90 days' (Automated)", "Profile_applicability": " Level 2", "Description": "Network Security Group Flow Logs should be enabled and the retention period set to greater than or equal to 90 days.", "Rationale": "Flow logs enable capturing information about IP traffic flowing in and out of network security groups. Logs can be used to check for anomalies and give insight into suspected breaches.", "Impact": "This will keep IP traffic logs for longer than 90 days. As a level 2, first determine your need to retain data, then apply your selection here. As this is data stored for longer, your monthly storage costs will increase depending on your data use.", "Audit": {"From Azure Portal": "1. Go to Network Watcher \n2. Select NSG flow logs blade in the Logs section \n3. Select each Network Security Group from the list \n4. Ensure Status is set to On \n5. Ensure Retention (days) setting greater than 90 days", "From Azure CLI": "az network watcher flow-log show --resource-group <resourceGroup> --nsg \n<NameorID of the NetworkSecurityGroup> --query 'retentionPolicy' \nEnsure that enabled is set to true and days is set to greater then or equal to 90.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022Policy ID: 5e1cd26a-5090-4fdb-9d6a-84a90335e22d - Name: 'Configure \nnetwork security groups to use specific workspace, storage account and flowlog \nretention policy for traffic analytics'"}, "Remediation": {"From Azure Portal": "1. Go to Network Watcher \n2. Select NSG flow logs blade in the Logs section \n3. Select each Network Security Group from the list \n4. Ensure Status is set to On \n5. Ensure Retention (days) setting greater than 90 days \n6. Select your storage account in the Storage account field \n7. Select Save", "From Azure CLI": "Enable the NSG flow logs and set the Retention (days) to greater than or equal to 90 \ndays. \naz network watcher flow-log configure --nsg <NameorID of the Network Security \nGroup> --enabled true --resource-group <resourceGroupName> --retention 91 --\nstorage-account <NameorID of the storage account to save flow logs>"}, "Default_value": "By default, Network Security Group Flow Logs are disabled. References: 1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-flow-logging-overview 2. https://docs.microsoft.com/en-us/cli/azure/network/watcher/flow-log?view=azure-cli-latest 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-6-configure-log-storage-retention", "pdf": "azure"}, {"Rule_number": "6.6", "Rule": "6.6 Ensure that Network Watcher is 'Enabled' (Automated)", "Profile_applicability": " Level 2", "Description": "Enable Network Watcher for physical regions in Azure subscriptions.", "Rationale": "Network diagnostic and visualization tools available with Network Watcher help users understand, diagnose, and gain insights to the network in Azure.", "Impact": "There are additional costs per transaction to run and store network data. For high-volume networks these charges will add up quickly.", "Audit": {"From Azure Portal": "1. Go to Network Watcher \n2. Ensure that a network watcher is listed for each region.", "From Azure CLI": "az network watcher list --query \n\"[].{Location:location,State:provisioningState}\" -o table \nThis will list all network watchers and their provisioning state. \nEnsure provisioningState is Succeeded for each network watcher. \naz account list-locations --query \n\"[?metadata.regionType=='Physical'].{Name:name,DisplayName:regionalDisplayNam\ne}\" -o table \nThis will list all physical regions that exist in the subscription. \nCompare this list to the previous one to ensure that for each region, a network watcher \nexists with provisioningState set to Succeeded. \nFrom PowerShell \nGet a list of Network Watchers \nGet-AzNetworkWatcher \nMake sure each watcher is set with the ProvisioningState setting set to Succeeded and \nall Locations are set with a watcher."}, "Remediation": {"From Azure Portal": "1. Go to Network Watcher. \n2. Click Create. \n3. Select a Region from the drop-down menu. \n4. Click Add.", "From Azure CLI": "az network watcher configure --locations <region> --enabled true --resource-\ngroup <resource_group>"}, "Default_value": "Network Watcher is automatically enabled. When you create or update a virtual network in your subscription, Network Watcher will be enabled automatically in your Virtual Network's region. There is no impact to your resources or associated charge for automatically enabling Network Watcher. References: 1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-monitoring-overview 2. https://docs.azure.cn/zh-cn/cli/network/watcher?view=azure-cli-latest#az_network_watcher_list 3. https://docs.azure.cn/zh-cn/cli/network/watcher?view=azure-cli-latest#az_network_watcher_configure 4. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-create 5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-detection#lt-4-enable-network-logging-for-security-investigation 6. https://azure.microsoft.com/en-ca/pricing/details/network-watcher/", "pdf": "azure"}, {"Rule_number": "6.7", "Rule": "6.7 Ensure that Public IP addresses are Evaluated on a Periodic Basis (Manual)", "Profile_applicability": " Level 1", "Description": "Public IP Addresses provide tenant accounts with Internet connectivity for resources contained within the tenant. During the creation of certain resources in Azure, a Public IP Address may be created. All Public IP Addresses within the tenant should be periodically reviewed for accuracy and necessity.", "Rationale": "Public IP Addresses allocated to the tenant should be periodically reviewed for necessity. Public IP Addresses that are not intentionally assigned and controlled present a publicly facing vector for threat actors and significant risk to the tenant. Audit: From Azure Portal 1. Open the All Resources blade 2. Click on Add Filter 3. In the Add Filter window, select the following: Filter: Type Operator: Equals Value: Public IP address 4. Click the Apply button 5. For each Public IP address in the list, use Overview (or Properties) to review the \"Associated to:\" field and determine if the associated resource is still relevant to your tenant environment. If the associated resource is relevant, ensure that additional controls exist to mitigate risk (e.g. Firewalls, VPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.) on all subsequently attached resources. From Azure CLI List all Public IP addresses: az network public-ip list For each Public IP address in the output, review the \"name\" property and determine if the associated resource is still relevant to your tenant environment. If the associated resource is relevant, ensure that additional controls exist to mitigate risk (e.g. Firewalls, VPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.) on all subsequently attached resources.", "Impact": "There are additional costs per transaction to run and store network data. For high-volume networks these charges will add up quickly.", "Audit": {"From Azure Portal": "1. Open the All Resources blade \n2. Click on Add Filter \n3. In the Add Filter window, select the followingFilter: Type \nOperator: Equals \nValue: Public IP address \n4. Click the Apply button \n5. For each Public IP address in the list, use Overview (or Properties) to review the \n\"Associated to:\" field and determine if the associated resource is still relevant \nto your tenant environment. If the associated resource is relevant, ensure that \nadditional controls exist to mitigate risk (e.g. Firewalls, VPNs, Traffic Filtering, \nVirtual Gateway Appliances, Web Application Firewalls, etc.) on all subsequently \nattached resources.", "From Azure CLI": "List all Public IP addressesaz network public-ip list \nFor each Public IP address in the output, review the \"name\" property and determine if \nthe associated resource is still relevant to your tenant environment. If the associated \nresource is relevant, ensure that additional controls exist to mitigate risk (e.g. Firewalls, \nVPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.) on \nall subsequently attached resources."}, "Remediation": {"General Remediation Instructions": "Remediation will vary significantly depending on your organization's security \nrequirements for the resources attached to each individual Public IP address."}, "Default_value": "During Virtual Machine and Application creation, a setting may create and attach a public IP. References: 1. https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security", "pdf": "azure"}, {"Rule_number": "7.1", "Rule": "7.1 Ensure an Azure Bastion Host Exists (Automated)", "Profile_applicability": " Level 2", "Description": "The Azure Bastion service allows secure remote access to Azure Virtual Machines over the Internet without exposing remote access protocol ports and services directly to the Internet. The Azure Bastion service provides this access using TLS over 443/TCP, and subscribes to hardened configurations within an organization's Azure Active Directory service.", "Rationale": "The Azure Bastion service allows organizations a more secure means of accessing Azure Virtual Machines over the Internet without assigning public IP addresses to those Virtual Machines. The Azure Bastion service provides Remote Desktop Protocol (RDP) and Secure Shell (SSH) access to Virtual Machines using TLS within a web browser, thus preventing organizations from opening up 3389/TCP and 22/TCP to the Internet on Azure Virtual Machines. Additional benefits of the Bastion service includes Multi-Factor Authentication, Conditional Access Policies, and any other hardening measures configured within Azure Active Directory using a central point of access.", "Impact": "The Azure Bastion service incurs additional costs and requires a specific virtual network configuration. The Standard tier offers additional configuration options compared to the Basic tier and may incur additional costs for those added features.", "Audit": {"From Azure Portal": "1. Click on Bastions \n2.", "Ensure there is at least one Bastion host listed under the Name column \nFrom Azure CLI \nNote:": "The Azure CLI network bastion module is in Preview as of this writing \naz network bastion list --subscription <subscription ID> \nEnsure the output of the above command is not empty. \n \nFrom PowerShell \nRetrieve the Bastion host(s) information for a specific Resource Group \nGet-AzBastion -ResourceGroupName <resource group name> \nEnsure the output of the above command is not empty."}, "Remediation": {"From Azure Portal": "1. Click on Bastions \n2. Select the Subscription \n3. Select the Resource group \n4. Type a Name for the new Bastion host \n5. Select a Region \n6. Choose Standard next to Tier \n7. Use the slider to set the Instance count \n8. Select the Virtual network or Create new \n9. Select the Subnet named AzureBastionSubnet. Create a Subnet named \nAzureBastionSubnet using a /26 CIDR range if it doesn't already exist. \n10. \nSelct the appropriate Public IP address option. \n11. \nIf Create new is selected for the Public IP address option, provide a Public IP \naddress name. \n12. \nIf Use existing is selected for Public IP address option, select an IP address \nfrom Choose public IP address \n13. \nClick Next: Tags > 14. \nConfigure the appropriate Tags \n15. \nClick Next: Advanced > 16. \nSelect the appropriate Advanced options \n17. \nClick Next: Review + create > 18. \nClick Create", "From Azure CLI": "az network bastion create --location <location> --name <name of bastion host> \n--public-ip-address <public IP address name or ID> --resource-group <resource \ngroup name or ID> --vnet-name <virtual network containing subnet called \n\"AzureBastionSubnet\"> --scale-units <integer> --sku Standard [--disable-copy-\npaste true|false] [--enable-ip-connect true|false] [--enable-tunneling \ntrue|false] \n \nFrom PowerShell \nCreate the appropriate Virtual network settings and Public IP Address settings. \n$subnetName = \"AzureBastionSubnet\" \n$subnet = New-AzVirtualNetworkSubnetConfig -Name $subnetName -AddressPrefix \n<IP address range in CIDR notation making sure to use a /26> \n$virtualNet = New-AzVirtualNetwork -Name <virtual network name> -\nResourceGroupName <resource group name> -Location <location> -AddressPrefix \n<IP address range in CIDR notation> -Subnet $subnet \n$publicip = New-AzPublicIpAddress -ResourceGroupName <resource group name> -\nName <public IP address name> -Location <location> -AllocationMethod Dynamic \n-Sku Standard"}, "Default_value": "During Virtual Machine and Application creation, a setting may create and attach a public IP. References: 1. https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security", "pdf": "azure"}, {"Rule_number": "7.2", "Rule": "7.2 Ensure Virtual Machines are utilizing Managed Disks (Automated)", "Profile_applicability": " Level 1", "Description": "Migrate blob-based VHDs to Managed Disks on Virtual Machines to exploit the default features of this configuration. The features include: 1. Default Disk Encryption 2. Resilience, as Microsoft will managed the disk storage and move around if underlying hardware goes faulty 3. Reduction of costs over storage accounts", "Rationale": "Managed disks are by default encrypted on the underlying hardware, so no additional encryption is required for basic protection. It is available if additional encryption is required. Managed disks are by design more resilient that storage accounts. For ARM-deployed Virtual Machines, Azure Adviser will at some point recommend moving VHDs to managed disks both from a security and cost management perspective.", "Impact": "There are additional costs for managed disks based off of disk space allocated. When converting to managed disks, VMs will be powered off and back on.", "Audit": {"From Azure Portal": "1. Using the search feature, go to Virtual Machines \n2. Click the Manage view dropdown, then select Edit columns \n3. Add Uses managed disks to the selected columns \n4. Select Save \n5.", "Ensure all virtual machines listed are using managed disks \nFrom PowerShell \nRun the following command:": "Get-AzVM | ForEach-Object {\"Name: \" + $_.Name;\"ManagedDisk Id: \" + \n$_.StorageProfile.OsDisk.ManagedDisk.Id;\"\"}"}, "Remediation": {"From Azure Portal": "1. Using the search feature, go to Virtual Machines \n2. Select the virtual machine you would like to convert \n3. Select Disks in the menu for the VM \n4. At the top select Migrate to managed disks \n5. You may follow the prompts to convert the disk and finish by selecting Migrate to \nstart the process \nNOTE VMs will be stopped and restarted after migration is complete. \nFrom PowerShell \nStop-AzVM -ResourceGroupName $rgName -Name $vmName -Force \nConvertTo-AzVMManagedDisk -ResourceGroupName $rgName -VMName $vmName \nStart-AzVM -ResourceGroupName $rgName -Name $vmName"}, "Default_value": "Managed disks or are an option upon the creation of VMs. References: 1. https://docs.microsoft.com/en-us/azure/virtual-machines/windows/convert-unmanaged-to-managed-disks 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-4-enable-data-at-rest-encryption-by-default 3. https://docs.microsoft.com/en-us/azure/virtual-machines/faq-for-disks 4. https://azure.microsoft.com/en-us/pricing/details/managed-disks/", "pdf": "azure"}, {"Rule_number": "7.3", "Rule": "7.3 Ensure that 'OS and Data' disks are encrypted with Customer Managed Key (CMK) (Automated)", "Profile_applicability": " Level 2", "Description": "Ensure that OS disks (boot volumes) and data disks (non-boot volumes) are encrypted with CMK (Customer Managed Keys). Customer Managed keys can be either ADE or Server Side Encryption (SSE).", "Rationale": "Encrypting the IaaS VM's OS disk (boot volume) and Data disks (non-boot volume) ensures that the entire content is fully unrecoverable without a key, thus protecting the volume from unwanted reads. PMK (Platform Managed Keys) are enabled by default in Azure-managed disks and allow encryption at rest. CMK is recommended because it gives the customer the option to control which specific keys are used for the encryption and decryption of the disk. The customer can then change keys and increase security by disabling them instead of relying on the PMK key that remains unchanging. There is also the option to increase security further by using automatically rotating keys so that access to disk is ensured to be limited. Organizations should evaluate what their security requirements are, however, for the data stored on the disk. For high-risk data using CMK is a must, as it provides extra steps of security. If the data is low risk, PMK is enabled by default and provides sufficient data security.", "Impact": "Using CMK/BYOK will entail additional management of keys. NOTE: You must have your key vault set up to utilize this.", "Audit": {"From Azure Portal": "1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Disks \n4. Ensure that the OS disk and Data disks have encryption set to CMK. \nFrom PowerShell \n$ResourceGroupName=\"yourResourceGroupName\" \n$DiskName=\"yourDiskName\" \n \n$disk=Get-AzDisk -ResourceGroupName $ResourceGroupName -DiskName $DiskName \n$disk.Encryption.Type"}, "Remediation": {"From Azure Portal": "Note: Disks must be detached from VMs to have encryption changed. 1.Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Disks \n4. Click the ellipsis (...), then click Detach to detach the disk from the VM \n5. Now search for Disks and locate the unattached disk \n6. Click the disk then select Encryption \n7. Change your encryption type, then select your encryption set \n8. Click Save \n9. Go back to the VM and re-attach the disk \nFrom PowerShell \n$KVRGname = 'MyKeyVaultResourceGroup'; \n $VMRGName = 'MyVirtualMachineResourceGroup'; \n $vmName = 'MySecureVM'; \n $KeyVaultName = 'MySecureVault'; \n $KeyVault = Get-AzKeyVault -VaultName $KeyVaultName -ResourceGroupName \n$KVRGname; \n $diskEncryptionKeyVaultUrl = $KeyVault.VaultUri; \n $KeyVaultResourceId = $KeyVault.ResourceId; \n \n Set-AzVMDiskEncryptionExtension -ResourceGroupName $VMRGname -VMName $vmName \n-DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -\nDiskEncryptionKeyVaultId $KeyVaultResourceId; \nNOTE: During encryption it is likely that a reboot will be required. It may take up to 15 \nminutes to complete the process. \nNOTE 2: This may differ for Linux machines as you may need to set the -skipVmBackup \nparameter"}, "Default_value": "By default, Azure disks are encrypted using SSE with PMK.", "pdf": "azure"}, {"Rule_number": "7.4", "Rule": "7.4 Ensure that 'Unattached disks' are encrypted with 'Customer Managed Key' (CMK) (Automated)", "Profile_applicability": " Level 2", "Description": "Ensure that unattached disks in a subscription are encrypted with a Customer Managed Key (CMK).", "Rationale": "Managed disks are encrypted by default with Platform-managed keys. Using Customer-managed keys may provide an additional level of security or meet an organization's regulatory requirements. Encrypting managed disks ensures that its entire content is fully unrecoverable without a key and thus protects the volume from unwarranted reads. Even if the disk is not attached to any of the VMs, there is always a risk where a compromised user account with administrative access to VM service can mount/attach these data disks, which may lead to sensitive information disclosure and tampering.", "Impact": "NOTE: You must have your key vault set up to utilize this. Encryption is available only on Standard tier VMs. This might cost you more. Utilizing and maintaining Customer-managed keys will require additional work to create, protect, and rotate keys.", "Audit": {"From Azure Portal": "1. Go to Disks \n2. Click on Add Filter \n3. In the filter field select Disk state \n4. In the Value field select Unattached \n5. Click Apply \n6. for each disk listed ensure that Encryption type in the encryption blade is \n`Encryption at-rest with a customer-managed key'", "From Azure CLI": "Ensure command below does not return any output. \naz disk list --query '[? diskstate == `Unattached`].{encryptionSettingsencryptionSettings, name: name}' -o json"}, "Remediation": {"General Remediation Instructions": "If data stored in the disk is no longer useful, refer to Azure documentation to delete \nunattached data disks at-https://docs.microsoft.com/en-us/rest/api/compute/disks/delete \n-https://docs.microsoft.com/en-us/cli/azure/disk?view=azure-cli-latest#az-\ndisk-delete \nIf data stored in the disk is important, To encrypt the disk refer azure documentation at-https://docs.microsoft.com/en-us/azure/virtual-machines/disks-enable-\ncustomer-managed-keys-portal \n-https://docs.microsoft.com/en-\nus/rest/api/compute/disks/update#encryptionsettings"}, "Default_value": "By default, managed disks are encrypted with a Platform-managed key. References: 1. https://docs.microsoft.com/en-us/azure/security/fundamentals/azure-disk-encryption-vms-vmss 2. https://docs.microsoft.com/en-us/azure/security-center/security-center-disk-encryption?toc=%2fazure%2fsecurity%2ftoc.json 3. https://docs.microsoft.com/en-us/rest/api/compute/disks/delete", "pdf": "azure"}, {"Rule_number": "7.5", "Rule": "7.5 Ensure that Only Approved Extensions Are Installed (Manual)", "Profile_applicability": " Level 1", "Description": "For added security, only install organization-approved extensions on VMs.", "Rationale": "Azure virtual machine extensions are small applications that provide post-deployment configuration and automation tasks on Azure virtual machines. These extensions run with administrative privileges and could potentially access anything on a virtual machine. The Azure Portal and community provide several such extensions. Each organization should carefully evaluate these extensions and ensure that only those that are approved for use are actually implemented.", "Impact": "Functionality by unsupported extensions will be disabled.", "Audit": {"From Azure Portal": "1. Go to Virtual machines. \n2. For each virtual machine, click on the server name to select it go to \n3. In the new column menu, under Settings Click on Extensions + applications. \n4. Ensure that all the listed extensions are approved by your organization for use.", "From Azure CLI": "Use the below command to list the extensions attached to a VM, and ensure the listed \nextensions are approved for use. \naz vm extension list --vm-name <vmName> --resource-group <sourceGroupName> --\nquery [*].name \nFrom PowerShell \nGet a list of VMs. \nGet-AzVM \nFor each VM run the following command. \nGet-AzVMExtension -ResourceGroupName <VM Resource Group> -VMName <VM Name> \nReview each Name, ExtensionType, and ProvisioningState to make sure no \nunauthorized extensions are installed on any virtual machines."}, "Remediation": {"From Azure Portal": "1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Extensions + applications \n4. If there are unapproved extensions, uninstall them.", "From Azure CLI": "From the audit command identify the unapproved extensions, and use the below CLI \ncommand to remove an unapproved extension attached to VM. \naz vm extension delete --resource-group <resourceGroupName> --vm-name \n<vmName> --name <extensionName> \nFrom PowerShell \nFor each VM and each insecure extension from the Audit Procedure run the following \ncommand. \nRemove-AzVMExtension -ResourceGroupName <ResourceGroupName> -Name \n<ExtensionName> -VMName <VirtualMachineName>"}, "Default_value": "By default, no extensions are added to the virtual machines. References: 1. https://docs.microsoft.com/en-us/azure/virtual-machines/windows/extensions-features 2. https://docs.microsoft.com/en-us/powershell/module/az.compute/?view=azps-7.5.0#vm-extensions 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-asset-management#am-2-use-only-approved-services 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-asset-management#am-5-use-only-approved-applications-in-virtual-machine", "pdf": "azure"}, {"Rule_number": "7.6", "Rule": "7.6 Ensure that Endpoint Protection for all Virtual Machines is installed (Manual)", "Profile_applicability": " Level 2", "Description": "Install endpoint protection for all virtual machines.", "Rationale": "Installing endpoint protection systems (like anti-malware for Azure) provides for real-time protection capability that helps identify and remove viruses, spyware, and other malicious software. These also offer configurable alerts when known-malicious or unwanted software attempts to install itself or run on Azure systems.", "Impact": "Endpoint protection will incur an additional cost to you.", "Audit": {"From Azure Portal": "1. Go to Security Center \n2. Click the Recommendations blade \n3. Ensure that there are no recommendations for Endpoint Protection not \ninstalled on Azure VMs", "From Azure CLI": "az vm show -g <MyResourceGroup> -n <MyVm> -d --query \n\"resources[?type=='Microsoft.Compute/virtualMachines/extensions'].{ExtensionN\name:name}\" -o table \nIf extensions are installed, it will list the installed extensions. \nEndpointSecurity || TrendMicroDSA* || Antimalware || EndpointProtection || \nSCWPAgent || PortalProtectExtension* || FileSecurity* \nAlternatively, you can employ your own endpoint protection tool for your OS.", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"General Remediation Instructions": "Follow Microsoft Azure documentation to install endpoint protection from the security \ncenter. Alternatively, you can employ your own endpoint protection tool for your OS."}, "Default_value": "By default Endpoint Protection is disabled. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-install-endpoint-protection 2. https://docs.microsoft.com/en-us/azure/security/azure-security-antimalware 3. https://docs.microsoft.com/en-us/cli/azure/vm/extension?view=azure-cli-latest#az_vm_extension_list 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-endpoint-security#es-1-use-endpoint-detection-and-response-edr", "pdf": "azure"}, {"Rule_number": "7.7", "Rule": "7.7 [Legacy] Ensure that VHDs are Encrypted (Manual)", "Profile_applicability": " Level 2", "Description": "NOTE: This is a legacy recommendation. Managed Disks are encrypted by default and recommended for all new VM implementations. VHD (Virtual Hard Disks) are stored in blob storage and are the old-style disks that were attached to Virtual Machines. The blob VHD was then leased to the VM. By default, storage accounts are not encrypted, and Microsoft Defender will then recommend that the OS disks should be encrypted. Storage accounts can be encrypted as a whole using PMK or CMK. This should be turned on for storage accounts containing VHDs.", "Rationale": "While it is recommended to use Managed Disks which are encrypted by default, \"legacy\" VHDs may exist for a variety of reasons and may need to remain in VHD format. VHDs are not encrypted by default, so this recommendation intends to address the security of these disks. In these niche cases, VHDs should be encrypted using the procedures in this recommendation to encrypt and protect the data content. If a virtual machine is using a VHD and can be converted to a managed disk, instructions for this procedure can be found in the resources section of this recommendation under the title \"Convert VHD to Managed Disk.\"", "Impact": "Depending on how the encryption is implemented will change the size of the impact. If provider-managed keys(PMK) are utilized, the impact is relatively low, but processes need to be put in place to regularly rotate the keys. If Customer-managed keys(CMK) are utilized, a key management process needs to be implemented to store and manage key rotation, thus the impact is medium to high depending on user maturity with key management.", "Audit": {"From Azure CLI": "For each virtual machine identify if the VM is using a legacy VHD by reviewing the VHD \nparameter in the output of the following command. The VHD parameter will contain the \nStorage Account name used for the VHD. \naz vm show --name <MyVM> --resource-group <MyResourceGroup> \nNext, identify if the storage account from the VHD parameter is encrypted by reviewing \nthe encryption --> services --> blob --> enabled within the output of the following \ncommand and make sure its value is True."}, "Remediation": {"From Azure Portal": "1. Navigate to the storage account that you wish to encrypt \n2. Select encryption \n3. Select the encryption type that you wish to use \nIf you wish to use a Microsoft-managed key (the default), you can save at this point and \nencryption will be applied to the account. \nIf you select Customer-managed keys, it will ask for the location of the key (The default is \nan Azure Key Vault) and the key name. \nOnce these are captured, save the configuration and the account will be encrypted \nusing the provided key.", "From Azure CLI": "Create the Key Vault \naz keyvault create --name <name> --resource-group <resourceGroup> --location \n<location> --enabled-for-disk-encryption \nEncrypt the disk and store the key in Key Vault"}, "Default_value": "By default Endpoint Protection is disabled. References: 1. https://docs.microsoft.com/en-us/azure/security-center/security-center-install-endpoint-protection 2. https://docs.microsoft.com/en-us/azure/security/azure-security-antimalware 3. https://docs.microsoft.com/en-us/cli/azure/vm/extension?view=azure-cli-latest#az_vm_extension_list 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-endpoint-security#es-1-use-endpoint-detection-and-response-edr", "pdf": "azure"}, {"Rule_number": "7.8", "Rule": "7.8 Ensure only MFA enabled identities can access privileged Virtual Machine (Automated)", "Profile_applicability": " Level 2", "Description": "Verify identities without MFA that can log in to a privileged virtual machine using separate login credentials. An adversary can leverage the access to move laterally and perform actions with the virtual machine's managed identity. Make sure the virtual machine only has necessary permissions, and revoke the admin-level permissions according to the least privileges principal", "Rationale": "Integrating multi-factor authentication (MFA) as part of the organizational policy can greatly reduce the risk of an identity gaining control of valid credentials that may be used for additional tactics such as initial access, lateral movement, and collecting information. MFA can also be used to restrict access to cloud resources and APIs. An Adversary may log into accessible cloud services within a compromised environment using Valid Accounts that are synchronized to move laterally and perform actions with the virtual machine's managed identity. The adversary may then perform management actions or access cloud-hosted resources as the logged-on managed identity.", "Impact": "this recommendation requires an Azure AD P2 License to implement. Ensure that identities that are provisioned to a virtual machine utilizes an RBAC/ABAC group and is allocated a role using Azure PIM, and the Role settings require MFA or use another PAM solution (like CyberArk) for accessing Virtual Machines.", "Audit": {"From Azure Portal": "1. Log in to the Azure portal. \n2. Select the Subscription, then click on Access control (IAM). \n3. Select Role Assignments from the top menu and apply filters on Assignment type \nas Privileged administrator roles and Type as Virtual Machines. \n4. Verify the list of privileged managed identities attached to any virtual machine. \n5. If there are privileged managed identities from the above list, then check the list \nof users without MFA by navigating to Azure AD. \n6. In the left navigation pane select Users from Manage. \n7. Click on Per-User MFA from the top menu options and for each user with MULTI-\nFACTOR AUTH STATUS as Disabled follow the below-mentioned steps:"}, "Remediation": {"From Azure Portal": "1. Log in to the Azure portal. \n2. This can be remediated by enabling MFA for user, Removing user access or \nReducing access of managed identities attached to virtual machines. \n\u2022Case I : Enable MFA for users having access on virtual machines. 1.Navigate to Azure AD from the left pane and select Users from the Manage \nsection. \n2. Click on Per-User MFA from the top menu options and select each user \nwith MULTI-FACTOR AUTH STATUS as Disabled and can login to virtual \nmachines\u25aa \nFrom quick steps on the right side select enable. \n\u25aa \nClick on enable multi-factor auth and share the link with the user \nto setup MFA as required. \n\u2022Case II : Removing user access on a virtual machine. 1.Select the Subscription, then click on Access control (IAM). \n2. Select Role assignments and search for Virtual Machine Administrator \nLogin or Virtual Machine User Login or any role that provides access to \nlog into virtual machines. \n3. Click on Role Name, Select Assignments, and remove identities with no \nMFA configured. \n\u2022Case III : Reducing access of managed identities attached to virtual machines. 1.Select the Subscription, then click on Access control (IAM). \n2. Select Role Assignments from the top menu and apply filters on \nAssignment type as Privileged administrator roles and Type as \nVirtual Machines. \n3. Click on Role Name, Select Assignments, and remove identities access \nmake sure this follows the least privileges principal."}, "Default_value": "The default value for encryption is \"NO Encryption\" References: 1. CLI: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disk-encryption-cli-quickstart 2. Powershell: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disk-encryption-powershell-quickstart 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-4-enable-data-at-rest-encryption-by-default 4. Convert VHD to Managed Disk: https://docs.microsoft.com/en-us/previous-versions/azure/virtual-machines/scripts/virtual-machines-powershell-sample-create-managed-disk-from-vhd", "pdf": "azure"}, {"Rule_number": "7.9", "Rule": "7.9 Ensure Trusted Launch is enabled on Virtual Machines (Automated)", "Profile_applicability": " Level 1", "Description": "When Secure Boot and vTPM are enabled together, they provide a strong foundation for protecting your VM from boot attacks. For example, if an attacker attempts to replace the bootloader with a malicious version, Secure Boot will prevent the VM from booting. If the attacker is able to bypass Secure Boot and install a malicious bootloader, vTPM can be used to detect the intrusion and alert you.", "Rationale": "Secure Boot and vTPM work together to protect your VM from a variety of boot attacks, including bootkits, rootkits, and firmware rootkits. Not enabling Trusted Launch in Azure VM can lead to increased vulnerability to rootkits and boot-level malware, reduced ability to detect and prevent unauthorized changes to the boot process, and a potential compromise of system integrity and data security.", "Impact": "Secure Boot and vTPM are not currently supported for Azure Generation 1 VMs. IMPORTANT: Before enabling Secure Boot and vTPM on a Generation 2 VM which does not already have both enabled, it is highly recommended to create a restore point of the VM prior to remediation.", "Audit": {"From Azure Portal": "1. Go to Virtual Machines \n2. For each VM, under Settings, click on Configuration on the left blade \n3. Under Security Type, make sure security type is not standard and if it is Trusted \nLaunch Virtual Machines then make sure Enable Secure Boot & Enable vTPM \nare checked", "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URLhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"}, "Remediation": {"From Azure Portal": "1. Go to Virtual Machines \n2. For each VM, under Settings, click on Configuration on the left blade \n3. Under Security Type, select 'Trusted Launch Virtual Machines' \n4. Make sure Enable Secure Boot & Enable vTPM are checked \n5. Click on Apply. \nNote: Trusted launch on existing virtual machines (VMs) is currently not supported for \nAzure Generation 1 VMs"}, "Default_value": "On Azure Generation 2 VMs, vTPM is enabled by default. Secure Boot is not enabled by default. References: 1. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-vm?tabs=portal 2. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-vm?tabs=portal#enable-trusted-launch-on-existing-vm 3. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch#secure-boot", "pdf": "azure"}, {"Rule_number": "8.1", "Rule": "8.1 Ensure that the Expiration Date is set for all Keys in RBAC Key Vaults (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure that all Keys in Role Based Access Control (RBAC) Azure Key Vaults have an expiration date set.", "Rationale": "Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration date) attribute identifies the expiration date on or after which the key MUST NOT be used for encryption of new data, wrapping of new keys, and signing. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration date for all keys to help enforce the key rotation. This ensures that the keys cannot be used beyond their assigned lifetimes.", "Impact": "Keys cannot be used beyond their assigned expiration dates respectively. Keys need to be rotated periodically wherever they are used.", "Audit": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that an appropriate Expiration date is set for any keys \nthat are Enabled.", "From Azure CLI": "Get a list of all the key vaults in your Azure environment by running the following \ncommandaz keyvault list \nThen for each key vault listed ensure that the output of the below command contains \nKey ID (kid), enabled status as true and Expiration date (expires) is not empty or nullaz keyvault key list --vault-name <VaultName> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"}, "Remediation": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that an appropriate Expiration date is set for any keys \nthat are Enabled.", "From Azure CLI": "Update the Expiration date for the key using the below commandaz keyvault key set-attributes --name <keyName> --vault-name <vaultName> --\nexpires Y-m-d'T'H:M:S'Z' \nNoteTo view the expiration date on all keys in a Key Vault using Microsoft API, the \"List\" Key \npermission is required. \nTo update the expiration date for the keys1. Go to the Key vault, click on Access Control (IAM). \n2. Click on Add role assignment and assign the role of Key Vault Crypto Officer to \nthe appropriate user."}, "Default_value": "On Azure Generation 2 VMs, vTPM is enabled by default. Secure Boot is not enabled by default. References: 1. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-vm?tabs=portal 2. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-vm?tabs=portal#enable-trusted-launch-on-existing-vm 3. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch#secure-boot", "pdf": "azure"}, {"Rule_number": "8.2", "Rule": "8.2 Ensure that the Expiration Date is set for all Keys in Non-RBAC Key Vaults. (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure that all Keys in Non Role Based Access Control (RBAC) Azure Key Vaults have an expiration date set.", "Rationale": "Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration date) attribute identifies the expiration date on or after which the key MUST NOT be used for a cryptographic operation. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration date for all keys. This ensures that the keys cannot be used beyond their assigned lifetimes.", "Impact": "Keys cannot be used beyond their assigned expiration dates respectively. Keys need to be rotated periodically wherever they are used.", "Audit": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that the status of the key is Enabled. \n4. For each enabled key, ensure that an appropriate Expiration date is set.", "From Azure CLI": "Get a list of all the key vaults in your Azure environment by running the following \ncommandaz keyvault list \nFor each key vault, ensure that the output of the below command contains Key ID (kid), \nenabled status as true and Expiration date (expires) is not empty or nullaz keyvault key list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"}, "Remediation": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that the status of the key is Enabled. \n4. For each enabled key, ensure that an appropriate Expiration date is set.", "From Azure CLI": "Update the Expiration date for the key using the below commandaz keyvault key set-attributes --name <keyName> --vault-name <vaultName> --\nexpires Y-m-d'T'H:M:S'Z' \nNoteTo view the expiration date on all keys in a Key Vault using Microsoft API, the \"List\" Key \npermission is required. \nTo update the expiration date for the keys1. Go to Key vault, click on Access policies. \n2. Click on Create and add an access policy with the Update permission (in the Key \nPermissions - Key Management Operations section)."}, "Default_value": "By default, keys do not expire. References: 1. https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis 2. https://docs.microsoft.com/en-us/rest/api/keyvault/about-keys--secrets-and-certificates#key-vault-keys 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-6-use-a-secure-key-management-process 4. https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-azkeyvaultkeyattribute?view=azps-0.10.0", "pdf": "azure"}, {"Rule_number": "8.3", "Rule": "8.3 Ensure that the Expiration Date is set for all Secrets in RBAC Key Vaults (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure that all Secrets in Role Based Access Control (RBAC) Azure Key Vaults have an expiration date set.", "Rationale": "The Azure Key Vault enables users to store and keep secrets within the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences with a maximum size of 25k bytes each. The exp (expiration date) attribute identifies the expiration date on or after which the secret MUST NOT be used. By default, secrets never expire. It is thus recommended to rotate secrets in the key vault and set an explicit expiration date for all secrets. This ensures that the secrets cannot be used beyond their assigned lifetimes.", "Impact": "Secrets cannot be used beyond their assigned expiry date respectively. Secrets need to be rotated periodically wherever they are used.", "Audit": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. For each enabled secret, ensure that an appropriate Expiration date is set.", "From Azure CLI": "Ensure that the output of the below command contains ID (id), enabled status as true \nand Expiration date (expires) is not empty or nullaz keyvault secret list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'", "From PowerShell:": "Retrieve a list of Key vaultsGet-AzKeyVault \nFor each Key vault, run the following command to determine which vaults are \nconfigured to use RBAC:"}, "Remediation": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. For each enabled secret, ensure that an appropriate Expiration date is set.", "From Azure CLI": "Update the Expiration date for the secret using the below commandaz keyvault secret set-attributes --name <secretName> --vault-name \n<vaultName> --expires Y-m-d'T'H:M:S'Z' \nNoteTo view the expiration date on all secrets in a Key Vault using Microsoft API, the List \nKey permission is required. \nTo update the expiration date for the secrets1. Go to the Key vault, click on Access Control (IAM). \n2. Click on Add role assignment and assign the role of Key Vault Secrets Officer \nto the appropriate user. \nFrom PowerShellSet-AzKeyVaultSecretAttribute -VaultName <Vault Name> -Name <Secret Name> -\nExpires <DateTime>"}, "Default_value": "By default, secrets do not expire.", "pdf": "azure"}, {"Rule_number": "8.4", "Rule": "8.4 Ensure that the Expiration Date is set for all Secrets in Non-RBAC Key Vaults (Automated)", "Profile_applicability": " Level 1", "Description": "Ensure that all Secrets in Non Role Based Access Control (RBAC) Azure Key Vaults have an expiration date set.", "Rationale": "The Azure Key Vault enables users to store and keep secrets within the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences with a maximum size of 25k bytes each. The exp (expiration date) attribute identifies the expiration date on or after which the secret MUST NOT be used. By default, secrets never expire. It is thus recommended to rotate secrets in the key vault and set an explicit expiration date for all secrets. This ensures that the secrets cannot be used beyond their assigned lifetimes.", "Impact": "Secrets cannot be used beyond their assigned expiry date respectively. Secrets need to be rotated periodically wherever they are used.", "Audit": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. Set an appropriate Expiration date on all secrets.", "From Azure CLI": "Get a list of all the key vaults in your Azure environment by running the following \ncommandaz keyvault list \nFor each key vault, ensure that the output of the below command contains ID (id), \nenabled status as true and Expiration date (expires) is not empty or nullaz keyvault secret list --vault-name <KEYVALUTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"}, "Remediation": {"From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. Set an appropriate Expiration date on all secrets.", "From Azure CLI": "Update the Expiration date for the secret using the below commandaz keyvault secret set-attributes --name <secretName> --vault-name \n<vaultName> --expires Y-m-d'T'H:M:S'Z' \nNote: To view the expiration date on all secrets in a Key Vault using Microsoft API, the \nList Key permission is required. \n \nTo update the expiration date for the secrets1. Go to Key vault, click on Access policies. \n2. Click on Create and add an access policy with the Update permission (in the \nSecret Permissions - Secret Management Operations section)."}, "Default_value": "By default, secrets do not expire.", "pdf": "azure"}, {"Rule_number": "8.5", "Rule": "8.5 Ensure the Key Vault is Recoverable (Automated)", "Profile_applicability": " Level 1", "Description": "The Key Vault contains object keys, secrets, and certificates. Accidental unavailability of a Key Vault can cause immediate data loss or loss of security functions (authentication, validation, verification, non-repudiation, etc.) supported by the Key Vault objects. It is recommended the Key Vault be made recoverable by enabling the \"Do Not Purge\" and \"Soft Delete\" functions. This is in order to prevent loss of encrypted data, including storage accounts, SQL databases, and/or dependent services provided by Key Vault objects (Keys, Secrets, Certificates) etc. This may happen in the case of accidental deletion by a user or from disruptive activity by a malicious user. WARNING: A current limitation is that role assignments disappearing when Key Vault is deleted. All role assignments will need to be recreated after recovery.", "Rationale": "There could be scenarios where users accidentally run delete/purge commands on Key Vault or an attacker/malicious user deliberately does so in order to cause disruption. Deleting or purging a Key Vault leads to immediate data loss, as keys encrypting data and secrets/certificates allowing access/services will become non-accessible. There is a Key Vault property that plays a role in permanent unavailability of a Key Vault: enablePurgeProtection: Setting this parameter to \"true\" for a Key Vault ensures that even if Key Vault is deleted, Key Vault itself or its objects remain recoverable for the next 90 days. Key Vault/objects can either be recovered or purged (permanent deletion) during those 90 days. If no action is taken, the key vault and its objects will subsequently be purged. Enabling the enablePurgeProtection parameter on Key Vaults ensures that Key Vaults and their objects cannot be deleted/purged permanently.", "Impact": "Once purge-protection and soft-delete are enabled for a Key Vault, the action is irreversible.", "Audit": {"From Azure Portal": "1. Go to Key Vaults \n2. For each Key Vault \n3. Click Properties \n4. Ensure the \"Enable purge protection (enforce a mandatory retention period for \ndeleted vaults and vault objects)\" is selected for Purge protection option on this \nkey vault`", "From Azure CLI": "1. List all Resources of type Key Vaultsaz resource list --query \"[?type=='Microsoft.KeyVault/vaults']\" \n2. For Every Key Vault ID ensure check parameters enablePurgeProtection is set \nto true. \naz resource show --id /subscriptions/xxxxxx-xxxx-xxxx-xxxx-\nxxxxxxxxxxxx/resourceGroups/<resourceGroupName>/providers/Microsoft.KeyVault \n/vaults/<keyVaultName> \n \nFrom PowerShell \nGet all Key Vaults. \nGet-AzKeyVault \nFor each Key Vault run the following command. \nGet-AzKeyVault -VaultName <Vault Name> \nExamine the results of the above command for the EnablePurgeProtection setting. \nMake sure enablePurgeProtection is set to True."}, "Remediation": {"From Azure Portal": "1. Go to Key Vaults \n2. For each Key Vault \n3. Click Properties \n4. Ensure the status of Purge protection reads Enable purge protection (enforce \na mandatory retention period for deleted vaults and vault objects). \nNote, once enabled you cannot disable it."}, "Default_value": "By default, secrets do not expire. References: 1. https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis 2. https://docs.microsoft.com/en-us/rest/api/keyvault/about-keys--secrets-and-certificates#key-vault-secrets 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-6-use-a-secure-key-management-process 4. https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-azkeyvaultsecret?view=azps-7.4.0", "pdf": "azure"}, {"Rule_number": "8.6", "Rule": "8.6 Enable Role Based Access Control for Azure Key Vault (Manual)", "Profile_applicability": " Level 2", "Description": "WARNING: Role assignments disappear when a Key Vault has been deleted (soft-delete) and recovered. Afterwards it will be required to recreate all role assignments. This is a limitation of the soft-delete feature across all Azure services.", "Rationale": "The new RBAC permissions model for Key Vaults enables a much finer grained access control for key vault secrets, keys, certificates, etc., than the vault access policy. This in turn will permit the use of privileged identity management over these roles, thus securing the key vaults with JIT Access management.", "Impact": "Implementation needs to be properly designed from the ground up, as this is a fundamental change to the way key vaults are accessed/managed. Changing permissions to key vaults will result in loss of service as permissions are re-applied. For the least amount of downtime, map your current groups and users to their corresponding permission needs.", "Audit": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left corner \n2. Select Key Vaults \n3. Select a Key Vault to audit \n4. Select Access configuration \n5. Ensure the Permission Model radio button is set to Azure role-based access \ncontrol", "From Azure CLI": "* \nRun the following command for each Key Vault in each Resource Groupaz keyvault show --resource-group <RESOURCE GROUP NAME> --name <KEY VAULT \nNAME> \nEnsure the enableRbacAuthorization setting is set to true within the output of the \nabove command."}, "Remediation": {"From Azure Portal": "Key Vaults can be configured to use Azure role-based access control on creation. \nFor existing Key Vaults1. From Azure Home open the Portal Menu in the top left corner \n2. Select Key Vaults \n3. Select a Key Vault to audit \n4. Select Access configuration \n5. Set the Permission model radio button to Azure role-based access control, \ntaking note of the warning message \n6. Click Save \n7. Select Access Control (IAM) \n8. Select the Role Assignments tab \n9. Reapply permissions as needed to groups or users", "From Azure CLI": "* \nTo enable RBAC Authorization for each Key Vault, run the following Azure CLI \ncommandaz keyvault update --resource-group <RESOURCE GROUP NAME> --name <KEY VAULT \nNAME> --enable-rbac-authorization true \nFrom PowerShell \nTo enable RBAC authorization on each Key Vault, run the following PowerShell \ncommandUpdate-AzKeyVault -ResourceGroupName <RESOURCE GROUP NAME> -VaultName <KEY \nVAULT NAME> -EnableRbacAuthorization $True"}, "Default_value": "The default value for Access control in Key Vaults is Vault Policy.", "pdf": "azure"}, {"Rule_number": "8.7", "Rule": "8.7 Ensure that Private Endpoints are Used for Azure Key Vault (Manual)", "Profile_applicability": " Level 2", "Description": "Private endpoints will secure network traffic from Azure Key Vault to the resources requesting secrets and keys.", "Rationale": "Private endpoints will keep network requests to Azure Key Vault limited to the endpoints attached to the resources that are whitelisted to communicate with each other. Assigning the Key Vault to a network without an endpoint will allow other resources on that network to view all traffic from the Key Vault to its destination. In spite of the complexity in configuration, this is recommended for high security secrets.", "Impact": "Incorrect or poorly-timed changing of network configuration could result in service interruption. There are also additional costs tiers for running a private endpoint per petabyte or more of networking traffic.", "Audit": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Select Networking in the left column. \n5. Select Private endpoint connections from the top row. \n6. View if there is an endpoint attached.", "From Azure CLI": "Run the following command within a subscription for each Key Vault you wish to audit. \naz keyvault private-endpoint-connection show -g <resourceGroup> --vault-name \n<keyVaultName>", "From Powershell": "Run the following command within a subscription for each Key Vault you wish to audit. \nGet-AzPrivateEndpointConnection -PrivateLinkResourceId \n'/subscriptions/<subscriptionNumber>/resourceGroups/<resourceGroup>/providers\n/Microsoft.KeyVault/vaults/<keyVaultName>/'"}, "Remediation": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Select Networking in the left column. \n5. Select Private endpoint connections from the top row. \n6. Select + Create. \n7. Select the subscription the Key Vault is within, and other desired configuration. \n8. Select Next. \n9. For resource type select Microsoft.KeyVault/vaults. \n10. \nSelect the Key Vault to associate the Private Endpoint with. \n11. \nSelect Next. \n12. \nIn the Virtual Networking field, select the network to assign the Endpoint. \n13. \nSelect other configuration options as desired, including an existing or new \napplication security group. \n14. \nSelect Next. \n15. \nSelect the private DNS the Private Endpoints will use. \n16. \nSelect Next. \n17. \nOptionally add Tags. \n18. \nSelect Next : Review + Create. \n19. \nReview the information and select Create. Follow the Audit Procedure to \ndetermine if it has successfully applied. \n20. \nRepeat steps 3-19 for each Key Vault."}, "Default_value": "The default value for Access control in Key Vaults is Vault Policy.", "pdf": "azure"}, {"Rule_number": "8.8", "Rule": "8.8 Ensure Automatic Key Rotation is Enabled Within Azure Key Vault for the Supported Services (Manual)", "Profile_applicability": " Level 2", "Description": "Automatic Key Rotation is available in Public Preview. The currently supported applications are Key Vault, Managed Disks, and Storage accounts accessing keys within Key Vault. The number of supported applications will incrementally increased.", "Rationale": "Once set up, Automatic Private Key Rotation removes the need for manual administration when keys expire at intervals determined by your organization's policy. The recommended key lifetime is 2 years. Your organization should determine its own key expiration policy.", "Impact": "There are an additional costs per operation in running the needed applications.", "Audit": {"From Azure Portal": "select the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Under Objects select Keys. \n5. Select a key to audit. \n6. In the top row select Rotation policy. \n7. Ensure Enable auto rotation is set to Enabled. \n8. Repeat steps 3-7 for each Key Vault and Key.", "From Azure CLI": "Run the following commandaz keyvault key rotation-policy show --vaultname <vaultName> --name <keyName>", "From PowerShell \nRun the following command:": "Get-AzKeyVaultKeyRotationPolicy -VaultName <vaultName> -Name <keyName>"}, "Remediation": {"From Azure Portal": "select the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Under Objects select Keys. \n5. Select a key to audit. \n6. In the top row select Rotation policy. \n7. Select an Expiry time. \n8. Set Enable auto rotation to Enabled. \n9. Set an appropriate Rotation option and Rotation time. \n10. \nOptionally set the Notification time. \n11. \nSelect Save. \n12. \nRepeat steps 3-11 for each Key Vault and Key."}, "Default_value": "By default, Private Endpoints are not enabled for any services within Azure. References: 1. https://docs.microsoft.com/en-us/azure/private-link/private-endpoint-overview 2. https://docs.microsoft.com/en-us/azure/storage/common/storage-private-endpoints 3. https://azure.microsoft.com/en-us/pricing/details/private-link/ 4. https://docs.microsoft.com/en-us/azure/key-vault/general/private-link-service?tabs=portal 5. https://docs.microsoft.com/en-us/azure/virtual-network/quick-create-portal 6. https://docs.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-storage-portal 7. https://docs.microsoft.com/en-us/azure/bastion/bastion-overview 8. https://docs.microsoft.com/azure/dns/private-dns-getstarted-cli#create-an-additional-dns-record 9. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-8-ensure-security-of-key-and-certificate-repository Additional Information: This recommendation assumes that you have created a Resource Group containing a Virtual Network that the services are already associated with and configured private DNS. A Bastion on the virtual network is also required, and the service to which you are connecting must already have a Private Endpoint. For information concerning the installation of these services, please see the attached documentation. Microsoft's own documentation lists the requirements as: A Key Vault. An Azure virtual network. A subnet in the virtual network. Owner or contributor permissions for both the Key Vault and the virtual network.", "pdf": "azure"}, {"Rule_number": "9.1", "Rule": "9.1 Ensure App Service Authentication is set up for apps in Azure App Service (Automated)", "Profile_applicability": " Level 2", "Description": "Azure App Service Authentication is a feature that can prevent anonymous HTTP requests from reaching a Web Application or authenticate those with tokens before they reach the app. If an anonymous request is received from a browser, App Service will redirect to a logon page. To handle the logon process, a choice from a set of identity providers can be made, or a custom authentication mechanism can be implemented.", "Rationale": "By Enabling App Service Authentication, every incoming HTTP request passes through it before being handled by the application code. It also handles authentication of users with the specified provider (Entra ID, Facebook, Google, Microsoft Account, and Twitter), validation, storing and refreshing of tokens, managing the authenticated sessions and injecting identity information into request headers. Disabling HTTP Basic Authentication functionality further ensures legacy authentication methods are disabled within the application.", "Impact": "This is only required for App Services which require authentication. Enabling on site like a marketing or support website will prevent unauthenticated access which would be undesirable. Adding Authentication requirement will increase cost of App Service and require additional security components to facilitate the authentication.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, Click on Authentication \n5. Ensure that App Service authentication set to Enabled (Will only appear once \nan Identity provider is set up/selected) \n6. Navigate back to the application blade \n7. Under Settings, click on Configuration \n8. Click on the 'General Settings' tab \n9. Under Platform settings, ensure Basic Auth Publishing Credentials is set to \nOff"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, click on Authentication \n5. If no identity providers are set up, then click Add identity provider \n6. Choose other parameters as per your requirements and click on Add \nTo disable the Basic Auth Publishing Credentials setting, perform the following \nsteps:"}, "Default_value": "By default, Automatic Key Rotation is not enabled. References: 1. https://docs.microsoft.com/en-us/azure/key-vault/keys/how-to-configure-key-rotation 2. https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-keys-overview#update-the-key-version 3. https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disks-enable-customer-managed-keys-powershell#set-up-an-azure-key-vault-and-diskencryptionset-optionally-with-automatic-key-rotation 4. https://azure.microsoft.com/en-us/updates/public-preview-automatic-key-rotation-of-customermanaged-keys-for-encrypting-azure-managed-disks/ 5. https://docs.microsoft.com/en-us/cli/azure/keyvault/key/rotation-policy?view=azure-cli-latest#az-keyvault-key-rotation-policy-update", "pdf": "azure"}, {"Rule_number": "9.2", "Rule": "9.2 Ensure Web App Redirects All HTTP traffic to HTTPS in Azure App Service (Automated)", "Profile_applicability": " Level 1", "Description": "Azure Web Apps allows sites to run under both HTTP and HTTPS by default. Web apps can be accessed by anyone using non-secure HTTP links by default. Non-secure HTTP requests can be restricted and all HTTP requests redirected to the secure HTTPS port. It is recommended to enforce HTTPS-only traffic.", "Rationale": "Enabling HTTPS-only traffic will redirect all non-secure HTTP requests to HTTPS ports. HTTPS uses the TLS/SSL protocol to provide a secure connection which is both encrypted and authenticated. It is therefore important to support HTTPS for the security benefits.", "Impact": "When it is enabled, every incoming HTTP request is redirected to the HTTPS port. This means an extra level of security will be added to the HTTP requests made to the app.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Click on configuration \n5. Ensure that the HTTPS Only setting is toggled to On", "From Azure CLI": "To check HTTPS-only traffic value for an existing app, run the following command, \naz webapp show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --\nquery httpsOnly \nThe output should return true if HTTPS-only traffic value is set to On. \nFrom PowerShell \nList all the web apps configured within the subscription. \nGet-AzWebApp | Select-Object ResourceGroup, Name, HttpsOnly \nFor each web app review the HttpsOnly setting and make sure it is set to True."}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Click on configuration \n5. Under the HTTPS Only heading select 'On' to enable https only \n6. Click Save at the top", "From Azure CLI": "To set HTTPS-only traffic value for an existing app, run the following commandaz webapp update --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --\nset httpsOnly=true \nFrom PowerShell \nSet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> -\nHttpsOnly $true"}, "Default_value": "By default, HTTPS-only feature will be disabled when a new app is created using the command-line tool or Azure Portal console. References: 1. https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl#enforce-https 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit 3. https://docs.microsoft.com/en-us/powershell/module/az.websites/set-azwebapp?view=azps-8.1.0", "pdf": "azure"}, {"Rule_number": "9.3", "Rule": "9.3 Ensure Web App is using the latest version of TLS encryption (Automated)", "Profile_applicability": " Level 1", "Description": "The TLS (Transport Layer Security) protocol secures transmission of data over the internet using standard encryption technology. Encryption should be set with the latest version of TLS. App service allows TLS 1.2 by default, which is the recommended TLS level by industry standards such as PCI DSS.", "Rationale": "App service currently allows the web app to set TLS versions 1.0, 1.1 and 1.2. It is highly recommended to use the latest TLS 1.2 version for web app secure connections. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com 2. Go to App Services 3. Click on each App 4. Under Setting section, Click on TLS/SSL settings 5. Under the Bindings pane, ensure that Minimum TLS Version set to 1.2 under Protocol Settings From Azure CLI To check TLS Version for an existing app, run the following command, az webapp config show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --query minTlsVersion The output should return 1.2 if TLS Version is set to 1.2 (Which is currently the latest version). From PowerShell List all web apps. Get-AzWebApp For each web app run the following command. Get-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> |Select-Object -ExpandProperty SiteConfig Make sure the minTlsVersion is set to at least 1.2.", "Impact": "When it is enabled, every incoming HTTP request is redirected to the HTTPS port. This means an extra level of security will be added to the HTTP requests made to the app.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on TLS/SSL settings \n5. Under the Bindings pane, ensure that Minimum TLS Version set to 1.2 under \nProtocol Settings", "From Azure CLI": "To check TLS Version for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query minTlsVersion \nThe output should return 1.2 if TLS Version is set to 1.2 (Which is currently the latest \nversion). \nFrom PowerShell \nList all web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> \n|Select-Object -ExpandProperty SiteConfig \nMake sure the minTlsVersion is set to at least 1.2."}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on SSL settings \n5. Under the Bindings pane, set Minimum TLS Version to 1.2 under Protocol \nSettings section", "From Azure CLI": "To set TLS Version for an existing app, run the following commandaz webapp config set --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> \n--min-tls-version 1.2 \nFrom PowerShell \nSet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> -\nMinTlsVersion 1.2"}, "Default_value": "By default, TLS Version feature will be set to 1.2 when a new app is created using the command-line tool or Azure Portal console. References: 1. https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-custom-ssl#enforce-tls-versions 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-security#ns-8-detect-and-disable-insecure-services-and-protocols 4. https://docs.microsoft.com/en-us/powershell/module/az.websites/set-azwebapp?view=azps-8.1.0", "pdf": "azure"}, {"Rule_number": "9.4", "Rule": "9.4 Ensure that Register with Entra ID is enabled on App Service (Automated)", "Profile_applicability": " Level 1", "Description": "Managed service identity in App Service provides more security by eliminating secrets from the app, such as credentials in the connection strings. When registering an App Service with Entra ID, the app will connect to other Azure services securely without the need for usernames and passwords.", "Rationale": "App Service provides a highly scalable, self-patching web hosting service in Azure. It also provides a managed identity for apps, which is a turn-key solution for securing access to Azure SQL Database and other Azure services. Audit: From Azure Portal 1. From Azure Portal open the Portal Menu in the top left 2. Go to App Services 3. Click on each App 4. Under the Setting section, Click on Identity 5. Under the System assigned pane, ensure that Status set to On From Azure CLI To check Register with Entra ID feature status for an existing app, run the following command, az webapp identity show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --query principalId The output should return unique Principal ID. If no output for the above command then Register with Entra ID is not set. From PowerShell List the web apps. Get-AzWebApp For each web app run the following command. Get-AzWebapp -ResourceGroupName  <app resource group> -Name <app name> Make sure the Identity setting contains a unique Principal ID", "Impact": "When it is enabled, every incoming HTTP request is redirected to the HTTPS port. This means an extra level of security will be added to the HTTP requests made to the app.", "Audit": {"From Azure Portal": "open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under the Setting section, Click on Identity \n5. Under the System assigned pane, ensure that Status set to On", "From Azure CLI": "To check Register with Entra ID feature status for an existing app, run the following \ncommand, \naz webapp identity show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query principalId \nThe output should return unique Principal ID. \nIf no output for the above command then Register with Entra ID is not set. \nFrom PowerShell \nList the web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebapp -ResourceGroupName  <app resource group> -Name <app name> \nMake sure the Identity setting contains a unique Principal ID"}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Identity \n5. Under the System assigned pane, set Status to On", "From Azure CLI": "To register with Entra ID for an existing app, run the following commandaz webapp identity assign --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> \nFrom PowerShell \nTo register with Entra ID for an existing app, run the following commandSet-AzWebApp -AssignIdentity $True -ResourceGroupName <resource_Group_Name> -\nName <App_Name>"}, "Default_value": "By default, Managed service identity via Entra ID is disabled. References: 1. https://docs.microsoft.com/en-gb/azure/app-service/app-service-web-tutorial-connect-msi 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-1-use-centralized-identity-and-authentication-system", "pdf": "azure"}, {"Rule_number": "9.5", "Rule": "9.5 Ensure That 'PHP version' is the Latest, If Used to Run the Web App (Manual)", "Profile_applicability": " Level 1", "Description": "Periodically newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for web apps is recommended in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.", "Rationale": "Newer versions may contain security enhancements and additional functionality. Using the latest software version is recommended in order to take advantage of enhancements and new capabilities. With each software installation, organizations need to determine if a given update meets their requirements. They must also verify the compatibility and support provided for any additional software against the update revision that is selected.", "Impact": "If your app is written using version-dependent features or libraries, they may not be available on the latest version. If you wish to upgrade, research the impact thoroughly. Upgrading may have unforeseen consequences that could result in downtime.", "Audit": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane, ensure that for a Stack of PHP the Major \nVersion and Minor Version reflect the latest stable and supported release. \n** The latest stable version can be confirmed by going to php.net. Navigate to the \ndownloads, and then find the most recent version that is marked by Current Stable PHP \n[version_number]. ** \nNOTE: No action is required If PHP version is set to Off as PHP is not used by your \nweb app."}, "Remediation": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane, ensure that for a Stack of PHP the Major \nVersion and Minor Version reflect the latest stable and supported release. \nNOTE: No action is required If PHP version is set to Off or is set with an empty value as \nPHP is not used by your web app."}, "Default_value": "By default, Managed service identity via Entra ID is disabled. References: 1. https://docs.microsoft.com/en-gb/azure/app-service/app-service-web-tutorial-connect-msi 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-management#im-1-use-centralized-identity-and-authentication-system", "pdf": "azure"}, {"Rule_number": "9.6", "Rule": "9.6 Ensure that 'Python version' is the Latest Stable Version, if Used to Run the Web App (Manual)", "Profile_applicability": " Level 1", "Description": "Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest full Python version for web apps is recommended in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.", "Rationale": "Newer versions may contain security enhancements and additional functionality. Using the latest software version is recommended in order to take advantage of enhancements and new capabilities. With each software installation, organizations need to determine if a given update meets their requirements. They must also verify the compatibility and support provided for any additional software against the update revision that is selected. Using the latest full version will keep your stack secure to vulnerabilities and exploits.", "Impact": "If your app is written using version-dependent features or libraries, they may not be available on the latest version. If you wish to upgrade, research the impact thoroughly. Upgrading may have unforeseen consequences that could result in downtime.", "Audit": {"From Azure Console": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Python, with \nMajor Version of Python 3, that the Minor Version is set to the latest stable \nversion available (Python 3.11, at the time of writing) \nNOTE: No action is required if Python version is set to Off, as Python is not used by \nyour web app."}, "Remediation": {"From Azure Portal": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that the Major Version and the \nMinor Version is set to the latest stable version available (Python 3.11, at the \ntime of writing) \nNOTE: No action is required if Python version is set to Off, as Python is not used by \nyour web app."}, "Default_value": "The version of PHP is whatever was selected upon App creation. References: 1. https://docs.microsoft.com/en-us/azure/app-service/web-sites-configure#general-settings 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-3-define-and-establish-secure-configurations-for-compute-resources 4. https://www.php.net/downloads", "pdf": "azure"}, {"Rule_number": "9.7", "Rule": "9.7 Ensure that 'Java version' is the latest, if used to run the Web App (Manual)", "Profile_applicability": " Level 1", "Description": "Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for web apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the newer version.", "Rationale": "Newer versions may contain security enhancements and additional functionality. Using the latest software version is recommended in order to take advantage of enhancements and new capabilities. With each software installation, organizations need to determine if a given update meets their requirements. They must also verify the compatibility and support provided for any additional software against the update revision that is selected.", "Impact": "If your app is written using version-dependent features or libraries, they may not be available on the latest version. If you wish to upgrade, research the impact thoroughly. Upgrading may have unforeseen consequences that could result in downtime.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Java the \nMajor Version and Minor Version reflect the latest stable and supported \nrelease, and that the Java web server version is set to the auto-update option. \nNOTE: No action is required if Java version is set to Off, as Java is not used by your \nweb app."}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Java the \nMajor Version and Minor Version reflect the latest stable and supported \nrelease, and that the Java web server version is set to the auto-update option. \nNOTE: No action is required if Java version is set to Off, as Java is not used by your \nweb app."}, "Default_value": "The version of Python is whatever was selected upon App creation. References: 1. https://docs.microsoft.com/en-us/azure/app-service/web-sites-configure#general-settings 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-3-define-and-establish-secure-configurations-for-compute-resources 4. https://www.python.org/downloads/ Additional Information: ** The latest stable version can be confirmed by going to python.org. Navigate to the downloads, and then find the most recent version that is marked by security in the maintenance column. **", "pdf": "azure"}, {"Rule_number": "9.8", "Rule": "9.8 Ensure that 'HTTP Version' is the Latest, if Used to Run the Web App (Automated)", "Profile_applicability": " Level 1", "Description": "Periodically, newer versions are released for HTTP either due to security flaws or to include additional functionality. Using the latest HTTP version for web apps to take advantage of security fixes, if any, and/or new functionalities of the newer version.", "Rationale": "Newer versions may contain security enhancements and additional functionality. Using the latest version is recommended in order to take advantage of enhancements and new capabilities. With each software installation, organizations need to determine if a given update meets their requirements. They must also verify the compatibility and support provided for any additional software against the update revision that is selected. HTTP 2.0 has additional performance improvements on the head-of-line blocking problem of old HTTP version, header compression, and prioritization of requests. HTTP 2.0 no longer supports HTTP 1.1's chunked transfer encoding mechanism, as it provides its own, more efficient, mechanisms for data streaming. Audit: From Azure Portal 1. Login to Azure Portal using https://portal.azure.com 2. Go to App Services 3. Click on each App 4. Under Setting section, Click on Configuration 5. Ensure that HTTP Version set to 2.0 version under General settings NOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-encrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to your app with HTTP/2, either buy an App Service Certificate for your app's custom domain or bind a third party certificate.  From Azure CLI To check HTTP 2.0 version status for an existing app, run the following command, az webapp config show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --query http20Enabled The output should return true if HTTPS 2.0 traffic value is set to On.", "Impact": "If your app is written using version-dependent features or libraries, they may not be available on the latest version. If you wish to upgrade, research the impact thoroughly. Upgrading may have unforeseen consequences that could result in downtime.", "Audit": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Configuration \n5. Ensure that HTTP Version set to 2.0 version under General settings \nNOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-\nencrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to \nyour app with HTTP/2, either buy an App Service Certificate for your app's custom \ndomain or bind a third party certificate.", "From Azure CLI": "To check HTTP 2.0 version status for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query http20Enabled \nThe output should return true if HTTPS 2.0 traffic value is set to On."}, "Remediation": {"From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Configuration \n5. Set HTTP version to 2.0 under General settings \nNOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-\nencrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to \nyour app with HTTP/2, either buy an App Service Certificate for your app's custom \ndomain or bind a third party certificate.", "From Azure CLI": "To set HTTP 2.0 version for an existing app, run the following commandaz webapp config set --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> \n--http20-enabled true \n \nFrom PowerShell \nTo enable HTTP 2.0 version support, run the following commandSet-AzWebApp -ResourceGroupName <app resource group> -Name <app name> -\nHttp20Enabled $true"}, "Default_value": "The default setting is whichever setting was chosen in the creation of the webapp. References: 1. https://docs.microsoft.com/en-us/azure/app-service/web-sites-configure#general-settings 2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-3-define-and-establish-secure-configurations-for-compute-resources 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities 4. https://www.oracle.com/java/technologies/downloads/#java11", "pdf": "azure"}, {"Rule_number": "9.9", "Rule": "9.9 Ensure FTP deployments are Disabled (Automated)", "Profile_applicability": " Level 1", "Description": "By default, Azure Functions, Web, and API Services can be deployed over FTP. If FTP is required for an essential deployment workflow, FTPS should be required for FTP login for all App Service Apps and Functions.", "Rationale": "Azure FTP deployment endpoints are public. An attacker listening to traffic on a wifi network used by a remote employee or a corporate network could see login traffic in clear-text which would then grant them full control of the code base of the app or service. This finding is more severe if User Credentials for deployment are set at the subscription level rather than using the default Application Credentials which are unique per App.", "Impact": "Any deployment workflows that rely on FTP or FTPs rather than the WebDeploy or HTTPs endpoints may be affected.", "Audit": {"From Azure Portal": "1. Go to the Azure Portal \n2. Select App Services \n3. Click on an app \n4. Select Settings and then Configuration \n5. Under General Settings, for the Platform Settings, the FTP state should not \nbe set to All allowed", "From Azure CLI": "List webapps to obtain the ids. \naz webapp list \nList the publish profiles to obtain the username, password \nand ftp server url."}, "Remediation": {"From Azure Portal": "1. Go to the Azure Portal \n2. Select App Services \n3. Click on an app \n4. Select Settings and then Configuration \n5. Under General Settings, for the Platform Settings, the FTP state should be \nset to Disabled or FTPS Only", "From Azure CLI": "For each out of compliance application, run the following choosing either 'disabled' or \n'FtpsOnly' as appropriateaz webapp config set --resource-group <resource group name> --name <app name> \n--ftps-state [disabled|FtpsOnly]"}, "Default_value": "", "pdf": "azure"}, {"Rule_number": "9.10", "Rule": "9.10 Ensure Azure Key Vaults are Used to Store Secrets (Manual)", "Profile_applicability": " Level 2", "Description": "Azure Key Vault will store multiple types of sensitive information such as encryption keys, certificate thumbprints, and Managed Identity Credentials. Access to these 'Secrets' can be controlled through granular permissions.", "Rationale": "The credentials given to an application have permissions to create, delete, or modify data stored within the systems they access. If these credentials are stored within the application itself, anyone with access to the application or a copy of the code has access to them. Storing within Azure Key Vault as secrets increases security by controlling access. This also allows for updates of the credentials without redeploying the entire application.", "Impact": "Integrating references to secrets within the key vault are required to be specifically integrated within the application code. This will require additional configuration to be made during the writing of an application, or refactoring of an already written one. There are also additional costs that are charged per 10000 requests to the Key Vault.", "Audit": {"From Azure Portal": "1. Login to Azure Portal \n2. In the expandable menu on the left go to Key Vaults \n3. View the Key Vaults listed.", "From Azure CLI": "To list key vaults within a subscription run the following commandGet-AzKeyVault \nTo list the secrets within these key vaults run the following commandGet-AzKeyVaultSecret [-VaultName] <vault name>", "From Powershell": "To list key vaults within a subscription run the following commandGet-AzKeyVault \nTo list all secrets in a key vault run the following command:"}, "Remediation": {"From Azure CLI": "az keyvault create --name \"<name>\" --resource-group \"<myResourceGroup>\" --\nlocation myLocation", "From Powershell": "New-AzKeyvault -name <name> -ResourceGroupName <myResourceGroup> -Location \n<myLocation> \n \nStep 2: Set up the App Service to use the Key Vault \nSample JSON Template for App Service Configuration:  \n[template continues on following pages]"}, "Default_value": "By default, FTP based deployment is All allowed References: 1. [Azure Web Service Deploy via FTP](https://docs.microsoft.com/en-us/azure/app-service/deploy-ftp) 2. [Azure Web Service Deployment](https://docs.microsoft.com/en-us/azure/app-service/overview-security) 3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-protection#dp-3-encrypt-sensitive-data-in-transit 4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-vulnerability-management#pv-6-rapidly-and-automatically-remediate-vulnerabilities", "pdf": "azure"}, {"Rule_number": "10.1", "Rule": "10.1 Ensure that Resource Locks are set for Mission-Critical Azure Resources (Manual)", "Profile_applicability": " Level 2", "Description": "Resource Manager Locks provide a way for administrators to lock down Azure resources to prevent deletion of, or modifications to, a resource. These locks sit outside of the Role Based Access Controls (RBAC) hierarchy and, when applied, will place restrictions on the resource for all users. These locks are very useful when there is an important resource in a subscription that users should not be able to delete or change. Locks can help prevent accidental and malicious changes or deletion.", "Rationale": "As an administrator, it may be necessary to lock a subscription, resource group, or resource to prevent other users in the organization from accidentally deleting or modifying critical resources. The lock level can be set to to CanNotDelete or ReadOnly to achieve this purpose. \u2022 CanNotDelete means authorized users can still read and modify a resource, but they cannot delete the resource. \u2022 ReadOnly means authorized users can read a resource, but they cannot delete or update the resource. Applying this lock is similar to restricting all authorized users to the permissions granted by the Reader role.", "Impact": "There can be unintended outcomes of locking a resource. Applying a lock to a parent service will cause it to be inherited by all resources within. Conversely, applying a lock to a resource may not apply to connected storage, leaving it unlocked. Please see the documentation for further information.", "Audit": {"From Azure Portal": "1. Navigate to the specific Azure Resource or Resource Group \n2. Click on Locks \n3. Ensure the lock is defined with name and description, with type Read-only or \nDelete as appropriate.", "From Azure CLI": "Review the list of all locks set currently:"}, "Remediation": {"From Azure Portal": "1. Navigate to the specific Azure Resource or Resource Group \n2. For each mission critical resource, click on Locks \n3. Click Add \n4. Give the lock a name and a description, then select the type, Read-only or \nDelete as appropriate \n5. Click OK", "From Azure CLI": "To lock a resource, provide the name of the resource, its resource type, and its \nresource group name. \naz lock create --name <LockName> --lock-type <CanNotDelete/Read-only> --\nresource-group <resourceGroupName> --resource-name <resourceName> --resource-\ntype <resourceType>", "From Powershell": "Get-AzResourceLock -ResourceName <Resource Name> -ResourceType <Resource \nType> -ResourceGroupName <Resource Group Name> -Locktype <CanNotDelete/Read-\nonly>"}, "Default_value": "By default, no locks are set. References: 1. https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-lock-resources 2. https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-manager-subscription-governance#azure-resource-locks", "pdf": "azure"}]