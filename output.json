[
    {
        "Rule": "1.1.1 Ensure Security Defaults is enabled on Microsoft Entra ID \n(Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Security defaults in Microsoft Entra ID make it easier to be secure and help protect your \norganization. Security defaults contain preconfigured security settings for common \nattacks. \nSecurity defaults is available to everyone. The goal is to ensure that all organizations \nhave a basic level of security enabled at no extra cost. You may turn on security \ndefaults in the Azure portal.",
        "Rationale": "Security defaults provide secure default settings that we manage on behalf of \norganizations to keep customers safe until they are ready to manage their own identity \nsecurity settings. \nFor example, doing the following: \n\u2022 \nRequiring all users and admins to register for MFA. \n\u2022 \nChallenging users with MFA - when necessary, based on factors such as \nlocation, device, role, and task. \n\u2022 \nDisabling authentication from legacy authentication clients, which can\u2019t do MFA. \nImpact: \nThis recommendation should be implemented initially and then may be overridden by \nother service/product specific CIS Benchmarks. Administrators should also be aware \nthat certain configurations in Microsoft Entra ID may impact other Microsoft services \nsuch as Microsoft 365.",
        "Audit": "From Azure Portal \nTo ensure security defaults is enabled in your directory: \n1. From Azure Home select the Portal Menu. \n2. Browse to\u202fMicrosoft Entra ID\u202f>\u202fProperties. \n3. Select Manage security defaults. \n4. Verify the Enable security defaults toggle is Enabled.",
        "Audit Steps": {
            "From Azure Portal": "To ensure security defaults is enabled in your directory: \n1. From Azure Home select the Portal Menu. \n2. Browse to\u202fMicrosoft Entra ID\u202f>\u202fProperties. \n3. Select Manage security defaults. \n4. Verify the Enable security defaults toggle is Enabled."
        },
        "Remediation": "From Azure Portal \nTo enable security defaults in your directory: \n1. From Azure Home select the Portal Menu. \n2. Browse to\u202fMicrosoft Entra ID\u202f>\u202fProperties \n3. Select Manage security defaults \n4. Set the Enable security defaults to Enabled \n5. Select Save",
        "Remediation Steps": {
            "From Azure Portal": "To ensure security defaults is enabled in your directory: \n1. From Azure Home select the Portal Menu. \n2. Browse to\u202fMicrosoft Entra ID\u202f>\u202fProperties. \n3. Select Manage security defaults. \n4. Verify the Enable security defaults toggle is Enabled."
        },
        "Default Value": "If your tenant was created on or after October 22, 2019, security defaults may already \nbe enabled in your tenant. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/concept-\nfundamentals-security-defaults \n2. https://techcommunity.microsoft.com/t5/azure-active-directory-\nidentity/introducing-security-defaults/ba-p/1061414 \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-2-protect-identity-and-authentication-systems \nAdditional Information: \nThis recommendation differs from the Microsoft 365 Benchmark. This is because the \npotential impact associated with disabling Security Defaults is dependent upon the \nsecurity settings implemented in the environment. It is recommended that organizations \ndisabling Security Defaults implement appropriate security settings to replace the \nsettings configured by Security Defaults.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.1 Establish and Maintain a Secure Configuration Process \n \nEstablish and maintain a secure configuration process for enterprise assets \n end-user devices including portable and mobile non-computing IoT devices and \nservers and software operating systems and applications . Review and update \ndocumentation annually or when significant enterprise changes occur that could \nimpact this Safeguard. \n \n \n \nv7 \n5.1 Establish Secure Configurations \n \nMaintain documented standard security configuration standards for all \nauthorized operating systems and software. \n \n \n "
    },
    {
        "Rule": "1.1.2 Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all \nPrivileged Users (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Enable multi-factor authentication for all roles, groups, and users that have write access \nor permissions to Azure resources. These include custom created objects or built-in \nroles such as; \n\u2022 \nService Co-Administrators \n\u2022 \nSubscription Owners \n\u2022 \nContributors",
        "Rationale": "Multi-factor authentication requires an individual to present a minimum of two separate \nforms of authentication before access is granted. Multi-factor authentication provides \nadditional assurance that the individual attempting to gain access is who they claim to \nbe. With multi-factor authentication, an attacker would need to compromise at least two \ndifferent authentication mechanisms, increasing the difficulty of compromise and thus \nreducing the risk. \nImpact: \nUsers would require two forms of authentication before any access is granted. \nAdditional administrative time will be required for managing dual forms of authentication \nwhen enabling multi-factor authentication.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all noted users \nFrom REST API \nFor Every Subscription, For Every Tenant \nStep 1: Identify Users with Administrative Access",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all noted users",
            "From REST API": "For Every Subscription, For Every Tenant \nStep 1: Identify Users with Administrative Access"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Check the box next to each noted user \n7. Click Enable under quick steps in the right-hand panel \n8. Click enable multi-factor auth \n9. Click close \nOther Options within Azure Portal \nFollow Microsoft Azure documentation and enable multi-factor authentication in your \nenvironment. \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-\nazure-mfa \nEnabling and configuring MFA with conditional access policy is a multi-step process. \nHere are some additional resources on the process within Entra ID to enable multi-\nfactor authentication for users within your subscriptions with conditional access policy. \nhttps://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-\nconditional-access-policy-admin-mfa \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-\ngetstarted#enable-multi-factor-authentication-with-conditional-access \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-\nmfasettings",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all noted users",
            "From REST API": "For Every Subscription, For Every Tenant \nStep 1: Identify Users with Administrative Access"
        },
        "Default Value": "By default, multi-factor authentication is disabled for all users. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-\nauthentication \n2. https://stackoverflow.com/questions/41156206/azure-active-directory-premium-\nmfa-attributes-via-graph-api \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-4-authenticate-server-and-services \nAdditional Information: \nPlease note that at the time of writing, there is no API, Azure CLI or Powershell \nmechanism available to programmatically conduct security assessment or remediation \nfor this recommendation. The only option is MSOL.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.1 Establish and Maintain a Secure Configuration Process \n \nEstablish and maintain a secure configuration process for enterprise assets \n end-user devices including portable and mobile non-computing IoT devices and \nservers and software operating systems and applications . Review and update \ndocumentation annually or when significant enterprise changes occur that could \nimpact this Safeguard. \n \n \n \nv7 \n5.1 Establish Secure Configurations \n \nMaintain documented standard security configuration standards for all \nauthorized operating systems and software. \n \n \n "
    },
    {
        "Rule": "1.1.3 Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all \nNon-Privileged Users (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Enable multi-factor authentication for all non-privileged users.",
        "Rationale": "Multi-factor authentication requires an individual to present a minimum of two separate \nforms of authentication before access is granted. Multi-factor authentication provides \nadditional assurance that the individual attempting to gain access is who they claim to \nbe. With multi-factor authentication, an attacker would need to compromise at least two \ndifferent authentication mechanisms, increasing the difficulty of compromise and thus \nreducing the risk. \nImpact: \nUsers would require two forms of authentication before any access is granted. Also, this \nrequires an overhead for managing dual forms of authentication.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Check the box next to each noted user \n7. Click Enable under quick steps in the right-hand panel \n8. Click enable multi-factor auth \n9. Click close \nFrom REST API \nFor Every Subscription, For Every Tenant \nStep 1: Identify Users with non-administrative Access \n1. List All Users Using Microsoft Graph API: \nGET https://graph.microsoft.com/v1.0/users \nCapture id and corresponding userPrincipalName ($uid, $userPrincipalName)",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Check the box next to each noted user \n7. Click Enable under quick steps in the right-hand panel \n8. Click enable multi-factor auth \n9. Click close",
            "From REST API": "For Every Subscription, For Every Tenant \nStep 1: Identify Users with non-administrative Access \n1. List All Users Using Microsoft Graph API: \nGET https://graph.microsoft.com/v1.0/users \nCapture id and corresponding userPrincipalName ($uid, $userPrincipalName)"
        },
        "Remediation": "Follow Microsoft Azure documentation and enable multi-factor authentication in your \nenvironment. \nhttps://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-enable-\nazure-mfa \nEnabling and configuring MFA is a multi-step process. Here are some additional \nresources on the process within Microsoft Entra ID: \nhttps://learn.microsoft.com/en-us/entra/identity/conditional-access/howto-conditional-\naccess-policy-admin-mfa \nhttps://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\ngetstarted#enable-multi-factor-authentication-with-conditional-access \nhttps://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-mfasettings",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select the Microsoft Entra ID blade \n3. Select Users \n4. Take note of all users with the role Service Co-Administrators, Owners or \nContributors \n5. Click on the Per-User MFA button in the top row menu \n6. Check the box next to each noted user \n7. Click Enable under quick steps in the right-hand panel \n8. Click enable multi-factor auth \n9. Click close",
            "From REST API": "For Every Subscription, For Every Tenant \nStep 1: Identify Users with non-administrative Access \n1. List All Users Using Microsoft Graph API: \nGET https://graph.microsoft.com/v1.0/users \nCapture id and corresponding userPrincipalName ($uid, $userPrincipalName)"
        },
        "Default Value": "By default, multi-factor authentication is disabled for all users. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-\nauthentication \n2. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\nuserstates \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-4-authenticate-server-and-services",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.1.4 Ensure that 'Allow users to remember multi-factor \nauthentication on devices they trust' is Disabled (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Do not allow users to remember multi-factor authentication on devices.",
        "Rationale": "Remembering Multi-Factor Authentication (MFA) for devices and browsers allows users \nto have the option to bypass MFA for a set number of days after performing a \nsuccessful sign-in using MFA. This can enhance usability by minimizing the number of \ntimes a user may need to perform two-step verification on the same device. However, if \nan account or device is compromised, remembering MFA for trusted devices may affect \nsecurity. Hence, it is recommended that users not be allowed to bypass MFA. \nImpact: \nFor every login attempt, the user will be required to perform multi-factor authentication.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click the Per-user MFA button on the top bar \n5. Click on service settings \n6. Ensure that Allow users to remember multi-factor authentication on \ndevices they trust is not enabled",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click the Per-user MFA button on the top bar \n5. Click on service settings \n6. Ensure that Allow users to remember multi-factor authentication on \ndevices they trust is not enabled"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click the Per-user MFA button on the top bar \n5. Click on service settings \n6. Uncheck the box next to Allow users to remember multi-factor \nauthentication on devices they trust",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click the Per-user MFA button on the top bar \n5. Click on service settings \n6. Ensure that Allow users to remember multi-factor authentication on \ndevices they trust is not enabled"
        },
        "Default Value": "By default, multi-factor authentication is disabled for all users. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/multi-factor-authentication/multi-factor-\nauthentication \n2. https://learn.microsoft.com/en-us/entra/identity/authentication/howto-mfa-\nuserstates \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-4-authenticate-server-and-services",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.2.1 Ensure Trusted Locations Are Defined (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Microsoft Entra ID Conditional Access allows an organization to configure Named \nlocations and configure whether those locations are trusted or untrusted. These \nsettings provide organizations the means to specify Geographical locations for use in \nconditional access policies, or define actual IP addresses and IP ranges and whether or \nnot those IP addresses and/or ranges are trusted by the organization.",
        "Rationale": "Defining trusted source IP addresses or ranges helps organizations create and enforce \nConditional Access policies around those trusted or untrusted IP addresses and ranges. \nUsers authenticating from trusted IP addresses and/or ranges may have less access \nrestrictions or access requirements when compared to users that try to authenticate to \nMicrosoft Entra ID from untrusted locations or untrusted source IP addresses/ranges. \nImpact: \nWhen configuring Named locations, the organization can create locations using \nGeographical location data or by defining source IP addresses or ranges. Configuring \nNamed locations using a Country location does not provide the organization the ability \nto mark those locations as trusted, and any Conditional Access policy relying on those \nCountries location setting will not be able to use the All trusted locations setting \nwithin the Conditional Access policy. They instead will have to rely on the Select \nlocations setting. This may add additional resource requirements when configuring, \nand will require thorough organizational testing. \nIn general, Conditional Access policies may completely prevent users from \nauthenticating to Microsoft Entra ID, and thorough testing is recommended. To avoid \ncomplete lockout, a 'Break Glass' account with full Global Administrator rights is \nrecommended in the event all other administrators are locked out of authenticating to \nMicrosoft Entra ID. This 'Break Glass' account should be excluded from Conditional \nAccess Policies and should be configured with the longest pass phrase feasible. This \naccount should only be used in the event of an emergency and complete administrator \nlockout.",
        "Audit": "From Azure Portal \n1. In the Azure Portal, navigate to Microsoft Entra ID Conditional Access \n2. Click on Manage \n3. Click on Named Locations",
        "Audit Steps": {
            "From Azure Portal": "1. In the Azure Portal, navigate to Microsoft Entra ID Conditional Access \n2. Click on Manage \n3. Click on Named Locations"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Microsoft Entra ID Conditional Access Blade \n2. Click on the Named locations blade \n3. Within the Named locations blade, click on IP ranges location \n4. Enter a name for this location setting in the Name text box \n5. Click on the + sign \n6. Add an IP Address Range in CIDR notation inside the text box that appears \n7. Click on the Add button \n8. Repeat steps 5 through 7 for each IP Range that needs to be added \n9. If the information entered are trusted ranges, select the Mark as trusted \nlocation check box \n10. \nOnce finished, click on Create \nFrom PowerShell \nCreate a new trusted IP-based Named location policy \n[System.Collections.Generic.List`1[Microsoft.Open.MSGraph.Model.IpRange]]$ipR\nanges = @() \n$ipRanges.Add(\"<first IP range in CIDR notation>\") \n$ipRanges.Add(\"<second IP range in CIDR notation>\") \n$ipRanges.Add(\"<third IP range in CIDR notation>\") \nNew-AzureADMSNamedLocationPolicy -OdataType \n\"#microsoft.graph.ipNamedLocation\" -DisplayName \"<name of IP Named location \npolicy> -IsTrusted $true -IpRanges $ipRanges \nSet an existing IP-based Named location policy to trusted \nSet-AzureADMSNamedLocationPolicy -PolicyId \"<ID of the policy>\" -OdataType \n\"#microsoft.graph.ipNamedLocation\" -IsTrusted $true",
        "Remediation Steps": {
            "From Azure Portal": "1. In the Azure Portal, navigate to Microsoft Entra ID Conditional Access \n2. Click on Manage \n3. Click on Named Locations"
        },
        "Default Value": "By default, no locations are configured under the Named locations blade within the \nMicrosoft Entra ID Conditional Access blade.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.2.2 Ensure that an exclusionary Geographic Access Policy is \nconsidered (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "CAUTION: If these policies are created without first auditing and testing the result, \nmisconfiguration can potentially lock out administrators or create undesired access \nissues. \nConditional Access Policies can be used to block access from geographic locations that \nare deemed out-of-scope for your organization or application. The scope and variables \nfor this policy should be carefully examined and defined.",
        "Rationale": "Conditional Access, when used as a deny list for the tenant or subscription, is able to \nprevent ingress or egress of traffic to countries that are outside of the scope of interest \n(e.g.: customers, suppliers) or jurisdiction of an organization. This is an effective way to \nprevent unnecessary and long-lasting exposure to international threats such as APTs. \nImpact: \nMicrosoft Entra ID P1 or P2 is required. Limiting access geographically will deny access \nto users that are traveling or working remotely in a different part of the world. A point-to-\nsite or site to site tunnel such as a VPN is recommended to address exceptions to \ngeographic access policies.",
        "Audit": "From Azure Portal \n1. From Azure Home open the Portal menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit, then: \no Under Assignments, Review the Users and Groups for the personnel the \npolicy will apply to \no Under Assignments, Review the Cloud apps or actions for the systems \nthe policy will apply to \no Under Conditions, Review the Include locations for those that should be \nblocked",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit, then: \no Under Assignments, Review the Users and Groups for the personnel the \npolicy will apply to \no Under Assignments, Review the Cloud apps or actions for the systems \nthe policy will apply to \no Under Conditions, Review the Include locations for those that should be \nblocked"
        },
        "Remediation": "From Azure Portal \nPart 1 of 2 - Create the policy and enable it in Report-only mode. \n1. From Azure Home open the portal menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Click the + New policy button, then: \n5. Provide a name for the policy. \n6. Under Assignments, select Users or workload identities then: \no Under Include, select All users \no Under Exclude, check Users and groups and only select emergency \naccess accounts and service accounts (NOTE: Service accounts are \nexcluded here because service accounts are non-interactive and cannot \ncomplete MFA) \n7. Under Assignments, select Cloud apps or actions then: \no Under Include, select All cloud apps \no Leave Exclude blank unless you have a well defined exception \n8. Under Conditions, select Locations then: \no Select Include, then add entries for locations for those that should be \nblocked \no Select Exclude, then add entries for those that should be allowed \n(IMPORTANT: Ensure that all Trusted Locations are in the Exclude list.)",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit, then: \no Under Assignments, Review the Users and Groups for the personnel the \npolicy will apply to \no Under Assignments, Review the Cloud apps or actions for the systems \nthe policy will apply to \no Under Conditions, Review the Include locations for those that should be \nblocked"
        },
        "Default Value": "By default, no locations are configured under the Named locations blade within the \nMicrosoft Entra ID Conditional Access blade.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service \nor SSO provider where supported. \n \n \n \nv8 \n12.2 Establish and Maintain a Secure Network \nArchitecture \n \nEstablish and maintain a secure network architecture. A secure network \narchitecture must address segmentation least privilege and availability at a \nminimum. \n \n \n \nv7 \n11.1 Maintain Standard Security Configurations for \nNetwork Devices \n \nMaintain standard documented security configuration standards for all \nauthorized network devices. \n \n \n "
    },
    {
        "Rule": "1.2.3 Ensure that A Multi-factor Authentication Policy Exists for \nAdministrative Groups (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "For designated users, they will be prompted to use their multi-factor authentication \n(MFA) process on login.",
        "Rationale": "Enabling multi-factor authentication is a recommended setting to limit the use of \nAdministrative accounts to authenticated personnel. \nImpact: \nThere is an increased cost, as Conditional Access policies require Microsoft Entra ID \nP1. Similarly, MFA may require additional overhead to maintain. There is also a \npotential scenario in which the multi-factor authentication method can be lost, and \nadministrative users are no longer able to log in. For this scenario, there should be an \nemergency access account. Please see References for creating this.",
        "Audit": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. Be certain the emergency access account is not in the list. \n6. View under Exclude to determine which Users and groups to whom the policy is \nnot applied.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. Be certain the emergency access account is not in the list. \n6. View under Exclude to determine which Users and groups to whom the policy is \nnot applied."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home open the Portal Menu in top left, and select Microsoft Entra \nID. \n2. Select Security. \n3. Select Conditional Access. \n4. Click + New policy.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. Be certain the emergency access account is not in the list. \n6. View under Exclude to determine which Users and groups to whom the policy is \nnot applied."
        },
        "Default Value": "This policy does not exist by default.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory \nservice or SSO provider where supported. \n \n \n \nv7 \n12.1 Maintain an Inventory of Network Boundaries \n \nMaintain an up-to-date inventory of all of the organization s network \nboundaries. \n \n \n "
    },
    {
        "Rule": "1.2.4 Ensure that A Multi-factor Authentication Policy Exists for All \nUsers (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "For designated users, they will be prompted to use their multi-factor authentication \n(MFA) process on logins.",
        "Rationale": "Enabling multi-factor authentication is a recommended setting to limit the potential of \naccounts being compromised and limiting access to authenticated personnel. \nImpact: \nThere is an increased cost, as Conditional Access policies require Microsoft Entra ID P1 \nor P2. Similarly, this may require additional overhead to maintain if users lose access to \ntheir MFA.",
        "Audit": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home open Portal menu in the top left, and select Microsoft Entra \nID. \n2. Select Security. \n3. Select Conditional Access. \n4. Click + New policy. \n5. Enter a name for the policy. \n6. Select Users or workload identities.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Scroll down in the menu on the left, and select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied."
        },
        "Default Value": "By default, MFA is not enabled for any administrative accounts. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/conditional-\naccess/howto-conditional-access-policy-admin-mfa \n2. https://docs.microsoft.com/en-us/azure/active-directory/roles/security-\nemergency-access \n3. https://docs.microsoft.com/en-us/azure/active-directory/conditional-\naccess/troubleshoot-conditional-access-what-if \n4. https://docs.microsoft.com/en-us/azure/active-directory/conditional-\naccess/howto-conditional-access-insights-reporting \n5. https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/plan-\nconditional-access \n6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-7-restrict-resource-access-based-on--conditions \nAdditional Information: \nThese policies should be tested by using the What If tool in the References. Setting \nthese can and will create issues with logging in for users until they use an MFA device \nlinked to their accounts. Further testing can also be done via the insights and reporting \nresource in References which monitors Azure sign ins.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv8 \n6.5 Require MFA for Administrative Access \n \nRequire MFA for all administrative access accounts where supported on all \nenterprise assets whether managed on-site or through a third-party provider. \n \n \n \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service or \nSSO provider where supported. \n \n \n \nv7 \n4.5 Use Multifactor Authentication For All Administrative \nAccess \n \nUse multi-factor authentication and encrypted channels for all administrative \naccount access. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.2.5 Ensure Multi-factor Authentication is Required for Risky \nSign-ins (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "For designated users, they will be prompted to use their multi-factor authentication \n(MFA) process on login.",
        "Rationale": "Enabling multi-factor authentication is a recommended setting to limit the potential of \naccounts being compromised and limiting access to authenticated personnel. \nImpact: \nThere is an increased cost, as Conditional Access policies require Microsoft Entra ID P1 \nor P2. Similarly, they may require additional overhead to maintain if users lose access \nto their MFA.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security \n3. Select Conditional Access. \n4. Click + New policy. \n5. Enter a name for the policy. \n6. Select Users or workload identities.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu in the top left, and select Microsoft \nEntra ID. \n2. Select Security. \n3. Select on the left side Conditional Access. \n4. Select the policy you wish to audit. \n5. View under Users and Groups the corresponding users and groups to whom the \npolicy is applied. \n6. View under Exclude to determine which users and groups to whom the policy is \nnot applied."
        },
        "Default Value": "MFA is not enabled by default. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/conditional-\naccess/howto-conditional-access-policy-all-users-mfa \n2. https://docs.microsoft.com/en-us/azure/active-directory/conditional-\naccess/troubleshoot-conditional-access-what-if \n3. https://docs.microsoft.com/en-us/azure/active-directory/conditional-\naccess/howto-conditional-access-insights-reporting \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-7-restrict-resource-access-based-on--conditions \nAdditional Information: \nThese policies should be tested by using the What If tool in the References. Setting \nthese can and will create issues with logging in for users until they use an MFA device \nlinked to their accounts. Further testing can also be done via the insights and reporting \nresource the in References which monitors Azure sign ins.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n "
    },
    {
        "Rule": "1.2.6 Ensure Multifactor Authentication is Required for Windows \nAzure Service Management API (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "This recommendation ensures that users accessing the Windows Azure Service \nManagement API (i.e. Azure Powershell, Azure CLI, Azure Resource Manager API, \netc.) are required to use multifactor authentication (MFA) credentials when accessing \nresources through the Windows Azure Service Management API.",
        "Rationale": "Administrative access to the Windows Azure Service Management API should be \nsecured with a higher level of scrutiny to authenticating mechanisms. Enabling \nmultifactor authentication is recommended to reduce the potential for abuse of \nAdministrative actions, and to prevent intruders or compromised admin credentials from \nchanging administrative settings. \nIMPORTANT: While this recommendation allows exceptions to specific Users or \nGroups, they should be very carefully tracked and reviewed for necessity on a regular \ninterval through an Access Review process. It is important that this rule be built to \ninclude \"All Users\" to ensure that all users not specifically excepted will be required to \nuse MFA to access the Azure Service Management API. \nImpact: \nConditional Access policies require Microsoft Entra ID P1 or P2 licenses. Similarly, they \nmay require additional overhead to maintain if users lose access to their MFA. Any \nusers or groups which are granted an exception to this policy should be carefully \ntracked, be granted only minimal necessary privileges, and conditional access \nexceptions should be regularly reviewed or investigated.",
        "Audit": "From Azure Portal \n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected.",
        "Audit Steps": {
            "From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected."
        },
        "Remediation": "From Azure Portal \n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. Click Security in the Entra ID blade. \n3. Click Conditional Access in the Security blade. \n4. Click Policies in the Conditional Access blade. \n5. Click + New policy. \n6. Enter a name for the policy. \n7. Click the blue text under Users. \n8. Under Include, select All users. \n9. Under Exclude, check Users and groups. \n10. \nSelect users or groups to be exempted from this policy (e.g. break-glass \nemergency accounts, and non-interactive service accounts) then click the Select \nbutton. \n11. \nClick the blue text under Target Resources. \n12. \nUnder Include, click the Select apps radio button. \n13. \nClick the blue text under Select. \n14. \nCheck the box next to Windows Azure Service Management APIs then click the \nSelect button. \n15. \nClick the blue text under Grant. \n16. \nUnder Grant access check the box for Require multifactor authentication \nthen click the Select button. \n17. \nBefore creating, set Enable policy to Report-only. \n18. \nClick Create. \nAfter testing the policy in report-only mode, update the Enable policy setting from \nReport-only to On.",
        "Remediation Steps": {
            "From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected."
        },
        "Default Value": "MFA is not enabled by default for administrative actions.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service or \nSSO provider where supported. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.2.7 Ensure Multifactor Authentication is Required to access \nMicrosoft Admin Portals (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "This recommendation ensures that users accessing Microsoft Admin Portals (i.e. \nMicrosoft 365 Admin, Microsoft 365 Defender, Exchange Admin Center, Azure Portal, \netc.) are required to use multifactor authentication (MFA) credentials when logging into \nan Admin Portal.",
        "Rationale": "Administrative Portals for Microsoft Azure should be secured with a higher level of \nscrutiny to authenticating mechanisms. Enabling multifactor authentication is \nrecommended to reduce the potential for abuse of Administrative actions, and to \nprevent intruders or compromised admin credentials from changing administrative \nsettings. \nIMPORTANT: While this recommendation allows exceptions to specific Users or \nGroups, they should be very carefully tracked and reviewed for necessity on a regular \ninterval through an Access Review process. It is important that this rule be built to \ninclude \"All Users\" to ensure that all users not specifically excepted will be required to \nuse MFA to access Admin Portals. \nImpact: \nConditional Access policies require Microsoft Entra ID P1 or P2 licenses. Similarly, they \nmay require additional overhead to maintain if users lose access to their MFA. Any \nusers or groups which are granted an exception to this policy should be carefully \ntracked, be granted only minimal necessary privileges, and conditional access \nexceptions should be reviewed or investigated.",
        "Audit": "From Azure Portal \n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected.",
        "Audit Steps": {
            "From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected."
        },
        "Remediation": "From Azure Portal \n1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. Click Security in the Entra ID blade. \n3. Click Conditional Access in the Security blade. \n4. Click Policies in the Conditional Access blade. \n5. Click + New policy. \n6. Enter a name for the policy. \n7. Click the blue text under Users. \n8. Under Include, select All users. \n9. Under Exclude, check Users and groups. \n10. \nSelect users or groups to be exempted from this policy (e.g. break-glass \nemergency accounts, and non-interactive service accounts) then click the Select \nbutton. \n11. \nClick the blue text under Target Resources. \n12. \nUnder Include, click the Select apps radio button. \n13. \nClick the blue text under Select. \n14. \nCheck the box next to Microsoft Admin Portals then click the Select button. \n15. \nClick the blue text under Grant. \n16. \nUnder Grant access check the box for Require multifactor authentication \nthen click the Select button. \n17. \nBefore creating, set Enable policy to Report-only. \n18. \nClick Create. \nAfter testing the policy in report-only mode, update the Enable policy setting from \nReport-only to On.",
        "Remediation Steps": {
            "From Azure Portal": "1. From the Azure Admin Portal dashboard, open Microsoft Entra ID. \n2. In the menu on the left of the Entra ID blade, click Security. \n3. In the menu on the left of the Security blade, click Conditional Access. \n4. In the menu on the left of the Conditional Access blade, click Policies. \n5. Click on the name of the policy you wish to audit. \n6. Click the blue text under Users. \n7. Under the Include section of Users, review Users and Groups to ensure that All \nUsers is selected."
        },
        "Default Value": "MFA is not enabled by default for administrative actions.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.5 Require MFA for Administrative Access \n \nRequire MFA for all administrative access accounts where supported on all \nenterprise assets whether managed on-site or through a third-party provider. \n \n \n \nv7 \n4.5 Use Multifactor Authentication For All Administrative \nAccess \n \nUse multi-factor authentication and encrypted channels for all administrative \naccount access. \n \n \n "
    },
    {
        "Rule": "1.3 Ensure that 'Restrict non-admin users from creating tenants' is \nset to 'Yes' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Require administrators or appropriately delegated users to create new tenants.",
        "Rationale": "It is recommended to only allow an administrator to create new tenants. This prevent \nusers from creating new Microsoft Entra ID or Azure AD B2C tenants and ensures that \nonly authorized users are able to do so. \nImpact: \nEnforcing this setting will ensure that only authorized users are able to create new \ntenants.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Restrict non-admin users from creating tenants is set to Yes \nFrom PowerShell \nImport-Module Microsoft.Graph.Identity.SignIns  \nConnect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'  \nGet-MgPolicyAuthorizationPolicy | Select-Object -ExpandProperty \nDefaultUserRolePermissions | Format-List \nReview the \"DefaultUserRolePermissions\" section of the output. Ensure that \nAllowedToCreateTenants is not \"True\".",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Restrict non-admin users from creating tenants is set to Yes \nFrom PowerShell \nImport-Module Microsoft.Graph.Identity.SignIns  \nConnect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'  \nGet-MgPolicyAuthorizationPolicy | Select-Object -ExpandProperty \nDefaultUserRolePermissions | Format-List \nReview the \"DefaultUserRolePermissions\" section of the output. Ensure that \nAllowedToCreateTenants is not \"True\"."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Restrict non-admin users from creating tenants is set to Yes \nFrom PowerShell \nImport-Module Microsoft.Graph.Identity.SignIns  \nConnect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'  \nGet-MgPolicyAuthorizationPolicy | Select-Object -ExpandProperty \nDefaultUserRolePermissions | Format-List \nReview the \"DefaultUserRolePermissions\" section of the output. Ensure that \nAllowedToCreateTenants is not \"True\"."
        },
        "Default Value": "MFA is not enabled by default for administrative actions.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.5 Require MFA for Administrative Access \n \nRequire MFA for all administrative access accounts where supported on all \nenterprise assets whether managed on-site or through a third-party provider. \n \n \n \nv7 \n4.5 Use Multifactor Authentication For All Administrative \nAccess \n \nUse multi-factor authentication and encrypted channels for all administrative \naccount access. \n \n \n "
    },
    {
        "Rule": "1.4 Ensure Guest Users Are Reviewed on a Regular Basis \n(Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Microsoft Entra ID is extended to include Azure AD B2B collaboration, allowing you to \ninvite people from outside your organization to be guest users in your cloud account and \nsign in with their own work, school, or social identities. Guest users allow you to share \nyour company's applications and services with users from any other organization, while \nmaintaining control over your own corporate data. \nWork with external partners, large or small, even if they don't have Azure AD or an IT \ndepartment. A simple invitation and redemption process lets partners use their own \ncredentials to access your company's resources as a guest user. \nGuest users in every subscription should be review on a regular basis to ensure that \ninactive and unneeded accounts are removed.",
        "Rationale": "Guest users in the Microsoft Entra ID are generally required for collaboration purposes \nin Office 365, and may also be required for Azure functions in enterprises with multiple \nAzure tenants. Guest users are typically added outside your employee on-boarding/off-\nboarding process and could potentially be overlooked indefinitely, leading to a potential \nvulnerability. To prevent this, guest users should be reviewed on a regular basis. During \nthis audit, guest users should also be determined to not have administrative privileges. \nImpact: \nBefore removing guest users, determine their use and scope. Like removing any user, \nthere may be unforeseen consequences to systems if it is deleted.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click on Add filter \n5. Select User type \n6. Select Guest from the Value dropdown \n7. Click Apply \n8. Audit the listed guest users",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click on Add filter \n5. Select User type \n6. Select Guest from the Value dropdown \n7. Click Apply \n8. Audit the listed guest users"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click on Add filter \n5. Select User type \n6. Select Guest from the Value dropdown \n7. Click Apply \n8. Delete all Guest users that are no longer required or are inactive \nFrom Azure CLI \nBefore deleting the user, set it to inactive using the ID from the Audit Procedure to \ndetermine if there are any dependent systems. \naz ad user update --id <exampleaccountid@domain.com> --account-enabled \n{false} \nAfter determining that there are no dependent systems delete the user. \nRemove-AzureADUser -ObjectId <exampleaccountid@domain.com>",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Click on Add filter \n5. Select User type \n6. Select Guest from the Value dropdown \n7. Click Apply \n8. Audit the listed guest users"
        },
        "Default Value": "",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "1.5 Ensure That 'Number of methods required to reset' is set to '2' \n(Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Ensures that two alternate forms of identification are provided before allowing a \npassword reset.",
        "Rationale": "A Self-service Password Reset (SSPR) through Azure Multi-factor Authentication (MFA) \nensures the user's identity is confirmed using two separate methods of identification. \nWith multiple methods set, an attacker would have to compromise both methods before \nthey could maliciously reset a user's password. \nImpact: \nThere may be administrative overhead, as users who lose access to their secondary \nauthentication methods will need an administrator with permissions to remove it. There \nwill also need to be organization-wide security policies and training to teach \nadministrators to verify the identity of the requesting user so that social engineering can \nnot render this setting useless.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Authentication methods \n6. Ensure that Number of methods required to reset is set to 2",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Authentication methods \n6. Ensure that Number of methods required to reset is set to 2"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Authentication methods \n6. Set the Number of methods required to reset to 2",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Authentication methods \n6. Ensure that Number of methods required to reset is set to 2"
        },
        "Default Value": "By default no guest users are created. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/b2b/user-properties \n2. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/add-users-\nazure-active-directory#delete-a-user \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-4-review-and-reconcile-user-access-regularly \n4. https://www.microsoft.com/en-us/security/business/identity-access-\nmanagement/azure-ad-pricing \n5. https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-\nmanage-inactive-user-accounts \n6. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-\ndirectory-users-restore \nAdditional Information: \nIt is good practice to use a dynamic security group to manage guest users. \nTo create the dynamic security group: \n1. Navigate to the 'Microsoft Entra ID' blade in the Azure Portal \n2. Select the 'Groups' item \n3. Create new \n4. Type of 'dynamic' \n5. Use the following dynamic selection rule. \"(user.userType -eq \"Guest\")\" \n6. Once the group has been created, select access reviews option and create a \nnew access review with a period of monthly and send to relevant administrators \nfor review.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.1 Establish and Maintain an Inventory of Accounts \n \nEstablish and maintain an inventory of all accounts managed in the enterprise. \nThe inventory must include both user and administrator accounts. The inventory at \na minimum should contain the person s name username start stop dates and \ndepartment. Validate that all active accounts are authorized on a recurring \nschedule at a minimum quarterly or more frequently. \n \n \n \nv8 \n5.3 Disable Dormant Accounts \n \nDelete or disable any dormant accounts after a period of 45 days of inactivity \nwhere supported. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n16.6 Maintain an Inventory of Accounts \n \nMaintain an inventory of all accounts organized by authentication system. \n \n \n \nv7 \n16.8 Disable Any Unassociated Accounts \n \nDisable any account that cannot be associated with a business process or \nbusiness owner. \n \n \n "
    },
    {
        "Rule": "1.6 Ensure that a Custom Bad Password List is set to 'Enforce' for \nyour Organization (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Microsoft Azure provides a Global Banned Password policy that applies to Azure \nadministrative and normal user accounts. This is not applied to user accounts that are \nsynced from an on-premise Active Directory unless Microsoft Entra ID Connect is used \nand you enable EnforceCloudPasswordPolicyForPasswordSyncedUsers. Please see \nthe list in default values on the specifics of this policy. To further password security, it is \nrecommended to further define a custom banned password policy.",
        "Rationale": "Enabling this gives your organization further customization on what secure passwords \nare allowed. Setting a bad password list enables your organization to fine-tune its \npassword policy further, depending on your needs. Removing easy-to-guess passwords \nincreases the security of access to your Azure resources. \nImpact: \nIncreasing needed password complexity might increase overhead on administration of \nuser accounts. Licensing requirement for Global Banned Password List and Custom \nBanned Password list requires Microsoft Entra ID P1 or P2. On-premises Active \nDirectory Domain Services users that are not synchronized to Microsoft Entra ID also \nbenefit from Microsoft Entra ID Password Protection based on existing licensing for \nsynchronized users.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID. \n3. Select 'Security'. \n4. Under Manage, select Authentication Methods. \n5. Select Password Protection. \n6. Ensure Enforce custom list is set to Yes. \n7. Scroll through the list to view the enforced passwords.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID. \n3. Select 'Security'. \n4. Under Manage, select Authentication Methods. \n5. Select Password Protection. \n6. Ensure Enforce custom list is set to Yes. \n7. Scroll through the list to view the enforced passwords."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Security. \n4. Under Manage, select Authentication Methods. \n5. Select Password Protection. \n6. Set the Enforce custom list option to Yes. \n7. Double click the custom banned password list to add a string.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID. \n3. Select 'Security'. \n4. Under Manage, select Authentication Methods. \n5. Select Password Protection. \n6. Ensure Enforce custom list is set to Yes. \n7. Scroll through the list to view the enforced passwords."
        },
        "Default Value": "By default the custom bad password list is not 'Enabled'. Organizational-specific terms \ncan be added to the custom banned password list, such as the following examples: \n\u2022 \nBrand names \n\u2022 \nProduct names \n\u2022 \nLocations, such as company headquarters \n\u2022 \nCompany-specific internal terms \n\u2022 \nAbbreviations that have specific company meaning \n\u2022 \nMonths and weekdays with your company's local languages \nThe default Azure bad password policy is already applied to your resources which \napplies the following basic requirements: \nCharacters allowed: \n\u2022 \nUppercase characters (A - Z) \n\u2022 \nLowercase characters (a - z) \n\u2022 \nNumbers (0 - 9) \n\u2022 \nSymbols: \n\u2022 \n@ # $ % ^ & * - _ ! + = [ ] { } | \\ : ' , . ? / ` ~ \" ( ) ; < > \n\u2022 \nblank space \nCharacters not allowed: \n\u2022 \nUnicode characters \n\u2022 \nPassword length Passwords require \n\u2022 \nA minimum of eight characters \n\u2022 \nA maximum of 256 characters \nPassword complexity: Passwords require three out of four of the following categories: \n\u2022 \nUppercase characters \n\u2022 \nLowercase characters",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.7 Ensure that 'Number of days before users are asked to re-\nconfirm their authentication information' is not set to '0' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that the number of days before users are asked to re-confirm their \nauthentication information is not set to 0.",
        "Rationale": "This setting is necessary if you have setup 'Require users to register when signing in \noption'. If authentication re-confirmation is disabled, registered users will never be \nprompted to re-confirm their existing authentication information. If the authentication \ninformation for a user changes, such as a phone number or email, then the password \nreset information for that user reverts to the previously registered authentication \ninformation. \nImpact: \nUsers will be prompted for their multifactor authentication at the duration set here.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Registration \n6. Ensure that Number of days before users are asked to re-confirm their \nauthentication information is not set to 0",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Registration \n6. Ensure that Number of days before users are asked to re-confirm their \nauthentication information is not set to 0"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Registration \n6. Set the Number of days before users are asked to re-confirm their \nauthentication information to your organization-defined frequency.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select Password reset \n5. Then Registration \n6. Ensure that Number of days before users are asked to re-confirm their \nauthentication information is not set to 0"
        },
        "Default Value": "By default the custom bad password list is not 'Enabled'. Organizational-specific terms \ncan be added to the custom banned password list, such as the following examples: \n\u2022 \nBrand names \n\u2022 \nProduct names \n\u2022 \nLocations, such as company headquarters \n\u2022 \nCompany-specific internal terms \n\u2022 \nAbbreviations that have specific company meaning \n\u2022 \nMonths and weekdays with your company's local languages \nThe default Azure bad password policy is already applied to your resources which \napplies the following basic requirements: \nCharacters allowed: \n\u2022 \nUppercase characters (A - Z) \n\u2022 \nLowercase characters (a - z) \n\u2022 \nNumbers (0 - 9) \n\u2022 \nSymbols: \n\u2022 \n@ # $ % ^ & * - _ ! + = [ ] { } | \\ : ' , . ? / ` ~ \" ( ) ; < > \n\u2022 \nblank space \nCharacters not allowed: \n\u2022 \nUnicode characters \n\u2022 \nPassword length Passwords require \n\u2022 \nA minimum of eight characters \n\u2022 \nA maximum of 256 characters \nPassword complexity: Passwords require three out of four of the following categories: \n\u2022 \nUppercase characters \n\u2022 \nLowercase characters",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.2 Use Unique Passwords \n \nUse unique passwords for all enterprise assets. Best practice implementation \nincludes at a minimum an 8-character password for accounts using MFA and a \n14-character password for accounts not using MFA. \n \n \n \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service \nor SSO provider where supported. \n \n \n \nv7 \n4.4 Use Unique Passwords \n \nWhere multi-factor authentication is not supported such as local administrator \nroot or service accounts accounts will use passwords that are unique to that \nsystem. \n \n \n "
    },
    {
        "Rule": "1.8 Ensure that 'Notify users on password resets?' is set to 'Yes' \n(Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that users are notified on their primary and secondary emails on password \nresets.",
        "Rationale": "User notification on password reset is a proactive way of confirming password reset \nactivity. It helps the user to recognize unauthorized password reset activities. \nImpact: \nUsers will receive emails alerting them to password changes to both their primary and \nsecondary emails.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Go to Password reset \n5. Under Manage, select Notifications \n6. Ensure that Notify users on password resets? is set to Yes",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Go to Password reset \n5. Under Manage, select Notifications \n6. Ensure that Notify users on password resets? is set to Yes"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select Password reset \n5. Under Manage, select Notifications \n6. Set Notify users on password resets? to Yes",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Go to Password reset \n5. Under Manage, select Notifications \n6. Ensure that Notify users on password resets? is set to Yes"
        },
        "Default Value": "By default, Notify users on password resets? is set to \"Yes\".",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.10 Ensure All Accounts Have An Expiration Date \n \nEnsure that all accounts have an expiration date that is monitored and \nenforced. \n \n \n "
    },
    {
        "Rule": "1.9 Ensure That 'Notify all admins when other admins reset their \npassword?' is set to 'Yes' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that all Global Administrators are notified if any other administrator resets their \npassword.",
        "Rationale": "Global Administrator accounts are sensitive. Any password reset activity notification, \nwhen sent to all Global Administrators, ensures that all Global administrators can \npassively confirm if such a reset is a common pattern within their group. For example, if \nall Global Administrators change their password every 30 days, any password reset \nactivity before that may require administrator(s) to evaluate any unusual activity and \nconfirm its origin. \nImpact: \nAll Global Administrators will receive a notification from Azure every time a password is \nreset. This is useful for auditing procedures to confirm that there are no out of the \nordinary password resets for Global Administrators. There is additional overhead, \nhowever, in the time required for Global Administrators to audit the notifications. This \nsetting is only useful if all Global Administrators pay attention to the notifications, and \naudit each one.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select Password reset \n5. Under Manage, select Notifications \n6. Ensure that notify all admins when other admins reset their password? is \nset to Yes",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select Password reset \n5. Under Manage, select Notifications \n6. Ensure that notify all admins when other admins reset their password? is \nset to Yes"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select Password reset \n5. Under Manage, select Notifications \n6. Ensure that notify all admins when other admins reset their password? is \nset to Yes"
        },
        "Default Value": "By default, Notify users on password resets? is set to \"Yes\".",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service \nor SSO provider where supported. \n \n \n \nv7 \n16.2 Configure Centralized Point of Authentication \n \nConfigure access for all accounts through as few centralized points of \nauthentication as possible including network security and cloud systems. \n \n \n "
    },
    {
        "Rule": "1.10 Ensure `User consent for applications` is set to `Do not allow \nuser consent` (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Require administrators to provide consent for applications before use.",
        "Rationale": "If Microsoft Entra ID is running as an identity provider for third-party applications, \npermissions and consent should be limited to administrators or pre-approved. Malicious \napplications may attempt to exfiltrate data or abuse privileged user accounts. \nImpact: \nEnforcing this setting may create additional requests that administrators need to review.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Ensure User consent for applications is set to Do not allow user consent \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Ensure User consent for applications is set to Do not allow user consent \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Ensure User consent for applications is set to Do not allow user consent \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse"
        },
        "Default Value": "By default, Notify all admins when other admins reset their password? is set to \n\"No\". \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/active-directory-\npasswords-how-it-works#notifications \n2. https://docs.microsoft.com/en-us/azure/active-directory/authentication/howto-\nsspr-deployment \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n5. https://docs.microsoft.com/en-us/azure/active-directory/authentication/tutorial-\nenable-sspr#set-up-notifications-and-customizations",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.4 Restrict Administrator Privileges to Dedicated \nAdministrator Accounts \n \nRestrict administrator privileges to dedicated administrator accounts on \nenterprise assets. Conduct general computing activities such as internet \nbrowsing email and productivity suite use from the user s primary non-privileged \naccount. \n \n \n \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service or \nSSO provider where supported. \n \n \n \nv7 \n4.8 Log and Alert on Changes to Administrative Group \nMembership \n \nConfigure systems to issue a log entry and alert when an account is added to \nor removed from any group assigned administrative privileges. \n \n \n "
    },
    {
        "Rule": "1.11 Ensure \u2018User consent for applications\u2019 Is Set To \u2018Allow for \nVerified Publishers\u2019 (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Allow users to provide consent for selected permissions when a request is coming from \na verified publisher.",
        "Rationale": "If Microsoft Entra ID is running as an identity provider for third-party applications, \npermissions and consent should be limited to administrators or pre-approved. Malicious \napplications may attempt to exfiltrate data or abuse privileged user accounts. \nImpact: \nEnforcing this setting may create additional requests that administrators need to review.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Under User consent for applications, ensure Allow user consent for apps \nfrom verified publishers, for selected permissions is selected \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Under User consent for applications, ensure Allow user consent for apps \nfrom verified publishers, for selected permissions is selected \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Enterprise Applications \n4. Select Consent and permissions \n5. Select User consent settings \n6. Under User consent for applications, ensure Allow user consent for apps \nfrom verified publishers, for selected permissions is selected \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToUserConsentToAppEnabled \nCommand should return UsersPermissionToUserConsentToAppEnabled with the value of \nFalse"
        },
        "Default Value": "By default, Users consent for applications is set to Allow user consent for apps. \nReferences: \n1. https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-\nPermissions-in-Azure-Active-Directory.aspx \n2. https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/configure-\nuser-consent#configure-user-consent-to-applications \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-\nduties-strategy \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.3 Address Unauthorized Software \n \nEnsure that unauthorized software is either removed from use on enterprise \nassets or receives a documented exception. Review monthly or more \nfrequently. \n \n \n \nv8 \n6.1 Establish an Access Granting Process \n \nEstablish and follow a process preferably automated for granting access to \nenterprise assets upon new hire rights grant or role change of a user. \n \n \n \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service \nor SSO provider where supported. \n \n \n \nv7 \n2.6 Address unapproved software \n \nEnsure that unauthorized software is either removed or the inventory is \nupdated in a timely manner \n \n \n "
    },
    {
        "Rule": "1.12 Ensure that 'Users can add gallery apps to My Apps' is set to \n'No' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Require administrators to provide consent for the apps before use.",
        "Rationale": "Unless Microsoft Entra ID is running as an identity provider for third-party applications, \ndo not allow users to use their identity outside of your cloud environment. User profiles \ncontain private information such as phone numbers and email addresses which could \nthen be sold off to other third parties without requiring any further consent from the user. \nImpact: \nCan cause additional requests to administrators that need to be fulfilled quite often.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Enterprise applications \n4. Select User settings \n5. Ensure that Users can add gallery apps to My Apps is set to No",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Enterprise applications \n4. Select User settings \n5. Ensure that Users can add gallery apps to My Apps is set to No"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Enterprise applications \n4. Select User settings \n5. Set Users can add gallery apps to My Apps to No",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Enterprise applications \n4. Select User settings \n5. Ensure that Users can add gallery apps to My Apps is set to No"
        },
        "Default Value": "By default, Users can add gallery apps to My Apps is set to No.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.3 Address Unauthorized Software \n \nEnsure that unauthorized software is either removed from use on enterprise \nassets or receives a documented exception. Review monthly or more frequently. \n \n \n \nv8 \n2.5 Allowlist Authorized Software \n \nUse technical controls such as application allowlisting to ensure that only \nauthorized software can execute or be accessed. Reassess bi-annually or more \nfrequently. \n \n \n \nv8 \n6.1 Establish an Access Granting Process \n \nEstablish and follow a process preferably automated for granting access to \nenterprise assets upon new hire rights grant or role change of a user. \n \n \n "
    },
    {
        "Rule": "1.13 Ensure That \u2018Users Can Register Applications\u2019 Is Set to \u2018No\u2019 \n(Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Require administrators or appropriately delegated users to register third-party \napplications.",
        "Rationale": "It is recommended to only allow an administrator to register custom-developed \napplications. This ensures that the application undergoes a formal security review and \napproval process prior to exposing Microsoft Entra ID data. Certain users like \ndevelopers or other high-request users may also be delegated permissions to prevent \nthem from waiting on an administrative user. Your organization should review your \npolicies and decide your needs. \nImpact: \nEnforcing this setting will create additional requests for approval that will need to be \naddressed by an administrator. If permissions are delegated, a user may approve a \nmalevolent third party application, potentially giving it access to your data.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Users can register applications is set to No \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToCreateLOBAppsEnabled \nCommand should return UsersPermissionToCreateLOBAppsEnabled with the value of \nFalse",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Users can register applications is set to No \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToCreateLOBAppsEnabled \nCommand should return UsersPermissionToCreateLOBAppsEnabled with the value of \nFalse"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Set Users can register applications to No \nFrom PowerShell \nConnect-MsolService \nSet-MsolCompanyInformation -UsersPermissionToCreateLOBAppsEnabled $False",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Users \n4. Select User settings \n5. Ensure that Users can register applications is set to No \nFrom PowerShell \nConnect-MsolService \nGet-MsolCompanyInformation | Select-Object \nUsersPermissionToCreateLOBAppsEnabled \nCommand should return UsersPermissionToCreateLOBAppsEnabled with the value of \nFalse"
        },
        "Default Value": "By default, Users can register applications is set to \"Yes\". \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/roles/delegate-app-\nroles#restrict-who-can-create-applications \n2. https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-\nhow-applications-are-added#who-has-permission-to-add-applications-to-my-\nazure-ad-instance \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n5. https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-\nconsent-for-applications-using-office-365-apis/ \n6. https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-\nPermissions-in-Azure-Active-Directory.aspx \n7. https://docs.microsoft.com/en-us/powershell/module/msonline/get-\nmsolcompanyinformation?view=azureadps-1.0 \n8. https://docs.microsoft.com/en-us/powershell/module/msonline/set-\nmsolcompanysettings?view=azureadps-1.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.3 Address Unauthorized Software \n \nEnsure that unauthorized software is either removed from use on enterprise \nassets or receives a documented exception. Review monthly or more \nfrequently. \n \n \n "
    },
    {
        "Rule": "1.14 Ensure That 'Guest users access restrictions' is set to 'Guest \nuser access is restricted to properties and memberships of their \nown directory objects' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Limit guest user permissions.",
        "Rationale": "Limiting guest access ensures that guest accounts do not have permission for certain \ndirectory tasks, such as enumerating users, groups or other directory resources, and \ncannot be assigned to administrative roles in your directory. Guest access has three \nlevels of restriction. \n1. Guest users have the same access as members (most inclusive), \n2. Guest users have limited access to properties and memberships of directory \nobjects (default value), \n3. Guest user access is restricted to properties and memberships of their own \ndirectory objects (most restrictive). \nThe recommended option is the 3rd, most restrictive: \"Guest user access is restricted to \ntheir own directory object\". \nImpact: \nThis may create additional requests for permissions to access resources that \nadministrators will need to approve. \nAccording to https://learn.microsoft.com/en-us/azure/active-directory/enterprise-\nusers/users-restrict-guest-permissions#services-currently-not-supported \nService without current support might have compatibility issues with the new guest \nrestriction setting. \n\u2022 \nForms \n\u2022 \nProject \n\u2022 \nYammer \n\u2022 \nPlanner in SharePoint",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest user access, ensure that Guest user access restrictions is set \nto Guest user access is restricted to properties and memberships of \ntheir own directory objects \nFrom PowerShell \n1. Enter the following Get-AzureADMSAuthorizationPolicy \nWhich will give a result like: \nId                                                : authorizationPolicy \nOdataType                                         : \nDescription                                       : Used to manage \nauthorization related settings across the company. \nDisplayName                                       : Authorization Policy \nEnabledPreviewFeatures                            : {} \nGuestUserRoleId                                   : 10dae51f-b6af-4016-8d66-\n8c2a99b929b3 \nPermissionGrantPolicyIdsAssignedToDefaultUserRole : {user-default-legacy} \nIf the GuestUserRoleID property does not equal 2af84b1e-32c8-42b7-82bc-\ndaa82404023b then it is not set to most restrictive.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest user access, ensure that Guest user access restrictions is set \nto Guest user access is restricted to properties and memberships of \ntheir own directory objects \nFrom PowerShell \n1. Enter the following Get-AzureADMSAuthorizationPolicy \nWhich will give a result like: \nId                                                : authorizationPolicy \nOdataType                                         : \nDescription                                       : Used to manage \nauthorization related settings across the company. \nDisplayName                                       : Authorization Policy \nEnabledPreviewFeatures                            : {} \nGuestUserRoleId                                   : 10dae51f-b6af-4016-8d66-\n8c2a99b929b3 \nPermissionGrantPolicyIdsAssignedToDefaultUserRole : {user-default-legacy} \nIf the GuestUserRoleID property does not equal 2af84b1e-32c8-42b7-82bc-\ndaa82404023b then it is not set to most restrictive."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest user access, change Guest user access restrictions to be Guest \nuser access is restricted to properties and memberships of their own \ndirectory objects \nFrom PowerShell \n1. From a PowerShell session enter Set-AzureADMSAuthorizationPolicy -\nGuestUserRoleId '2af84b1e-32c8-42b7-82bc-daa82404023b' \n2. Check that the setting was applied by entering Get-\nAzureADMSAuthorizationPolicy \n3. Make certain that the GuestUserRoleId is equal to the earlier entered value of \n2af84b1e-32c8-42b7-82bc-daa82404023b.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest user access, ensure that Guest user access restrictions is set \nto Guest user access is restricted to properties and memberships of \ntheir own directory objects \nFrom PowerShell \n1. Enter the following Get-AzureADMSAuthorizationPolicy \nWhich will give a result like: \nId                                                : authorizationPolicy \nOdataType                                         : \nDescription                                       : Used to manage \nauthorization related settings across the company. \nDisplayName                                       : Authorization Policy \nEnabledPreviewFeatures                            : {} \nGuestUserRoleId                                   : 10dae51f-b6af-4016-8d66-\n8c2a99b929b3 \nPermissionGrantPolicyIdsAssignedToDefaultUserRole : {user-default-legacy} \nIf the GuestUserRoleID property does not equal 2af84b1e-32c8-42b7-82bc-\ndaa82404023b then it is not set to most restrictive."
        },
        "Default Value": "By default, Users can register applications is set to \"Yes\". \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/roles/delegate-app-\nroles#restrict-who-can-create-applications \n2. https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-\nhow-applications-are-added#who-has-permission-to-add-applications-to-my-\nazure-ad-instance \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n5. https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-\nconsent-for-applications-using-office-365-apis/ \n6. https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-\nPermissions-in-Azure-Active-Directory.aspx \n7. https://docs.microsoft.com/en-us/powershell/module/msonline/get-\nmsolcompanyinformation?view=azureadps-1.0 \n8. https://docs.microsoft.com/en-us/powershell/module/msonline/set-\nmsolcompanysettings?view=azureadps-1.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.3 Address Unauthorized Software \n \nEnsure that unauthorized software is either removed from use on enterprise \nassets or receives a documented exception. Review monthly or more \nfrequently. \n \n \n "
    },
    {
        "Rule": "1.15 Ensure that 'Guest invite restrictions' is set to \"Only users \nassigned to specific admin roles can invite guest users\" (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Restrict invitations to users with specific administrative roles only.",
        "Rationale": "Restricting invitations to users with specific administrator roles ensures that only \nauthorized accounts have access to cloud resources. This helps to maintain \"Need to \nKnow\" permissions and prevents inadvertent access to data. \nBy default the setting Guest invite restrictions is set to Anyone in the \norganization can invite guest users including guests and non-admins. This would \nallow anyone within the organization to invite guests and non-admins to the tenant, \nposing a security risk. \nImpact: \nWith the option of Only users assigned to specific admin roles can invite guest \nusers selected, users with specific admin roles will be in charge of sending invitations to \nthe external users, requiring additional overhead by them to manage user accounts. \nThis will mean coordinating with other departments as they are onboarding new users.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4.  \nExternal collaboration settings \n5. Under Guest invite settings, for Guest invite restrictions, ensure that that \nOnly users assigned to specific admin roles can invite guest users is \nselected \nNote: This setting has 4 levels of restriction, which include: \n\u2022 \nAnyone in the organization can invite guest users including guests and non-\nadmins (most inclusive), \n\u2022 \nMember users and users assigned to specific admin roles can invite guest users \nincluding guests with member permissions,",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4.  \nExternal collaboration settings \n5. Under Guest invite settings, for Guest invite restrictions, ensure that that \nOnly users assigned to specific admin roles can invite guest users is \nselected \nNote: This setting has 4 levels of restriction, which include: \n\u2022 \nAnyone in the organization can invite guest users including guests and non-\nadmins (most inclusive), \n\u2022 \nMember users and users assigned to specific admin roles can invite guest users \nincluding guests with member permissions,"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4. Select External collaboration settings \n5. Under Guest invite settings, for Guest invite restrictions, ensure that Only \nusers assigned to specific admin roles can invite guest users is selected",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then External Identities \n4.  \nExternal collaboration settings \n5. Under Guest invite settings, for Guest invite restrictions, ensure that that \nOnly users assigned to specific admin roles can invite guest users is \nselected \nNote: This setting has 4 levels of restriction, which include: \n\u2022 \nAnyone in the organization can invite guest users including guests and non-\nadmins (most inclusive), \n\u2022 \nMember users and users assigned to specific admin roles can invite guest users \nincluding guests with member permissions,"
        },
        "Default Value": "By default, Guest invite restrictions is set to Anyone in the organization can \ninvite guest users including guests and non-admins \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/active-directory-b2b-\ndelegate-invitations \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-\nduties-strategy \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-3-manage-lifecycle-of-identities-and-entitlements",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.1 Establish an Access Granting Process \n \nEstablish and follow a process preferably automated for granting access to \nenterprise assets upon new hire rights grant or role change of a user. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n "
    },
    {
        "Rule": "1.16 Ensure That 'Restrict access to Microsoft Entra admin \ncenter' is Set to 'Yes' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Restrict access to the Microsoft Entra ID administration center to administrators only. \nNOTE: This only affects access to the Entra ID administrator's web portal. This setting \ndoes not prohibit privileged users from using other methods such as Rest API or \nPowershell to obtain sensitive information from Microsoft Entra ID.",
        "Rationale": "The Microsoft Entra ID administrative center has sensitive data and permission settings. \nAll non-administrators should be prohibited from accessing any Microsoft Entra ID data \nin the administration center to avoid exposure. \nImpact: \nAll administrative tasks will need to be done by Administrators, causing additional \noverhead in management of users and resources.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select User settings \n5. Ensure that Restrict access to Microsoft Entra admin center is set to Yes",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select User settings \n5. Ensure that Restrict access to Microsoft Entra admin center is set to Yes"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select User settings \n5. Set Restrict access to Microsoft Entra admin center to Yes",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Users \n4. Select User settings \n5. Ensure that Restrict access to Microsoft Entra admin center is set to Yes"
        },
        "Default Value": "By default, Restrict access to Microsoft Entra admin center is set to No",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.1 Establish an Access Granting Process \n \nEstablish and follow a process preferably automated for granting access to \nenterprise assets upon new hire rights grant or role change of a user. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n "
    },
    {
        "Rule": "1.17 Ensure that 'Restrict user ability to access groups features in \nthe Access Pane' is Set to 'Yes' (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Restrict access to group web interface in the Access Panel portal.",
        "Rationale": "Self-service group management enables users to create and manage security groups or \nOffice 365 groups in Microsoft Entra ID. Unless a business requires this day-to-day \ndelegation for some users, self-service group management should be disabled. Any \nuser can access the Access Panel, where they can reset their passwords, view their \ninformation, etc. By default, users are also allowed to access the Group feature, which \nshows groups, members, related resources (SharePoint URL, Group email address, \nYammer URL, and Teams URL). By setting this feature to 'Yes', users will no longer \nhave access to the web interface, but still have access to the data using the API. This is \nuseful to prevent non-technical users from enumerating groups-related information, but \ntechnical users will still be able to access this information using APIs. \nImpact: \nSetting to Yes could create administrative overhead by customers seeking certain group \nmemberships that will have to be manually managed by administrators with appropriate \npermissions.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Restrict user ability to access groups features in My Groups \nis set to Yes",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Restrict user ability to access groups features in My Groups \nis set to Yes"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Restrict user ability to access groups features in My Groups \nis set to Yes"
        },
        "Default Value": "By default, Restrict access to Microsoft Entra admin center is set to No",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.4 Restrict Administrator Privileges to Dedicated \nAdministrator Accounts \n \nRestrict administrator privileges to dedicated administrator accounts on \nenterprise assets. Conduct general computing activities such as internet browsing \nemail and productivity suite use from the user s primary non-privileged account. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n4.3 Ensure the Use of Dedicated Administrative Accounts \n \nEnsure that all users with administrative account access use a dedicated or \nsecondary account for elevated activities. This account should only be used for \nadministrative activities and not internet browsing email or similar activities. \n \n \n "
    },
    {
        "Rule": "1.18 Ensure that 'Users can create security groups in Azure \nportals, API or PowerShell' is set to 'No' (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Restrict security group creation to administrators only.",
        "Rationale": "When creating security groups is enabled, all users in the directory are allowed to \ncreate new security groups and add members to those groups. Unless a business \nrequires this day-to-day delegation, security group creation should be restricted to \nadministrators only. \nImpact: \nEnabling this setting could create a number of requests that would need to be managed \nby an administrator.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Users can create security groups in Azure portals, API or \nPowerShell is set to No",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Users can create security groups in Azure portals, API or \nPowerShell is set to No"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Set Users can create security groups in Azure portals, API or PowerShell \nto No",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Groups \n4. Select General under Settings \n5. Ensure that Users can create security groups in Azure portals, API or \nPowerShell is set to No"
        },
        "Default Value": "By default, Restrict user ability to access groups features in the Access Pane \nis set to No \nReferences: \n1. https://docs.microsoft.com/en-us/azure/active-directory/active-directory-\naccessmanagement-self-service-group-management \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-3-manage-lifecycle-of-identities-and-entitlements \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-\nduties-strategy \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "1.19 Ensure that 'Owners can manage group membership \nrequests in the Access Panel' is set to 'No' (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Restrict security group management to administrators only.",
        "Rationale": "Restricting security group management to administrators only prohibits users from \nmaking changes to security groups. This ensures that security groups are appropriately \nmanaged and their management is not delegated to non-administrators. \nImpact: \nGroup Membership for user accounts will need to be handled by Admins and cause \nadministrative overhead.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Ensure that Owners can manage group membership requests in the Access \nPanel is set to No",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Ensure that Owners can manage group membership requests in the Access \nPanel is set to No"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Set Owners can manage group membership requests in the Access Panel to No",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Ensure that Owners can manage group membership requests in the Access \nPanel is set to No"
        },
        "Default Value": "By default, Owners can manage group membership requests in the Access Panel is \nset to No.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "1.20 Ensure that 'Users can create Microsoft 365 groups in Azure \nportals, API or PowerShell' is set to 'No' (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Restrict Microsoft 365 group creation to administrators only.",
        "Rationale": "Restricting Microsoft 365 group creation to administrators only ensures that creation of \nMicrosoft 365 groups is controlled by the administrator. Appropriate groups should be \ncreated and managed by the administrator and group creation rights should not be \ndelegated to any other user. \nImpact: \nEnabling this setting could create a number of requests that would need to be managed \nby an administrator.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in setting \n5. Ensure that Users can create Microsoft 365 groups in Azure portals, API \nor PowerShell is set to No",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in setting \n5. Ensure that Users can create Microsoft 365 groups in Azure portals, API \nor PowerShell is set to No"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in settings \n5. Set Users can create Microsoft 365 groups in Azure portals, API or \nPowerShell to No",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Then Groups \n4. Select General in setting \n5. Ensure that Users can create Microsoft 365 groups in Azure portals, API \nor PowerShell is set to No"
        },
        "Default Value": "By default, Owners can manage group membership requests in the Access Panel is \nset to No.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "1.21 Ensure that 'Require Multi-Factor Authentication to register \nor join devices with Microsoft Entra ID' is set to 'Yes' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Joining or registering devices to Microsoft Entra ID should require Multi-factor \nauthentication.",
        "Rationale": "Multi-factor authentication is recommended when adding devices to Microsoft Entra ID. \nWhen set to Yes, users who are adding devices from the internet must first use the \nsecond method of authentication before their device is successfully added to the \ndirectory. This ensures that rogue devices are not added to the domain using a \ncompromised user account. Note: Some Microsoft documentation suggests to use \nconditional access policies for joining a domain from certain whitelisted networks or \ndevices. Even with these in place, using Multi-Factor Authentication is still \nrecommended, as it creates a process for review before joining the domain. \nImpact: \nA slight impact of additional overhead, as Administrators will now have to approve every \naccess to the domain.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Devices \n4. Select Device settings \n5. Ensure that Require Multi-Factor Authentication to register or join \ndevices with Microsoft Entra is set to Yes",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Devices \n4. Select Device settings \n5. Ensure that Require Multi-Factor Authentication to register or join \ndevices with Microsoft Entra is set to Yes"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Devices \n4. Select Device settings",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Devices \n4. Select Device settings \n5. Ensure that Require Multi-Factor Authentication to register or join \ndevices with Microsoft Entra is set to Yes"
        },
        "Default Value": "By default, Users can create Microsoft 365 groups in Azure portals, API or \nPowerShell is set to Yes. \nReferences: \n1. https://whitepages.unlimitedviz.com/2017/01/disable-office-365-groups-2/ \n2. https://support.office.com/en-us/article/Control-who-can-create-Office-365-\nGroups-4c46c8cb-17d0-44b5-9776-005fced8e618 \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-\nduties-strategy \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-3-manage-lifecycle-of-identities-and-entitlements",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "1.22 Ensure That No Custom Subscription Administrator Roles \nExist (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "The principle of least privilege should be followed and only necessary privileges should \nbe assigned instead of allowing full administrative access.",
        "Rationale": "Classic subscription admin roles offer basic access management and include Account \nAdministrator, Service Administrator, and Co-Administrators. It is recommended the \nleast necessary permissions be given initially. Permissions can be added as needed by \nthe account holder. This ensures the account holder cannot perform actions which were \nnot intended. \nImpact: \nSubscriptions will need to be handled by Administrators with permissions.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Select Subscriptions. \n3. Select Access control (IAM). \n4. Select Roles. \n5. Click Type and select CustomRole from the drop down menu. \n6. Select View next to a role. \n7. Select JSON. \n8. Check for assignableScopes set to the subscription, and actions set to *. \n9. Repeat steps 6-8 for each custom role. \nFrom Azure CLI \nList custom roles: \naz role definition list --custom-role-only True \nCheck for entries with assignableScope of the subscription, and an action of *",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Subscriptions. \n3. Select Access control (IAM). \n4. Select Roles. \n5. Click Type and select CustomRole from the drop down menu. \n6. Select View next to a role. \n7. Select JSON. \n8. Check for assignableScopes set to the subscription, and actions set to *. \n9. Repeat steps 6-8 for each custom role.",
            "From Azure CLI": "List custom roles: \naz role definition list --custom-role-only True \nCheck for entries with assignableScope of the subscription, and an action of *"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Select Subscriptions. \n3. Select Access control (IAM). \n4. Select Roles. \n5. Click Type and select CustomRole from the drop down menu. \n6. Check the box next to each role which grants subscription administrator \nprivileges. \n7. Select Remove. \n8. Select Yes. \nFrom Azure CLI \nList custom roles: \naz role definition list --custom-role-only True \nCheck for entries with assignableScope of the subscription, and an action of *. \nTo remove a violating role: \naz role definition delete --name <role name> \nNote that any role assignments must be removed before a custom role can be deleted. \nEnsure impact is assessed before deleting a custom role granting subscription \nadministrator privileges.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Subscriptions. \n3. Select Access control (IAM). \n4. Select Roles. \n5. Click Type and select CustomRole from the drop down menu. \n6. Select View next to a role. \n7. Select JSON. \n8. Check for assignableScopes set to the subscription, and actions set to *. \n9. Repeat steps 6-8 for each custom role.",
            "From Azure CLI": "List custom roles: \naz role definition list --custom-role-only True \nCheck for entries with assignableScope of the subscription, and an action of *"
        },
        "Default Value": "By default, no custom owner roles are created.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.3 Require MFA for Externally-Exposed Applications \n \nRequire all externally-exposed enterprise or third-party applications to enforce \nMFA where supported. Enforcing MFA through a directory service or SSO \nprovider is a satisfactory implementation of this Safeguard. \n \n \n \nv8 \n6.4 Require MFA for Remote Network Access \n \nRequire MFA for remote network access. \n \n \n \nv7 \n16.3 Require Multi-factor Authentication \n \nRequire multi-factor authentication for all user accounts on all systems \nwhether managed onsite or by a third-party provider. \n \n \n "
    },
    {
        "Rule": "1.23 Ensure a Custom Role is Assigned Permissions for \nAdministering Resource Locks (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Resource locking is a powerful protection mechanism that can prevent inadvertent \nmodification/deletion of resources within Azure subscriptions/Resource Groups and is a \nrecommended NIST configuration.",
        "Rationale": "Given the resource lock functionality is outside of standard Role Based Access \nControl(RBAC), it would be prudent to create a resource lock administrator role to \nprevent inadvertent unlocking of resources. \nImpact: \nBy adding this role, specific permissions may be granted for managing just resource \nlocks rather than needing to provide the wide Owner or User Access Administrator role, \nreducing the risk of the user being able to do unintentional damage.",
        "Audit": "From Azure Portal \n1. In the Azure portal, open a subscription or resource group where you want to \nview assigned roles. \n2. Select Access control (IAM) \n3. Select Roles \n4. Search for the custom role named <role_name> Ex. from remediation Resource \nLock Administrator \n5. Ensure that the role is assigned to the appropriate users.",
        "Audit Steps": {
            "From Azure Portal": "1. In the Azure portal, open a subscription or resource group where you want to \nview assigned roles. \n2. Select Access control (IAM) \n3. Select Roles \n4. Search for the custom role named <role_name> Ex. from remediation Resource \nLock Administrator \n5. Ensure that the role is assigned to the appropriate users."
        },
        "Remediation": "From Azure Portal \n1. In the Azure portal, open a subscription or resource group where you want the \ncustom role to be assigned. \n2. Select Access control (IAM). \n3. Click Add. \n4. Select Add custom role. \n5. In the Custom Role Name field enter Resource Lock Administrator. \n6. In the Description field enter Can Administer Resource Locks.",
        "Remediation Steps": {
            "From Azure Portal": "1. In the Azure portal, open a subscription or resource group where you want to \nview assigned roles. \n2. Select Access control (IAM) \n3. Select Roles \n4. Search for the custom role named <role_name> Ex. from remediation Resource \nLock Administrator \n5. Ensure that the role is assigned to the appropriate users."
        },
        "Default Value": "By default, no custom owner roles are created.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.4 Restrict Administrator Privileges to Dedicated \nAdministrator Accounts \n \nRestrict administrator privileges to dedicated administrator accounts on \nenterprise assets. Conduct general computing activities such as internet browsing \nemail and productivity suite use from the user s primary non-privileged account. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n4.1 Maintain Inventory of Administrative Accounts \n \nUse automated tools to inventory all administrative accounts including domain \nand local accounts to ensure that only authorized individuals have elevated \nprivileges. \n \n \n "
    },
    {
        "Rule": "1.24 Ensure That `Subscription leaving Microsoft Entra ID \ndirectory` and `Subscription entering Microsoft Entra ID directory` \nIs Set To \u2018Permit No One\u2019 (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Users who are set as subscription owners are able to make administrative changes to \nthe subscriptions and move them into and out of Microsoft Entra ID.",
        "Rationale": "Permissions to move subscriptions in and out of Microsoft Entra ID directory must only \nbe given to appropriate administrative personnel. A subscription that is moved into an \nMicrosoft Entra ID directory may be within a folder to which other users have elevated \npermissions. This prevents loss of data or unapproved changes of the objects within by \npotential bad actors. \nImpact: \nSubscriptions will need to have these settings turned off to be moved.",
        "Audit": "From Azure Portal \n1. From the Azure Portal Home select the portal menu \n2. Select Subscriptions \n3. In the Advanced options drop-down menu, select Manage Policies \n4. Ensure Subscription leaving Microsoft Entra ID directory and \nSubscription entering Microsoft Entra ID directory are set to Permit no \none",
        "Audit Steps": {
            "From Azure Portal": "1. From the Azure Portal Home select the portal menu \n2. Select Subscriptions \n3. In the Advanced options drop-down menu, select Manage Policies \n4. Ensure Subscription leaving Microsoft Entra ID directory and \nSubscription entering Microsoft Entra ID directory are set to Permit no \none"
        },
        "Remediation": "From Azure Portal \n1. From the Azure Portal Home select the portal menu \n2. Select Subscriptions \n3. In the Advanced options drop-down menu, select Manage Policies \n4. Under Subscription leaving Microsoft Entra ID directory and Subscription \nentering Microsoft Entra ID directory select Permit no one",
        "Remediation Steps": {
            "From Azure Portal": "1. From the Azure Portal Home select the portal menu \n2. Select Subscriptions \n3. In the Advanced options drop-down menu, select Manage Policies \n4. Ensure Subscription leaving Microsoft Entra ID directory and \nSubscription entering Microsoft Entra ID directory are set to Permit no \none"
        },
        "Default Value": "",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "1.25 Ensure fewer than 5 users have global administrator \nassignment (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "This recommendation aims to maintain a balance between security and operational \nefficiency by ensuring that a minimum of 2 and a maximum of 4 users are assigned the \nGlobal Administrator role in Microsoft Entra ID. Having at least two Global \nAdministrators ensures redundancy, while limiting the number to four reduces the risk of \nexcessive privileged access.",
        "Rationale": "The Global Administrator role has extensive privileges across all services in Microsoft \nEntra ID. The Global Administrator role should never be used in regular daily activities; \nadministrators should have a regular user account for daily activities, and a separate \naccount for administrative responsibilities. Limiting the number of Global Administrators \nhelps mitigate the risk of unauthorized access, reduces the potential impact of human \nerror, and aligns with the principle of least privilege to reduce the attack surface of an \nAzure tenant. Conversely, having at least two Global Administrators ensures that \nadministrative functions can be performed without interruption in case of unavailability of \na single admin. \nImpact: \nImplementing this recommendation may require changes in administrative workflows or \nthe redistribution of roles and responsibilities. Adequate training and awareness should \nbe provided to all Global Administrators.",
        "Audit": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Entra ID \n3. Select Roles and Administrators \n4. Select Global Administrator \n5. Ensure less than 5 users are actively assigned the role. \n6. Ensure that at least 2 users are actively assigned the role.",
        "Audit Steps": {},
        "Remediation": "If more 4 users are assigned: \n1. Remove Global Administrator role for users which do not or no longer require the \nrole.",
        "Remediation Steps": {},
        "Default Value": "By default Subscription leaving Microsoft Entra ID directory and Subscription \nentering Microsoft Entra ID directory are set to Allow everyone (default) \nReferences: \n1. https://docs.microsoft.com/en-us/azure/cost-management-\nbilling/manage/manage-azure-subscription-policy \n2. https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-\ndirectory-how-subscriptions-associated-directory \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-2-protect-identity-and-authentication-systems",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.4 Restrict Administrator Privileges to Dedicated \nAdministrator Accounts \n \nRestrict administrator privileges to dedicated administrator accounts on \nenterprise assets. Conduct general computing activities such as internet browsing \nemail and productivity suite use from the user s primary non-privileged account. \n \n \n \nv8 \n6.1 Establish an Access Granting Process \n \nEstablish and follow a process preferably automated for granting access to \nenterprise assets upon new hire rights grant or role change of a user. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n4.3 Ensure the Use of Dedicated Administrative Accounts \n \nEnsure that all users with administrative account access use a dedicated or \nsecondary account for elevated activities. This account should only be used for \nadministrative activities and not internet browsing email or similar activities. \n \n \n "
    },
    {
        "Rule": "2.1.1 Ensure That Microsoft Defender for Servers Is Set to 'On' \n(Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for Servers enables threat detection for Servers, \nproviding threat intelligence, anomaly detection, and behavior analytics in the Microsoft \nDefender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for Servers allows for greater defense-in-depth, with threat \ndetection provided by the Microsoft Security Response Center (MSRC). \nImpact: \nTurning on Microsoft Defender for Servers in Microsoft Defender for Cloud incurs an \nadditional cost per resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Servers Status is set to On. \nFrom Azure CLI \nRun the following command: \naz security pricing show -n VirtualMachines --query pricingTier \nIf the tenant is licensed and enabled, the output should indicate Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'VirtualMachines' |Select-Object Name,PricingTier \nIf the tenant is licensed and enabled, the -PricingTier parameter will indicate Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Servers Status is set to On.",
            "From Azure CLI": "Run the following command: \naz security pricing show -n VirtualMachines --query pricingTier \nIf the tenant is licensed and enabled, the output should indicate Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'VirtualMachines' |Select-Object Name,PricingTier \nIf the tenant is licensed and enabled, the -PricingTier parameter will indicate Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Set Server Status to On \n6. Select Save \nFrom Azure CLI \nRun the following command: \naz security pricing create -n VirtualMachines --tier 'standard' \nFrom PowerShell \nRun the following command: \nSet-AzSecurityPricing -Name 'VirtualMachines' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Servers Status is set to On.",
            "From Azure CLI": "Run the following command: \naz security pricing show -n VirtualMachines --query pricingTier \nIf the tenant is licensed and enabled, the output should indicate Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'VirtualMachines' |Select-Object Name,PricingTier \nIf the tenant is licensed and enabled, the -PricingTier parameter will indicate Standard"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-endpoint-\nsecurity#es-1-use-endpoint-detection-and-response-edr",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.1 Establish and Maintain an Inventory of Accounts \n \nEstablish and maintain an inventory of all accounts managed in the enterprise. \nThe inventory must include both user and administrator accounts. The inventory at \na minimum should contain the person s name username start stop dates and \ndepartment. Validate that all active accounts are authorized on a recurring \nschedule at a minimum quarterly or more frequently. \n \n \n \nv7 \n4.1 Maintain Inventory of Administrative Accounts \n \nUse automated tools to inventory all administrative accounts including domain \nand local accounts to ensure that only authorized individuals have elevated \nprivileges. \n \n \n "
    },
    {
        "Rule": "2.1.2 Ensure That Microsoft Defender for App Services Is Set To \n'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for App Service enables threat detection for App Service, \nproviding threat intelligence, anomaly detection, and behavior analytics in the Microsoft \nDefender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for App Service allows for greater defense-in-depth, with \nthreat detection provided by the Microsoft Security Response Center (MSRC). \nImpact: \nTurning on Microsoft Defender for App Service incurs an additional cost per resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Status is On for App Service \nFrom Azure CLI \nRun the following command: \naz security pricing show -n AppServices \nEnsure -PricingTier is set to Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'AppServices' |Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Status is On for App Service",
            "From Azure CLI": "Run the following command: \naz security pricing show -n AppServices \nEnsure -PricingTier is set to Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'AppServices' |Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Set App Service Status to On \n6. Select Save \nFrom Azure CLI \nRun the following command: \naz security pricing create -n Appservices --tier 'standard' \nFrom PowerShell \nRun the following command: \nSet-AzSecurityPricing -Name \"AppServices\" -PricingTier \"Standard\"",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings \n3. Click on the subscription name \n4. Select Defender plans \n5. Ensure Status is On for App Service",
            "From Azure CLI": "Run the following command: \naz security pricing show -n AppServices \nEnsure -PricingTier is set to Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'AppServices' |Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n10.1 Deploy and Maintain Anti-Malware Software \n \nDeploy and maintain anti-malware software on all enterprise assets. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n \nv7 \n8.1 Utilize Centrally Managed Anti-malware Software \n \nUtilize centrally managed anti-malware software to continuously monitor and \ndefend each of the organization s workstations and servers. \n \n \n "
    },
    {
        "Rule": "2.1.3 Ensure That Microsoft Defender for (Managed Instance) \nAzure SQL Databases Is Set To 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for Azure SQL Databases enables threat detection for \nManaged Instance Azure SQL databases, providing threat intelligence, anomaly \ndetection, and behavior analytics in Microsoft Defender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for Azure SQL Databases allows for greater defense-in-\ndepth, includes functionality for discovering and classifying sensitive data, surfacing and \nmitigating potential database vulnerabilities, and detecting anomalous activities that \ncould indicate a threat to your database. \nImpact: \nTurning on Microsoft Defender for Azure SQL Databases incurs an additional cost per \nresource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Azure SQL Databases is set to On. \nFrom Azure CLI \nRun the following command: \naz security pricing show -n SqlServers \nEnsure -PricingTier is set to Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'SqlServers' | Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Azure SQL Databases is set to On.",
            "From Azure CLI": "Run the following command: \naz security pricing show -n SqlServers \nEnsure -PricingTier is set to Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'SqlServers' | Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Set the radio button next to Azure SQL Databases to On. \n7. Select Continue. \n8. Select Save. \nFrom Azure CLI \nRun the following command: \naz security pricing create -n SqlServers --tier 'standard' \nFrom PowerShell \nRun the following command: \nSet-AzSecurityPricing -Name 'SqlServers' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Azure SQL Databases is set to On.",
            "From Azure CLI": "Run the following command: \naz security pricing show -n SqlServers \nEnsure -PricingTier is set to Standard \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'SqlServers' | Select-Object Name,PricingTier \nEnsure the -PricingTier is set to Standard"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-2-monitor-anomalies-and-threats-targeting-sensitive-data",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and unauthenticated \nscans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly or \nmore frequent basis. \n \n \n \nv8 \n16.11 Leverage Vetted Modules or Services for Application \nSecurity Components \n \nLeverage vetted modules or services for application security components such \nas identity management encryption and auditing and logging. Using platform \nfeatures in critical security functions will reduce developers workload and minimize \nthe likelihood of design or implementation errors. Modern operating systems provide \neffective mechanisms for identification authentication and authorization and make \nthose mechanisms available to applications. Use only standardized currently \naccepted and extensively reviewed encryption algorithms. Operating systems also \nprovide mechanisms to create and maintain secure audit logs. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to automatically \nscan all systems on the network on a weekly or more frequent basis to identify all \npotential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.4 Ensure That Microsoft Defender for SQL Servers on \nMachines Is Set To 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for SQL servers on machines enables threat detection \nfor SQL servers on machines, providing threat intelligence, anomaly detection, and \nbehavior analytics in Microsoft Defender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for SQL servers on machines allows for greater defense-\nin-depth, functionality for discovering and classifying sensitive data, surfacing and \nmitigating potential database vulnerabilities, and detecting anomalous activities that \ncould indicate a threat to your database. \nImpact: \nTurning on Microsoft Defender for SQL servers on machines incurs an additional cost \nper resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to SQL servers on machines is set to On. \nFrom Azure CLI \nEnsure Defender for SQL is licensed with the following command: \naz security pricing show -n SqlServerVirtualMachines \nEnsure the 'PricingTier' is set to 'Standard' \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'SqlServerVirtualMachines' | Select-Object \nName,PricingTier \nEnsure the 'PricingTier' is set to 'Standard'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to SQL servers on machines is set to On.",
            "From Azure CLI": "Ensure Defender for SQL is licensed with the following command: \naz security pricing show -n SqlServerVirtualMachines \nEnsure the 'PricingTier' is set to 'Standard' \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'SqlServerVirtualMachines' | Select-Object \nName,PricingTier \nEnsure the 'PricingTier' is set to 'Standard'"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Set the radio button next to SQL servers on machines to On. \n7. Select Continue. \n8. Select Save. \nFrom Azure CLI \nRun the following command: \naz security pricing create -n SqlServerVirtualMachines --tier 'standard' \nFrom PowerShell \nRun the following command: \nSet-AzSecurityPricing -Name 'SqlServerVirtualMachines' -PricingTier \n'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to SQL servers on machines is set to On.",
            "From Azure CLI": "Ensure Defender for SQL is licensed with the following command: \naz security pricing show -n SqlServerVirtualMachines \nEnsure the 'PricingTier' is set to 'Standard' \n \nFrom PowerShell \nRun the following command: \nGet-AzSecurityPricing -Name 'SqlServerVirtualMachines' | Select-Object \nName,PricingTier \nEnsure the 'PricingTier' is set to 'Standard'"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/defender-for-sql-usage \n2. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and unauthenticated \nscans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n16.11 Leverage Vetted Modules or Services for Application \nSecurity Components \n \nLeverage vetted modules or services for application security components such \nas identity management encryption and auditing and logging. Using platform \nfeatures in critical security functions will reduce developers workload and minimize \nthe likelihood of design or implementation errors. Modern operating systems provide \neffective mechanisms for identification authentication and authorization and make \nthose mechanisms available to applications. Use only standardized currently \naccepted and extensively reviewed encryption algorithms. Operating systems also \nprovide mechanisms to create and maintain secure audit logs. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to automatically \nscan all systems on the network on a weekly or more frequent basis to identify all \npotential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.5 Ensure That Microsoft Defender for Open-Source Relational \nDatabases Is Set To 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for Open-source relational databases enables threat \ndetection for Open-source relational databases, providing threat intelligence, anomaly \ndetection, and behavior analytics in the Microsoft Defender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for Open-source relational databases allows for greater \ndefense-in-depth, with threat detection provided by the Microsoft Security Response \nCenter (MSRC). \nImpact: \nTurning on Microsoft Defender for Open-source relational databases incurs an \nadditional cost per resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Open-source relational databases is set to On. \nFrom Azure CLI \nRun the following command: \naz security pricing show -n OpenSourceRelationalDatabases --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing | Where-Object {$_.Name -eq \n'OpenSourceRelationalDatabases'} | Select-Object Name, PricingTier \nEnsure output for Name PricingTier is OpenSourceRelationalDatabases Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Open-source relational databases is set to On.",
            "From Azure CLI": "Run the following command: \naz security pricing show -n OpenSourceRelationalDatabases --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing | Where-Object {$_.Name -eq \n'OpenSourceRelationalDatabases'} | Select-Object Name, PricingTier \nEnsure output for Name PricingTier is OpenSourceRelationalDatabases Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Set the radio button next to Open-source relational databases to On. \n7. Select Continue. \n8. Select Save. \nFrom Azure CLI \nRun the following command: \naz security pricing create -n 'OpenSourceRelationalDatabases' --tier \n'standard' \nFrom PowerShell \nUse the below command to enable Standard pricing tier for Open-source relational \ndatabases \nset-azsecuritypricing -name \"OpenSourceRelationalDatabases\" -pricingtier \n\"Standard\"",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Click Select types > in the row for Databases. \n6. Ensure the radio button next to Open-source relational databases is set to On.",
            "From Azure CLI": "Run the following command: \naz security pricing show -n OpenSourceRelationalDatabases --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing | Where-Object {$_.Name -eq \n'OpenSourceRelationalDatabases'} | Select-Object Name, PricingTier \nEnsure output for Name PricingTier is OpenSourceRelationalDatabases Standard"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n3. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-2-monitor-anomalies-and-threats-targeting-sensitive-data \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and unauthenticated \nscans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n16.11 Leverage Vetted Modules or Services for Application \nSecurity Components \n \nLeverage vetted modules or services for application security components such \nas identity management encryption and auditing and logging. Using platform \nfeatures in critical security functions will reduce developers workload and minimize \nthe likelihood of design or implementation errors. Modern operating systems provide \neffective mechanisms for identification authentication and authorization and make \nthose mechanisms available to applications. Use only standardized currently \naccepted and extensively reviewed encryption algorithms. Operating systems also \nprovide mechanisms to create and maintain secure audit logs. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to automatically \nscan all systems on the network on a weekly or more frequent basis to identify all \npotential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.6 Ensure That Microsoft Defender for Azure Cosmos DB Is \nSet To 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Microsoft Defender for Azure Cosmos DB scans all incoming network requests for \nthreats to your Azure Cosmos DB resources.",
        "Rationale": "In scanning Azure Cosmos DB requests within a subscription, requests are compared to \na heuristic list of potential security threats. These threats could be a result of a security \nbreach within your services, thus scanning for them could prevent a potential security \nthreat from being introduced. \nImpact: \nEnabling Microsoft Defender for Azure Cosmos DB requires enabling Microsoft \nDefender for your subscription. Both will incur additional charges.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. On the Database row click on Select types > \n6. Ensure the radio button next to Azure Cosmos DB is set to On. \nFrom Azure CLI \nEnsure the output of the below command is Standard \naz security pricing show -n CosmosDbs --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'CosmosDbs' | Select-Object Name,PricingTier  \nEnsure output of -PricingTier is Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. On the Database row click on Select types > \n6. Ensure the radio button next to Azure Cosmos DB is set to On.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n CosmosDbs --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'CosmosDbs' | Select-Object Name,PricingTier  \nEnsure output of -PricingTier is Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. On the Database row click on Select types >. \n6. Set the radio button next to Azure Cosmos DB to On. \n7. Click Continue. \n8. Click Save. \nFrom Azure CLI \nRun the following command: \naz security pricing create -n 'CosmosDbs' --tier 'standard' \nFrom PowerShell \nUse the below command to enable Standard pricing tier for Azure Cosmos DB \nSet-AzSecurityPricing -Name 'CosmosDbs' -PricingTier 'Standard",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. On the Database row click on Select types > \n6. Ensure the radio button next to Azure Cosmos DB is set to On.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n CosmosDbs --query pricingTier \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'CosmosDbs' | Select-Object Name,PricingTier  \nEnsure output of -PricingTier is Standard"
        },
        "Default Value": "By default, Microsoft Defender for Azure Cosmos DB is not enabled. \nReferences: \n1. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ \n2. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-\nsecurity \n3. https://docs.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview \n4. https://docs.microsoft.com/en-us/security/benchmark/azure/baselines/cosmos-\ndb-security-baseline \n5. https://docs.microsoft.com/en-us/azure/defender-for-cloud/quickstart-enable-\ndatabase-protections \n6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and unauthenticated \nscans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n16.11 Leverage Vetted Modules or Services for Application \nSecurity Components \n \nLeverage vetted modules or services for application security components such \nas identity management encryption and auditing and logging. Using platform \nfeatures in critical security functions will reduce developers workload and minimize \nthe likelihood of design or implementation errors. Modern operating systems provide \neffective mechanisms for identification authentication and authorization and make \nthose mechanisms available to applications. Use only standardized currently \naccepted and extensively reviewed encryption algorithms. Operating systems also \nprovide mechanisms to create and maintain secure audit logs. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to automatically \nscan all systems on the network on a weekly or more frequent basis to identify all \npotential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.7 Ensure That Microsoft Defender for Storage Is Set To 'On' \n(Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for Storage enables threat detection for Storage, \nproviding threat intelligence, anomaly detection, and behavior analytics in the Microsoft \nDefender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for Storage allows for greater defense-in-depth, with threat \ndetection provided by the Microsoft Security Response Center (MSRC). \nImpact: \nTurning on Microsoft Defender for Storage incurs an additional cost per resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Ensure Status is set to On for Storage. \nFrom Azure CLI \nEnsure the output of the below command is Standard \naz security pricing show -n StorageAccounts \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'StorageAccounts' | Select-Object \nName,PricingTier \nEnsure output for Name PricingTier is StorageAccounts Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Ensure Status is set to On for Storage.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n StorageAccounts \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'StorageAccounts' | Select-Object \nName,PricingTier \nEnsure output for Name PricingTier is StorageAccounts Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Set Status to On for Storage. \n6. Select Save. \nFrom Azure CLI \nEnsure the output of the below command is Standard \naz security pricing create -n StorageAccounts --tier 'standard' \n \nFrom PowerShell \nSet-AzSecurityPricing -Name 'StorageAccounts' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Ensure Status is set to On for Storage.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n StorageAccounts \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'StorageAccounts' | Select-Object \nName,PricingTier \nEnsure output for Name PricingTier is StorageAccounts Standard"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and unauthenticated \nscans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n16.11 Leverage Vetted Modules or Services for Application \nSecurity Components \n \nLeverage vetted modules or services for application security components such \nas identity management encryption and auditing and logging. Using platform \nfeatures in critical security functions will reduce developers workload and minimize \nthe likelihood of design or implementation errors. Modern operating systems provide \neffective mechanisms for identification authentication and authorization and make \nthose mechanisms available to applications. Use only standardized currently \naccepted and extensively reviewed encryption algorithms. Operating systems also \nprovide mechanisms to create and maintain secure audit logs. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to automatically \nscan all systems on the network on a weekly or more frequent basis to identify all \npotential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.8 Ensure That Microsoft Defender for Containers Is Set To \n'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for Containers enables threat detection for Container \nRegistries including Kubernetes, providing threat intelligence, anomaly detection, and \nbehavior analytics in the Microsoft Defender for Cloud. The following services will be \nenabled for container instances: \n\u2022 \nDefender agent in Azure \n\u2022 \nAzure Policy for Kubernetes \n\u2022 \nAgentless discovery for Kubernetes \n\u2022 \nAgentless container vulnerability assessment",
        "Rationale": "Enabling Microsoft Defender for Container Registries allows for greater defense-in-\ndepth, with threat detection provided by the Microsoft Security Response Center \n(MSRC). \nImpact: \nTurning on Microsoft Defender for Containers incurs an additional cost per resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings. \n3. Click on the subscription name. \n4. Select Defender plans. \n5. Ensure On is set under Status for Containers. \nFrom Azure CLI \nEnsure the output of the commands below indicates Standard pricing. \nFor legacy Defender for Container Registries instances: \naz security pricing show --name \"ContainerRegistry\" --query pricingTier \nFor new Defender for Containers instances: \naz security pricing show --name \"Containers\" --query pricingTier",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings. \n3. Click on the subscription name. \n4. Select Defender plans. \n5. Ensure On is set under Status for Containers.",
            "From Azure CLI": "Ensure the output of the commands below indicates Standard pricing. \nFor legacy Defender for Container Registries instances: \naz security pricing show --name \"ContainerRegistry\" --query pricingTier \nFor new Defender for Containers instances: \naz security pricing show --name \"Containers\" --query pricingTier"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings. \n3. Click on the subscription name. \n4. Select Defender plans. \n5. Set Status to On for Containers. \n6. Click Save. \nFrom Azure CLI \n(Note: 'ContainerRegistry' has been deprecated and is replaced by 'Containers') \nUse the below command to enable Standard pricing tier for Containers. \naz security pricing create -n 'Containers' --tier 'standard' \nFrom PowerShell \n(Note: 'ContainerRegistry' has been deprecated and is replaced by 'Containers') \nUse the below command to enable Standard pricing tier for Containers. \nSet-AzSecurityPricing -Name 'Containers' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings. \n3. Click on the subscription name. \n4. Select Defender plans. \n5. Ensure On is set under Status for Containers.",
            "From Azure CLI": "Ensure the output of the commands below indicates Standard pricing. \nFor legacy Defender for Container Registries instances: \naz security pricing show --name \"ContainerRegistry\" --query pricingTier \nFor new Defender for Containers instances: \naz security pricing show --name \"Containers\" --query pricingTier"
        },
        "Default Value": "By default, Microsoft Defender for Containers is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.9 Ensure That Microsoft Defender for Key Vault Is Set To 'On' \n(Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Turning on Microsoft Defender for Key Vault enables threat detection for Key Vault, \nproviding threat intelligence, anomaly detection, and behavior analytics in the Microsoft \nDefender for Cloud.",
        "Rationale": "Enabling Microsoft Defender for Key Vault allows for greater defense-in-depth, with \nthreat detection provided by the Microsoft Security Response Center (MSRC). \nImpact: \nTurning on Microsoft Defender for Key Vault incurs an additional cost per resource.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Key Vault. \nFrom Azure CLI \nEnsure the output of the below command is Standard \naz security pricing show -n 'KeyVaults' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'KeyVaults' | Select-Object Name,PricingTier \nEnsure output for PricingTier is Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Key Vault.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'KeyVaults' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'KeyVaults' | Select-Object Name,PricingTier \nEnsure output for PricingTier is Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Select On under Status for Key Vault. \n6. Select Save. \nFrom Azure CLI \nEnable Standard pricing tier for Key Vault: \naz security pricing create -n 'KeyVaults' --tier 'Standard' \nFrom PowerShell \nEnable Standard pricing tier for Key Vault: \nSet-AzSecurityPricing -Name 'KeyVaults' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Key Vault.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'KeyVaults' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing -Name 'KeyVaults' | Select-Object Name,PricingTier \nEnsure output for PricingTier is Standard"
        },
        "Default Value": "By default, Microsoft Defender plan is off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-detection-\ncapabilities \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/pricings/update \n4. https://docs.microsoft.com/en-us/powershell/module/az.security/get-\nazsecuritypricing \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.10 [LEGACY] Ensure That Microsoft Defender for DNS Is Set \nTo 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "[NOTE: As of August 1, customers with an existing subscription to Defender for DNS \ncan continue to use the service, but new subscribers will receive alerts about suspicious \nDNS activity as part of Defender for Servers P2.] \nMicrosoft Defender for DNS scans all network traffic exiting from within a subscription.",
        "Rationale": "DNS lookups within a subscription are scanned and compared to a dynamic list of \nwebsites that might be potential security threats. These threats could be a result of a \nsecurity breach within your services, thus scanning for them could prevent a potential \nsecurity threat from being introduced. \nImpact: \nEnabling Microsoft Defender for DNS requires enabling Microsoft Defender for your \nsubscription. Both will incur additional charges, with Defender for DNS being a small \namount per million queries.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for DNS. \nFrom Azure CLI \nEnsure the output of the below command is Standard \naz security pricing show -n 'DNS' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing --Name 'DNS' | Select-Object Name,PricingTier \nEnsure output of PricingTier is Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for DNS.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'DNS' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing --Name 'DNS' | Select-Object Name,PricingTier \nEnsure output of PricingTier is Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Select On under Status for DNS. \n6. Select Save. \nFrom Powershell \nEnable Standard pricing tier for DNS: \naz security pricing create -n 'DNS' --tier 'Standard' \nFrom PowerShell \nEnable Standard pricing tier for DNS: \nSet-AzSecurityPricing -Name 'DNS' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for DNS.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'DNS' --query 'PricingTier' \n \nFrom PowerShell \nGet-AzSecurityPricing --Name 'DNS' | Select-Object Name,PricingTier \nEnsure output of PricingTier is Standard"
        },
        "Default Value": "By default, Microsoft Defender for DNS is not enabled. \nReferences: \n1. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ \n2. https://docs.microsoft.com/en-us/security/benchmark/azure/baselines/dns-\nsecurity-baseline \n3. https://docs.microsoft.com/en-us/azure/defender-for-cloud/defender-for-dns-\nalerts \n4. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-\nsecurity \n5. https://docs.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview \n6. https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-\nnetwork-security#ns-10-ensure-domain-name-system-dns-security \n7. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.11 Ensure That Microsoft Defender for Resource Manager Is \nSet To 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Microsoft Defender for Resource Manager scans incoming administrative requests to \nchange your infrastructure from both CLI and the Azure portal.",
        "Rationale": "Scanning resource requests lets you be alerted every time there is suspicious activity in \norder to prevent a security threat from being introduced. \nImpact: \nEnabling Microsoft Defender for Resource Manager requires enabling Microsoft \nDefender for your subscription. Both will incur additional charges.",
        "Audit": "From Azure Portal \n1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Resource Manager. \nFrom Azure CLI \nEnsure the output of the below command is Standard \naz security pricing show -n 'Arm' --query 'PricingTier' \n \nFrom Azure PowerShell \nGet-AzSecurityPricing -Name 'Arm' | Select-Object Name,PricingTier \nEnsure the output of PricingTier is Standard",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Resource Manager.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'Arm' --query 'PricingTier'",
            "From Azure PowerShell": "Get-AzSecurityPricing -Name 'Arm' | Select-Object Name,PricingTier \nEnsure the output of PricingTier is Standard"
        },
        "Remediation": "From Azure Portal \n1. Go to Microsoft Defender for Cloud. \n2. Select Environment Settings blade. \n3. Click on the subscription name. \n4. Select the Defender plans blade. \n5. Select On under Status for Resource Manager. \n6. Select `Save. \nFrom Azure CLI \nUse the below command to enable Standard pricing tier for Defender for Resource \nManager \naz security pricing create -n 'Arm' --tier 'Standard' \nFrom PowerShell \nUse the below command to enable Standard pricing tier for Defender for Resource \nManager \nSet-AzSecurityPricing -Name 'Arm' -PricingTier 'Standard'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Microsoft Defender for Cloud \n2. Select Environment Settings blade \n3. Click on the subscription name \n4. Select the Defender plans blade \n5. Ensure Status is set to On for Resource Manager.",
            "From Azure CLI": "Ensure the output of the below command is Standard \naz security pricing show -n 'Arm' --query 'PricingTier'",
            "From Azure PowerShell": "Get-AzSecurityPricing -Name 'Arm' | Select-Object Name,PricingTier \nEnsure the output of PricingTier is Standard"
        },
        "Default Value": "By default, Microsoft Defender for Resource Manager is not enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-enhanced-\nsecurity \n2. https://docs.microsoft.com/en-us/azure/defender-for-cloud/defender-for-resource-\nmanager-introduction \n3. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ \n4. https://docs.microsoft.com/en-us/azure/defender-for-cloud/alerts-overview \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-1-enable-threat-detection-capabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.9 Configure Trusted DNS Servers on Enterprise Assets \n \nConfigure trusted DNS servers on enterprise assets. Example implementations \ninclude configuring assets to use enterprise-controlled DNS servers and or \nreputable externally accessible DNS servers. \n \n \n \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n13.6 Collect Network Traffic Flow Logs \n \nCollect network traffic flow logs and or network traffic to review and alert upon \nfrom network devices. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n \nv7 \n7.6 Log all URL requests \n \nLog all URL requests from each of the organization s systems whether onsite \nor a mobile device in order to identify potentially malicious activity and assist \nincident handlers with identifying potentially compromised systems. \n \n \n "
    },
    {
        "Rule": "2.1.12 Ensure that Microsoft Defender Recommendation for \n'Apply system updates' status is 'Completed' (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that the latest OS patches for all virtual machines are applied.",
        "Rationale": "Windows and Linux virtual machines should be kept updated to: \n\u2022 \nAddress a specific bug or flaw \n\u2022 \nImprove an OS or application\u2019s general stability \n\u2022 \nFix a security vulnerability \nMicrosoft Defender for Cloud retrieves a list of available security and critical updates \nfrom Windows Update or Windows Server Update Services (WSUS), depending on \nwhich service is configured on a Windows VM. The security center also checks for the \nlatest updates in Linux systems. If a VM is missing a system update, the security center \nwill recommend system updates be applied. \nImpact: \nRunning Microsoft Defender for Cloud incurs additional charges for each resource \nmonitored. Please see attached reference for exact charges per hour.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then the Recommendations blade \n4. Ensure that there are no recommendations for Apply system updates \nAlternatively, you can employ your own patch assessment and management tool to \nperiodically assess, report and install the required security patches for your OS.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then the Recommendations blade \n4. Ensure that there are no recommendations for Apply system updates \nAlternatively, you can employ your own patch assessment and management tool to \nperiodically assess, report and install the required security patches for your OS."
        },
        "Remediation": "Follow Microsoft Azure documentation to apply security patches from the security \ncenter. Alternatively, you can employ your own patch assessment and management tool \nto periodically assess, report, and install the required security patches for your OS.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then the Recommendations blade \n4. Ensure that there are no recommendations for Apply system updates \nAlternatively, you can employ your own patch assessment and management tool to \nperiodically assess, report and install the required security patches for your OS."
        },
        "Default Value": "By default, patches are not automatically deployed. \nReferences: \n1. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-6-rapidly-and-automatically-remediate-\nvulnerabilities \n2. https://azure.microsoft.com/en-us/pricing/details/defender-for-cloud/ \n3. https://docs.microsoft.com/en-us/azure/defender-for-cloud/deploy-vulnerability-\nassessment-vm",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.3 Perform Automated Operating System Patch \nManagement \n \nPerform operating system updates on enterprise assets through automated \npatch management on a monthly or more frequent basis. \n \n \n \nv7 \n3.4 Deploy Automated Operating System Patch \nManagement Tools \n \nDeploy automated software update tools in order to ensure that the operating \nsystems are running the most recent security updates provided by the software \nvendor. \n \n \n "
    },
    {
        "Rule": "2.1.13 Ensure that Microsoft Cloud Security Benchmark policies \nare not set to 'Disabled' (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "The Microsoft Cloud Security Benchmark (or \"MCSB\") is an Azure Policy Initiative \ncontaining many security policies to evaluate resource configuration against best \npractice recommendations. If a policy in the MCSB is set with effect type Disabled, it is \nnot evaluated and may prevent administrators from being informed of valuable security \nrecommendations.",
        "Rationale": "A security policy defines the desired configuration of resources in your environment and \nhelps ensure compliance with company or regulatory security requirements. The MCSB \nPolicy Initiative a set of security recommendations based on best practices and is \nassociated with every subscription by default. When a policy \"Effect\" is set to Audit, \npolicies in the MCSB ensure that Defender for Cloud evaluates relevant resources for \nsupported recommendations. To ensure that policies within the MCSB are not being \nmissed when the Policy Initiative is evaluated, none of the policies should have an \nEffect of Disabled. \nImpact: \nPolicies within the MCSB default to an effect of Audit and will evaluate - but not enforce \n- policy recommendations. Ensuring these policies are set to Audit simply ensures that \nthe evaluation occurs to allow administrators to understand where an improvement may \nbe possible. Administrators will need to determine if the recommendations are relevant \nand desirable for their environment, then manually take action to resolve the status if \ndesired.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select the appropriate Subscription \n5. Click on Security Policy in the left column. \n6. Click on Microsoft Cloud Security Benchmark \n7. Click Add Filter and select Effect \n8. Check the Disabled box to search for all disabled policies \n9. Click Apply",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select the appropriate Subscription \n5. Click on Security Policy in the left column. \n6. Click on Microsoft Cloud Security Benchmark \n7. Click Add Filter and select Effect \n8. Check the Disabled box to search for all disabled policies \n9. Click Apply"
        },
        "Remediation": "From Azure Portal \nPart A - List all disabled policies \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select the appropriate Subscription \n5. Click on Security Policy in the left column. \n6. Click on Microsoft Cloud Security Benchmark \n7. Click Add Filter and select Effect \n8. Check the Disabled box to search for all disabled policies \n9. Click Apply \nPart B - Remediate Policy Effect \nFor each policy that remains in the list: \n1. Click the blue ellipses ... to the right of the policy name \n2. Click Manage effect and parameters \n3. Under Policy Effect, select the Audit radio button \n4. Click Save \n5. Click Refresh \nRepeat \"Part B - Remediate Policy Effect\" until no more policies are listed.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select the appropriate Subscription \n5. Click on Security Policy in the left column. \n6. Click on Microsoft Cloud Security Benchmark \n7. Click Add Filter and select Effect \n8. Check the Disabled box to search for all disabled policies \n9. Click Apply"
        },
        "Default Value": "By default, the MCSB policy initiative is associated to all subscriptions and most \npolicies will have an effect of Audit. Some policies will have a default effect of Disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-policies \n2. https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-\ntransparent-data-encryption \n3. https://msdn.microsoft.com/en-us/library/mt704062.aspx \n4. https://msdn.microsoft.com/en-us/library/mt704063.aspx \n5. https://docs.microsoft.com/en-us/rest/api/policy/policy-assignments/get \n6. https://docs.microsoft.com/en-us/rest/api/policy/policy-assignments/create \n7. https://docs.microsoft.com/en-in/azure/security-center/tutorial-security-policy",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.3 Perform Automated Operating System Patch \nManagement \n \nPerform operating system updates on enterprise assets through automated \npatch management on a monthly or more frequent basis. \n \n \n \nv7 \n3.4 Deploy Automated Operating System Patch \nManagement Tools \n \nDeploy automated software update tools in order to ensure that the operating \nsystems are running the most recent security updates provided by the software \nvendor. \n \n \n "
    },
    {
        "Rule": "2.1.14 Ensure that Auto provisioning of 'Log Analytics agent for \nAzure VMs' is Set to 'On' (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable automatic provisioning of the monitoring agent to collect security data.",
        "Rationale": "When Log Analytics agent for Azure VMs is turned on, Microsoft Defender for Cloud \nprovisions the Microsoft Monitoring Agent on all existing supported Azure virtual \nmachines and any new ones that are created. The Microsoft Monitoring Agent scans for \nvarious security-related configurations and events such as system updates, OS \nvulnerabilities, endpoint protection, and provides alerts.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Log Analytics agent/Azure Monitor agent is set to On \nRepeat the above for any additional subscriptions. \nFrom Azure CLI \nEnsure the output of the below command is On \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/<subscriptionID>/providers/Microso\nft.Security/autoProvisioningSettings?api-version=2017-08-01-preview' | jq \n'.|.value[] | select(.name==\"default\")'|jq '.properties.autoProvision' \nUsing PowerShell \nConnect-AzAccount \nGet-AzSecurityAutoProvisioningSetting | Select-Object Name, AutoProvision \nEnsure output for Id Name AutoProvision is \n/subscriptions//providers/Microsoft.Security/autoProvisioningSettings/default \ndefault On",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Log Analytics agent/Azure Monitor agent is set to On \nRepeat the above for any additional subscriptions.",
            "From Azure CLI": "Ensure the output of the below command is On \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/<subscriptionID>/providers/Microso\nft.Security/autoProvisioningSettings?api-version=2017-08-01-preview' | jq \n'.|.value[] | select(.name==\"default\")'|jq '.properties.autoProvision' \nUsing PowerShell \nConnect-AzAccount \nGet-AzSecurityAutoProvisioningSetting | Select-Object Name, AutoProvision \nEnsure output for Id Name AutoProvision is \n/subscriptions//providers/Microsoft.Security/autoProvisioningSettings/default \ndefault On"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Log Analytics agent for Azure VMs is set to On \nRepeat the above for any additional subscriptions. \nFrom Azure CLI \nUse the below command to set Automatic provisioning of monitoring agent to On. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/subscriptionID/providers/Microsoft\n.Security/autoProvisioningSettings/default?api-version=2017-08-01-preview -\nd@\"input.json\"' \nWhere input.json contains the Request body json data as mentioned below. \n   { \n  \"id\": \n\"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/autoProvi\nsioningSettings/default\", \n  \"name\": \"default\", \n  \"type\": \"Microsoft.Security/autoProvisioningSettings\", \n  \"properties\": { \n    \"autoProvision\": \"On\" \n  } \n}",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Log Analytics agent/Azure Monitor agent is set to On \nRepeat the above for any additional subscriptions.",
            "From Azure CLI": "Ensure the output of the below command is On \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/<subscriptionID>/providers/Microso\nft.Security/autoProvisioningSettings?api-version=2017-08-01-preview' | jq \n'.|.value[] | select(.name==\"default\")'|jq '.properties.autoProvision' \nUsing PowerShell \nConnect-AzAccount \nGet-AzSecurityAutoProvisioningSetting | Select-Object Name, AutoProvision \nEnsure output for Id Name AutoProvision is \n/subscriptions//providers/Microsoft.Security/autoProvisioningSettings/default \ndefault On"
        },
        "Default Value": "By default, Automatic provisioning of monitoring agent is set to On.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.1 Establish and Maintain a Secure Configuration Process \n \nEstablish and maintain a secure configuration process for enterprise assets \n end-user devices including portable and mobile non-computing IoT devices and \nservers and software operating systems and applications . Review and update \ndocumentation annually or when significant enterprise changes occur that could \nimpact this Safeguard. \n \n \n \nv8 \n4.2 Establish and Maintain a Secure Configuration Process \nfor Network Infrastructure \n \nEstablish and maintain a secure configuration process for network devices. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv7 \n5.1 Establish Secure Configurations \n \nMaintain documented standard security configuration standards for all \nauthorized operating systems and software. \n \n \n \nv7 \n5.5 Implement Automated Configuration Monitoring \nSystems \n \nUtilize a Security Content Automation Protocol SCAP compliant configuration \nmonitoring system to verify all security configuration elements catalog approved \nexceptions and alert when unauthorized changes occur. \n \n \n "
    },
    {
        "Rule": "2.1.15 Ensure that Auto provisioning of 'Vulnerability assessment \nfor machines' is Set to 'On' (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Enable automatic provisioning of vulnerability assessment for machines on both Azure \nand hybrid (Arc enabled) machines.",
        "Rationale": "Vulnerability assessment for machines scans for various security-related configurations \nand events such as system updates, OS vulnerabilities, and endpoint protection, then \nproduces alerts on threat and vulnerability findings. \nImpact: \nAdditional licensing is required and configuration of Azure Arc introduces complexity \nbeyond this recommendation.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Vulnerability assessment for machines is set to On \nRepeat the above for any additional subscriptions.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Vulnerability assessment for machines is set to On \nRepeat the above for any additional subscriptions."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Vulnerability assessment for machines is set to On \nRepeat the above for any additional subscriptions.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Select a subscription \n5. Click on Settings & Monitoring \n6. Ensure that Vulnerability assessment for machines is set to On \nRepeat the above for any additional subscriptions."
        },
        "Default Value": "By default, Automatic provisioning of monitoring agent is set to On.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly \nor more frequent basis. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.16 Ensure that Auto provisioning of 'Microsoft Defender for \nContainers components' is Set to 'On' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Enable automatic provisioning of the Microsoft Defender for Containers components.",
        "Rationale": "As with any compute resource, Container environments require hardening and run-time \nprotection to ensure safe operations and detection of threats and vulnerabilities. \nImpact: \nMicrosoft Defender for Containers will require additional licensing.",
        "Audit": "From Azure Portal \n1. From the Azure Portal Home page, select Microsoft Defender for Cloud \n2. Under Management select Environment Settings \n3. Select a subscription \n4. Ensure that Containers is set to On \nRepeat the above for any additional subscriptions. \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 1c988dd6-ade4-430f-a608-2a3e5b0a6d38 - Name: 'Microsoft \nDefender for Containers should be enabled'",
        "Audit Steps": {
            "From Azure Portal": "1. From the Azure Portal Home page, select Microsoft Defender for Cloud \n2. Under Management select Environment Settings \n3. Select a subscription \n4. Ensure that Containers is set to On \nRepeat the above for any additional subscriptions.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 1c988dd6-ade4-430f-a608-2a3e5b0a6d38 - Name: 'Microsoft \nDefender for Containers should be enabled'"
        },
        "Remediation": "From Azure Portal \n1. From the Azure Portal Home page, select Microsoft Defender for Cloud \n2. Under Management, select Environment Settings \n3. Select a subscription \n4. Set Containers to On",
        "Remediation Steps": {
            "From Azure Portal": "1. From the Azure Portal Home page, select Microsoft Defender for Cloud \n2. Under Management select Environment Settings \n3. Select a subscription \n4. Ensure that Containers is set to On \nRepeat the above for any additional subscriptions.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 1c988dd6-ade4-430f-a608-2a3e5b0a6d38 - Name: 'Microsoft \nDefender for Containers should be enabled'"
        },
        "Default Value": "By default, Automatic provisioning of monitoring agent is set to Off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-data-\ncollection?tabs=autoprovision-va \n2. https://msdn.microsoft.com/en-us/library/mt704062.aspx \n3. https://msdn.microsoft.com/en-us/library/mt704063.aspx \n4. https://docs.microsoft.com/en-\nus/rest/api/securitycenter/autoprovisioningsettings/list \n5. https://docs.microsoft.com/en-\nus/rest/api/securitycenter/autoprovisioningsettings/create \n6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-5-perform-vulnerability-assessments \nAdditional Information: \nWhile this feature is generally available as of publication, it is not yet available for Azure \nGovernment tenants.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly \nor more frequent basis. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.17 Ensure That 'All users with the following roles' is set to \n'Owner' (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable security alert emails to subscription owners.",
        "Rationale": "Enabling security alert emails to subscription owners ensures that they receive security \nalert emails from Microsoft. This ensures that they are aware of any potential security \nissues and can mitigate the risk in a timely fashion.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that All users with the following roles is set to Owner \nFrom Azure CLI \nEnsure the command below returns state of On and that Owner appears in roles. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview'| jq '.[] | \nselect(.name==\"default\").properties.notificationsByRole'",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that All users with the following roles is set to Owner",
            "From Azure CLI": "Ensure the command below returns state of On and that Owner appears in roles. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview'| jq '.[] | \nselect(.name==\"default\").properties.notificationsByRole'"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. In the drop down of the All users with the following roles field select Owner \n7. Click Save",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Then Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that All users with the following roles is set to Owner",
            "From Azure CLI": "Ensure the command below returns state of On and that Owner appears in roles. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview'| jq '.[] | \nselect(.name==\"default\").properties.notificationsByRole'"
        },
        "Default Value": "By default, Microsoft Defender for Containers is disabled. If Defender for Containers is \nenabled from the Microsoft Defender for Cloud portal, auto provisioning will be enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/defender-for-cloud/defender-for-\ncontainers-introduction \n2. https://docs.microsoft.com/en-us/azure/defender-for-cloud/enable-data-\ncollection?tabs=autoprovision-containers \n3. https://msdn.microsoft.com/en-us/library/mt704062.aspx \n4. https://msdn.microsoft.com/en-us/library/mt704063.aspx \n5. https://docs.microsoft.com/en-\nus/rest/api/securitycenter/autoprovisioningsettings/list \n6. https://docs.microsoft.com/en-\nus/rest/api/securitycenter/autoprovisioningsettings/create \n7. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-incident-\nresponse#ir-2-preparation---setup-incident-notification",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and \nunauthenticated scans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly \nor more frequent basis. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.1.18 Ensure 'Additional email addresses' is Configured with a \nSecurity Contact Email (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Microsoft Defender for Cloud emails the subscription owners whenever a high-severity \nalert is triggered for their subscription. You should provide a security contact email \naddress as an additional email address.",
        "Rationale": "Microsoft Defender for Cloud emails the Subscription Owner to notify them about \nsecurity alerts. Adding your Security Contact's email address to the 'Additional email \naddresses' field ensures that your organization's Security Team is included in these \nalerts. This ensures that the proper people are aware of any potential compromise in \norder to mitigate the risk in a timely fashion.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that a valid security contact email address is listed in the Additional \nemail addresses field \nFrom Azure CLI \nEnsure the output of the below command is set not empty and is set with appropriate \nemail ids. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.emails'",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that a valid security contact email address is listed in the Additional \nemail addresses field",
            "From Azure CLI": "Ensure the output of the below command is set not empty and is set with appropriate \nemail ids. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.emails'"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Enter a valid security contact email address (or multiple addresses separated by \ncommas) in the Additional email addresses field \n7. Click Save \nFrom Azure CLI \nUse the below command to set Security contact emails to On. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts/default?api-version=2020-01-01-preview -d@\"input.json\"' \nWhere input.json contains the data below, replacing validEmailAddress with a single \nemail address or multiple comma-separated email addresses: \n    { \n      \"id\": \n\"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/securityC\nontacts/default\", \n      \"name\": \"default\", \n      \"type\": \"Microsoft.Security/securityContacts\", \n      \"properties\": { \n        \"email\": \"<validEmailAddress>\", \n        \"alertNotifications\": \"On\", \n        \"alertsToAdmins\": \"On\" \n      } \n    }",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that a valid security contact email address is listed in the Additional \nemail addresses field",
            "From Azure CLI": "Ensure the output of the below command is set not empty and is set with appropriate \nemail ids. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.emails'"
        },
        "Default Value": "By default, there are no additional email addresses entered.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n17.2 Establish and Maintain Contact Information for \nReporting Security Incidents \n \nEstablish and maintain contact information for parties that need to be informed of \nsecurity incidents. Contacts may include internal staff third-party vendors law \nenforcement cyber insurance providers relevant government agencies Information \nSharing and Analysis Center ISAC partners or other stakeholders. Verify contacts \nannually to ensure that information is up-to-date. \n \n \n \nv7 \n19.5 Maintain Contact Information For Reporting Security \nIncidents \n \nAssemble and maintain information on third-party contact information to be used \nto report a security incident such as Law Enforcement relevant government \ndepartments vendors and ISAC partners. \n \n \n "
    },
    {
        "Rule": "2.1.19 Ensure That 'Notify about alerts with the following severity' \nis Set to 'High' (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enables emailing security alerts to the subscription owner or other designated security \ncontact.",
        "Rationale": "Enabling security alert emails ensures that security alert emails are received from \nMicrosoft. This ensures that the right people are aware of any potential security issues \nand are able to mitigate the risk.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that the Notify about alerts with the following severity (or \nhigher): setting is checked and set to High \nFrom Azure CLI \nEnsure the output of below command is set to true, enter your Subscription ID at the $0 \nbetween /subscriptions/<$0>/providers. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.alertNotifications'",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that the Notify about alerts with the following severity (or \nhigher): setting is checked and set to High",
            "From Azure CLI": "Ensure the output of below command is set to true, enter your Subscription ID at the $0 \nbetween /subscriptions/<$0>/providers. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.alertNotifications'"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Under Notification types, check the check box next to Notify about alerts \nwith the following severity (or higher): and select High from the drop \ndown menu \n7. Click Save \nFrom Azure CLI \nUse the below command to set Send email notification for high severity alerts \nto On. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/<$0>/providers/Microsoft.Security/\nsecurityContacts/default1?api-version=2017-08-01-preview -d@\"input.json\"' \nWhere input.json contains the data below, replacing validEmailAddress with a single \nemail address or multiple comma-separated email addresses: \n       { \n      \"id\": \n\"/subscriptions/<Your_Subscription_Id>/providers/Microsoft.Security/securityC\nontacts/default1\", \n      \"name\": \"default1\", \n      \"type\": \"Microsoft.Security/securityContacts\", \n      \"properties\": { \n        \"email\": \"<validEmailAddress>\", \n        \"alertNotifications\": \"On\", \n        \"alertsToAdmins\": \"On\" \n      }",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Click on Environment Settings \n4. Click on the appropriate Management Group, Subscription, or Workspace \n5. Click on Email notifications \n6. Ensure that the Notify about alerts with the following severity (or \nhigher): setting is checked and set to High",
            "From Azure CLI": "Ensure the output of below command is set to true, enter your Subscription ID at the $0 \nbetween /subscriptions/<$0>/providers. \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/providers/Microsoft.Security/se\ncurityContacts?api-version=2020-01-01-preview' | jq '.|.[] | \nselect(.name==\"default\")'|jq '.properties.alertNotifications'"
        },
        "Default Value": "By default, there are no additional email addresses entered.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n17.2 Establish and Maintain Contact Information for \nReporting Security Incidents \n \nEstablish and maintain contact information for parties that need to be informed of \nsecurity incidents. Contacts may include internal staff third-party vendors law \nenforcement cyber insurance providers relevant government agencies Information \nSharing and Analysis Center ISAC partners or other stakeholders. Verify contacts \nannually to ensure that information is up-to-date. \n \n \n \nv7 \n19.5 Maintain Contact Information For Reporting Security \nIncidents \n \nAssemble and maintain information on third-party contact information to be used \nto report a security incident such as Law Enforcement relevant government \ndepartments vendors and ISAC partners. \n \n \n "
    },
    {
        "Rule": "2.1.20 Ensure that Microsoft Defender for Cloud Apps integration \nwith Microsoft Defender for Cloud is Selected (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "This integration setting enables Microsoft Defender for Cloud Apps (formerly 'Microsoft \nCloud App Security' or 'MCAS' - see additional info) to communicate with Microsoft \nDefender for Cloud.",
        "Rationale": "Microsoft Defender for Cloud offers an additional layer of protection by using Azure \nResource Manager events, which is considered to be the control plane for Azure. By \nanalyzing the Azure Resource Manager records, Microsoft Defender for Cloud detects \nunusual or potentially harmful operations in the Azure subscription environment. Several \nof the preceding analytics are powered by Microsoft Defender for Cloud Apps. To \nbenefit from these analytics, subscription must have a Cloud App Security license. \nMicrosoft Defender for Cloud Apps works only with Standard Tier subscriptions. \nImpact: \nMicrosoft Defender for Cloud Apps works with Standard pricing tier Subscription. \nChoosing the Standard pricing tier of Microsoft Defender for Cloud incurs an additional \ncost per resource.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade \n6. Ensure setting Allow Microsoft Defender for Cloud Apps to access my data \nis selected. \nFrom Azure CLI \nEnsure the output of the below command is True",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade \n6. Ensure setting Allow Microsoft Defender for Cloud Apps to access my data \nis selected.",
            "From Azure CLI": "Ensure the output of the below command is True"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Select Microsoft Defender for Cloud. \n3. Select Environment Settings blade. \n4. Select the subscription. \n5. Select Integrations. \n6. Check Allow Microsoft Defender for Cloud Apps to access my data. \n7. Select Save. \nFrom Azure CLI \nUse the below command to enable Standard pricing tier for Storage Accounts \naz account get-access-token --query \n\"{subscription:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X PUT -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/<subscription_ID>/providers/Micros\noft.Security/settings/MCAS?api-version=2021-06-01 -d@\"input.json\"' \nWhere input.json contains the Request body json data as mentioned below.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade \n6. Ensure setting Allow Microsoft Defender for Cloud Apps to access my data \nis selected.",
            "From Azure CLI": "Ensure the output of the below command is True"
        },
        "Default Value": "By default, Notify about alerts with the following severity (or higher): is set to \nHigh. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-provide-\nsecurity-contact-details \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/securitycontacts/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/security-contacts \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-incident-\nresponse#ir-2-preparation---setup-incident-notification \nAdditional Information: \nExcluding any entries in the input.json properties block disables the specific setting by \ndefault. This recommendation has been updated to reflect recent changes to Microsoft \nREST APIs for getting and updating security contact information.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n13.11 Tune Security Event Alerting Thresholds \n \nTune security event alerting thresholds monthly or more frequently. \n \n \n \nv7 \n6.8 Regularly Tune SIEM \n \nOn a regular basis tune your SIEM system to better identify actionable \nevents and decrease event noise. \n \n \n "
    },
    {
        "Rule": "2.1.21 Ensure that Microsoft Defender for Endpoint integration \nwith Microsoft Defender for Cloud is selected (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "This integration setting enables Microsoft Defender for Endpoint (formerly 'Advanced \nThreat Protection' or 'ATP' or 'WDATP' - see additional info) to communicate with \nMicrosoft Defender for Cloud. \nIMPORTANT: When enabling integration between DfE & DfC it needs to be taken into \naccount that this will have some side effects that may be undesirable. \n1. For server 2019 & above if defender is installed (default for these server SKU's) \nthis will trigger a deployment of the new unified agent and link to any of the \nextended configuration in the Defender portal. \n2. If the new unified agent is required for server SKU's of Win 2016 or Linux and \nlower there is additional integration that needs to be switched on and agents \nneed to be aligned.",
        "Rationale": "Microsoft Defender for Endpoint integration brings comprehensive Endpoint Detection \nand Response (EDR) capabilities within Microsoft Defender for Cloud. This integration \nhelps to spot abnormalities, as well as detect and respond to advanced attacks on \nendpoints monitored by Microsoft Defender for Cloud. \nMDE works only with Standard Tier subscriptions. \nImpact: \nMicrosoft Defender for Endpoint works with Standard pricing tier Subscription. Choosing \nthe Standard pricing tier of Microsoft Defender for Cloud incurs an additional cost per \nresource.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade"
        },
        "Remediation": "From Azure Console \n1. From Azure Home select the Portal Menu. \n2. Go to Microsoft Defender for Cloud. \n3. Select Environment Settings blade. \n4. Select the subscription. \n5. Select Integrations. \n6. Check Allow Microsoft Defender for Endpoint to access my data. \n7. Select Save. \nFrom Azure CLI \nUse the below command to enable Standard pricing tier for Storage Accounts",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Select Microsoft Defender for Cloud \n3. Select Environment Settings blade \n4. Click on the subscription name \n5. Select the Integrations blade"
        },
        "Default Value": "With Cloud App Security license, these alerts are enabled by default. \nReferences: \n1. https://docs.microsoft.com/en-in/azure/security-center/security-center-alerts-\nservice-layer#azure-management-layer-azure-resource-manager-preview \n2. https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/list \n3. https://docs.microsoft.com/en-us/rest/api/securitycenter/settings/update \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-9-secure-user-access-to--existing-applications \nAdditional Information: \nNOTE: \"Microsoft Defender for Cloud Apps\" (\"MDCA\") is formerly known as \"Microsoft \nCloud App Security\" (\"MCAS\"). There are a number of places (e.g. Azure CLI) where \nthe \"MCAS\" acronym is still used within Azure.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.5 Perform Automated Vulnerability Scans of Internal \nEnterprise Assets \n \nPerform automated vulnerability scans of internal enterprise assets on a \nquarterly or more frequent basis. Conduct both authenticated and unauthenticated \nscans using a SCAP-compliant vulnerability scanning tool. \n \n \n \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly or \nmore frequent basis. \n \n \n \nv8 \n13.10 Perform Application Layer Filtering \n \nPerform application layer filtering. Example implementations include a filtering \nproxy application layer firewall or gateway. \n \n \n "
    },
    {
        "Rule": "2.1.22 Ensure that Microsoft Defender External Attack Surface \nMonitoring (EASM) is enabled (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "An organization's attack surface is the collection of assets with a public network \nidentifier or URI that an external threat actor can see or access from outside your cloud. \nIt is the set of points on the boundary of a system, a system element, system \ncomponent, or an environment where an attacker can try to enter, cause an effect on, or \nextract data from, that system, system element, system component, or environment. \nThe larger the attack surface, the harder it is to protect. \nThis tool can be configured to scan your organization's online infrastructure such as \nspecified domains, hosts, CIDR blocks, and SSL certificates, and store them in an \nInventory. Inventory items can be added, reviewed, approved, and removed, and may \ncontain enrichments (\"insights\") and additional information collected from the tool's \ndifferent scan engines and open-source intelligence sources. \nA Defender EASM workspace will generate an Inventory of publicly exposed assets by \ncrawling and scanning the internet using Seeds you provide when setting up the tool. \nSeeds can be FQDNs, IP CIDR blocks, and WHOIS records. \nDefender EASM will generate Insights within 24-48 hours after Seeds are provided, and \nthese insights include vulnerability data (CVEs), ports and protocols, and weak or \nexpired SSL certificates that could be used by an attacker for reconnaisance or \nexploitation. \nResults are classified High/Medium/Low and some of them include proposed \nmitigations.",
        "Rationale": "This tool can monitor the externally exposed resources of an organization, provide \nvaluable insights, and export these findings in a variety of formats (including CSV) for \nuse in vulnerability management operations and red/purple team exercises. \nImpact: \nMicrosoft Defender EASM workspaces are currently available as Azure Resources with \na 30-day free trial period but can quickly accrue significant charges. The costs are \ncalculated daily as (Number of \"billable\" inventory items) x (item cost per day; \napproximately: $0.017). \nEstimated cost is not provided within the tool, and users are strongly advised to contact \ntheir Microsoft sales representative for pricing and set a calendar reminder for the end \nof the trial period.",
        "Audit": "To view Defender EASM workspaces created for your Subscriptions, search for EASM \nin the Azure Portal using the search box.",
        "Audit Steps": {},
        "Remediation": "To begin remediation, a Microsoft Defender EASM workspace must be created. The \nresources and inventory items added to this workspace will depend on your \nenvironment.",
        "Remediation Steps": {},
        "Default Value": "Microsoft Defender EASM is an optional, paid Azure Resource that must be created and \nconfigured inside a Subscription and Resource Group. \nReferences: \n1. https://learn.microsoft.com/en-us/azure/external-attack-surface-management/ \n2. https://learn.microsoft.com/en-us/azure/external-attack-surface-\nmanagement/deploying-the-defender-easm-azure-\nresource?source=recommendations \n3. https://www.microsoft.com/en-us/security/blog/2022/08/02/microsoft-announces-\nnew-solutions-for-threat-intelligence-and-attack-surface-management/ \nAdditional Information: \nMicrosoft added its Defender for External Attack Surface management (EASM) offering \nto Azure following its 2022 acquisition of EASM SaaS tool company RiskIQ.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly \nor more frequent basis. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "2.2.1 Ensure That Microsoft Defender for IoT Hub Is Set To 'On' \n(Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Microsoft Defender for IoT acts as a central security hub for IoT devices within your \norganization.",
        "Rationale": "IoT devices are very rarely patched and can be potential attack vectors for enterprise \nnetworks. Updating their network configuration to use a central security hub allows for \ndetection of these breaches. \nImpact: \nEnabling Microsoft Defender for IoT will incur additional charges dependent on the level \nof usage.",
        "Audit": "From Azure Portal \n1. Go to IoT Hub. \n2. Select a IoT Hub to validate. \n3. Select Overview in Defender for IoT. \n4. The Threat prevention and Threat detection screen will appear, if Defender for \nIoT is Enabled.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to IoT Hub. \n2. Select a IoT Hub to validate. \n3. Select Overview in Defender for IoT. \n4. The Threat prevention and Threat detection screen will appear, if Defender for \nIoT is Enabled."
        },
        "Remediation": "From Azure Portal \n1. Go to IoT Hub. \n2. Select a IoT Hub to validate. \n3. Select Overview in Defender for IoT. \n4. Click on Secure your IoT solution, and complete the onboarding.",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to IoT Hub. \n2. Select a IoT Hub to validate. \n3. Select Overview in Defender for IoT. \n4. The Threat prevention and Threat detection screen will appear, if Defender for \nIoT is Enabled."
        },
        "Default Value": "By default, Microsoft Defender for IoT is not enabled. \nReferences: \n1. https://azure.microsoft.com/en-us/services/iot-defender/#overview",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n7.6 Perform Automated Vulnerability Scans of Externally-\nExposed Enterprise Assets \n \nPerform automated vulnerability scans of externally-exposed enterprise assets \nusing a SCAP-compliant vulnerability scanning tool. Perform scans on a monthly \nor more frequent basis. \n \n \n \nv7 \n3.1 Run Automated Vulnerability Scanning Tools \n \nUtilize an up-to-date SCAP-compliant vulnerability scanning tool to \nautomatically scan all systems on the network on a weekly or more frequent basis \nto identify all potential vulnerabilities on the organization s systems. \n \n \n "
    },
    {
        "Rule": "3.1 Ensure that 'Secure transfer required' is set to 'Enabled' \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable data encryption in transit.",
        "Rationale": "The secure transfer option enhances the security of a storage account by only allowing \nrequests to the storage account by a secure connection. For example, when calling \nREST APIs to access storage accounts, the connection must use HTTPS. Any requests \nusing HTTP will be rejected when 'secure transfer required' is enabled. When using the \nAzure files service, connection without encryption will fail, including scenarios using \nSMB 2.1, SMB 3.0 without encryption, and some flavors of the Linux SMB client. \nBecause Azure storage doesn\u2019t support HTTPS for custom domain names, this option is \nnot applied when using a custom domain name.",
        "Audit": "From Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, go to Configuration \n3. Ensure that Secure transfer required is set to Enabled \nFrom Azure CLI \nUse the below command to ensure the Secure transfer required is enabled for all the \nStorage Accounts by ensuring the output contains true for each of the Storage \nAccounts. \naz storage account list --query \"[*].[name,enableHttpsTrafficOnly]\" \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 404c3081-a854-4457-ae30-26a93ef643f9 - Name: 'Secure transfer to \nstorage accounts should be enabled'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, go to Configuration \n3. Ensure that Secure transfer required is set to Enabled",
            "From Azure CLI": "Use the below command to ensure the Secure transfer required is enabled for all the \nStorage Accounts by ensuring the output contains true for each of the Storage \nAccounts. \naz storage account list --query \"[*].[name,enableHttpsTrafficOnly]\"",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 404c3081-a854-4457-ae30-26a93ef643f9 - Name: 'Secure transfer to \nstorage accounts should be enabled'"
        },
        "Remediation": "From Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, go to Configuration \n3. Set Secure transfer required to Enabled \nFrom Azure CLI \nUse the below command to enable Secure transfer required for a Storage Account \naz storage account update --name <storageAccountName> --resource-group \n<resourceGroupName> --https-only true",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, go to Configuration \n3. Ensure that Secure transfer required is set to Enabled",
            "From Azure CLI": "Use the below command to ensure the Secure transfer required is enabled for all the \nStorage Accounts by ensuring the output contains true for each of the Storage \nAccounts. \naz storage account list --query \"[*].[name,enableHttpsTrafficOnly]\"",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 404c3081-a854-4457-ae30-26a93ef643f9 - Name: 'Secure transfer to \nstorage accounts should be enabled'"
        },
        "Default Value": "By default, Secure transfer required is set to Disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/blobs/security-\nrecommendations#encryption-in-transit \n2. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-\nlatest#az_storage_account_list \n3. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-\nlatest#az_storage_account_update \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "3.2 Ensure that \u2018Enable Infrastructure Encryption\u2019 for Each \nStorage Account in Azure Storage is Set to \u2018enabled\u2019 (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Enabling encryption at the hardware level on top of the default software encryption for \nStorage Accounts accessing Azure storage solutions.",
        "Rationale": "Azure Storage automatically encrypts all data in a storage account at the network level \nusing 256-bit AES encryption, which is one of the strongest, FIPS 140-2-compliant block \nciphers available. Customers who require higher levels of assurance that their data is \nsecure can also enable 256-bit AES encryption at the Azure Storage infrastructure level \nfor double encryption. Double encryption of Azure Storage data protects against a \nscenario where one of the encryption algorithms or keys may be compromised. \nSimilarly, data is encrypted even before network transmission and in all backups. In this \nscenario, the additional layer of encryption continues to protect your data. For the most \nsecure implementation of key based encryption, it is recommended to use a Customer \nManaged asymmetric RSA 2048 Key in Azure Key Vault. \nImpact: \nThe read and write speeds to the storage will be impacted if both default encryption and \nInfrastructure Encryption are checked, as a secondary form of encryption requires more \nresource overhead for the cryptography of information. This performance impact should \nbe considered in an analysis for justifying use of the feature in your environment. \nCustomer-managed keys are recommended for the most secure implementation, \nleading to overhead of key management. The key will also need to be backed up in a \nsecure location, as loss of the key will mean loss of the information in the storage.",
        "Audit": "From Azure Portal \n1. From Azure Portal select the portal menu in the top left. \n2. Select Storage Accounts. \n3. Click on each storage account within each resource group you wish to audit. \n4. In the overview, under Security, ensure Infrastructure encryption is set to \nEnabled.",
        "Audit Steps": {
            "From Azure Portal": "select the portal menu in the top left. \n2. Select Storage Accounts. \n3. Click on each storage account within each resource group you wish to audit. \n4. In the overview, under Security, ensure Infrastructure encryption is set to \nEnabled."
        },
        "Remediation": "From Azure Portal \n1. During Storage Account creation, in the Encryption tab, check the box next to \nEnable infrastructure encryption. \nFrom Azure CLI \nReplace the information within <> with appropriate values: \naz storage account create \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --location <location> \\ \n    --sku Standard_RAGRS \\ \n    --kind StorageV2 \\ \n    --require-infrastructure-encryption \nFrom PowerShell \nReplace the information within <> with appropriate values: \nNew-AzStorageAccount -ResourceGroupName <resource_group> ` \n    -AccountName <storage-account> ` \n    -Location <location> ` \n    -SkuName \"Standard_RAGRS\" ` \n    -Kind StorageV2 ` \n    -RequireInfrastructureEncryption",
        "Remediation Steps": {
            "From Azure Portal": "select the portal menu in the top left. \n2. Select Storage Accounts. \n3. Click on each storage account within each resource group you wish to audit. \n4. In the overview, under Security, ensure Infrastructure encryption is set to \nEnabled."
        },
        "Default Value": "By default, Secure transfer required is set to Disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/blobs/security-\nrecommendations#encryption-in-transit \n2. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-\nlatest#az_storage_account_list \n3. https://docs.microsoft.com/en-us/cli/azure/storage/account?view=azure-cli-\nlatest#az_storage_account_update \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "3.3 Ensure that 'Enable key rotation reminders' is enabled for \neach Storage Account (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Access Keys authenticate application access requests to data contained in Storage \nAccounts. A periodic rotation of these keys is recommended to ensure that potentially \ncompromised keys cannot result in a long-term exploitable credential. The \"Rotation \nReminder\" is an automatic reminder feature for a manual procedure.",
        "Rationale": "Reminders such as those generated by this recommendation will help maintain a \nregular and healthy cadence for activities which improve the overall efficacy of a \nsecurity program. \nCryptographic key rotation periods will vary depending on your organization's security \nrequirements and the type of data which is being stored in the Storage Account. For \nexample, PCI DSS mandates that cryptographic keys be replaced or rotated 'regularly,' \nand advises that keys for static data stores be rotated every 'few months.' \nFor the purposes of this recommendation, 90 days will prescribed for the reminder. \nReview and adjustment of the 90 day period is recommended, and may even be \nnecessary. Your organization's security requirements should dictate the appropriate \nsetting. \nImpact: \nThis recommendation only creates a periodic reminder to regenerate access keys. \nRegenerating access keys can affect services in Azure as well as the organization's \napplications that are dependent on the storage account. All clients that use the access \nkey to access the storage account must be updated to use the new key.",
        "Audit": "From Azure Portal \n1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Click Set rotation reminder \nIf the checkbox for Enable key rotation reminders is already checked, that Storage \nAccount is compliant. Review the Remind me every field for a desirable periodic setting \nthat fits your security program's needs.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Click Set rotation reminder \nIf the checkbox for Enable key rotation reminders is already checked, that Storage \nAccount is compliant. Review the Remind me every field for a desirable periodic setting \nthat fits your security program's needs."
        },
        "Remediation": "From Azure Portal \n1. Go to Storage Accounts \n2. For each Storage Account that is not compliant, go to Access keys \n3. Click Set rotation reminder \n4. Check Enable key rotation reminders \n5. In the Send reminders field select Custom, then set the Remind me every field to \n90 and the period drop down to Days. \n6. Click Save \nFrom Powershell \n$rgName = <resource group name for the storage> \n$accountName = <storage account name> \n$account = Get-AzStorageAccount -ResourceGroupName $rgName -Name $accountName \nif ($account.KeyCreationTime.Key1 -eq $null -or $account.KeyCreationTime.Key2 \n-eq $null){ \n \nWrite-output (\"You must regenerate both keys at least once before \nsetting expiration policy\") \n} else { \n \n$account = Set-AzStorageAccount -ResourceGroupName $rgName -Name \n$accountName -KeyExpirationPeriodInDay 90 \n} \n$account.KeyPolicy.KeyExpirationPeriodInDays",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Click Set rotation reminder \nIf the checkbox for Enable key rotation reminders is already checked, that Storage \nAccount is compliant. Review the Remind me every field for a desirable periodic setting \nthat fits your security program's needs."
        },
        "Default Value": "By default, Key rotation reminders is not configured.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "3.4 Ensure that Storage Account Access Keys are Periodically \nRegenerated (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "For increased security, regenerate storage account access keys periodically.",
        "Rationale": "When a storage account is created, Azure generates two 512-bit storage access keys \nwhich are used for authentication when the storage account is accessed. Rotating these \nkeys periodically ensures that any inadvertent access or exposure does not result from \nthe compromise of these keys. \nCryptographic key rotation periods will vary depending on your organization's security \nrequirements and the type of data which is being stored in the Storage Account. For \nexample, PCI DSS mandates that cryptographic keys be replaced or rotated 'regularly,' \nand advises that keys for static data stores be rotated every 'few months.' \nFor the purposes of this recommendation, 90 days will prescribed for the reminder. \nReview and adjustment of the 90 day period is recommended, and may even be \nnecessary. Your organization's security requirements should dictate the appropriate \nsetting. \nImpact: \nRegenerating access keys can affect services in Azure as well as the organization's \napplications that are dependent on the storage account. All clients who use the access \nkey to access the storage account must be updated to use the new key.",
        "Audit": "From Azure Portal \n1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Review the date in the Last rotated field for each key. \nIf the Last rotated field indicates value greater than 90 day [or greater than your \norganization's period of validity], the key should be rotated. \nFrom Azure CLI \n1. Get a list of storage accounts",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Review the date in the Last rotated field for each key. \nIf the Last rotated field indicates value greater than 90 day [or greater than your \norganization's period of validity], the key should be rotated.",
            "From Azure CLI": "1. Get a list of storage accounts"
        },
        "Remediation": "From Azure Portal \n1. Go to Storage Accounts \n2. For each Storage Account with outdated keys, go to Access keys \n3. Click Rotate key next to the outdated key, then click Yes to the prompt confirming \nthat you want to regenerate the access key. \nAfter Azure regenerates the Access Key, you can confirm that Access keys reflects a \nLast rotated date of (0 days ago).",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each Storage Account, go to Access keys \n3. Review the date in the Last rotated field for each key. \nIf the Last rotated field indicates value greater than 90 day [or greater than your \norganization's period of validity], the key should be rotated.",
            "From Azure CLI": "1. Get a list of storage accounts"
        },
        "Default Value": "By default, access keys are not regenerated periodically. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/common/storage-create-storage-\naccount#regenerate-storage-access-keys \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-privileged-\naccess#pa-1-separate-and-limit-highly-privilegedadministrative-users \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-2-protect-identity-and-authentication-systems \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-6-define-and-implement-identity-and-privileged-access-strategy \n5. https://www.pcidssguide.com/pci-dss-key-rotation-requirements/ \n6. https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt1r5.pdf",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.1 Establish and Maintain a Secure Configuration Process \n \nEstablish and maintain a secure configuration process for enterprise assets \n end-user devices including portable and mobile non-computing IoT devices and \nservers and software operating systems and applications . Review and update \ndocumentation annually or when significant enterprise changes occur that could \nimpact this Safeguard. \n \n \n \nv8 \n13.11 Tune Security Event Alerting Thresholds \n \nTune security event alerting thresholds monthly or more frequently. \n \n \n \nv7 \n6.8 Regularly Tune SIEM \n \nOn a regular basis tune your SIEM system to better identify actionable events \nand decrease event noise. \n \n \n \nv7 \n11.3 Use Automated Tools to Verify Standard Device \nConfigurations and Detect Changes \n \nCompare all network device configuration against approved security \nconfigurations defined for each network device in use and alert when any deviations \nare discovered. \n \n \n "
    },
    {
        "Rule": "3.5 Ensure Storage Logging is Enabled for Queue Service for \n'Read', 'Write', and 'Delete' requests (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "The Storage Queue service stores messages that may be read by any client who has \naccess to the storage account. A queue can contain an unlimited number of messages, \neach of which can be up to 64KB in size using version 2011-08-18 or newer. Storage \nLogging happens server-side and allows details for both successful and failed requests \nto be recorded in the storage account. These logs allow users to see the details of read, \nwrite, and delete operations against the queues. Storage Logging log entries contain the \nfollowing information about individual requests: Timing information such as start time, \nend-to-end latency, and server latency, authentication details, concurrency information, \nand the sizes of the request and response messages.",
        "Rationale": "Storage Analytics logs contain detailed information about successful and failed requests \nto a storage service. This information can be used to monitor individual requests and to \ndiagnose issues with a storage service. Requests are logged on a best-effort basis. \nStorage Analytics logging is not enabled by default for your storage account. \nImpact: \nEnabling this setting can have a high impact on the cost of the log analytics service and \ndata storage used by logging more data per each request. Do not enable this without \ndetermining your need for this level of logging, and do not forget to check in on data \nusage and projected cost. Some users have seen their logging costs increase from $10 \nper month to $10,000 per month.",
        "Audit": "From Azure Portal: \n1. Go to Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the queue tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logs section and that they are sent to the correct destination.",
        "Audit Steps": {
            "From Azure Portal": ": \n1. Go to Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the queue tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logs section and that they are sent to the correct destination."
        },
        "Remediation": "From Azure Portal \n1. Go to Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the queue tab indented below the storage account. \n5. Click + Add diagnostic setting. \n6. Select StorageRead, StorageWrite and StorageDelete options under the Logs \nsection to enable Storage Logging for Queue service. \n7. Select a destination for your logs to be sent to. \nFrom Azure CLI \nUse the below command to enable the Storage Logging for Queue service. \naz storage logging update --account-name <storageAccountName> --account-key \n<storageAccountKey> --services q --log rwd --retention 90",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. Go to Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the queue tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logs section and that they are sent to the correct destination."
        },
        "Default Value": "By default storage account queue services are not logged. \nReferences: \n1. https://docs.microsoft.com/en-us/rest/api/storageservices/about-storage-\nanalytics-logging \n2. https://docs.microsoft.com/en-us/cli/azure/storage/logging?view=azure-cli-latest \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-4-enable-network-logging-for-security-investigation \n4. https://docs.microsoft.com/en-us/azure/storage/queues/monitor-queue-\nstorage?tabs=azure-portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.6 Securely Manage Enterprise Assets and Software \n \nSecurely manage enterprise assets and software. Example implementations \ninclude managing configuration through version-controlled-infrastructure-as-code \nand accessing administrative interfaces over secure network protocols such as \nSecure Shell SSH and Hypertext Transfer Protocol Secure HTTPS . Do not use \ninsecure management protocols such as Telnet Teletype Network and HTTP \nunless operationally essential. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "3.6 Ensure that Shared Access Signature Tokens Expire Within \nan Hour (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Expire shared access signature tokens within an hour.",
        "Rationale": "A shared access signature (SAS) is a URI that grants restricted access rights to Azure \nStorage resources. A shared access signature can be provided to clients who should \nnot be trusted with the storage account key but for whom it may be necessary to \ndelegate access to certain storage account resources. Providing a shared access \nsignature URI to these clients allows them access to a resource for a specified period of \ntime. This time should be set as low as possible and preferably no longer than an hour.",
        "Audit": "Currently, SAS token expiration times cannot be audited. Until Microsoft makes token \nexpiration time a setting rather than a token creation parameter, this recommendation \nwould require a manual verification.",
        "Audit Steps": {},
        "Remediation": "When generating shared access signature tokens, use start and end time such that it \nfalls within an hour. \nFrom Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, go to Shared access signature \n3. Set Start and expiry date/time within an hour",
        "Remediation Steps": {},
        "Default Value": "By default, expiration for shared access signature is set to 8 hours. \nReferences: \n1. https://docs.microsoft.com/en-us/rest/api/storageservices/delegating-access-\nwith-a-shared-access-signature \n2. https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "3.7 Ensure that 'Public Network Access' is `Disabled' for storage \naccounts (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Disallowing public network access for a storage account overrides the public access \nsettings for individual containers in that storage account for Azure Resource Manager \nDeployment Model storage accounts. Azure Storage accounts that use the classic \ndeployment model will be retired on August 31, 2024.",
        "Rationale": "The default network configuration for a storage account permits a user with appropriate \npermissions to configure public network access to containers and blobs in a storage \naccount. Keep in mind that public access to a container is always turned off by default \nand must be explicitly configured to permit anonymous requests. It grants read-only \naccess to these resources without sharing the account key, and without requiring a \nshared access signature. It is recommended not to provide public network access to \nstorage accounts until, and unless, it is strongly desired. A shared access signature \ntoken or Azure AD RBAC should be used for providing controlled and timed access to \nblob containers. \nImpact: \nAccess will have to be managed using shared access signatures or via Azure AD \nRBAC.",
        "Audit": "From Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, under the Security + networking section, click \nNetworking \n3. Ensure the Public Network Access setting is set to Disabled. \nFrom Azure CLI \nEnsure publicNetworkAccess is Disabled \naz storage account show --name <storage-account> --resource-group <resource-\ngroup> --query \"{publicNetworkAccess:publicNetworkAccess}\" \nFrom PowerShell \nFor each Storage Account, ensure PublicNetworkAccess is Disabled",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, under the Security + networking section, click \nNetworking \n3. Ensure the Public Network Access setting is set to Disabled.",
            "From Azure CLI": "Ensure publicNetworkAccess is Disabled \naz storage account show --name <storage-account> --resource-group <resource-\ngroup> --query \"{publicNetworkAccess:publicNetworkAccess}\" \nFrom PowerShell \nFor each Storage Account, ensure PublicNetworkAccess is Disabled"
        },
        "Remediation": "From Azure Portal \nFirst, follow Microsoft documentation and create shared access signature tokens for \nyour blob containers. Then, \n1. Go to Storage Accounts \n2. For each storage account, under the Security + networking section, click \nNetworking \n3. Set Public Network Access to Disabled. \nFrom Azure CLI \nSet 'Public Network Access' to Disabled on the storage account \naz storage account update --name <storage-account> --resource-group \n<resource-group> --public-network-access Disabled \nFrom PowerShell \nFor each Storage Account, run the following to set the PublicNetworkAccess setting to \nDisabled \nSet-AzStorageAccount -ResourceGroupName <resource group name> -Name <storage \naccount name> -PublicNetworkAccess Disabled",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, under the Security + networking section, click \nNetworking \n3. Ensure the Public Network Access setting is set to Disabled.",
            "From Azure CLI": "Ensure publicNetworkAccess is Disabled \naz storage account show --name <storage-account> --resource-group <resource-\ngroup> --query \"{publicNetworkAccess:publicNetworkAccess}\" \nFrom PowerShell \nFor each Storage Account, ensure PublicNetworkAccess is Disabled"
        },
        "Default Value": "By default, Public Network Access is set to Enabled from all networks for the Storage \nAccount. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/blobs/storage-manage-access-to-\nresources \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-governance-\nstrategy#gs-2-define-and-implement-enterprise-segmentationseparation-of-\nduties-strategy",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "3.8 Ensure Default Network Access Rule for Storage Accounts is \nSet to Deny (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Restricting default network access helps to provide a new layer of security, since \nstorage accounts accept connections from clients on any network. To limit access to \nselected networks, the default action must be changed.",
        "Rationale": "Storage accounts should be configured to deny access to traffic from all networks \n(including internet traffic). Access can be granted to traffic from specific Azure Virtual \nnetworks, allowing a secure network boundary for specific applications to be built. \nAccess can also be granted to public internet IP address ranges to enable connections \nfrom specific internet or on-premises clients. When network rules are configured, only \napplications from allowed networks can access a storage account. When calling from an \nallowed network, applications continue to require proper authorization (a valid access \nkey or SAS token) to access the storage account. \nImpact: \nAll allowed networks will need to be whitelisted on each specific network, creating \nadministrative overhead. This may result in loss of network connectivity, so do not turn \non for critical resources during business hours.",
        "Audit": "From Azure Console \n1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade. \n3. Click the Firewalls and virtual networks heading. \n4. Ensure that Allow access from All networks is not selected. \nFrom Azure CLI \nEnsure defaultAction is not set to Allow. \n    az storage account list --query '[*].networkRuleSet' \nFrom PowerShell",
        "Audit Steps": {
            "From Azure Console": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade. \n3. Click the Firewalls and virtual networks heading. \n4. Ensure that Allow access from All networks is not selected.",
            "From Azure CLI": "Ensure defaultAction is not set to Allow. \n    az storage account list --query '[*].networkRuleSet' \nFrom PowerShell"
        },
        "Remediation": "From Azure Console \n1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click the Firewalls and virtual networks heading. \n4. Ensure that you have elected to allow access from Selected networks \n5. Add rules to allow traffic from specific network. \n6. Click Save to apply your changes. \nFrom Azure CLI \nUse the below command to update default-action to Deny. \n    az storage account update --name <StorageAccountName> --resource-group \n<resourceGroupName> --default-action Deny",
        "Remediation Steps": {
            "From Azure Console": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade. \n3. Click the Firewalls and virtual networks heading. \n4. Ensure that Allow access from All networks is not selected.",
            "From Azure CLI": "Ensure defaultAction is not set to Allow. \n    az storage account list --query '[*].networkRuleSet' \nFrom PowerShell"
        },
        "Default Value": "By default, Storage Accounts will accept connections from clients on any network. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/common/storage-network-\nsecurity",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share \nclaims application or database specific access control lists. These controls will \nenforce the principle that only authorized individuals should have access to the \ninformation based on their need to access the information as a part of their \nresponsibilities. \n \n \n "
    },
    {
        "Rule": "3.9 Ensure 'Allow Azure services on the trusted services list to \naccess this storage account' is Enabled for Storage Account \nAccess (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Some Azure services that interact with storage accounts operate from networks that \ncan't be granted access through network rules. To help this type of service work as \nintended, allow the set of trusted Azure services to bypass the network rules. These \nservices will then use strong authentication to access the storage account. If the Allow \ntrusted Azure services exception is enabled, the following services are granted access \nto the storage account: Azure Backup, Azure Site Recovery, Azure DevTest Labs, \nAzure Event Grid, Azure Event Hubs, Azure Networking, Azure Monitor, and Azure SQL \nData Warehouse (when registered in the subscription).",
        "Rationale": "Turning on firewall rules for storage account will block access to incoming requests for \ndata, including from other Azure services. We can re-enable this functionality by \nenabling \"Trusted Azure Services\" through networking exceptions. \nImpact: \nThis creates authentication credentials for services that need access to storage \nresources so that services will no longer need to communicate via network request. \nThere may be a temporary loss of communication as you set each Storage Account. It \nis recommended to not do this on mission-critical resources during business hours.",
        "Audit": "From Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click on the Firewalls and virtual networks heading. \n4. Ensure that Enabled from selected virtual networks and IP addresses is \nselected. \n5. Ensure that Allow Azure services on the trusted services list to access \nthis storage account is checked in Exceptions. \nFrom Azure CLI \nEnsure bypass contains AzureServices",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click on the Firewalls and virtual networks heading. \n4. Ensure that Enabled from selected virtual networks and IP addresses is \nselected. \n5. Ensure that Allow Azure services on the trusted services list to access \nthis storage account is checked in Exceptions.",
            "From Azure CLI": "Ensure bypass contains AzureServices"
        },
        "Remediation": "From Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click on the Firewalls and virtual networks heading. \n4. Ensure that Enabled from selected virtual networks and IP addresses is \nselected. \n5. Under the 'Exceptions' label, enable check box for Allow Azure services on the \ntrusted services list to access this storage account. \n6. Click Save to apply your changes. \nFrom Azure CLI \nUse the below command to update Azure services. \naz storage account update --name <StorageAccountName> --resource-group \n<resourceGroupName> --bypass AzureServices",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Storage Accounts \n2. For each storage account, Click on the Networking blade \n3. Click on the Firewalls and virtual networks heading. \n4. Ensure that Enabled from selected virtual networks and IP addresses is \nselected. \n5. Ensure that Allow Azure services on the trusted services list to access \nthis storage account is checked in Exceptions.",
            "From Azure CLI": "Ensure bypass contains AzureServices"
        },
        "Default Value": "By default, Storage Accounts will accept connections from clients on any network. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/common/storage-network-\nsecurity",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.2 Establish and Maintain a Secure Network \nArchitecture \n \nEstablish and maintain a secure network architecture. A secure network \narchitecture must address segmentation least privilege and availability at a \nminimum. \n \n \n \nv7 \n13.3 Monitor and Block Unauthorized Network Traffic \n \nDeploy an automated tool on network perimeters that monitors for \nunauthorized transfer of sensitive information and blocks such transfers while \nalerting information security professionals. \n \n \n "
    },
    {
        "Rule": "3.10 Ensure Private Endpoints are used to access Storage \nAccounts (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Use private endpoints for your Azure Storage accounts to allow clients and services to \nsecurely access data located over a network via an encrypted Private Link. To do this, \nthe private endpoint uses an IP address from the VNet for each service. Network traffic \nbetween disparate services securely traverses encrypted over the VNet. This VNet can \nalso link addressing space, extending your network and accessing resources on it. \nSimilarly, it can be a tunnel through public networks to connect remote infrastructures \ntogether. This creates further security through segmenting network traffic and \npreventing outside sources from accessing it.",
        "Rationale": "Securing traffic between services through encryption protects the data from easy \ninterception and reading. \nImpact: \nThere is no cost in deploying VNets between Azure resources. If improperly \nimplemented, it may result in loss of critical network traffic.",
        "Audit": "From Azure Portal \n1. Open the Storage Accounts blade. \n2. For each listed Storage Account, perform the following check: \n3. Under the Security + networking heading, click on Networking. \n4. Click on the Private Endpoint Connections tab at the top of the networking \nwindow. \n5. Ensure that for each VNet that the Storage Account must be accessed from, a \nunique Private Endpoint is deployed and the Connection State for each Private \nEndpoint is Approved \nRepeat the procedure for each Storage Account.",
        "Audit Steps": {
            "From Azure Portal": "1. Open the Storage Accounts blade. \n2. For each listed Storage Account, perform the following check: \n3. Under the Security + networking heading, click on Networking. \n4. Click on the Private Endpoint Connections tab at the top of the networking \nwindow. \n5. Ensure that for each VNet that the Storage Account must be accessed from, a \nunique Private Endpoint is deployed and the Connection State for each Private \nEndpoint is Approved \nRepeat the procedure for each Storage Account."
        },
        "Remediation": "From Azure Portal \n1. Open the Storage Accounts blade \n2. For each listed Storage Account, perform the following: \n3. Under the Security + networking heading, click on Networking \n4. Click on the Private Endpoint Connections tab at the top of the networking \nwindow \n5. Click the +Private endpoint button \n6. In the 1 - Basics tab/step: \no  \nEnter a name that will be easily recognizable as associated with the \nStorage Account (Note: The \"Network Interface Name\" will be \nautomatically completed, but you can customize it if needed.) \no Ensure that the Region matches the region of the Storage Account \no Click Next \n7. In the 2 - Resource tab/step:",
        "Remediation Steps": {
            "From Azure Portal": "1. Open the Storage Accounts blade. \n2. For each listed Storage Account, perform the following check: \n3. Under the Security + networking heading, click on Networking. \n4. Click on the Private Endpoint Connections tab at the top of the networking \nwindow. \n5. Ensure that for each VNet that the Storage Account must be accessed from, a \nunique Private Endpoint is deployed and the Connection State for each Private \nEndpoint is Approved \nRepeat the procedure for each Storage Account."
        },
        "Default Value": "By default, Storage Accounts will accept connections from clients on any network. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/common/storage-network-\nsecurity",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv8 \n13.5 Manage Access Control for Remote Assets \n \nManage access control for assets remotely connecting to enterprise resources. \nDetermine amount of access to enterprise resources based on up-to-date anti-\nmalware software installed configuration compliance with the enterprise s secure \nconfiguration process and ensuring the operating system and applications are up-\nto-date. \n \n \n \nv7 \n13.3 Monitor and Block Unauthorized Network Traffic \n \nDeploy an automated tool on network perimeters that monitors for unauthorized \ntransfer of sensitive information and blocks such transfers while alerting information \nsecurity professionals. \n \n \n "
    },
    {
        "Rule": "3.11 Ensure Soft Delete is Enabled for Azure Containers and Blob \nStorage (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "The Azure Storage blobs contain data like ePHI or Financial, which can be secret or \npersonal. Data that is erroneously modified or deleted by an application or other storage \naccount user will cause data loss or unavailability. \nIt is recommended that both Azure Containers with attached Blob Storage and \nstandalone containers with Blob Storage be made recoverable by enabling the soft \ndelete configuration. This is to save and recover data when blobs or blob snapshots are \ndeleted.",
        "Rationale": "Containers and Blob Storage data can be incorrectly deleted. An attacker/malicious \nuser may do this deliberately in order to cause disruption. Deleting an Azure Storage \nblob causes immediate data loss. Enabling this configuration for Azure storage ensures \nthat even if blobs/data were deleted from the storage account, Blobs/data objects are \nrecoverable for a particular time which is set in the \"Retention policies,\" ranging from 7 \ndays to 365 days. \nImpact: \nAdditional storage costs may be incurred as snapshots are retained.",
        "Audit": "From Azure Portal: \n1. From the Azure home page, open the hamburger menu in the top left or click on \nthe arrow pointing right with 'More services' underneath. \n2. Select Storage. \n3. Select Storage Accounts. \n4. For each Storage Account, navigate to Data protection in the left scroll column. \n5. Ensure that soft delete is checked for both blobs and containers. Also check if \nthe retention period is a sufficient length for your organization. \nFrom Azure CLI \nBlob Storage: Ensure that the output of the below command contains enabled status as \ntrue and days is not empty or null \naz storage blob service-properties delete-policy show --account-name \n<StorageAccountName> --account-key <accountkey>",
        "Audit Steps": {
            "From Azure Portal": ": \n1. From the Azure home page, open the hamburger menu in the top left or click on \nthe arrow pointing right with 'More services' underneath. \n2. Select Storage. \n3. Select Storage Accounts. \n4. For each Storage Account, navigate to Data protection in the left scroll column. \n5. Ensure that soft delete is checked for both blobs and containers. Also check if \nthe retention period is a sufficient length for your organization.",
            "From Azure CLI": "Blob Storage: Ensure that the output of the below command contains enabled status as \ntrue and days is not empty or null \naz storage blob service-properties delete-policy show --account-name \n<StorageAccountName> --account-key <accountkey>"
        },
        "Remediation": "From Azure Portal \n1. From the Azure home page, open the hamburger menu in the top left or click on \nthe arrow pointing right with 'More services' underneath. \n2. Select Storage. \n3. Select Storage Accounts. \n4. For each Storage Account, navigate to Data protection in the left scroll column. \n5. Check soft delete for both blobs and containers. Set the retention period to a \nsufficient length for your organization. \nFrom Azure CLI \nUpdate blob storage retention days in below command \naz storage blob service-properties delete-policy update --days-retained \n<RetentionDaysValue> --account-name <StorageAccountName> --account-key \n<AccountKey> --enable true \nUpdate container retention with the below command \naz storage account blob-service-properties update \n    --enable-container-delete-retention true \n    --container-delete-retention-days <days> \n    --account-name <storage-account> \n    --resource-group <resource_group> \n    --account-key <AccountKey>",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. From the Azure home page, open the hamburger menu in the top left or click on \nthe arrow pointing right with 'More services' underneath. \n2. Select Storage. \n3. Select Storage Accounts. \n4. For each Storage Account, navigate to Data protection in the left scroll column. \n5. Ensure that soft delete is checked for both blobs and containers. Also check if \nthe retention period is a sufficient length for your organization.",
            "From Azure CLI": "Blob Storage: Ensure that the output of the below command contains enabled status as \ntrue and days is not empty or null \naz storage blob service-properties delete-policy show --account-name \n<StorageAccountName> --account-key <accountkey>"
        },
        "Default Value": "When a new storage account is created, soft delete for containers and blob storage is \nby default disabled.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.2 Establish and Maintain a Secure Network \nArchitecture \n \nEstablish and maintain a secure network architecture. A secure network \narchitecture must address segmentation least privilege and availability at a \nminimum. \n \n \n \nv7 \n14.1 Segment the Network Based on Sensitivity \n \nSegment the network based on the label or classification level of the \ninformation stored on the servers locate all sensitive information on separated \nVirtual Local Area Networks VLANs . \n \n \n "
    },
    {
        "Rule": "3.12 Ensure Storage for Critical Data are Encrypted with \nCustomer Managed Keys (CMK) (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Enable sensitive data encryption at rest using Customer Managed Keys (CMK) rather \nthan Microsoft Managed keys.",
        "Rationale": "By default, data in the storage account is encrypted using Microsoft Managed Keys at \nrest. All Azure Storage resources are encrypted, including blobs, disks, files, queues, \nand tables. All object metadata is also encrypted. If you want to control and manage this \nencryption key yourself, however, you can specify a customer-managed key. That key is \nused to protect and control access to the key that encrypts your data. You can also \nchoose to automatically update the key version used for Azure Storage encryption \nwhenever a new version is available in the associated Key Vault. \nImpact: \nIf the key expires by setting the 'activation date' and 'expiration date', the user must \nrotate the key manually. \nUsing Customer Managed Keys may also incur additional man-hour requirements to \ncreate, store, manage, and protect the keys as needed.",
        "Audit": "From Azure Console: \n1. Go to Storage Accounts \n2. For each storage account, go to Encryption \n3. Ensure that Encryption type is set to Customer Managed Keys \nFrom PowerShell \nConnect-AzAccount \nSet-AzContext -Subscription <subscription id> \nGet-AzStorageAccount |Select-Object -ExpandProperty Encryption \nPowerShell Results - Non-Compliant \n... \nKeySource                       : Microsoft.Storage \n...",
        "Audit Steps": {
            "From Azure Console": ": \n1. Go to Storage Accounts \n2. For each storage account, go to Encryption \n3. Ensure that Encryption type is set to Customer Managed Keys \nFrom PowerShell \nConnect-AzAccount \nSet-AzContext -Subscription <subscription id> \nGet-AzStorageAccount |Select-Object -ExpandProperty Encryption \nPowerShell Results - Non-Compliant \n... \nKeySource                       : Microsoft.Storage \n..."
        },
        "Remediation": "From Azure Portal \n1. Go to Storage Accounts \n2. For each storage account, go to Encryption \n3. Set Customer Managed Keys \n4. Select the Encryption key and enter the appropriate setting value \n5. Click Save",
        "Remediation Steps": {
            "From Azure Console": ": \n1. Go to Storage Accounts \n2. For each storage account, go to Encryption \n3. Ensure that Encryption type is set to Customer Managed Keys \nFrom PowerShell \nConnect-AzAccount \nSet-AzContext -Subscription <subscription id> \nGet-AzStorageAccount |Select-Object -ExpandProperty Encryption \nPowerShell Results - Non-Compliant \n... \nKeySource                       : Microsoft.Storage \n..."
        },
        "Default Value": "By default, Encryption type is set to Microsoft Managed Keys. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/common/storage-service-\nencryption \n2. https://docs.microsoft.com/en-us/azure/security/fundamentals/data-encryption-\nbest-practices#protect-data-at-rest \n3. https://docs.microsoft.com/en-us/azure/storage/common/storage-service-\nencryption#azure-storage-encryption-versus-disk-encryption \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-\nwhen-required",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n11.1 Establish and Maintain a Data Recovery Process \n \nEstablish and maintain a data recovery process. In the process address the \nscope of data recovery activities recovery prioritization and the security of backup \ndata. Review and update documentation annually or when significant enterprise \nchanges occur that could impact this Safeguard. \n \n \n \nv7 \n10.4 Ensure Protection of Backups \n \nEnsure that backups are properly protected via physical security or encryption \nwhen they are stored as well as when they are moved across the network. This \nincludes remote backups and cloud services. \n \n \n "
    },
    {
        "Rule": "3.13 Ensure Storage logging is Enabled for Blob Service for \n'Read', 'Write', and 'Delete' requests (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "The Storage Blob service provides scalable, cost-efficient object storage in the cloud. \nStorage Logging happens server-side and allows details for both successful and failed \nrequests to be recorded in the storage account. These logs allow users to see the \ndetails of read, write, and delete operations against the blobs. Storage Logging log \nentries contain the following information about individual requests: timing information \nsuch as start time, end-to-end latency, and server latency; authentication details; \nconcurrency information; and the sizes of the request and response messages.",
        "Rationale": "Storage Analytics logs contain detailed information about successful and failed requests \nto a storage service. This information can be used to monitor each individual request to \na storage service for increased security or diagnostics. Requests are logged on a best-\neffort basis. \nStorage Analytics logging is not enabled by default for your storage account. \nImpact: \nBeing a level 2, enabling this setting can have a high impact on the cost of data storage \nused for logging more data per each request. Do not enable this without determining \nyour need for this level of logging or forget to check in on data usage and projected \ncost.",
        "Audit": "From Azure Portal \n1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'blob' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination. \nFrom Azure CLI \nEnsure the below command's output contains properties delete, read and write set to \ntrue.",
        "Audit Steps": {
            "From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'blob' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination.",
            "From Azure CLI": "Ensure the below command's output contains properties delete, read and write set to \ntrue."
        },
        "Remediation": "From Azure Portal \n1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'blob' tab indented below the storage account. \n5. Click '+ Add diagnostic setting'. \n6. Select StorageRead, StorageWrite and StorageDelete options under the Logging \nsection to enable Storage Logging for Blob service. \n7. Select a destination for your logs to be sent to. \nFrom Azure CLI \nUse the below command to enable the Storage Logging for Blob service. \naz storage logging update --account-name <storageAccountName> --account-key \n<storageAccountKey> --services b --log rwd --retention 90",
        "Remediation Steps": {
            "From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'blob' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination.",
            "From Azure CLI": "Ensure the below command's output contains properties delete, read and write set to \ntrue."
        },
        "Default Value": "By default, storage account blob service logging is disabled for read, write, and delete \noperations. \nReferences: \n1. https://docs.microsoft.com/en-us/rest/api/storageservices/about-storage-\nanalytics-logging \n2. https://docs.microsoft.com/en-us/cli/azure/storage/logging?view=azure-cli-latest \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \nAdditional Information: \nWe cannot practically generalize detailed audit log requirements for every blob due to \ntheir nature and intent. This recommendation may be applicable to storage account blob \nservice where the security is paramount.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "3.14 Ensure Storage Logging is Enabled for Table Service for \n'Read', 'Write', and 'Delete' Requests (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Azure Table storage is a service that stores structured NoSQL data in the cloud, \nproviding a key/attribute store with a schema-less design. Storage Logging happens \nserver-side and allows details for both successful and failed requests to be recorded in \nthe storage account. These logs allow users to see the details of read, write, and delete \noperations against the tables. Storage Logging log entries contain the following \ninformation about individual requests: timing information such as start time, end-to-end \nlatency, and server latency; authentication details; concurrency information; and the \nsizes of the request and response messages.",
        "Rationale": "Storage Analytics logs contain detailed information about successful and failed requests \nto a storage service. This information can be used to monitor each individual request to \na storage service for increased security or diagnostics. Requests are logged on a best-\neffort basis. \nStorage Analytics logging is not enabled by default for your storage account. \nImpact: \nBeing a level 2, enabling this setting can have a high impact on the cost of data storage \nused for logging more data per each request. Do not enable this without determining \nyour need for this level of logging or forget to check in on data usage and projected \ncost.",
        "Audit": "From Azure Portal \n1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'table' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination.",
        "Audit Steps": {
            "From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'table' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination."
        },
        "Remediation": "From Azure Portal \n1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'table' tab indented below the storage account. \n5. Click '+ Add diagnostic setting'. \n6. Select StorageRead, StorageWrite and StorageDelete options under the Logging \nsection to enable Storage Logging for Table service. \n7. Select a destination for your logs to be sent to. \nFrom Azure CLI \nUse the below command to enable the Storage Logging for Table service. \naz storage logging update --account-name <storageAccountName> --account-key \n<storageAccountKey> --services t --log rwd --retention 90",
        "Remediation Steps": {
            "From Azure Portal": "1. From the default portal page select Storage Accounts. \n2. Select the specific Storage Account. \n3. Click the Diagnostics settings under the Monitoring section in the left column. \n4. Select the 'table' tab indented below the storage account. Then select the \ndiagnostic setting listed. \n5. Ensure StorageRead, StorageWrite, and StorageDelete options are selected \nunder the Logging section and that they are sent to the correct destination."
        },
        "Default Value": "By default, storage account table service logging is disabled for read, write, an delete \noperations \nReferences: \n1. https://docs.microsoft.com/en-us/rest/api/storageservices/about-storage-\nanalytics-logging \n2. https://docs.microsoft.com/en-us/cli/azure/storage/logging?view=azure-cli-latest \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "3.15 Ensure the \"Minimum TLS version\" for storage accounts is \nset to \"Version 1.2\" (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "In some cases, Azure Storage sets the minimum TLS version to be version 1.0 by \ndefault. TLS 1.0 is a legacy version and has known vulnerabilities. This minimum TLS \nversion can be configured to be later protocols such as TLS 1.2.",
        "Rationale": "TLS 1.0 has known vulnerabilities and has been replaced by later versions of the TLS \nprotocol. Continued use of this legacy protocol affects the security of data in transit. \nImpact: \nWhen set to TLS 1.2 all requests must leverage this version of the protocol. Applications \nleveraging legacy versions of the protocol will fail.",
        "Audit": "From Azure Console \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Storage Accounts \n3. Click on each Storage Account \n4. Under Setting section, Click on Configuration \n5. Ensure that the minimum TLS version is set to be Version 1.2 \nFrom Azure CLI \nGet a list of all storage accounts and their resource groups \naz storage account list | jq '.[] | {name, resourceGroup}' \nThen query the minimumTLSVersion field \naz storage account show \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --query minimumTlsVersion \\ \n    --output tsv \nFrom Azure PowerShell \nTo get the minimum TLS version, run the following command: \n(Get-AzStorageAccount -Name <STORAGEACCOUNTNAME>  -ResourceGroupName \n<RESOURCEGROUPNAME>).MinimumTlsVersion",
        "Audit Steps": {
            "From Azure Console": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Storage Accounts \n3. Click on each Storage Account \n4. Under Setting section, Click on Configuration \n5. Ensure that the minimum TLS version is set to be Version 1.2",
            "From Azure CLI": "Get a list of all storage accounts and their resource groups \naz storage account list | jq '.[] | {name, resourceGroup}' \nThen query the minimumTLSVersion field \naz storage account show \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --query minimumTlsVersion \\ \n    --output tsv",
            "From Azure PowerShell": "To get the minimum TLS version, run the following command: \n(Get-AzStorageAccount -Name <STORAGEACCOUNTNAME>  -ResourceGroupName \n<RESOURCEGROUPNAME>).MinimumTlsVersion"
        },
        "Remediation": "From Azure Console \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Storage Accounts \n3. Click on each Storage Account \n4. Under Setting section, Click on Configuration \n5. Set the minimum TLS version to be Version 1.2 \nFrom Azure CLI \naz storage account update \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --min-tls-version TLS1_2 \nFrom Azure PowerShell \nTo set the minimum TLS version, run the following command: \nSet-AzStorageAccount -AccountName <STORAGEACCOUNTNAME> ` \n                     -ResourceGroupName <RESOURCEGROUPNAME> ` \n                     -MinimumTlsVersion TLS1_2",
        "Remediation Steps": {
            "From Azure Console": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Storage Accounts \n3. Click on each Storage Account \n4. Under Setting section, Click on Configuration \n5. Ensure that the minimum TLS version is set to be Version 1.2",
            "From Azure CLI": "Get a list of all storage accounts and their resource groups \naz storage account list | jq '.[] | {name, resourceGroup}' \nThen query the minimumTLSVersion field \naz storage account show \\ \n    --name <storage-account> \\ \n    --resource-group <resource-group> \\ \n    --query minimumTlsVersion \\ \n    --output tsv",
            "From Azure PowerShell": "To get the minimum TLS version, run the following command: \n(Get-AzStorageAccount -Name <STORAGEACCOUNTNAME>  -ResourceGroupName \n<RESOURCEGROUPNAME>).MinimumTlsVersion"
        },
        "Default Value": "If a storage account is created through the portal, the MinimumTlsVersion property for \nthat storage account will be set to TLS 1.2. \nIf a storage account is created through PowerShell or CLI, the MinimumTlsVersion \nproperty for that storage account will not be set, and defaults to TLS 1.0. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/storage/common/transport-layer-security-\nconfigure-minimum-version?tabs=portal \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "3.16 Ensure 'Cross Tenant Replication' is not enabled \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Cross Tenant Replication in Azure allows data to be replicated across multiple Azure \ntenants. While this feature can be beneficial for data sharing and availability, it also \nposes a significant security risk if not properly managed. Unauthorized data access, \ndata leakage, and compliance violations are potential risks. Disabling Cross Tenant \nReplication ensures that data is not inadvertently replicated across different tenant \nboundaries without explicit authorization.",
        "Rationale": "Disabling Cross Tenant Replication minimizes the risk of unauthorized data access and \nensures that data governance policies are strictly adhered to. This control is especially \ncritical for organizations with stringent data security and privacy requirements, as it \nprevents the accidental sharing of sensitive information. \nImpact: \nDisabling Cross Tenant Replication may affect data availability and sharing across \ndifferent Azure tenants. Ensure that this change aligns with your organizational data \nsharing and availability requirements.",
        "Audit": "From Azure Portal \nLogin to the Azure Portal using https://portal.azure.com \n1. Navigate to Storage Accounts \n2. For each storage account, on the left blade under Data Management, click on \nObject replication \n3. Select Advanced settings \n4. Make sure Allow cross-tenant replication is not checked \nFrom Azure CLI \naz storage account list --query \"[*].[name,allowCrossTenantReplication]\" \nThe value of false should be returned for each storage account listed.",
        "Audit Steps": {
            "From Azure Portal": "Login to the Azure Portal using https://portal.azure.com \n1. Navigate to Storage Accounts \n2. For each storage account, on the left blade under Data Management, click on \nObject replication \n3. Select Advanced settings \n4. Make sure Allow cross-tenant replication is not checked",
            "From Azure CLI": "az storage account list --query \"[*].[name,allowCrossTenantReplication]\" \nThe value of false should be returned for each storage account listed."
        },
        "Remediation": "From Azure Portal \n1. Navigate to Storage Accounts \n2. For each storage account, on the left blade under Data Management, click on \nObject replication \n3. Click on Advanced settings and untick Allow cross-tenant replication \n4. Click on OK \nFrom Azure CLI \nReplace the information within <> with appropriate values: \naz storage account update --name <storageAccountName> --resource-group \n<resourceGroupName> --allow-cross-tenant-replication false",
        "Remediation Steps": {
            "From Azure Portal": "Login to the Azure Portal using https://portal.azure.com \n1. Navigate to Storage Accounts \n2. For each storage account, on the left blade under Data Management, click on \nObject replication \n3. Select Advanced settings \n4. Make sure Allow cross-tenant replication is not checked",
            "From Azure CLI": "az storage account list --query \"[*].[name,allowCrossTenantReplication]\" \nThe value of false should be returned for each storage account listed."
        },
        "Default Value": "For new storage accounts created after Dec 15, 2023 cross tenant replication is not \nenabled. \nReferences: \n1. https://learn.microsoft.com/en-us/azure/storage/blobs/object-replication-prevent-\ncross-tenant-policies?tabs=portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply \ndata access control lists also known as access permissions to local and remote \nfile systems databases and applications. \n \n \n \nv7 \n13.4 Only Allow Access to Authorized Cloud Storage or \nEmail Providers \n \nOnly allow access to authorized cloud storage or email providers. \n \n \n "
    },
    {
        "Rule": "3.17 Ensure that `Allow Blob Anonymous Access` is set to \n`Disabled` (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "The Azure Storage setting \u2018Allow Blob Anonymous Access\u2019 (aka \n\"allowBlobPublicAccess\") controls whether anonymous access is allowed for blob data \nin a storage account. When this property is set to True, it enables public read access to \nblob data, which can be convenient for sharing data but may carry security risks. When \nset to False, it disallows public access to blob data, providing a more secure storage \nenvironment.",
        "Rationale": "If \"Allow Blob Anonymous Access\" is enabled, blobs can be accessed by adding the \nblob name to the URL to see the contents. An attacker can enumerate a blob using \nmethods, such as brute force, and access them. \nExfiltration of data by brute force enumeration of items from a storage account may \noccur if this setting is set to 'Enabled'. \nImpact: \nAdditional consideration may be required for exceptional circumstances where elements \nof a storage account require public accessibility. In these circumstances, it is highly \nrecommended that all data stored in the public facing storage account be reviewed for \nsensitive or potentially compromising data, and that sensitive or compromising data is \nnever stored in these storage accounts.",
        "Audit": "From Azure Portal: \n1. Open the Storage Accounts blade \n2. Click on a Storage Account \n3. In the storage account menu pane, under the Settings section, click \nConfiguration. \n4. Under Allow Blob Anonymous Access ensure that the selected setting is \nDisabled. \nRepeat these steps for each Storage Account.",
        "Audit Steps": {
            "From Azure Portal": ": \n1. Open the Storage Accounts blade \n2. Click on a Storage Account \n3. In the storage account menu pane, under the Settings section, click \nConfiguration. \n4. Under Allow Blob Anonymous Access ensure that the selected setting is \nDisabled. \nRepeat these steps for each Storage Account."
        },
        "Remediation": "From Azure Portal: \n1. Open the Storage Accounts blade \n2. Click on a Storage Account \n3. In the storage account menu pane, under the Settings section, click \nConfiguration. \n4. Under Allow Blob Anonymous Access, select Disabled. \nRepeat these steps for each Storage Account. \nFrom Powershell: \nFor every storage account in scope, run the following: \n$storageAccount = Get-AzStorageAccount -ResourceGroupName \n\"<yourResourceGroup>\" -Name \"<yourStorageAccountName>\" \n$storageAccount.AllowBlobPublicAccess = $false \nSet-AzStorageAccount -InputObject $storageAccount",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. Open the Storage Accounts blade \n2. Click on a Storage Account \n3. In the storage account menu pane, under the Settings section, click \nConfiguration. \n4. Under Allow Blob Anonymous Access ensure that the selected setting is \nDisabled. \nRepeat these steps for each Storage Account."
        },
        "Default Value": "Disabled \nReferences: \n1. https://learn.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-\nprevent?tabs=portal \n2. https://learn.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-\nprevent?source=recommendations&tabs=portal \n3. Classic Storage Accounts: https://learn.microsoft.com/en-\nus/azure/storage/blobs/anonymous-read-access-prevent-classic?tabs=portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply \ndata access control lists also known as access permissions to local and remote \nfile systems databases and applications. \n \n \n \nv7 \n13.4 Only Allow Access to Authorized Cloud Storage or \nEmail Providers \n \nOnly allow access to authorized cloud storage or email providers. \n \n \n "
    },
    {
        "Rule": "4.1.1 Ensure that 'Auditing' is set to 'On' (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable auditing on SQL Servers.",
        "Rationale": "The Azure platform allows a SQL server to be created as a service. Enabling auditing at \nthe server level ensures that all existing and newly created databases on the SQL \nserver instance are audited. Auditing policy applied on the SQL database does not \noverride auditing policy and settings applied on the particular SQL server where the \ndatabase is hosted. \nAuditing tracks database events and writes them to an audit log in the Azure storage \naccount. It also helps to maintain regulatory compliance, understand database activity, \nand gain insight into discrepancies and anomalies that could indicate business concerns \nor suspected security violations.",
        "Audit": "From Azure Portal \n1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. Ensure that Enable Azure SQL Auditing is set to On \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <ResourceGroupName> -ServerName \n<SQLServerName> \nEnsure that BlobStorageTargetState, EventHubTargetState, or \nLogAnalyticsTargetState is set to Enabled. \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9 - Name: 'Auditing on SQL \nserver should be enabled'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. Ensure that Enable Azure SQL Auditing is set to On \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <ResourceGroupName> -ServerName \n<SQLServerName> \nEnsure that BlobStorageTargetState, EventHubTargetState, or \nLogAnalyticsTargetState is set to Enabled.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9 - Name: 'Auditing on SQL \nserver should be enabled'"
        },
        "Remediation": "From Azure Portal \n1. Go to SQL servers \n2. Select the SQL server instance \n3. Under Security, click Auditing \n4. Click the toggle next to Enable Azure SQL Auditing \n5. Select an Audit log destination \n6. Click Save \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server, enable auditing and set the retention for at least 90 days. \nLog Analytics Example \nSet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<SQL Server name> -RetentionInDays <Number of Days to retain the audit logs, \nshould be 90days minimum> -LogAnalyticsTargetState Enabled -\nWorkspaceResourceId \"/subscriptions/<subscription \nID>/resourceGroups/insights-\nintegration/providers/Microsoft.OperationalInsights/workspaces/<workspace \nname> \nEvent Hub Example \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -EventHubTargetState Enabled -EventHubName  \n    \"<Event Hub name>\" -EventHubAuthorizationRuleResourceId \"<Event Hub \nAuthorization Rule Resource ID>\" \nBlob Storage Example* \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -BlobStorageTargetState Enabled  \n    -StorageAccountResourceId \n\"/subscriptions/<subscription_ID>/resourceGroups/<Resource_Group>/providers/M\nicrosoft.Stora \n    ge/storageAccounts/<Storage Account name>\"",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. Ensure that Enable Azure SQL Auditing is set to On \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <ResourceGroupName> -ServerName \n<SQLServerName> \nEnsure that BlobStorageTargetState, EventHubTargetState, or \nLogAnalyticsTargetState is set to Enabled.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9 - Name: 'Auditing on SQL \nserver should be enabled'"
        },
        "Default Value": "By default, Enable Azure SQL Auditing is set to Off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-\nauditing-on-sql-servers \n2. https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/get-\nazurermsqlserverauditing?view=azurermps-5.2.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share \nclaims application or database specific access control lists. These controls will \nenforce the principle that only authorized individuals should have access to the \ninformation based on their need to access the information as a part of their \nresponsibilities. \n \n \n "
    },
    {
        "Rule": "4.1.2 Ensure no Azure SQL Databases allow ingress from \n0.0.0.0/0 (ANY IP) (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that no SQL Databases allow ingress from 0.0.0.0/0 (ANY IP).",
        "Rationale": "Azure SQL Server includes a firewall to block access to unauthorized connections. \nMore granular IP addresses can be defined by referencing the range of addresses \navailable from specific datacenters. \nBy default, for a SQL server, a Firewall exists with StartIp of 0.0.0.0 and EndIP of \n0.0.0.0 allowing access to all the Azure services. \nAdditionally, a custom rule can be set up with StartIp of 0.0.0.0 and EndIP of \n255.255.255.255 allowing access from ANY IP over the Internet. \nIn order to reduce the potential attack surface for a SQL server, firewall rules should be \ndefined with more granular IP addresses by referencing the range of addresses \navailable from specific datacenters. \nImpact: \nDisabling Allow Azure services and resources to access this server will break all \nconnections to SQL server and Hosted Databases unless custom IP specific rules are \nadded in Firewall Policy.",
        "Audit": "From Azure Portal \n1. Go to SQL servers \n2. For each SQL server \n3. Click on Networking \n4. Ensure that Allow Azure services and resources to access this server is \nUnchecked \n5. Ensure that no firewall rule exists with \n\u2022 \nStart IP of 0.0.0.0 \n\u2022 \nor other combinations which allows access to wider public IP ranges",
        "Audit Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each SQL server \n3. Click on Networking \n4. Ensure that Allow Azure services and resources to access this server is \nUnchecked \n5. Ensure that no firewall rule exists with \n\u2022 \nStart IP of 0.0.0.0 \n\u2022 \nor other combinations which allows access to wider public IP ranges"
        },
        "Remediation": "From Azure Portal \n1. Go to SQL servers \n2. For each SQL server \n3. Click on Networking \n4. Uncheck the checkbox for Allow Azure services and resources to access this \nserver \n5. Set firewall rules to limit access to only authorized connections",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each SQL server \n3. Click on Networking \n4. Ensure that Allow Azure services and resources to access this server is \nUnchecked \n5. Ensure that no firewall rule exists with \n\u2022 \nStart IP of 0.0.0.0 \n\u2022 \nor other combinations which allows access to wider public IP ranges"
        },
        "Default Value": "By default, Enable Azure SQL Auditing is set to Off. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-enable-\nauditing-on-sql-servers \n2. https://docs.microsoft.com/en-us/powershell/module/azurerm.sql/get-\nazurermsqlserverauditing?view=azurermps-5.2.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "4.1.3 Ensure SQL server's Transparent Data Encryption (TDE) \nprotector is encrypted with Customer-managed key (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Transparent Data Encryption (TDE) with Customer-managed key support provides \nincreased transparency and control over the TDE Protector, increased security with an \nHSM-backed external service, and promotion of separation of duties. \nWith TDE, data is encrypted at rest with a symmetric key (called the database \nencryption key) stored in the database or data warehouse distribution. To protect this \ndata encryption key (DEK) in the past, only a certificate that the Azure SQL Service \nmanaged could be used. Now, with Customer-managed key support for TDE, the DEK \ncan be protected with an asymmetric key that is stored in the Azure Key Vault. The \nAzure Key Vault is a highly available and scalable cloud-based key store which offers \ncentral key management, leverages FIPS 140-2 Level 2 validated hardware security \nmodules (HSMs), and allows separation of management of keys and data for additional \nsecurity. \nBased on business needs or criticality of data/databases hosted on a SQL server, it is \nrecommended that the TDE protector is encrypted by a key that is managed by the data \nowner (Customer-managed key).",
        "Rationale": "Customer-managed key support for Transparent Data Encryption (TDE) allows user \ncontrol of TDE encryption keys and restricts who can access them and when. Azure \nKey Vault, Azure\u2019s cloud-based external key management system, is the first key \nmanagement service where TDE has integrated support for Customer-managed keys. \nWith Customer-managed key support, the database encryption key is protected by an \nasymmetric key stored in the Key Vault. The asymmetric key is set at the server level \nand inherited by all databases under that server. \nImpact: \nOnce TDE protector is encrypted with a Customer-managed key, it transfers entire \nresponsibility of respective key management on to you, and hence you should be more \ncareful about doing any operations on the particular key in order to keep data from \ncorresponding SQL server and Databases hosted accessible. \nWhen deploying Customer Managed Keys, it is prudent to ensure that you also deploy \nan automated toolset for managing these keys (this should include discovery and key \nrotation), and Keys should be stored in an HSM or hardware backed keystore, such as \nAzure Key Vault.",
        "Audit": "From Azure Portal \n1. Go to SQL servers \nFor the desired server instance \n2. Click On Transparent data encryption \n3. Ensure that Customer-managed key is selected \n4. Ensure Make selected key the default TDE protector is checked \nFrom Azure CLI \naz account get-access-token --query \n\"{subscripton:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/resourceGroups/{resourceGroupNa\nme}/providers/Microsoft.Sql/servers/{serverName}/encryptionProtector?api-\nversion=2015-05-01-preview' \nEnsure the output of the command contains properties \nkind set to azurekeyvault \nserverKeyType set to AzureKeyVault \nuri is not null \n \nFrom PowerShell \nGet-AzSqlServerTransparentDataEncryptionProtector -ServerName <ServerName> -\nResourceGroupName <ResourceGroupName> \nEnsure the output of the command contains properties \nType set to AzureKeyVault \nServerKeyVaultKeyName set to KeyVaultName_KeyName_KeyIdentifierVersion \nKeyId set to KeyIdentifier \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 0a370ff3-6cab-4e85-8995-295fd854c5b8 - Name: 'SQL servers \nshould use customer-managed keys to encrypt data at rest' \n\u2022 \nPolicy ID: ac01ad65-10e5-46df-bdd9-6b0cad13e1d2 - Name: 'SQL managed \ninstances should use customer-managed keys to encrypt data at rest'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to SQL servers \nFor the desired server instance \n2. Click On Transparent data encryption \n3. Ensure that Customer-managed key is selected \n4. Ensure Make selected key the default TDE protector is checked",
            "From Azure CLI": "az account get-access-token --query \n\"{subscripton:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/resourceGroups/{resourceGroupNa\nme}/providers/Microsoft.Sql/servers/{serverName}/encryptionProtector?api-\nversion=2015-05-01-preview' \nEnsure the output of the command contains properties \nkind set to azurekeyvault \nserverKeyType set to AzureKeyVault \nuri is not null \n \nFrom PowerShell \nGet-AzSqlServerTransparentDataEncryptionProtector -ServerName <ServerName> -\nResourceGroupName <ResourceGroupName> \nEnsure the output of the command contains properties \nType set to AzureKeyVault \nServerKeyVaultKeyName set to KeyVaultName_KeyName_KeyIdentifierVersion \nKeyId set to KeyIdentifier",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 0a370ff3-6cab-4e85-8995-295fd854c5b8 - Name: 'SQL servers \nshould use customer-managed keys to encrypt data at rest' \n\u2022 \nPolicy ID: ac01ad65-10e5-46df-bdd9-6b0cad13e1d2 - Name: 'SQL managed \ninstances should use customer-managed keys to encrypt data at rest'"
        },
        "Remediation": "From Azure Console \n1. Go to SQL servers \nFor the desired server instance \n2. Click On Transparent data encryption \n3. Set Transparent data encryption to Customer-managed key \n4. Browse through your key vaults to Select an existing key or create a new key in \nthe Azure Key Vault. \n5. Check Make selected key the default TDE protector \nFrom Azure CLI \nUse the below command to encrypt SQL server's TDE protector with a Customer-\nmanaged key \naz sql server tde-key set --resource-group <resourceName> --server \n<dbServerName> --server-key-type {AzureKeyVault} --kid <keyIdentifier> \n \nFrom PowerShell \nUse the below command to encrypt SQL server's TDE protector with a Customer-\nmanaged Key Vault key \nSet-AzSqlServerTransparentDataEncryptionProtector -Type AzureKeyVault -KeyId \n<KeyIdentifier> -ServerName <ServerName> -ResourceGroupName \n<ResourceGroupName> \nSelect Y when prompted",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to SQL servers \nFor the desired server instance \n2. Click On Transparent data encryption \n3. Ensure that Customer-managed key is selected \n4. Ensure Make selected key the default TDE protector is checked",
            "From Azure CLI": "az account get-access-token --query \n\"{subscripton:subscription,accessToken:accessToken}\" --out tsv | xargs -L1 \nbash -c 'curl -X GET -H \"Authorization: Bearer $1\" -H \"Content-Type: \napplication/json\" \nhttps://management.azure.com/subscriptions/$0/resourceGroups/{resourceGroupNa\nme}/providers/Microsoft.Sql/servers/{serverName}/encryptionProtector?api-\nversion=2015-05-01-preview' \nEnsure the output of the command contains properties \nkind set to azurekeyvault \nserverKeyType set to AzureKeyVault \nuri is not null \n \nFrom PowerShell \nGet-AzSqlServerTransparentDataEncryptionProtector -ServerName <ServerName> -\nResourceGroupName <ResourceGroupName> \nEnsure the output of the command contains properties \nType set to AzureKeyVault \nServerKeyVaultKeyName set to KeyVaultName_KeyName_KeyIdentifierVersion \nKeyId set to KeyIdentifier",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 0a370ff3-6cab-4e85-8995-295fd854c5b8 - Name: 'SQL servers \nshould use customer-managed keys to encrypt data at rest' \n\u2022 \nPolicy ID: ac01ad65-10e5-46df-bdd9-6b0cad13e1d2 - Name: 'SQL managed \ninstances should use customer-managed keys to encrypt data at rest'"
        },
        "Default Value": "By Default, Microsoft managed TDE protector is enabled for a SQL server. \nReferences: \n1. https://docs.microsoft.com/en-us/sql/relational-\ndatabases/security/encryption/transparent-data-encryption-byok-azure-sql \n2. https://azure.microsoft.com/en-in/blog/preview-sql-transparent-data-encryption-\ntde-with-bring-your-own-key-support/ \n3. https://winterdom.com/2017/09/07/azure-sql-tde-protector-keyvault \n4. https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-\ndata-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-\nencryption-when-required \n5. https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts \n6. https://docs.microsoft.com/en-us/cli/azure/sql/server/tde-key?view=azure-cli-\nlatest",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share \nclaims application or database specific access control lists. These controls will \nenforce the principle that only authorized individuals should have access to the \ninformation based on their need to access the information as a part of their \nresponsibilities. \n \n \n "
    },
    {
        "Rule": "4.1.4 Ensure that Microsoft Entra authentication is Configured for \nSQL Servers (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Use Microsoft Entra authentication for authentication with SQL Database to manage \ncredentials in a single place.",
        "Rationale": "Microsoft Entra authentication is a mechanism to connect to Microsoft Azure SQL \nDatabase and SQL Data Warehouse by using identities in the Microsoft Entra ID \ndirectory. With Entra ID authentication, identities of database users and other Microsoft \nservices can be managed in one central location. Central ID management provides a \nsingle place to manage database users and simplifies permission management. \n\u2022 \nIt provides an alternative to SQL Server authentication. \n\u2022 \nHelps stop the proliferation of user identities across database servers. \n\u2022 \nAllows password rotation in a single place. \n\u2022 \nCustomers can manage database permissions using external (Entra ID) groups. \n\u2022 \nIt can eliminate storing passwords by enabling integrated Windows \nauthentication and other forms of authentication supported by Microsoft Entra. \n\u2022 \nEntra ID authentication uses contained database users to authenticate identities \nat the database level. \n\u2022 \nEntra ID supports token-based authentication for applications connecting to SQL \nDatabase. \n\u2022 \nEntra ID authentication supports ADFS (domain federation) or native \nuser/password authentication for a local Active Directory without domain \nsynchronization. \n\u2022 \nEntra ID supports connections from SQL Server Management Studio that use \nActive Directory Universal Authentication, which includes Multi-Factor \nAuthentication (MFA). MFA includes strong authentication with a range of easy \nverification options \u2014 phone call, text message, smart cards with pin, or mobile \napp notification. \nImpact: \nThis will create administrative overhead with user account and permission \nmanagement. For further security on these administrative accounts, you may want to \nconsider licensing which supports features like Multi Factor Authentication.",
        "Audit": "From Azure Portal \n1. Go to SQL servers \n2. For each SQL server, click on Microsoft Entra admin under the Settings section \n3. Ensure that a value has been set for Admin Name under the Microsoft Entra \nadmin section \nFrom Azure CLI \nTo list SQL Server Admins on a specific server: \naz sql server ad-admin list --resource-group <resource-group> --server \n<server>From PowerShell \nPrint a list of all SQL Servers to find which one you want to audit \nGet-AzSqlServer \nAudit a list of Administrators on a Specific Server \nGet-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName <resource \ngroup name> -ServerName <server name> \nEnsure Output shows DisplayName set to AD account. \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 1f314764-cb73-4fc9-b863-8eca98ac36e9 - Name: 'An Azure Active \nDirectory administrator should be provisioned for SQL servers'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each SQL server, click on Microsoft Entra admin under the Settings section \n3. Ensure that a value has been set for Admin Name under the Microsoft Entra \nadmin section",
            "From Azure CLI": "To list SQL Server Admins on a specific server: \naz sql server ad-admin list --resource-group <resource-group> --server \n<server>From PowerShell \nPrint a list of all SQL Servers to find which one you want to audit \nGet-AzSqlServer \nAudit a list of Administrators on a Specific Server \nGet-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName <resource \ngroup name> -ServerName <server name> \nEnsure Output shows DisplayName set to AD account.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 1f314764-cb73-4fc9-b863-8eca98ac36e9 - Name: 'An Azure Active \nDirectory administrator should be provisioned for SQL servers'"
        },
        "Remediation": "From Azure Portal \n1. Go to SQL servers \n2. For each SQL server, click on Microsoft Entra admin \n3. Click on Set admin \n4. Select an admin \n5. Click Save \nFrom Azure CLI \naz ad user show --id  \nFor each Server, set AD Admin \naz sql server ad-admin create --resource-group <resource group name> --server \n<server name> --display-name <display name> --object-id <object id of user>",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each SQL server, click on Microsoft Entra admin under the Settings section \n3. Ensure that a value has been set for Admin Name under the Microsoft Entra \nadmin section",
            "From Azure CLI": "To list SQL Server Admins on a specific server: \naz sql server ad-admin list --resource-group <resource-group> --server \n<server>From PowerShell \nPrint a list of all SQL Servers to find which one you want to audit \nGet-AzSqlServer \nAudit a list of Administrators on a Specific Server \nGet-AzSqlServerActiveDirectoryAdministrator -ResourceGroupName <resource \ngroup name> -ServerName <server name> \nEnsure Output shows DisplayName set to AD account.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 1f314764-cb73-4fc9-b863-8eca98ac36e9 - Name: 'An Azure Active \nDirectory administrator should be provisioned for SQL servers'"
        },
        "Default Value": "By Default, Microsoft managed TDE protector is enabled for a SQL server. \nReferences: \n1. https://docs.microsoft.com/en-us/sql/relational-\ndatabases/security/encryption/transparent-data-encryption-byok-azure-sql \n2. https://azure.microsoft.com/en-in/blog/preview-sql-transparent-data-encryption-\ntde-with-bring-your-own-key-support/ \n3. https://winterdom.com/2017/09/07/azure-sql-tde-protector-keyvault \n4. https://docs.microsoft.com/en-us/security/benchmark/azure/security-controls-v3-\ndata-protection#dp-5-use-customer-managed-key-option-in-data-at-rest-\nencryption-when-required \n5. https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts \n6. https://docs.microsoft.com/en-us/cli/azure/sql/server/tde-key?view=azure-cli-\nlatest",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n16.4 Encrypt or Hash all Authentication Credentials \n \nEncrypt or hash with a salt all authentication credentials when stored. \n \n \n "
    },
    {
        "Rule": "4.1.5 Ensure that 'Data encryption' is set to 'On' on a SQL \nDatabase (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable Transparent Data Encryption on every SQL server.",
        "Rationale": "Azure SQL Database transparent data encryption helps protect against the threat of \nmalicious activity by performing real-time encryption and decryption of the database, \nassociated backups, and transaction log files at rest without requiring changes to the \napplication.",
        "Audit": "From Azure Portal \n1. Go to SQL databases \n2. For each DB instance \n3. Click on Transparent data encryption \n4. Ensure that Data encryption is set to On \nFrom Azure CLI \nEnsure the output of the below command is Enabled \naz sql db tde show --resource-group <resourceGroup> --server <dbServerName> -\n-database <dbName> --query status \n \nFrom PowerShell \nGet a list of SQL Servers. \nGet-AzSqlServer \nFor each server, list the databases. \nGet-AzSqlDatabase -ServerName <SQL Server Name> -ResourceGroupName <Resource \nGroup Name> \nFor each database not listed as a Master database, check for Transparent Data \nEncryption. \nGet-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group \nName> -ServerName <SQL Server Name> -DatabaseName <Database Name> \nMake sure DataEncryption is Enabled for each database except the Master database.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to SQL databases \n2. For each DB instance \n3. Click on Transparent data encryption \n4. Ensure that Data encryption is set to On",
            "From Azure CLI": "Ensure the output of the below command is Enabled \naz sql db tde show --resource-group <resourceGroup> --server <dbServerName> -\n-database <dbName> --query status \n \nFrom PowerShell \nGet a list of SQL Servers. \nGet-AzSqlServer \nFor each server, list the databases. \nGet-AzSqlDatabase -ServerName <SQL Server Name> -ResourceGroupName <Resource \nGroup Name> \nFor each database not listed as a Master database, check for Transparent Data \nEncryption. \nGet-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group \nName> -ServerName <SQL Server Name> -DatabaseName <Database Name> \nMake sure DataEncryption is Enabled for each database except the Master database."
        },
        "Remediation": "From Azure Portal \n1. Go to SQL databases \n2. For each DB instance \n3. Click on Transparent data encryption \n4. Set Data encryption to On \nFrom Azure CLI \nUse the below command to enable Transparent data encryption for SQL DB instance. \naz sql db tde set --resource-group <resourceGroup> --server <dbServerName> --\ndatabase <dbName> --status Enabled \nFrom PowerShell \nUse the below command to enable Transparent data encryption for SQL DB instance. \nSet-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group \nName> -ServerName <SQL Server Name> -DatabaseName <Database Name> -State \n'Enabled' \nNote: \n\u2022 \nTDE cannot be used to encrypt the logical master database in SQL Database. \nThe master database contains objects that are needed to perform the TDE \noperations on the user databases. \n\u2022 \nAzure Portal does not show master databases per SQL server. However, \nCLI/API responses will show master databases.",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to SQL databases \n2. For each DB instance \n3. Click on Transparent data encryption \n4. Ensure that Data encryption is set to On",
            "From Azure CLI": "Ensure the output of the below command is Enabled \naz sql db tde show --resource-group <resourceGroup> --server <dbServerName> -\n-database <dbName> --query status \n \nFrom PowerShell \nGet a list of SQL Servers. \nGet-AzSqlServer \nFor each server, list the databases. \nGet-AzSqlDatabase -ServerName <SQL Server Name> -ResourceGroupName <Resource \nGroup Name> \nFor each database not listed as a Master database, check for Transparent Data \nEncryption. \nGet-AzSqlDatabaseTransparentDataEncryption -ResourceGroupName <Resource Group \nName> -ServerName <SQL Server Name> -DatabaseName <Database Name> \nMake sure DataEncryption is Enabled for each database except the Master database."
        },
        "Default Value": "By default, Data encryption is set to On. \nReferences: \n1. https://docs.microsoft.com/en-us/sql/relational-\ndatabases/security/encryption/transparent-data-encryption-with-azure-sql-\ndatabase \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-4-enable-data-at-rest-encryption-by-default",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.6 Centralize Account Management \n \nCentralize account management through a directory or identity service. \n \n \n \nv7 \n16.2 Configure Centralized Point of Authentication \n \nConfigure access for all accounts through as few centralized points of \nauthentication as possible including network security and cloud systems. \n \n \n "
    },
    {
        "Rule": "4.1.6 Ensure that 'Auditing' Retention is 'greater than 90 days' \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "SQL Server Audit Retention should be configured to be greater than 90 days.",
        "Rationale": "Audit Logs can be used to check for anomalies and give insight into suspected \nbreaches or misuse of information and access.",
        "Audit": "From Azure Portal \n1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. If storage is selected, expand Advanced properties \n5. Ensure Retention (days) setting is greater than 90 days or 0 for unlimited \nretention. \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<server name> \nEnsure that RetentionInDays is set to more than 90 \nNote: If the SQL server is set with LogAnalyticsTargetState setting set to Enabled, run \nthe following additional command. \nGet-AzOperationalInsightsWorkspace | Where-Object {$_.ResourceId -eq <SQL \nServer WorkSpaceResourceId>} \nEnsure that RetentionInDays is set to more than 90",
        "Audit Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. If storage is selected, expand Advanced properties \n5. Ensure Retention (days) setting is greater than 90 days or 0 for unlimited \nretention. \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<server name> \nEnsure that RetentionInDays is set to more than 90 \nNote: If the SQL server is set with LogAnalyticsTargetState setting set to Enabled, run \nthe following additional command. \nGet-AzOperationalInsightsWorkspace | Where-Object {$_.ResourceId -eq <SQL \nServer WorkSpaceResourceId>} \nEnsure that RetentionInDays is set to more than 90"
        },
        "Remediation": "From Azure Portal \n1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. If storage is selected, expand Advanced properties \n5. Set the Retention (days) setting greater than 90 days or 0 for unlimited \nretention. \n6. Select Save \nFrom PowerShell \nFor each Server, set retention policy to more than 90 days \nLog Analytics Example \nSet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<SQL Server name> -RetentionInDays <Number of Days to retain the audit logs, \nshould be more than 90 days> -LogAnalyticsTargetState Enabled -\nWorkspaceResourceId \"/subscriptions/<subscription \nID>/resourceGroups/insights-\nintegration/providers/Microsoft.OperationalInsights/workspaces/<workspace \nname> \nEvent Hub Example \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -EventHubTargetState Enabled -EventHubName  \n    \"<Event Hub name>\" -EventHubAuthorizationRuleResourceId \"<Event Hub \nAuthorization Rule Resource ID>\" \nBlob Storage Example* \nSet-AzSqlServerAudit -ResourceGroupName \"<resource group name>\" -ServerName \n\"<SQL Server name>\" -BlobStorageTargetState Enabled  \n    -StorageAccountResourceId \n\"/subscriptions/<subscription_ID>/resourceGroups/<Resource_Group>/providers/M\nicrosoft.Stora \n    ge/storageAccounts/<Storage Account name>\"",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to SQL servers \n2. For each server instance \n3. Click on Auditing \n4. If storage is selected, expand Advanced properties \n5. Ensure Retention (days) setting is greater than 90 days or 0 for unlimited \nretention. \nFrom PowerShell \nGet the list of all SQL Servers \nGet-AzSqlServer \nFor each Server \nGet-AzSqlServerAudit -ResourceGroupName <resource group name> -ServerName \n<server name> \nEnsure that RetentionInDays is set to more than 90 \nNote: If the SQL server is set with LogAnalyticsTargetState setting set to Enabled, run \nthe following additional command. \nGet-AzOperationalInsightsWorkspace | Where-Object {$_.ResourceId -eq <SQL \nServer WorkSpaceResourceId>} \nEnsure that RetentionInDays is set to more than 90"
        },
        "Default Value": "By default, SQL Server audit storage is disabled.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "4.3.1 Ensure 'Enforce SSL connection' is set to 'ENABLED' for \nPostgreSQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable SSL connection on PostgreSQL Servers.",
        "Rationale": "SSL connectivity helps to provide a new layer of security by connecting database \nserver to client applications using Secure Sockets Layer (SSL). Enforcing SSL \nconnections between database server and client applications helps protect against \n\"man in the middle\" attacks by encrypting the data stream between the server and \napplication.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for PostgreSQL server \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED. \nFrom Azure CLI \nEnsure the output of the below command returns Enabled. \naz postgres server show --resource-group myresourcegroup --name \n<resourceGroupName> --query sslEnforcement \n \nFrom PowerShell \nEnsure the output of the below command returns Enabled. \nGet-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName \n<ServerName> | Select-Object SslEnforcement \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for PostgreSQL server \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED.",
            "From Azure CLI": "Ensure the output of the below command returns Enabled. \naz postgres server show --resource-group myresourcegroup --name \n<resourceGroupName> --query sslEnforcement \n \nFrom PowerShell \nEnsure the output of the below command returns Enabled. \nGet-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName \n<ServerName> | Select-Object SslEnforcement",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for PostgreSQL server \n3. For each database, click on Connection security \n4. In SSL settings, click on ENABLED to enforce SSL connections \n5. Click Save \nFrom Azure CLI \nUse the below command to enforce ssl connection for PostgreSQL Database. \naz postgres server update --resource-group <resourceGroupName> --name \n<serverName> --ssl-enforcement Enabled \nFrom PowerShell \nUpdate-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName \n<ServerName> -SslEnforcement Enabled",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for PostgreSQL server \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED.",
            "From Azure CLI": "Ensure the output of the below command returns Enabled. \naz postgres server show --resource-group myresourcegroup --name \n<resourceGroupName> --query sslEnforcement \n \nFrom PowerShell \nEnsure the output of the below command returns Enabled. \nGet-AzPostgreSqlServer -ResourceGroupName <ResourceGroupName > -ServerName \n<ServerName> | Select-Object SslEnforcement",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, secure connectivity is enforced, but some application frameworks may not \nenable it during deployment. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/postgresql/concepts-ssl-connection-\nsecurity \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-4-enable-data-at-rest-encryption-by-default \n3. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-\nazpostgresqlserver?view=azps-9.2.0#example-2-get-postgresql-server-by-\nresource-group-and-server-name \n4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-\nazpostgresqlserver?view=azps-9.2.0#example-1-update-postgresql-server-by-\nresource-group-and-server-name",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.3 Ensure Adequate Audit Log Storage \n \nEnsure that logging destinations maintain adequate storage to comply with \nthe enterprise s audit log management process. \n \n \n \nv7 \n6.4 Ensure adequate storage for logs \n \nEnsure that all systems that store logs have adequate storage space for the \nlogs generated. \n \n \n "
    },
    {
        "Rule": "4.3.2 Ensure Server Parameter 'log_checkpoints' is set to 'ON' for \nPostgreSQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable log_checkpoints on PostgreSQL Servers.",
        "Rationale": "Enabling log_checkpoints helps the PostgreSQL Database to Log each checkpoint in \nturn generates query and error logs. However, access to transaction logs is not \nsupported. Query and error logs can be used to identify, troubleshoot, and repair \nconfiguration errors and sub-optimal performance.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_checkpoints. \n5. Ensure that value is set to ON. \nFrom Azure CLI \nEnsure value is set to ON \naz postgres server configuration show  --resource-group <resourceGroupName> -\n-server-name <serverName> --name log_checkpoints \n \nFrom PowerShell \nEnsure value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_checkpoints \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_checkpoints. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure value is set to ON \naz postgres server configuration show  --resource-group <resourceGroupName> -\n-server-name <serverName> --name log_checkpoints \n \nFrom PowerShell \nEnsure value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_checkpoints",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_checkpoints. \n5. Click ON and save. \nFrom Azure CLI \nUse the below command to update log_checkpoints configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_checkpoints --value on \nFrom PowerShell \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_checkpoints -Value on",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_checkpoints. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure value is set to ON \naz postgres server configuration show  --resource-group <resourceGroupName> -\n-server-name <serverName> --name log_checkpoints \n \nFrom PowerShell \nEnsure value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_checkpoints",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default log_checkpoints is enabled (set to on). \nReferences: \n1. https://docs.microsoft.com/en-\nus/rest/api/postgresql/singleserver/configurations/list-by-server \n2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-\nparameters-using-portal \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n4. https://learn.microsoft.com/en-us/azure/postgresql/single-server/concepts-server-\nlogs#configure-logging \n5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-\nazpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-\nconfiguration-by-name \n6. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-\nazpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-\nconfiguration-by-name",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "4.3.3 Ensure server parameter 'log_connections' is set to 'ON' for \nPostgreSQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable log_connections on PostgreSQL Servers.",
        "Rationale": "Enabling log_connections helps PostgreSQL Database to log attempted connection to \nthe server, as well as successful completion of client authentication. Log data can be \nused to identify, troubleshoot, and repair configuration errors and suboptimal \nperformance.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_connections. \n5. Ensure that value is set to ON. \nFrom Azure CLI \nEnsure log_connections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_connections \n \nFrom PowerShell \nEnsure log_connections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_connections \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_connections. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure log_connections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_connections \n \nFrom PowerShell \nEnsure log_connections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_connections",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_connections. \n5. Click ON and save. \nFrom Azure CLI \nUse the below command to update log_connections configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_connections --value on \nFrom PowerShell \nUse the below command to update log_connections configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_connections -Value on",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_connections. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure log_connections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_connections \n \nFrom PowerShell \nEnsure log_connections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_connections",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default log_connections is enabled (set to on). \nReferences: \n1. https://docs.microsoft.com/en-us/rest/api/postgresql/configurations/listbyserver \n2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-\nparameters-using-portal \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-\nazpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-\nconfiguration-by-name \n5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-\nazpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-\nconfiguration-by-name",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging per the enterprise s audit log \nmanagement process has been enabled across enterprise assets. \n \n \n \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n \n \n "
    },
    {
        "Rule": "4.3.4 Ensure server parameter 'log_disconnections' is set to 'ON' \nfor PostgreSQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable log_disconnections on PostgreSQL Servers.",
        "Rationale": "Enabling log_disconnections helps PostgreSQL Database to Logs end of a session, \nincluding duration, which in turn generates query and error logs. Query and error logs \ncan be used to identify, troubleshoot, and repair configuration errors and sub-optimal \nperformance. \nImpact: \nEnabling this setting will enable a log of all disconnections. If this is enabled for a high \ntraffic server, the log may grow exponentially.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Go to Azure Database for PostgreSQL servers \n3. For each database, click on Server parameters \n4. Search for log_disconnections. \n5. Ensure that value is set to ON. \nFrom Azure CLI \nEnsure log_disconnections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_disconnections \nFrom PowerShell \nEnsure log_disconnections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_disconnections \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Go to Azure Database for PostgreSQL servers \n3. For each database, click on Server parameters \n4. Search for log_disconnections. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure log_disconnections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_disconnections \nFrom PowerShell \nEnsure log_disconnections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_disconnections",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu \n2. Go to Azure Database for PostgreSQL servers \n3. For each database, click on Server parameters \n4. Search for log_disconnections. \n5. Click ON and save. \nFrom Azure CLI \nUse the below command to update log_disconnections configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_disconnections --value on \nFrom PowerShell \nUse the below command to update log_disconnections configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_disconnections -Value on",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu \n2. Go to Azure Database for PostgreSQL servers \n3. For each database, click on Server parameters \n4. Search for log_disconnections. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure log_disconnections value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_disconnections \nFrom PowerShell \nEnsure log_disconnections value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_disconnections",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default log_disconnections is disabled (set to off). \nReferences: \n1. https://docs.microsoft.com/en-\nus/rest/api/postgresql/singleserver/configurations/list-by-server \n2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-\nparameters-using-portal \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-\nazpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-\nconfiguration-by-name \n5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-\nazpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-\nconfiguration-by-name",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging per the enterprise s audit log \nmanagement process has been enabled across enterprise assets. \n \n \n \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n \n \n "
    },
    {
        "Rule": "4.3.5 Ensure server parameter 'connection_throttling' is set to \n'ON' for PostgreSQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable connection_throttling on PostgreSQL Servers.",
        "Rationale": "Enabling connection_throttling helps the PostgreSQL Database to Set the \nverbosity of logged messages. This in turn generates query and error logs with \nrespect to concurrent connections that could lead to a successful Denial of Service \n(DoS) attack by exhausting connection resources. A system can also fail or be \ndegraded by an overload of legitimate users. Query and error logs can be used to \nidentify, troubleshoot, and repair configuration errors and sub-optimal performance.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for connection_throttling. \n5. Ensure that value is set to ON. \nFrom Azure CLI \nEnsure connection_throttling value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name connection_throttling \nFrom PowerShell \nEnsure connection_throttling value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name connection_throttling \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 5345bb39-67dc-4960-a1bf-427e16b9a0bd - Name: 'Connection \nthrottling should be enabled for PostgreSQL database servers'",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for connection_throttling. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure connection_throttling value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name connection_throttling \nFrom PowerShell \nEnsure connection_throttling value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name connection_throttling",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 5345bb39-67dc-4960-a1bf-427e16b9a0bd - Name: 'Connection \nthrottling should be enabled for PostgreSQL database servers'"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for connection_throttling. \n5. Click ON and save. \nFrom Azure CLI \nUse the below command to update connection_throttling configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name connection_throttling --value on \nFrom PowerShell \nUse the below command to update connection_throttling configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name connection_throttling -Value on",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for connection_throttling. \n5. Ensure that value is set to ON.",
            "From Azure CLI": "Ensure connection_throttling value is set to ON \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name connection_throttling \nFrom PowerShell \nEnsure connection_throttling value is set to ON \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name connection_throttling",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 5345bb39-67dc-4960-a1bf-427e16b9a0bd - Name: 'Connection \nthrottling should be enabled for PostgreSQL database servers'"
        },
        "Default Value": "By default, connection_throttling is enabled (set to on). \nReferences: \n1. https://docs.microsoft.com/en-\nus/rest/api/postgresql/singleserver/configurations/list-by-server \n2. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-\nparameters-using-portal \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-\nazpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-\nconfiguration-by-name \n5. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/update-\nazpostgresqlconfiguration?view=azps-9.2.0#example-1-update-postgresql-\nconfiguration-by-name",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging per the enterprise s audit log \nmanagement process has been enabled across enterprise assets. \n \n \n "
    },
    {
        "Rule": "4.3.6 Ensure Server Parameter 'log_retention_days' is greater \nthan 3 days for PostgreSQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure log_retention_days on PostgreSQL Servers is set to an appropriate value.",
        "Rationale": "Configuring log_retention_days determines the duration in days that Azure Database \nfor PostgreSQL retains log files. Query and error logs can be used to identify, \ntroubleshoot, and repair configuration errors and sub-optimal performance. \nImpact: \nConfiguring this setting will result in logs being retained for the specified number of \ndays. If this is configured on a high traffic server, the log may grow quickly to occupy a \nlarge amount of disk space. In this case you may want to set this to a lower number.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_retention_days. \n5. Ensure that the value is between 4 and 7 (inclusive). \n \nFrom Azure CLI \nEnsure log_retention_days value is greater than 3. \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_retention_days \n \nFrom Powershell \nEnsure log_retention_days value is greater than 3. \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_retention_days",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_retention_days. \n5. Ensure that the value is between 4 and 7 (inclusive).",
            "From Azure CLI": "Ensure log_retention_days value is greater than 3. \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_retention_days",
            "From Powershell": "Ensure log_retention_days value is greater than 3. \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_retention_days"
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_retention_days. \n5. Input a value between 4 and 7 (inclusive) and click Save. \nFrom Azure CLI \nUse the below command to update log_retention_days configuration. \naz postgres server configuration set --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_retention_days --value <4-7> \nFrom Powershell \nUse the below command to update log_retention_days configuration. \nUpdate-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_retention_days -Value <4-7>",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Server parameters. \n4. Search for log_retention_days. \n5. Ensure that the value is between 4 and 7 (inclusive).",
            "From Azure CLI": "Ensure log_retention_days value is greater than 3. \naz postgres server configuration show --resource-group <resourceGroupName> --\nserver-name <serverName> --name log_retention_days",
            "From Powershell": "Ensure log_retention_days value is greater than 3. \nGet-AzPostgreSqlConfiguration -ResourceGroupName <ResourceGroupName> -\nServerName <ServerName> -Name log_retention_days"
        },
        "Default Value": "By default log_retention_days is set to 3. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/postgresql/howto-configure-server-\nparameters-using-portal \n2. https://docs.microsoft.com/en-\nus/rest/api/postgresql/singleserver/configurations/list-by-server \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-6-configure-log-storage-retention \n4. https://learn.microsoft.com/en-us/powershell/module/az.postgresql/get-\nazpostgresqlconfiguration?view=azps-9.2.0#example-2-get-specified-postgresql-\nconfiguration-by-name",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging per the enterprise s audit log \nmanagement process has been enabled across enterprise assets. \n \n \n "
    },
    {
        "Rule": "4.3.7 Ensure 'Allow access to Azure services' for PostgreSQL \nDatabase Server is disabled (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Disable access from Azure services to PostgreSQL Database Server.",
        "Rationale": "If access from Azure services is enabled, the server's firewall will accept connections \nfrom all Azure resources, including resources not in your subscription. This is usually \nnot a desired configuration. Instead, set up firewall rules to allow access from specific \nnetwork ranges or VNET rules to allow access from specific virtual networks.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Connection security. \n4. Under Firewall rules, ensure Allow access to Azure services is set to No. \nFrom Azure CLI \nEnsure the output of the below command does not include a rule with the name \nAllowAllWindowsAzureIps or \"startIpAddress\": \"0.0.0.0\" or \"endIpAddress\": \"0.0.0.0\", \naz postgres server firewall-rule list --resource-group <resourceGroupName>  -\n-server <serverName> \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: b52376f7-9612-48a1-81cd-1ffe4b61032c - Name: 'Public network \naccess should be disabled for PostgreSQL servers' \n\u2022 \nPolicy ID: 5e1de0e3-42cb-4ebc-a86d-61d0c619ca48 - Name: 'Public network \naccess should be disabled for PostgreSQL flexible servers'",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Connection security. \n4. Under Firewall rules, ensure Allow access to Azure services is set to No.",
            "From Azure CLI": "Ensure the output of the below command does not include a rule with the name \nAllowAllWindowsAzureIps or \"startIpAddress\": \"0.0.0.0\" or \"endIpAddress\": \"0.0.0.0\", \naz postgres server firewall-rule list --resource-group <resourceGroupName>  -\n-server <serverName>",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: b52376f7-9612-48a1-81cd-1ffe4b61032c - Name: 'Public network \naccess should be disabled for PostgreSQL servers' \n\u2022 \nPolicy ID: 5e1de0e3-42cb-4ebc-a86d-61d0c619ca48 - Name: 'Public network \naccess should be disabled for PostgreSQL flexible servers'"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Connection security. \n4. Under Firewall rules, set Allow access to Azure services to No. \n5. Click Save. \nFrom Azure CLI \nUse the below command to delete the AllowAllWindowsAzureIps rule for PostgreSQL \nDatabase. \naz postgres server firewall-rule delete --name AllowAllWindowsAzureIps  --\nresource-group <resourceGroupName> --server-name <serverName>",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com. \n2. Go to Azure Database for PostgreSQL servers. \n3. For each database, click on Connection security. \n4. Under Firewall rules, ensure Allow access to Azure services is set to No.",
            "From Azure CLI": "Ensure the output of the below command does not include a rule with the name \nAllowAllWindowsAzureIps or \"startIpAddress\": \"0.0.0.0\" or \"endIpAddress\": \"0.0.0.0\", \naz postgres server firewall-rule list --resource-group <resourceGroupName>  -\n-server <serverName>",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: b52376f7-9612-48a1-81cd-1ffe4b61032c - Name: 'Public network \naccess should be disabled for PostgreSQL servers' \n\u2022 \nPolicy ID: 5e1de0e3-42cb-4ebc-a86d-61d0c619ca48 - Name: 'Public network \naccess should be disabled for PostgreSQL flexible servers'"
        },
        "Default Value": "The Azure Postgres firewall is set to block all access by default. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/postgresql/concepts-firewall-rules \n2. https://docs.microsoft.com/en-us/azure/postgresql/howto-manage-firewall-using-\ncli \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-6-deploy-web-application-firewall",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n \nv7 \n9.4 Apply Host-based Firewalls or Port Filtering \n \nApply host-based firewalls or port filtering tools on end systems with a \ndefault-deny rule that drops all traffic except those services and ports that are \nexplicitly allowed. \n \n \n "
    },
    {
        "Rule": "4.3.8 Ensure 'Infrastructure double encryption' for PostgreSQL \nDatabase Server is 'Enabled' (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Azure Database for PostgreSQL servers should be created with 'infrastructure double \nencryption' enabled.",
        "Rationale": "If Double Encryption is enabled, another layer of encryption is implemented at the \nhardware level before the storage or network level. Information will be encrypted before \nit is even accessed, preventing both interception of data in motion if the network layer \nencryption is broken and data at rest in system resources such as memory or processor \ncache. Encryption will also be in place for any backups taken of the database, so the \nkey will secure access the data in all forms. For the most secure implementation of key \nbased encryption, it is recommended to use a Customer Managed asymmetric RSA \n2048 Key in Azure Key Vault. \nImpact: \nThe read and write speeds to the database will be impacted if both default encryption \nand Infrastructure Encryption are checked, as a secondary form of encryption requires \nmore resource overhead for the cryptography of information. This cost is justified for \ninformation security. Customer managed keys are recommended for the most secure \nimplementation, leading to overhead of key management. The key will also need to be \nbacked up in a secure location, as loss of the key will mean loss of the information in \nthe database.",
        "Audit": "From Azure Portal \n1. From Azure Home, click on more services. \n2. Click on Databases. \n3. Click on Azure Database for PostgreSQL servers. \n4. Select the database by clicking on its name. \n5. Under Security, click Data encryption. \n6. Ensure that 'Infrastructure encryption enabled' is displayed and is 'checked'. \nFrom Azure CLI \n1. Enter the command",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home, click on more services. \n2. Click on Databases. \n3. Click on Azure Database for PostgreSQL servers. \n4. Select the database by clicking on its name. \n5. Under Security, click Data encryption. \n6. Ensure that 'Infrastructure encryption enabled' is displayed and is 'checked'.",
            "From Azure CLI": "1. Enter the command"
        },
        "Remediation": "It is not possible to enable 'infrastructure double encryption' on an existing Azure \nDatabase for PostgreSQL server. \nThe remediation steps detail the creation of a new Azure Database for PostgreSQL \nserver with 'infrastructure double encryption' enabled. \nFrom Azure Portal \n1. Go through the normal process of database creation. \n2. On step 2 titled 'Additional settings' ensure that 'Infrastructure double encryption \nenabled' is 'checked'. \n3. Acknowledge that you understand this will impact database performance. \n4. Finish database creation as normal. \nFrom Azure CLI \naz postgres server create --resource-group <resourcegroup> --name \n<servername>  --location <location> --admin-user <adminusername> --admin-\npassword <server_admin_password> --sku-name GP_Gen4_2 --version 11 --\ninfrastructure-encryption Enabled",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home, click on more services. \n2. Click on Databases. \n3. Click on Azure Database for PostgreSQL servers. \n4. Select the database by clicking on its name. \n5. Under Security, click Data encryption. \n6. Ensure that 'Infrastructure encryption enabled' is displayed and is 'checked'.",
            "From Azure CLI": "1. Enter the command"
        },
        "Default Value": "By Default, Double Encryption is disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/postgresql/howto-double-encryption \n2. https://docs.microsoft.com/en-us/azure/postgresql/concepts-infrastructure-\ndouble-encryption \n3. https://docs.microsoft.com/en-us/azure/postgresql/concepts-data-encryption-\npostgresql \n4. https://docs.microsoft.com/en-us/azure/key-vault/keys/byok-specification \n5. https://docs.microsoft.com/en-us/azure/postgresql/howto-double-encryption \n6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-4-enable-data-at-rest-encryption-by-default",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n \nv7 \n9.4 Apply Host-based Firewalls or Port Filtering \n \nApply host-based firewalls or port filtering tools on end systems with a \ndefault-deny rule that drops all traffic except those services and ports that are \nexplicitly allowed. \n \n \n "
    },
    {
        "Rule": "4.4.1 Ensure 'Enforce SSL connection' is set to 'Enabled' for \nStandard MySQL Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable SSL connection on MYSQL Servers.",
        "Rationale": "SSL connectivity helps to provide a new layer of security by connecting database server \nto client applications using Secure Sockets Layer (SSL). Enforcing SSL connections \nbetween database server and client applications helps protect against \"man in the \nmiddle\" attacks by encrypting the data stream between the server and application.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL servers \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED. \nFrom Azure CLI \nEnsure the output of the below command returns ENABLED. \n   az mysql server show --resource-group <resourceGroupName> --name \n<serverName> --query sslEnforcement \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: e802a67a-daf5-4436-9ea6-f6d821dd0c5d - Name: 'Enforce SSL \nconnection should be enabled for MySQL database servers'",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL servers \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED.",
            "From Azure CLI": "Ensure the output of the below command returns ENABLED. \n   az mysql server show --resource-group <resourceGroupName> --name \n<serverName> --query sslEnforcement",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: e802a67a-daf5-4436-9ea6-f6d821dd0c5d - Name: 'Enforce SSL \nconnection should be enabled for MySQL database servers'"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL servers \n3. For each database, click on Connection security \n4. In SSL settings, click on ENABLED to Enforce SSL connections \nFrom Azure CLI \nUse the below command to set MYSQL Databases to Enforce SSL connection. \n    az mysql server update --resource-group <resourceGroupName> --name \n<serverName> --ssl-enforcement Enabled",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL servers \n3. For each database, click on Connection security \n4. In SSL settings, ensure Enforce SSL connection is set to ENABLED.",
            "From Azure CLI": "Ensure the output of the below command returns ENABLED. \n   az mysql server show --resource-group <resourceGroupName> --name \n<serverName> --query sslEnforcement",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: e802a67a-daf5-4436-9ea6-f6d821dd0c5d - Name: 'Enforce SSL \nconnection should be enabled for MySQL database servers'"
        },
        "Default Value": "Azure Database for MySQL when provisioned through the Azure portal or CLI will \nrequire SSL connections by default. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/mysql/single-server/concepts-ssl-\nconnection-security \n2. https://docs.microsoft.com/en-us/azure/mysql/single-server/how-to-configure-ssl \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "4.4.2 Ensure 'TLS Version' is set to 'TLSV1.2' (or higher) for \nMySQL flexible Database Server (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure TLS version on MySQL flexible servers is set to use TLS version 1.2 or higher.",
        "Rationale": "TLS connectivity helps to provide a new layer of security by connecting database server \nto client applications using Transport Layer Security (TLS). Enforcing TLS connections \nbetween database server and client applications helps protect against \"man in the \nmiddle\" attacks by encrypting the data stream between the server and application.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL flexible servers \n3. For each database, click on Server parameters under Settings \n4. In the search box, type in tls_version \n5. Ensure tls_version is set to TLSV1.2 (or higher) \nFrom Azure CLI \nEnsure the output of the below command contains the key value pair \"values\": \n\"TLSV1.2\" (or higher). \naz mysql flexible-server parameter show --name tls_version --resource-group \n<resourceGroupName> --server-name <serverName> \nExample output:",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL flexible servers \n3. For each database, click on Server parameters under Settings \n4. In the search box, type in tls_version \n5. Ensure tls_version is set to TLSV1.2 (or higher)",
            "From Azure CLI": "Ensure the output of the below command contains the key value pair \"values\": \n\"TLSV1.2\" (or higher). \naz mysql flexible-server parameter show --name tls_version --resource-group \n<resourceGroupName> --server-name <serverName> \nExample output:"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL flexible servers \n3. For each database, click on Server parameters under Settings \n4. In the search box, type in tls_version \n5. Click on the VALUE dropdown, and ensure only TLSV1.2 (or higher) is selected \nfor tls_version \nFrom Azure CLI \nUse the below command to set MYSQL flexible databases to used version 1.2 for the \ntls_version parameter. \n    az mysql flexible-server parameter set --name tls_version --resource-\ngroup <resourceGroupName> --server-name <serverName> --value TLSV1.2",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to Azure Database for MySQL flexible servers \n3. For each database, click on Server parameters under Settings \n4. In the search box, type in tls_version \n5. Ensure tls_version is set to TLSV1.2 (or higher)",
            "From Azure CLI": "Ensure the output of the below command contains the key value pair \"values\": \n\"TLSV1.2\" (or higher). \naz mysql flexible-server parameter show --name tls_version --resource-group \n<resourceGroupName> --server-name <serverName> \nExample output:"
        },
        "Default Value": "By default, TLS is set to v1.2 for MySQL Flexible servers.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "4.4.3 Ensure server parameter 'audit_log_enabled' is set to 'ON' \nfor MySQL Database Server (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Enable audit_log_enabled on MySQL Servers.",
        "Rationale": "Enabling audit_log_enabled helps MySQL Database to log items such as connection \nattempts to the server, DDL/DML access, and more. Log data can be used to identify, \ntroubleshoot, and repair configuration errors and suboptimal performance. \nImpact: \nThere are further costs incurred for storage of logs. For high traffic databases these logs \nwill be significant. Determine your organization's needs before enabling.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Select Azure Database for MySQL Servers \n3. For each database, under the Settings section in the sidebar, select Server \nparameters \n4. Ensure the audit_log_enabled parameter is set to ON",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Select Azure Database for MySQL Servers \n3. For each database, under the Settings section in the sidebar, select Server \nparameters \n4. Ensure the audit_log_enabled parameter is set to ON"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com. \n2. Select Azure Database for MySQL Servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Update audit_log_enabled parameter to ON \n6. Under Monitoring, select Diagnostic settings. \n7. Select + Add diagnostic setting. \n8. Provide a diagnostic setting name. \n9. Under Categories, select MySQL Audit Logs. \n10. \nSpecify destination details. \n11. \nClick Save. \nIt may take up to 10 minutes for the logs to appear in the configured destination.",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Select Azure Database for MySQL Servers \n3. For each database, under the Settings section in the sidebar, select Server \nparameters \n4. Ensure the audit_log_enabled parameter is set to ON"
        },
        "Default Value": "By default, TLS is set to v1.2 for MySQL Flexible servers.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "4.4.4 Ensure server parameter 'audit_log_events' has \n'CONNECTION' set for MySQL Database Server (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Set audit_log_enabled to include CONNECTION on MySQL Servers.",
        "Rationale": "Enabling CONNECTION helps MySQL Database to log items such as successful and \nfailed connection attempts to the server. Log data can be used to identify, troubleshoot, \nand repair configuration errors and suboptimal performance. \nImpact: \nThere are further costs incurred for storage of logs. For high traffic databases these logs \nwill be significant. Determine your organization's needs before enabling.",
        "Audit": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Select Azure Database for MySQL servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Ensure audit_log_enabled parameter is set to ON. \n6. Ensure audit_log_events parameter has CONNECTION checked.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Azure Database for MySQL servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Ensure audit_log_enabled parameter is set to ON. \n6. Ensure audit_log_events parameter has CONNECTION checked."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home select the Portal Menu. \n2. Select Azure Database for MySQL servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Update audit_log_enabled parameter to ON. \n6. Update audit_log_events parameter to have at least CONNECTION checked. \n7. Click Save. \n8. Under Monitoring, select Diagnostic settings. \n9. Select + Add diagnostic setting. \n10. \nProvide a diagnostic setting name. \n11. \nUnder Categories, select MySQL Audit Logs. \n12. \nSpecify destination details. \n13. \nClick Save.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home select the Portal Menu. \n2. Select Azure Database for MySQL servers. \n3. Select a database. \n4. Under Settings, select Server parameters. \n5. Ensure audit_log_enabled parameter is set to ON. \n6. Ensure audit_log_events parameter has CONNECTION checked."
        },
        "Default Value": "audit_log_enabled is set to OFF by default \nReferences: \n1. https://docs.microsoft.com/en-us/azure/mysql/single-server/how-to-configure-\naudit-logs-portal \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \nAdditional Information: \nThere is also a CLI version: https://docs.microsoft.com/en-us/azure/mysql/single-\nserver/how-to-configure-audit-logs-cli \nThere are numerous settings and event types and it might be helpful to discuss which of \nthese may be appropriate to have a separate check item for.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging per the enterprise s audit log \nmanagement process has been enabled across enterprise assets. \n \n \n \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n \n \n "
    },
    {
        "Rule": "4.5.1 Ensure That 'Firewalls & Networks' Is Limited to Use \nSelected Networks Instead of All Networks (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Limiting your Cosmos DB to only communicate on whitelisted networks lowers its attack \nfootprint.",
        "Rationale": "Selecting certain networks for your Cosmos DB to communicate restricts the number of \nnetworks including the internet that can interact with what is stored within the database. \nImpact: \nFailure to whitelist the correct networks will result in a connection loss.",
        "Audit": "From Azure Portal \n1. Open the portal menu. \n2. Select the Azure Cosmos DB blade \n3. Select a Cosmos DB to audit. \n4. Select Networking. \n5. Under Public network access, ensure Selected networks is selected. \n6. Under Virtual networks, ensure appropriate virtual networks are configured. \nFrom Azure CLI \nRetrieve a list of all CosmosDB database names: \naz cosmosdb list \nFor each database listed, run the following command: \naz cosmosdb show <database id> \nFor each database, ensure that isVirtualNetworkFilterEnabled is set to true \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb - Name: 'Azure Cosmos DB \naccounts should have firewall rules'",
        "Audit Steps": {
            "From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade \n3. Select a Cosmos DB to audit. \n4. Select Networking. \n5. Under Public network access, ensure Selected networks is selected. \n6. Under Virtual networks, ensure appropriate virtual networks are configured.",
            "From Azure CLI": "Retrieve a list of all CosmosDB database names: \naz cosmosdb list \nFor each database listed, run the following command: \naz cosmosdb show <database id> \nFor each database, ensure that isVirtualNetworkFilterEnabled is set to true",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb - Name: 'Azure Cosmos DB \naccounts should have firewall rules'"
        },
        "Remediation": "From Azure Portal \n1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select a Cosmos DB account to audit. \n4. Select Networking. \n5. Under Public network access, select Selected networks. \n6. Under Virtual networks, select + Add existing virtual network or + Add a \nnew virtual network. \n7. For existing networks, select subscription, virtual network, subnet and click Add. \nFor new networks, provide a name, update the default values if required, and \nclick Create. \n8. Click Save.",
        "Remediation Steps": {
            "From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade \n3. Select a Cosmos DB to audit. \n4. Select Networking. \n5. Under Public network access, ensure Selected networks is selected. \n6. Under Virtual networks, ensure appropriate virtual networks are configured.",
            "From Azure CLI": "Retrieve a list of all CosmosDB database names: \naz cosmosdb list \nFor each database listed, run the following command: \naz cosmosdb show <database id> \nFor each database, ensure that isVirtualNetworkFilterEnabled is set to true",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb - Name: 'Azure Cosmos DB \naccounts should have firewall rules'"
        },
        "Default Value": "By default, Cosmos DBs are set to have access all networks. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-\nendpoints \n2. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-vnet-\nservice-endpoint \n3. https://docs.microsoft.com/en-us/cli/azure/cosmosdb?view=azure-cli-latest#az-\ncosmosdb-show \n4. https://docs.microsoft.com/en-us/cli/azure/cosmosdb/database?view=azure-cli-\nlatest#az-cosmosdb-database-list \n5. https://docs.microsoft.com/en-us/powershell/module/az.cosmosdb/?view=azps-\n8.1.0 \n6. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-2-secure-cloud-native-services-with-network-controls",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n "
    },
    {
        "Rule": "4.5.2 Ensure That Private Endpoints Are Used Where Possible \n(Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Private endpoints limit network traffic to approved sources.",
        "Rationale": "For sensitive data, private endpoints allow granular control of which services can \ncommunicate with Cosmos DB and ensure that this network traffic is private. You set \nthis up on a case by case basis for each service you wish to be connected. \nImpact: \nOnly whitelisted services will have access to communicate with the Cosmos DB.",
        "Audit": "From Azure Portal \n1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select the Azure Cosmos DB account. \n4. Select Networking. \n5. Ensure Public network access is set to Selected networks. \n6. Ensure the listed networks are set appropriately. \n7. Select Private access. \n8. Ensure a private endpoint exists and Connection state is Approved. \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 58440f8a-10c5-4151-bdce-dfbaad4a20b7 - Name: 'CosmosDB \naccounts should use private link'",
        "Audit Steps": {
            "From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select the Azure Cosmos DB account. \n4. Select Networking. \n5. Ensure Public network access is set to Selected networks. \n6. Ensure the listed networks are set appropriately. \n7. Select Private access. \n8. Ensure a private endpoint exists and Connection state is Approved.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 58440f8a-10c5-4151-bdce-dfbaad4a20b7 - Name: 'CosmosDB \naccounts should use private link'"
        },
        "Remediation": "From Azure Portal \n1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select the Azure Cosmos DB account. \n4. Select Networking. \n5. Select Private access. \n6. Click + Private Endpoint. \n7. Provide a Name. \n8. Click Next. \n9. From the Resource type drop down, select \nMicrosoft.AzureCosmosDB/databaseAccounts. \n10. \nFrom the Resource drop down, select the Cosmos DB account. \n11. \nClick Next. \n12. \nProvide appropriate Virtual Network details. \n13. \nClick Next. \n14. \nProvide appropriate DNS details. \n15. \nClick Next. \n16. \nOptionally provide Tags. \n17. \nClick Next : Review + create. \n18. \nClick Create.",
        "Remediation Steps": {
            "From Azure Portal": "1. Open the portal menu. \n2. Select the Azure Cosmos DB blade. \n3. Select the Azure Cosmos DB account. \n4. Select Networking. \n5. Ensure Public network access is set to Selected networks. \n6. Ensure the listed networks are set appropriately. \n7. Select Private access. \n8. Ensure a private endpoint exists and Connection state is Approved.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 58440f8a-10c5-4151-bdce-dfbaad4a20b7 - Name: 'CosmosDB \naccounts should use private link'"
        },
        "Default Value": "By default Cosmos DB does not have private endpoints enabled and its traffic is public \nto the network. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-\nendpoints \n2. https://docs.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-\ncosmosdb-portal \n3. https://docs.microsoft.com/en-us/cli/azure/cosmosdb/private-endpoint-\nconnection?view=azure-cli-latest \n4. https://docs.microsoft.com/en-us/cli/azure/network/private-endpoint?view=azure-\ncli-latest#az-network-private-endpoint-create \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-2-secure-cloud-native-services-with-network-controls",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n "
    },
    {
        "Rule": "4.5.3 Use Entra ID Client Authentication and Azure RBAC where \npossible. (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Cosmos DB can use tokens or Entra ID for client authentication which in turn will use \nAzure RBAC for authorization. Using Entra ID is significantly more secure because \nEntra ID handles the credentials and allows for MFA and centralized management, and \nthe Azure RBAC better integrated with the rest of Azure.",
        "Rationale": "Entra ID client authentication is considerably more secure than token-based \nauthentication because the tokens must be persistent at the client. Entra ID does not \nrequire this.",
        "Audit": "From Powershell: \n$cosmosdbname = \"<your-cosmos-db-account-name>\" \n$resourcegroup = \"<your-resource-group-name>\" \naz cosmosdb show --name $cosmosdbname --resource-group $resourcegroup | \nConvertFrom-Json \nIn the resulting output, disableLocalAuth should be true",
        "Audit Steps": {
            "From Powershell": ": \n$cosmosdbname = \"<your-cosmos-db-account-name>\" \n$resourcegroup = \"<your-resource-group-name>\" \naz cosmosdb show --name $cosmosdbname --resource-group $resourcegroup | \nConvertFrom-Json \nIn the resulting output, disableLocalAuth should be true"
        },
        "Remediation": "Map all the resources that currently access to the Azure Cosmos DB account with keys \nor access tokens. \nCreate an Entra ID identity for each of these resources: \n\u2022 \nFor Azure resources, you can create a managed identity. You may choose \nbetween system-assigned and user-assigned managed identities. \n\u2022 \nFor non-Azure resources, create an Entra ID identity. Grant each Entra ID \nidentity the minimum permission it requires. When possible, we recommend you \nuse one of the 2 built-in role definitions: Cosmos DB Built-in Data Reader or \nCosmos DB Built-in Data Contributor. Validate that the new resource is \nfunctioning correctly. After new permissions are granted to identities, it may take \na few hours until they propagate. When all resources are working correctly with \nthe new identities, continue to the next step.",
        "Remediation Steps": {
            "From Powershell": ": \n$cosmosdbname = \"<your-cosmos-db-account-name>\" \n$resourcegroup = \"<your-resource-group-name>\" \naz cosmosdb show --name $cosmosdbname --resource-group $resourcegroup | \nConvertFrom-Json \nIn the resulting output, disableLocalAuth should be true"
        },
        "Default Value": "By default Cosmos DB does not have private endpoints enabled and its traffic is public \nto the network. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-private-\nendpoints \n2. https://docs.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-\ncosmosdb-portal \n3. https://docs.microsoft.com/en-us/cli/azure/cosmosdb/private-endpoint-\nconnection?view=azure-cli-latest \n4. https://docs.microsoft.com/en-us/cli/azure/network/private-endpoint?view=azure-\ncli-latest#az-network-private-endpoint-create \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-2-secure-cloud-native-services-with-network-controls",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.2 Establish and Maintain a Secure Network \nArchitecture \n \nEstablish and maintain a secure network architecture. A secure network \narchitecture must address segmentation least privilege and availability at a \nminimum. \n \n \n \nv7 \n14.1 Segment the Network Based on Sensitivity \n \nSegment the network based on the label or classification level of the \ninformation stored on the servers locate all sensitive information on separated \nVirtual Local Area Networks VLANs . \n \n \n "
    },
    {
        "Rule": "5.1.1 Ensure that a 'Diagnostic Setting' exists for Subscription \nActivity Logs (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Enable Diagnostic settings for exporting activity logs. Diagnostic settings are available \nfor each individual resource within a subscription. Settings should be configured for all \nappropriate resources for your environment.",
        "Rationale": "A diagnostic setting controls how a diagnostic log is exported. By default, logs are \nretained only for 90 days. Diagnostic settings should be defined so that logs can be \nexported and stored for a longer duration in order to analyze security activities within an \nAzure subscription.",
        "Audit": "From Azure Portal \nTo identify Diagnostic Settings on a subscription: \n1. Go to Monitor \n2. Click Activity Log \n3. Click Export Activity Logs \n4. Select a Subscription \n5. Ensure a Diagnostic settings exists for the selected Subscription \nTo identify Diagnostic Settings on specific resources: \n1. Go to Monitor \n2. Click Diagnostic settings \n3. Ensure that Diagnostics status is enabled on all appropriate resources. \nFrom Azure CLI \nTo identify Diagnostic Settings on a subscription: \naz monitor diagnostic-settings subscription list --subscription <subscription \nID> \nTo identify Diagnostic Settings on a resource \naz monitor diagnostic-settings list --resource <resource Id> \n \nFrom PowerShell \nTo identify Diagnostic Settings on a Subscription: \nGet-AzDiagnosticSetting -SubscriptionId <subscription ID> \nTo identify Diagnostic Settings on a specific resource:",
        "Audit Steps": {
            "From Azure Portal": "To identify Diagnostic Settings on a subscription: \n1. Go to Monitor \n2. Click Activity Log \n3. Click Export Activity Logs \n4. Select a Subscription \n5. Ensure a Diagnostic settings exists for the selected Subscription \nTo identify Diagnostic Settings on specific resources: \n1. Go to Monitor \n2. Click Diagnostic settings \n3. Ensure that Diagnostics status is enabled on all appropriate resources.",
            "From Azure CLI": "To identify Diagnostic Settings on a subscription: \naz monitor diagnostic-settings subscription list --subscription <subscription \nID> \nTo identify Diagnostic Settings on a resource \naz monitor diagnostic-settings list --resource <resource Id> \n \nFrom PowerShell \nTo identify Diagnostic Settings on a Subscription: \nGet-AzDiagnosticSetting -SubscriptionId <subscription ID> \nTo identify Diagnostic Settings on a specific resource:"
        },
        "Remediation": "From Azure Portal \nTo enable Diagnostic Settings on a Subscription: \n1. Go to Monitor \n2. Click on Activity Log \n3. Click on Export Activity Logs \n4. Click + Add diagnostic setting \n5. Enter a Diagnostic setting name \n6. Select Categories for the diagnostic settings \n7. Select the appropriate Destination details (this may be Log Analytics, Storage \nAccount, Event Hub, or Partner solution) \n8. Click Save \nTo enable Diagnostic Settings on a specific resource: \n1. Go to Monitor \n2. Click Diagnostic settings \n3. Click on the resource that has a diagnostics status of disabled \n4. Select Add Diagnostic Setting \n5. Enter a Diagnostic setting name \n6. Select the appropriate log, metric, and destination. (this may be Log Analytics, \nStorage Account, Event Hub, or Partner solution) \n7. Click save \nRepeat these step for all resources as needed. \n \nFrom Azure CLI \nTo configure Diagnostic Settings on a Subscription: \naz monitor diagnostic-settings subscription create --subscription \n<subscription id> --name <diagnostic settings name> --location <location> <[-\n-event-hub <event hub ID> --event-hub-auth-rule <event hub auth rule ID>] [--\nstorage-account <storage account ID>] [--workspace <log analytics workspace \nID>] --logs \"<JSON encoded categories>\" (e.g. \n[{category:Security,enabled:true},{category:Administrative,enabled:true},{cat\negory:Alert,enabled:true},{category:Policy,enabled:true}]) \nTo configure Diagnostic Settings on a specific resource:",
        "Remediation Steps": {
            "From Azure Portal": "To identify Diagnostic Settings on a subscription: \n1. Go to Monitor \n2. Click Activity Log \n3. Click Export Activity Logs \n4. Select a Subscription \n5. Ensure a Diagnostic settings exists for the selected Subscription \nTo identify Diagnostic Settings on specific resources: \n1. Go to Monitor \n2. Click Diagnostic settings \n3. Ensure that Diagnostics status is enabled on all appropriate resources.",
            "From Azure CLI": "To identify Diagnostic Settings on a subscription: \naz monitor diagnostic-settings subscription list --subscription <subscription \nID> \nTo identify Diagnostic Settings on a resource \naz monitor diagnostic-settings list --resource <resource Id> \n \nFrom PowerShell \nTo identify Diagnostic Settings on a Subscription: \nGet-AzDiagnosticSetting -SubscriptionId <subscription ID> \nTo identify Diagnostic Settings on a specific resource:"
        },
        "Default Value": "The default is to use tokens/keys for client authentication. \nReferences: \n1. https://learn.microsoft.com/en-us/azure/cosmos-db/role-based-access-control",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n6.7 Centralize Access Control \n \nCentralize access control for all enterprise assets through a directory service \nor SSO provider where supported. \n \n \n \nv7 \n16.2 Configure Centralized Point of Authentication \n \nConfigure access for all accounts through as few centralized points of \nauthentication as possible including network security and cloud systems. \n \n \n "
    },
    {
        "Rule": "5.1.2 Ensure Diagnostic Setting captures appropriate categories \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Prerequisite: A Diagnostic Setting must exist. If a Diagnostic Setting does not exist, the \nnavigation and options within this recommendation will not be available. Please review \nthe recommendation at the beginning of this subsection titled: \"Ensure that a 'Diagnostic \nSetting' exists.\" \nThe diagnostic setting should be configured to log the appropriate activities from the \ncontrol/management plane.",
        "Rationale": "A diagnostic setting controls how the diagnostic log is exported. Capturing the \ndiagnostic setting categories for appropriate control/management plane activities allows \nproper alerting.",
        "Audit": "From Azure Portal \n1. Go to Azure Monitor \n2. Click Activity log \n3. Click on Export Activity Logs \n4. Select the appropriate Subscription \n5. If there is no Diagnostic Settings listed, generate a finding. \n6. Otherwise, click on Edit Settings \n7. Ensure that the following categories are checked: Administrative, Alert, \nPolicy, and Security \nFrom Azure CLI \nEnsure the categories 'Administrative', 'Alert', 'Policy', and 'Security' set to: \n'enabled: true' \naz monitor diagnostic-settings subscription list --subscription <subscription \nID> \nFrom Powershell \nEnsure the categories Administrative, Alert, Policy, and Security are set to Enabled:True \nGet-AzSubscriptionDiagnosticSetting -Subscription <subscriptionID>",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Azure Monitor \n2. Click Activity log \n3. Click on Export Activity Logs \n4. Select the appropriate Subscription \n5. If there is no Diagnostic Settings listed, generate a finding. \n6. Otherwise, click on Edit Settings \n7. Ensure that the following categories are checked: Administrative, Alert, \nPolicy, and Security",
            "From Azure CLI": "Ensure the categories 'Administrative', 'Alert', 'Policy', and 'Security' set to: \n'enabled: true' \naz monitor diagnostic-settings subscription list --subscription <subscription \nID>",
            "From Powershell": "Ensure the categories Administrative, Alert, Policy, and Security are set to Enabled:True \nGet-AzSubscriptionDiagnosticSetting -Subscription <subscriptionID>"
        },
        "Remediation": "From Azure Portal \n1. Go to Azure Monitor \n2. Click Activity log \n3. Click on Export Activity Logs \n4. Select the Subscription from the drop down menu \n5. Click on Add diagnostic setting \n6. Enter a name for your new Diagnostic Setting \n7. Check the following categories: Administrative, Alert, Policy, and Security \n8. Choose the destination details according to your organization's needs. \nFrom Az CLI \naz monitor diagnostic-settings subscription create --subscription \n<subscription id> --name <diagnostic settings name> --location <location> <[-\n-event-hub <event hub ID> --event-hub-auth-rule <event hub auth rule ID>] [--\nstorage-account <storage account ID>] [--workspace <log analytics workspace \nID>] --logs \n\"[{category:Security,enabled:true},{category:Administrative,enabled:true},{ca\ntegory:Alert,enabled:true},{category:Policy,enabled:true}]\" \nFrom PowerShell",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Azure Monitor \n2. Click Activity log \n3. Click on Export Activity Logs \n4. Select the appropriate Subscription \n5. If there is no Diagnostic Settings listed, generate a finding. \n6. Otherwise, click on Edit Settings \n7. Ensure that the following categories are checked: Administrative, Alert, \nPolicy, and Security",
            "From Azure CLI": "Ensure the categories 'Administrative', 'Alert', 'Policy', and 'Security' set to: \n'enabled: true' \naz monitor diagnostic-settings subscription list --subscription <subscription \nID>",
            "From Powershell": "Ensure the categories Administrative, Alert, Policy, and Security are set to Enabled:True \nGet-AzSubscriptionDiagnosticSetting -Subscription <subscriptionID>"
        },
        "Default Value": "By default, diagnostic setting is not set.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.9 Centralize Audit Logs \n \nCentralize to the extent possible audit log collection and retention across \nenterprise assets. \n \n \n \nv7 \n6.5 Central Log Management \n \nEnsure that appropriate logs are being aggregated to a central log \nmanagement system for analysis and review. \n \n \n "
    },
    {
        "Rule": "5.1.3 Ensure the storage account containing the container with \nactivity logs is encrypted with Customer Managed Key (CMK) \n(Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Storage accounts with the activity log exports can be configured to use Customer \nManaged Keys (CMK).",
        "Rationale": "Configuring the storage account with the activity log export container to use CMKs \nprovides additional confidentiality controls on log data, as a given user must have read \npermission on the corresponding storage account and must be granted decrypt \npermission by the CMK. \nImpact: \nNOTE: You must have your key vault setup to utilize this. All Audit Logs will be \nencrypted with a key you provide. You will need to set up customer managed keys \nseparately, and you will select which key to use via the instructions here. You will be \nresponsible for the lifecycle of the keys, and will need to manually replace them at your \nown determined intervals to keep the data secure.",
        "Audit": "From Azure Portal \n1. Go to Activity log \n2. Select Export \n3. Select Subscription \n4. In section Storage Account, note the name of the Storage account \n5. Close the Export Audit Logs blade. Close the Monitor - Activity Log blade. \n6. In right column, Click service Storage Accounts to access Storage account blade \n7. Click on the storage account name noted in step 4. This will open blade specific \nto that storage account \n8. Under Security + networking, click Encryption. \n9. Ensure Customer-managed keys is selected and Key URI is set. \nFrom Azure CLI \n1. Get storage account id configured with log profile: \naz monitor diagnostic-settings subscription list --subscription <subscription \nid> --query 'value[*].storageAccountId'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Activity log \n2. Select Export \n3. Select Subscription \n4. In section Storage Account, note the name of the Storage account \n5. Close the Export Audit Logs blade. Close the Monitor - Activity Log blade. \n6. In right column, Click service Storage Accounts to access Storage account blade \n7. Click on the storage account name noted in step 4. This will open blade specific \nto that storage account \n8. Under Security + networking, click Encryption. \n9. Ensure Customer-managed keys is selected and Key URI is set.",
            "From Azure CLI": "1. Get storage account id configured with log profile: \naz monitor diagnostic-settings subscription list --subscription <subscription \nid> --query 'value[*].storageAccountId'"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Storage accounts blade. \n2. Click on the storage account. \n3. Under Security + networking, click Encryption. \n4. Next to Encryption type, select Customer-managed keys. \n5. Complete the steps to configure a customer-managed key for encryption of the \nstorage account. \nFrom Azure CLI \naz storage account update --name <name of the storage account> --resource-\ngroup <resource group for a storage account> --encryption-key-\nsource=Microsoft.Keyvault --encryption-key-vault <Key Vault URI> --\nencryption-key-name <KeyName> --encryption-key-version <Key Version>  \nFrom PowerShell \nSet-AzStorageAccount -ResourceGroupName <resource group name> -Name <storage \naccount name> -KeyvaultEncryption -KeyVaultUri <key vault URI> -KeyName <key \nname>",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Activity log \n2. Select Export \n3. Select Subscription \n4. In section Storage Account, note the name of the Storage account \n5. Close the Export Audit Logs blade. Close the Monitor - Activity Log blade. \n6. In right column, Click service Storage Accounts to access Storage account blade \n7. Click on the storage account name noted in step 4. This will open blade specific \nto that storage account \n8. Under Security + networking, click Encryption. \n9. Ensure Customer-managed keys is selected and Key URI is set.",
            "From Azure CLI": "1. Get storage account id configured with log profile: \naz monitor diagnostic-settings subscription list --subscription <subscription \nid> --query 'value[*].storageAccountId'"
        },
        "Default Value": "When the diagnostic setting is created using Azure Portal, by default no categories are \nselected. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/azure-monitor/platform/diagnostic-\nsettings \n2. https://docs.microsoft.com/en-us/azure/azure-monitor/samples/resource-\nmanager-diagnostic-settings \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n4. https://learn.microsoft.com/en-us/cli/azure/monitor/diagnostic-\nsettings?view=azure-cli-latest \n5. https://learn.microsoft.com/en-us/powershell/module/az.monitor/new-\nazsubscriptiondiagnosticsetting?view=azps-9.2.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.1.4 Ensure that logging for Azure Key Vault is 'Enabled' \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Enable AuditEvent logging for key vault instances to ensure interactions with key vaults \nare logged and available.",
        "Rationale": "Monitoring how and when key vaults are accessed, and by whom, enables an audit trail \nof interactions with confidential information, keys, and certificates managed by Azure \nKey Vault. Enabling logging for Key Vault saves information in a user provided \ndestination of either an Azure storage account or Log Analytics workspace. The same \ndestination can be used for collecting logs for multiple Key Vaults.",
        "Audit": "From Azure Portal \n1. Go to Key vaults. \n2. For each Key vault. \n3. Go to Diagnostic settings. \n4. Click Edit setting. \n5. Ensure that a destination is configured. \n6. Under Category groups, ensure that audit and allLogs are checked. \nFrom Azure CLI \nList all key vaults \naz keyvault list \nFor each keyvault id \naz monitor diagnostic-settings list --resource <id> \nEnsure that storageAccountId reflects your desired destination and that categoryGroup \nand enabled are set as follows in the sample outputs below.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault. \n3. Go to Diagnostic settings. \n4. Click Edit setting. \n5. Ensure that a destination is configured. \n6. Under Category groups, ensure that audit and allLogs are checked.",
            "From Azure CLI": "List all key vaults \naz keyvault list \nFor each keyvault id \naz monitor diagnostic-settings list --resource <id> \nEnsure that storageAccountId reflects your desired destination and that categoryGroup \nand enabled are set as follows in the sample outputs below."
        },
        "Remediation": "From Azure Portal \n1. Go to Key vaults. \n2. Select a Key vault. \n3. Select Diagnostic settings. \n4. Click Edit setting to update an existing diagnostic setting, or Add diagnostic \nsetting to create a new one. \n5. If creating a new diagnostic setting, provide a name. \n6. Configure an appropriate destination. \n7. Under Category groups, check audit and allLogs. \n8. Click Save. \nFrom Azure CLI \nTo update an existing Diagnostic Settings",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Key vaults. \n2. For each Key vault. \n3. Go to Diagnostic settings. \n4. Click Edit setting. \n5. Ensure that a destination is configured. \n6. Under Category groups, ensure that audit and allLogs are checked.",
            "From Azure CLI": "List all key vaults \naz keyvault list \nFor each keyvault id \naz monitor diagnostic-settings list --resource <id> \nEnsure that storageAccountId reflects your desired destination and that categoryGroup \nand enabled are set as follows in the sample outputs below."
        },
        "Default Value": "By default, for a storage account keySource is set to Microsoft.Storage allowing \nencryption with vendor Managed key and not a Customer Managed Key. \nReferences: \n1. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-5-use-customer-managed-key-option-in-data-at-rest-encryption-\nwhen-required \n2. https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/activity-\nlog?tabs=cli#managing-legacy-log-profiles",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "5.1.5 Ensure that Network Security Group Flow logs are captured \nand sent to Log Analytics (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Ensure that network flow logs are captured and fed into a central log analytics \nworkspace.",
        "Rationale": "Network Flow Logs provide valuable insight into the flow of traffic around your network \nand feed into both Azure Monitor and Azure Sentinel (if in use), permitting the \ngeneration of visual flow diagrams to aid with analyzing for lateral movement, etc. \nImpact: \nThe impact of configuring NSG Flow logs is primarily one of cost and configuration. If \ndeployed, it will create storage accounts that hold minimal amounts of data on a 5-day \nlifecycle before feeding to Log Analytics Workspace. This will increase the amount of \ndata stored and used by Azure Monitor.",
        "Audit": "From Azure Portal \n1. Navigate to Network Watcher. \n2. Select NSG flow logs \n3. For each log you wish to audit select it from this view. \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 27960feb-a23c-4577-8d36-ef8b5f35e0be - Name: 'All flow log \nresources should be in enabled state' \n\u2022 \nPolicy ID: c251913d-7d24-4958-af87-478ed3b9ba41 - Name: 'Flow logs should \nbe configured for every network security group' \n\u2022 \nPolicy ID: 4c3c6c5f-0d47-4402-99b8-aa543dd8bcee - Name: 'Flow logs should \nbe configured for every virtual network'",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to Network Watcher. \n2. Select NSG flow logs \n3. For each log you wish to audit select it from this view.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 27960feb-a23c-4577-8d36-ef8b5f35e0be - Name: 'All flow log \nresources should be in enabled state' \n\u2022 \nPolicy ID: c251913d-7d24-4958-af87-478ed3b9ba41 - Name: 'Flow logs should \nbe configured for every network security group' \n\u2022 \nPolicy ID: 4c3c6c5f-0d47-4402-99b8-aa543dd8bcee - Name: 'Flow logs should \nbe configured for every virtual network'"
        },
        "Remediation": "From Azure Portal \n1. Navigate to Network Watcher. \n2. Select NSG flow logs. \n3. Select + Create. \n4. Select the desired Subscription. \n5. Select + Select NSG. \n6. Select a network security group. \n7. Click Confirm selection. \n8. Select or create a new Storage Account. \n9. Input the retention in days to retain the log. \n10. \nClick Next. \n11. \nUnder Configuration, select Version 2. \n12. \nIf rich analytics are required, select Enable Traffic Analytics, a processing \ninterval, and a Log Analytics Workspace. \n13. \nSelect Next. \n14. \nOptionally add Tags. \n15. \nSelect Review + create. \n16. \nSelect Create. \nWarning \nThe remediation policy creates remediation deployment and names them by \nconcatenating the subscription name and the resource group name. The MAXIMUM \npermitted length of a deployment name is 64 characters. Exceeding this will cause the \nremediation task to fail.",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to Network Watcher. \n2. Select NSG flow logs \n3. For each log you wish to audit select it from this view.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 27960feb-a23c-4577-8d36-ef8b5f35e0be - Name: 'All flow log \nresources should be in enabled state' \n\u2022 \nPolicy ID: c251913d-7d24-4958-af87-478ed3b9ba41 - Name: 'Flow logs should \nbe configured for every network security group' \n\u2022 \nPolicy ID: 4c3c6c5f-0d47-4402-99b8-aa543dd8bcee - Name: 'Flow logs should \nbe configured for every virtual network'"
        },
        "Default Value": "By default Network Security Group logs are not sent to Log Analytics. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-\nflow-logging-portal \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-4-enable-network-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n13.6 Collect Network Traffic Flow Logs \n \nCollect network traffic flow logs and or network traffic to review and alert \nupon from network devices. \n \n \n "
    },
    {
        "Rule": "5.1.6 Ensure that logging for Azure AppService 'HTTP logs' is \nenabled (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Enable AppServiceHTTPLogs diagnostic log category for Azure App Service instances \nto ensure all http requests are captured and centrally logged.",
        "Rationale": "Capturing web requests can be important supporting information for security analysts \nperforming monitoring and incident response activities. Once logging, these logs can be \ningested into SIEM or other central aggregation point for the organization. \nImpact: \nLog consumption and processing will incur additional cost.",
        "Audit": "From Azure Portal \n1. Go to App Services \nFor each App Service: \n2. Go to Diagnostic Settings \n3. Ensure that 'HTTP logs' is configured to log to a destination aligned to your \nenvironments approach to log consumption (event hub, storage account, etc. \ndependent on what is consuming the logs such as SIEM or other log aggregation \nutility).",
        "Audit Steps": {
            "From Azure Portal": "1. Go to App Services \nFor each App Service: \n2. Go to Diagnostic Settings \n3. Ensure that 'HTTP logs' is configured to log to a destination aligned to your \nenvironments approach to log consumption (event hub, storage account, etc. \ndependent on what is consuming the logs such as SIEM or other log aggregation \nutility)."
        },
        "Remediation": "From Azure Portal \n1. Go to App Services \nFor each App Service: \n2. Go to Diagnostic Settings \n3. Click Add Diagnostic Setting \n4. Check the checkbox next to 'HTTP logs'",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to App Services \nFor each App Service: \n2. Go to Diagnostic Settings \n3. Ensure that 'HTTP logs' is configured to log to a destination aligned to your \nenvironments approach to log consumption (event hub, storage account, etc. \ndependent on what is consuming the logs such as SIEM or other log aggregation \nutility)."
        },
        "Default Value": "By default Network Security Group logs are not sent to Log Analytics. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-\nflow-logging-portal \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-4-enable-network-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n13.6 Collect Network Traffic Flow Logs \n \nCollect network traffic flow logs and or network traffic to review and alert \nupon from network devices. \n \n \n "
    },
    {
        "Rule": "5.2.1 Ensure that Activity Log Alert exists for Create Policy \nAssignment (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Create Policy Assignment event.",
        "Rationale": "Monitoring for create policy assignment events gives insight into changes done in \n\"Azure policy - assignments\" and can reduce the time it takes to detect unsolicited \nchanges.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/write in the output. If it's \nmissing, generate a finding. \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nIf the output is empty, an alert rule for Create Policy Assignments is not configured.",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/write in the output. If it's \nmissing, generate a finding. \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nIf the output is empty, an alert rule for Create Policy Assignments is not configured."
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create policy assignment (Policy assignment). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Authorization/policyAssignments/write and \nlevel=<verbose | information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription ID> --action-group <action group ID>",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/write in the output. If it's \nmissing, generate a finding. \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nIf the output is empty, an alert rule for Create Policy Assignments is not configured."
        },
        "Default Value": "Not configured. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/app-service/troubleshoot-diagnostic-logs \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.7 Collect URL Request Audit Logs \n \nCollect URL request audit logs on enterprise assets where appropriate and \nsupported. \n \n \n \nv7 \n7.6 Log all URL requests \n \nLog all URL requests from each of the organization s systems whether onsite \nor a mobile device in order to identify potentially malicious activity and assist \nincident handlers with identifying potentially compromised systems. \n \n \n "
    },
    {
        "Rule": "5.2.2 Ensure that Activity Log Alert exists for Delete Policy \nAssignment (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Delete Policy Assignment event.",
        "Rationale": "Monitoring for delete policy assignment events gives insight into changes done in \"azure \npolicy - assignments\" and can reduce the time it takes to detect unsolicited changes.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete policy assignment (Policy assignment). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Authorization/policyAssignments/delete and \nlevel=<verbose | information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the conditions object \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Authorization/policyAssignments/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Action \nobject.",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Authorization/policyAssignments/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete policy \nassignment' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Authorization/policyAssignments/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Authorization/policyAssignments/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, no monitoring alerts are created. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n6. https://docs.microsoft.com/en-in/rest/api/policy/policy-assignments \n7. https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-log",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.2.3 Ensure that Activity Log Alert exists for Create or Update \nNetwork Security Group (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an Activity Log Alert for the Create or Update Network Security Group event.",
        "Rationale": "Monitoring for Create or Update Network Security Group events gives insight into \nnetwork access changes and may reduce the time it takes to detect suspicious activity.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Network Security Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Network Security Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create or Update Network Security Group (Network Security Group). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/networkSecurityGroups/write and level=verbose \n--scope \"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" \n--subscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Network/networkSecurityGroups/write -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject.",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Network Security Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, no monitoring alerts are created. \nReferences: \n1. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n2. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n3. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation \n5. https://azure.microsoft.com/en-us/services/blueprints/ \nAdditional Information: \nThis log alert also applies for Azure Blueprints.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.2.4 Ensure that Activity Log Alert exists for Delete Network \nSecurity Group (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Delete Network Security Group event.",
        "Rationale": "Monitoring for \"Delete Network Security Group\" events gives insight into network access \nchanges and may reduce the time it takes to detect suspicious activity.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Network \nSecurity Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Network \nSecurity Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete Network Security Group (Network Security Group). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/networkSecurityGroups/delete and \nlevel=<verbose | information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Network/networkSecurityGroups/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject.",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/networkSecurityGroups/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Network \nSecurity Group' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription ID> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/networkSecurityGroups/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/networkSecurityGroups/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, no monitoring alerts are created. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.2.5 Ensure that Activity Log Alert exists for Create or Update \nSecurity Solution (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Create or Update Security Solution event.",
        "Rationale": "Monitoring for Create or Update Security Solution events gives insight into changes to \nthe active security solutions and may reduce the time it takes to detect suspicious \nactivity.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Security Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Security Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create or Update Security Solutions (Security Solutions). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Security/securitySolutions/write and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Security/securitySolutions/write -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject.",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Security Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, no monitoring alerts are created. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.2.6 Ensure that Activity Log Alert exists for Delete Security \nSolution (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Delete Security Solution event.",
        "Rationale": "Monitoring for Delete Security Solution events gives insight into changes to the active \nsecurity solutions and may reduce the time it takes to detect suspicious activity.",
        "Audit": "From Azure Console \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete \nSecurity Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Console": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete \nSecurity Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Console \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete Security Solutions (Security Solutions). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Security/securitySolutions/delete and level=<verbose \n| information | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID> \nFrom PowerShell \nCreate the Conditions object. \n$conditions = @() \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Administrative -Field category \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Microsoft.Security/securitySolutions/delete -Field operationName \n$conditions += New-AzActivityLogAlertAlertRuleAnyOfOrLeafConditionObject -\nEqual Verbose -Field level \nRetrieve the Action Group information and store in a variable, then create the Actions \nobject.",
        "Remediation Steps": {
            "From Azure Console": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Security/securitySolutions/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete \nSecurity Solutions' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Security/securitySolutions/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Security/securitySolutions/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, no monitoring alerts are created. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.2.7 Ensure that Activity Log Alert exists for Create or Update \nSQL Server Firewall Rule (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Create or Update SQL Server Firewall Rule event.",
        "Rationale": "Monitoring for Create or Update SQL Server Firewall Rule events gives insight into \nnetwork access changes and may reduce the time it takes to detect suspicious activity. \nImpact: \nThere will be a substantial increase in log size if there are a large number of \nadministrative actions on a server.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create/Update \nserver firewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create/Update \nserver firewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create/Update server firewall rule (Server Firewall Rule). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Sql/servers/firewallRules/write and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create/Update \nserver firewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Default Value": "By default, no monitoring alerts are created. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n "
    },
    {
        "Rule": "5.2.8 Ensure that Activity Log Alert exists for Delete SQL Server \nFirewall Rule (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the \"Delete SQL Server Firewall Rule.\"",
        "Rationale": "Monitoring for Delete SQL Server Firewall Rule events gives insight into SQL network \naccess changes and may reduce the time it takes to detect suspicious activity. \nImpact: \nThere will be a substantial increase in log size if there are a large number of \nadministrative actions on a server.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete server \nfirewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete server \nfirewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete server firewall rule (Server Firewall Rule). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Sql/servers/firewallRules/delete and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Sql/servers/firewallRules/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete server \nfirewall rule' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Sql/servers/firewallRules/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Sql/servers/firewallRules/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Default Value": "By default, no monitoring alerts are created or active. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n "
    },
    {
        "Rule": "5.2.9 Ensure that Activity Log Alert exists for Create or Update \nPublic IP Address rule (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Create or Update Public IP Addresses rule.",
        "Rationale": "Monitoring for Create or Update Public IP Address events gives insight into network \naccess changes and may reduce the time it takes to detect suspicious activity. \nImpact: \nThere will be a substantial increase in log size if there are a large number of \nadministrative actions on a server.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Public Ip Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Public Ip Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Create or Update Public Ip Address (Public Ip Address). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/publicIPAddresses/write and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/write. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Create or \nUpdate Public Ip Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/write in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/write\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Default Value": "By default, no monitoring alerts are created or active. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n "
    },
    {
        "Rule": "5.2.10 Ensure that Activity Log Alert exists for Delete Public IP \nAddress rule (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Create an activity log alert for the Delete Public IP Address rule.",
        "Rationale": "Monitoring for Delete Public IP Address events gives insight into network access \nchanges and may reduce the time it takes to detect suspicious activity. \nImpact: \nThere will be a substantial increase in log size if there are a large number of \nadministrative actions on a server.",
        "Audit": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Public \nIp Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization. \nFrom Azure CLI \naz monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Public \nIp Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the Monitor blade. \n2. Select Alerts. \n3. Select Create. \n4. Select Alert rule. \n5. Choose a subscription. \n6. Select Apply. \n7. Select the Condition tab. \n8. Click See all signals. \n9. Select Delete Public Ip Address (Public Ip Address). \n10. \nClick Apply. \n11. \nSelect the Actions tab. \n12. \nClick Select action groups to select an existing action group, or Create action \ngroup to create a new action group. \n13. \nFollow the prompts to choose or create an action group. \n14. \nSelect the Details tab. \n15. \nSelect a Resource group, provide an Alert rule name and an optional Alert \nrule description. \n16. \nClick Review + create. \n17. \nClick Create. \nFrom Azure CLI \naz monitor activity-log alert create --resource-group \"<resource group name>\" \n--condition category=Administrative and \noperationName=Microsoft.Network/publicIPAddresses/delete and level=<verbose | \ninformation | warning | error | critical> --scope \n\"/subscriptions/<subscription ID>\" --name \"<activity log rule name>\" --\nsubscription <subscription id> --action-group <action group ID>",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the Monitor blade. \n2. Click on Alerts. \n3. In the Alerts window, click on Alert rules. \n4. Ensure an alert rule exists where the Condition column contains Operation \nname=Microsoft.Network/publicIPAddresses/delete. \n5. Click on the Alert Name associated with the previous step. \n6. Ensure the Condition panel displays the text Whenever the Activity Log has \nan event with Category='Administrative', Operation name='Delete Public \nIp Address' and does not filter on Level, Status or Caller. \n7. Ensure the Actions panel displays an Action group is assigned to notify the \nappropriate personnel in your organization.",
            "From Azure CLI": "az monitor activity-log alert list --subscription <subscription Id> --query \n\"[].{Name:name,Enabled:enabled,Condition:condition.allOf,Actions:actions}\" \nLook for Microsoft.Network/publicIPAddresses/delete in the output \nFrom PowerShell \nGet-AzActivityLogAlert -SubscriptionId <subscription ID>|where-object \n{$_.ConditionAllOf.Equal -match \n\"Microsoft.Network/publicIPAddresses/delete\"}|select-object \nLocation,Name,Enabled,ResourceGroupName,ConditionAllOf"
        },
        "Default Value": "By default, no monitoring alerts are created or active. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n "
    },
    {
        "Rule": "5.3.1 Ensure Application Insights are Configured (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Application Insights within Azure act as an Application Performance Monitoring solution \nproviding valuable data into how well an application performs and additional information \nwhen performing incident response. The types of log data collected include application \nmetrics, telemetry data, and application trace logging data providing organizations with \ndetailed information about application activity and application transactions. Both data \nsets help organizations adopt a proactive and retroactive means to handle security and \nperformance related metrics within their modern applications.",
        "Rationale": "Configuring Application Insights provides additional data not found elsewhere within \nAzure as part of a much larger logging and monitoring program within an organization's \nInformation Security practice. The types and contents of these logs will act as both a \npotential cost saving measure (application performance) and a means to potentially \nconfirm the source of a potential incident (trace logging). Metrics and Telemetry data \nprovide organizations with a proactive approach to cost savings by monitoring an \napplication's performance, while the trace logging data provides necessary details in a \nreactive incident response scenario by helping organizations identify the potential \nsource of an incident within their application. \nImpact: \nBecause Application Insights relies on a Log Analytics Workspace, an organization will \nincur additional expenses when using this service.",
        "Audit": "From Azure Portal \n1. Navigate to Application Insights \n2. Ensure an Application Insights service is configured and exists. \nFrom Azure CLI \nNote: The application-insights extension to Azure CLI is currently in Preview \nAdd the application-insights extension.",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to Application Insights \n2. Ensure an Application Insights service is configured and exists.",
            "From Azure CLI": "Note: The application-insights extension to Azure CLI is currently in Preview \nAdd the application-insights extension."
        },
        "Remediation": "From Azure Portal \n1. Navigate to Application Insights \n2. Under the Basics tab within the PROJECT DETAILS section, select the \nSubscription \n3. Select the Resource group \n4. Within the INSTANCE DETAILS, enter a Name \n5. Select a Region \n6. Next to Resource Mode, select Workspace-based \n7. Within the WORKSPACE DETAILS, select the Subscription for the log analytics \nworkspace \n8. Select the appropriate Log Analytics Workspace \n9. Click Next:Tags > \n10. \nEnter the appropriate Tags as Name, Value pairs. \n11. \nClick Next:Review+Create \n12. \nClick Create \nFrom Azure CLI \naz monitor app-insights component create --app <app name> --resource-group \n<resource group name> --location <location> --kind \"web\" --retention-time \n<INT days to retain logs> --workspace <log analytics workspace ID> --\nsubscription <subscription ID> \nFrom PowerShell",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to Application Insights \n2. Ensure an Application Insights service is configured and exists.",
            "From Azure CLI": "Note: The application-insights extension to Azure CLI is currently in Preview \nAdd the application-insights extension."
        },
        "Default Value": "By default, no monitoring alerts are created or active. \nReferences: \n1. https://azure.microsoft.com/en-us/updates/classic-alerting-monitoring-retirement \n2. https://docs.microsoft.com/en-in/azure/azure-monitor/platform/alerts-activity-log \n3. https://docs.microsoft.com/en-in/rest/api/monitor/activitylogalerts/createorupdate \n4. https://docs.microsoft.com/en-\nin/rest/api/monitor/activitylogalerts/listbysubscriptionid \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-3-enable-logging-for-security-investigation",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n "
    },
    {
        "Rule": "5.4 Ensure that Azure Monitor Resource Logging is Enabled for \nAll Services that Support it (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Resource Logs capture activity to the data access plane while the Activity log is a \nsubscription-level log for the control plane. Resource-level diagnostic logs provide \ninsight into operations that were performed within that resource itself; for example, \nreading or updating a secret from a Key Vault. Currently, 95 Azure resources support \nAzure Monitoring (See the more information section for a complete list), including \nNetwork Security Groups, Load Balancers, Key Vault, AD, Logic Apps, and CosmosDB. \nThe content of these logs varies by resource type. \nA number of back-end services were not configured to log and store Resource Logs for \ncertain activities or for a sufficient length. It is crucial that monitoring is correctly \nconfigured to log all relevant activities and retain those logs for a sufficient length of \ntime. Given that the mean time to detection in an enterprise is 240 days, a minimum \nretention period of two years is recommended.",
        "Rationale": "A lack of monitoring reduces the visibility into the data plane, and therefore an \norganization's ability to detect reconnaissance, authorization attempts or other malicious \nactivity. Unlike Activity Logs, Resource Logs are not enabled by default. Specifically, \nwithout monitoring it would be impossible to tell which entities had accessed a data \nstore that was breached. In addition, alerts for failed attempts to access APIs for Web \nServices or Databases are only possible when logging is enabled. \nImpact: \nCosts for monitoring varies with Log Volume. Not every resource needs to have logging \nenabled. It is important to determine the security classification of the data being \nprocessed by the given resource and adjust the logging based on which events need to \nbe tracked. This is typically determined by governance and compliance requirements.",
        "Audit": "From Azure Portal \nThe specific steps for configuring resources within the Azure \nconsole vary depending on resource, but typically the steps are: \n1. Go to the resource \n2. Click on Diagnostic settings \n3. In the blade that appears, click \"Add diagnostic setting\"",
        "Audit Steps": {
            "From Azure Portal": "The specific steps for configuring resources within the Azure \nconsole vary depending on resource, but typically the steps are: \n1. Go to the resource \n2. Click on Diagnostic settings \n3. In the blade that appears, click \"Add diagnostic setting\""
        },
        "Remediation": "Azure Subscriptions should log every access and operation for all resources. \nLogs should be sent to Storage and a Log Analytics Workspace or equivalent third-party \nsystem. Logs should be kept in readily-accessible storage for a minimum of one year, \nand then moved to inexpensive cold storage for a duration of time as necessary. If \nretention policies are set but storing logs in a Storage Account is disabled (for example, \nif only Event Hubs or Log Analytics options are selected), the retention policies have no \neffect. Enable all monitoring at first, and then be more aggressive moving data to cold \nstorage if the volume of data becomes a cost concern. \nFrom Azure Portal \nThe specific steps for configuring resources within the Azure console vary depending on \nresource, but typically the steps are: \n1. Go to the resource \n2. Click on Diagnostic settings \n3. In the blade that appears, click \"Add diagnostic setting\" \n4. Configure the diagnostic settings \n5. Click on Save \nFrom Azure CLI \nFor each resource, run the following making sure to use a resource appropriate JSON \nencoded category for the --logs option. \naz monitor diagnostic-settings create --name <diagnostic settings name> --\nresource <resource ID> --logs \"[{category:<resource specific \ncategory>,enabled:true,rentention-policy:{enabled:true,days:180}}]\" --metrics \n\"[{category:AllMetrics,enabled:true,retention-\npolicy:{enabled:true,days:180}}]\" <[--event-hub <event hub ID> --event-hub-\nrule <event hub auth rule ID> | --storage-account <storage account ID> |--\nworkspace <log analytics workspace ID> | --marketplace-partner-id <full \nresource ID of third-party solution>]> \nFrom PowerShell \nCreate the log settings object \n$logSettings = @() \n$logSettings += New-AzDiagnosticSettingLogSettingsObject -Enabled $true -\nRetentionPolicyDay 180 -RetentionPolicyEnabled $true -Category <resource \nspecific category> \n$logSettings += New-AzDiagnosticSettingLogSettingsObject -Enabled $true -\nRetentionPolicyDay 180 -RetentionPolicyEnabled $true -Category <resource \nspecific category number 2> \nCreate the metric settings object",
        "Remediation Steps": {
            "From Azure Portal": "The specific steps for configuring resources within the Azure \nconsole vary depending on resource, but typically the steps are: \n1. Go to the resource \n2. Click on Diagnostic settings \n3. In the blade that appears, click \"Add diagnostic setting\""
        },
        "Default Value": "Application Insights are not enabled by default. \nReferences: \n1. https://learn.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.2 Collect Audit Logs \n \nCollect audit logs. Ensure that logging per the enterprise s audit log \nmanagement process has been enabled across enterprise assets. \n \n \n \nv7 \n6.2 Activate audit logging \n \nEnsure that local logging has been enabled on all systems and networking \ndevices. \n \n \n "
    },
    {
        "Rule": "5.5 Ensure that SKU Basic/Consumption is not used on artifacts \nthat need to be monitored (Particularly for Production Workloads) \n(Manual)",
        "Profile Applicability": " Level 2",
        "Description": "The use of Basic or Free SKUs in Azure whilst cost effective have significant limitations \nin terms of what can be monitored and what support can be realized from Microsoft. \nTypically, these SKU\u2019s do not have a service SLA and Microsoft may refuse to provide \nsupport for them. Consequently Basic/Free SKUs should never be used for production \nworkloads.",
        "Rationale": "Typically, production workloads need to be monitored and should have an SLA with \nMicrosoft, using Basic SKUs for any deployed product will mean that that these \ncapabilities do not exist. \nThe following resource types should use standard SKUs as a minimum. \n\u2022 \nPublic IP Addresses \n\u2022 \nNetwork Load Balancers \n\u2022 \nREDIS Cache \n\u2022 \nSQL PaaS Databases \n\u2022 \nVPN Gateways \nImpact: \nThe impact of enforcing Standard SKU's is twofold \n1. There will be a cost increase \n2. The monitoring and service level agreements will be available and will support \nthe production service. \nAll resources should be either tagged or in separate Management Groups/Subscriptions",
        "Audit": "This needs to be audited by Azure Policy (one for each resource type) and denied for \neach artifact that is production.",
        "Audit Steps": {},
        "Remediation": "Each artifact has its own process for upgrading from basic to standard SKU's and this \nshould be followed if required.",
        "Remediation Steps": {},
        "Default Value": "Policy should enforce standard SKUs for the following artifacts: \n\u2022 \nPublic IP Addresses \n\u2022 \nNetwork Load Balancers \n\u2022 \nREDIS Cache \n\u2022 \nSQL PaaS Databases \n\u2022 \nVPN Gateways \nReferences: \n1. https://azure.microsoft.com/en-us/support/plans \n2. https://azure.microsoft.com/en-us/support/plans/response/",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.5 Collect Detailed Audit Logs \n \nConfigure detailed audit logging for enterprise assets containing sensitive data. \nInclude event source date username timestamp source addresses destination \naddresses and other useful elements that could assist in a forensic investigation. \n \n \n \nv8 \n8.9 Centralize Audit Logs \n \nCentralize to the extent possible audit log collection and retention across \nenterprise assets. \n \n \n \nv7 \n6.3 Enable Detailed Logging \n \nEnable system logging to include detailed information such as an event source \ndate user timestamp source addresses destination addresses and other useful \nelements. \n \n \n \nv7 \n6.5 Central Log Management \n \nEnsure that appropriate logs are being aggregated to a central log \nmanagement system for analysis and review. \n \n \n "
    },
    {
        "Rule": "6.1 Ensure that RDP access from the Internet is evaluated and \nrestricted (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Network security groups should be periodically evaluated for port misconfigurations. \nWhere certain ports and protocols may be exposed to the Internet, they should be \nevaluated for necessity and restricted wherever they are not explicitly required.",
        "Rationale": "The potential security problem with using RDP over the Internet is that attackers can \nuse various brute force techniques to gain access to Azure Virtual Machines. Once the \nattackers gain access, they can use a virtual machine as a launch point for \ncompromising other machines on an Azure Virtual Network or even attack networked \ndevices outside of Azure.",
        "Audit": "From Azure Portal \n1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for RDP such as \no port = 3389, \no protocol = TCP OR ANY, \no Source = Any OR Internet \nFrom Azure CLI \nList Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"3389\" or \"*\" or \"[port range containing 3389]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\"",
        "Audit Steps": {
            "From Azure Portal": "1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for RDP such as \no port = 3389, \no protocol = TCP OR ANY, \no Source = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"3389\" or \"*\" or \"[port range containing 3389]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""
        },
        "Remediation": "Where RDP is not explicitly required and narrowly configured for resources attached to \nthe Network Security Group, Internet-level access to your Azure resources should be \nrestricted or eliminated. \nFor internal access to relevant resources, configure an encrypted network tunnel such \nas: \nExpressRoute \nSite-to-site VPN \nPoint-to-site VPN",
        "Remediation Steps": {
            "From Azure Portal": "1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for RDP such as \no port = 3389, \no protocol = TCP OR ANY, \no Source = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"3389\" or \"*\" or \"[port range containing 3389]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""
        },
        "Default Value": "By default, RDP access from internet is not enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security/azure-security-network-security-\nbest-practices#disable-rdpssh-access-to-azure-virtual-machines \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries \n3. Express Route: https://docs.microsoft.com/en-us/azure/expressroute/ \n4. Site-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-site-to-site-resource-manager-portal \n5. Point-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-point-to-site-resource-manager-portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n "
    },
    {
        "Rule": "6.2 Ensure that SSH access from the Internet is evaluated and \nrestricted (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Network security groups should be periodically evaluated for port misconfigurations. \nWhere certain ports and protocols may be exposed to the Internet, they should be \nevaluated for necessity and restricted wherever they are not explicitly required.",
        "Rationale": "The potential security problem with using SSH over the Internet is that attackers can \nuse various brute force techniques to gain access to Azure Virtual Machines. Once the \nattackers gain access, they can use a virtual machine as a launch point for \ncompromising other machines on the Azure Virtual Network or even attack networked \ndevices outside of Azure.",
        "Audit": "From Azure Portal \n1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for SSH such as \no port = 22, \no protocol = TCP OR ANY, \no Source = Any OR Internet \nFrom Azure CLI \nList Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"22\" or \"*\" or \"[port range containing 22]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\" \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for SSH such as \no port = 22, \no protocol = TCP OR ANY, \no Source = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"22\" or \"*\" or \"[port range containing 22]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\"",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "Where SSH is not explicitly required and narrowly configured for resources attached to \nthe Network Security Group, Internet-level access to your Azure resources should be \nrestricted or eliminated. \nFor internal access to relevant resources, configure an encrypted network tunnel such \nas: \nExpressRoute \nSite-to-site VPN \nPoint-to-site VPN",
        "Remediation Steps": {
            "From Azure Portal": "1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for SSH such as \no port = 22, \no protocol = TCP OR ANY, \no Source = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"22\" or \"*\" or \"[port range containing 22]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" or \"*\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\"",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default, SSH access from internet is not enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security/azure-security-network-security-\nbest-practices#disable-rdpssh-access-to-azure-virtual-machines \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries \n3. Express Route: https://docs.microsoft.com/en-us/azure/expressroute/ \n4. Site-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-site-to-site-resource-manager-portal \n5. Point-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-point-to-site-resource-manager-portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n \nv8 \n4.5 Implement and Manage a Firewall on End-User \nDevices \n \nImplement and manage a host-based firewall or port-filtering tool on end-user \ndevices with a default-deny rule that drops all traffic except those services and \nports that are explicitly allowed. \n \n \n \nv8 \n13.4 Perform Traffic Filtering Between Network Segments \n \nPerform traffic filtering between network segments where appropriate. \n \n \n "
    },
    {
        "Rule": "6.3 Ensure that UDP access from the Internet is evaluated and \nrestricted (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Network security groups should be periodically evaluated for port misconfigurations. \nWhere certain ports and protocols may be exposed to the Internet, they should be \nevaluated for necessity and restricted wherever they are not explicitly required.",
        "Rationale": "The potential security problem with broadly exposing UDP services over the Internet is \nthat attackers can use DDoS amplification techniques to reflect spoofed UDP traffic \nfrom Azure Virtual Machines. The most common types of these attacks use exposed \nDNS, NTP, SSDP, SNMP, CLDAP and other UDP-based services as amplification \nsources for disrupting services of other machines on the Azure Virtual Network or even \nattack networked devices outside of Azure.",
        "Audit": "From Azure Portal \n1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for UDP such as \n\u2022 \nprotocol = UDP, \n\u2022 \nSource = Any OR Internet \nFrom Azure CLI \nList Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"*\" or \"[port range containing 53, 123, 161, 389, \n1900, or other vulnerable UDP-based services]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"UDP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\"",
        "Audit Steps": {
            "From Azure Portal": "1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for UDP such as \n\u2022 \nprotocol = UDP, \n\u2022 \nSource = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"*\" or \"[port range containing 53, 123, 161, 389, \n1900, or other vulnerable UDP-based services]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"UDP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""
        },
        "Remediation": "Where UDP is not explicitly required and narrowly configured for resources attached to \nthe Network Security Group, Internet-level access to your Azure resources should be \nrestricted or eliminated. \nFor internal access to relevant resources, configure an encrypted network tunnel such \nas: \nExpressRoute \nSite-to-site VPN \nPoint-to-site VPN",
        "Remediation Steps": {
            "From Azure Portal": "1. Open the Networking blade for the specific Virtual machine in Azure portal \n2. Verify that the INBOUND PORT RULES does not have a rule for UDP such as \n\u2022 \nprotocol = UDP, \n\u2022 \nSource = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"*\" or \"[port range containing 53, 123, 161, 389, \n1900, or other vulnerable UDP-based services]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"UDP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""
        },
        "Default Value": "By default, UDP access from internet is not enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-\npractices#secure-your-critical-azure-service-resources-to-only-your-virtual-\nnetworks \n2. https://docs.microsoft.com/en-us/azure/security/fundamentals/ddos-best-\npractices \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries \n4. ExpressRoute: https://docs.microsoft.com/en-us/azure/expressroute/ \n5. Site-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-site-to-site-resource-manager-portal \n6. Point-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-point-to-site-resource-manager-portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n \nv8 \n4.5 Implement and Manage a Firewall on End-User \nDevices \n \nImplement and manage a host-based firewall or port-filtering tool on end-user \ndevices with a default-deny rule that drops all traffic except those services and \nports that are explicitly allowed. \n \n \n \nv8 \n13.4 Perform Traffic Filtering Between Network Segments \n \nPerform traffic filtering between network segments where appropriate. \n \n \n "
    },
    {
        "Rule": "6.4 Ensure that HTTP(S) access from the Internet is evaluated \nand restricted (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Network security groups should be periodically evaluated for port misconfigurations. \nWhere certain ports and protocols may be exposed to the Internet, they should be \nevaluated for necessity and restricted wherever they are not explicitly required and \nnarrowly configured.",
        "Rationale": "The potential security problem with using HTTP(S) over the Internet is that attackers \ncan use various brute force techniques to gain access to Azure resources. Once the \nattackers gain access, they can use the resource as a launch point for compromising \nother resources within the Azure tenant.",
        "Audit": "From Azure Portal \n1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for HTTP(S) such \nas \no port = 80/ 443, \no protocol = TCP, \no Source = Any OR Internet \nFrom Azure CLI \nList Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"80/443\" or \"*\" or \"[port range containing 80/443]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\"",
        "Audit Steps": {
            "From Azure Portal": "1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for HTTP(S) such \nas \no port = 80/ 443, \no protocol = TCP, \no Source = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"80/443\" or \"*\" or \"[port range containing 80/443]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""
        },
        "Remediation": "From Azure Portal \n1. Go to Virtual machines. \n2. For each VM, open the Networking blade. \n3. Click on Inbound port rules. \n4. Delete the rule with: \no Port = 80/443 OR [port range containing 80/443] \no Protocol = TCP OR Any \no Source = Any (*) OR IP Addresses(0.0.0.0/0) OR Service Tag(Internet) \no Action = Allow \nFrom Azure CLI  \nRun below command to list network security groups: \naz network nsg list --subscription <subscription-id> --output table \n1. For each network security group, run below command to list the rules associated \nwith the specified port: \naz network nsg rule list --resource-group <resource-group> --nsg-name \n<nsg-name> --query \"[?destinationPortRange=='80 or 443']\" \n2. Run the below command to delete the rule with: \no Port = 80/443 OR [port range containing 80/443] \no Protocol = TCP OR \"*\" \no Source = Any (*) OR IP Addresses(0.0.0.0/0) OR Service Tag(Internet) \no Action = Allow \naz network nsg rule delete --resource-group <resource-group> --nsg-name \n<nsg-name> --name <rule-name> \nReferences: \n1. Express Route: https://docs.microsoft.com/en-us/azure/expressroute/ \n2. Site-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-site-to-site-resource-manager-portal \n3. Point-to-Site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-point-to-site-resource-manager-portal \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries",
        "Remediation Steps": {
            "From Azure Portal": "1. For each VM, open the Networking blade \n2. Verify that the INBOUND PORT RULES does not have a rule for HTTP(S) such \nas \no port = 80/ 443, \no protocol = TCP, \no Source = Any OR Internet",
            "From Azure CLI": "List Network security groups with corresponding non-default Security rules: \naz network nsg list --query [*].[name,securityRules] \nEnsure that none of the NSGs have security rule as below \n\"access\" : \"Allow\" \n\"destinationPortRange\" : \"80/443\" or \"*\" or \"[port range containing 80/443]\" \n\"direction\" : \"Inbound\" \n\"protocol\" : \"TCP\" \n\"sourceAddressPrefix\" : \"*\" or \"0.0.0.0\" or \"<nw>/0\" or \"/0\" or \"internet\" or \n\"any\""
        },
        "Default Value": "By default, UDP access from internet is not enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security/fundamentals/network-best-\npractices#secure-your-critical-azure-service-resources-to-only-your-virtual-\nnetworks \n2. https://docs.microsoft.com/en-us/azure/security/fundamentals/ddos-best-\npractices \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-1-establish-network-segmentation-boundaries \n4. ExpressRoute: https://docs.microsoft.com/en-us/azure/expressroute/ \n5. Site-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-site-to-site-resource-manager-portal \n6. Point-to-site VPN: https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-\ngateway-howto-point-to-site-resource-manager-portal",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.4 Implement and Manage a Firewall on Servers \n \nImplement and manage a firewall on servers where supported. Example \nimplementations include a virtual firewall operating system firewall or a third-\nparty firewall agent. \n \n \n \nv8 \n4.5 Implement and Manage a Firewall on End-User \nDevices \n \nImplement and manage a host-based firewall or port-filtering tool on end-user \ndevices with a default-deny rule that drops all traffic except those services and \nports that are explicitly allowed. \n \n \n \nv8 \n13.4 Perform Traffic Filtering Between Network Segments \n \nPerform traffic filtering between network segments where appropriate. \n \n \n "
    },
    {
        "Rule": "6.5 Ensure that Network Security Group Flow Log retention period \nis 'greater than 90 days' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Network Security Group Flow Logs should be enabled and the retention period set to \ngreater than or equal to 90 days.",
        "Rationale": "Flow logs enable capturing information about IP traffic flowing in and out of network \nsecurity groups. Logs can be used to check for anomalies and give insight into \nsuspected breaches. \nImpact: \nThis will keep IP traffic logs for longer than 90 days. As a level 2, first determine your \nneed to retain data, then apply your selection here. As this is data stored for longer, \nyour monthly storage costs will increase depending on your data use.",
        "Audit": "From Azure Portal \n1. Go to Network Watcher \n2. Select NSG flow logs blade in the Logs section \n3. Select each Network Security Group from the list \n4. Ensure Status is set to On \n5. Ensure Retention (days) setting greater than 90 days \nFrom Azure CLI \naz network watcher flow-log show --resource-group <resourceGroup> --nsg \n<NameorID of the NetworkSecurityGroup> --query 'retentionPolicy' \nEnsure that enabled is set to true and days is set to greater then or equal to 90. \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 5e1cd26a-5090-4fdb-9d6a-84a90335e22d - Name: 'Configure \nnetwork security groups to use specific workspace, storage account and flowlog \nretention policy for traffic analytics'",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Network Watcher \n2. Select NSG flow logs blade in the Logs section \n3. Select each Network Security Group from the list \n4. Ensure Status is set to On \n5. Ensure Retention (days) setting greater than 90 days",
            "From Azure CLI": "az network watcher flow-log show --resource-group <resourceGroup> --nsg \n<NameorID of the NetworkSecurityGroup> --query 'retentionPolicy' \nEnsure that enabled is set to true and days is set to greater then or equal to 90.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 5e1cd26a-5090-4fdb-9d6a-84a90335e22d - Name: 'Configure \nnetwork security groups to use specific workspace, storage account and flowlog \nretention policy for traffic analytics'"
        },
        "Remediation": "From Azure Portal \n1. Go to Network Watcher \n2. Select NSG flow logs blade in the Logs section \n3. Select each Network Security Group from the list \n4. Ensure Status is set to On \n5. Ensure Retention (days) setting greater than 90 days \n6. Select your storage account in the Storage account field \n7. Select Save \nFrom Azure CLI \nEnable the NSG flow logs and set the Retention (days) to greater than or equal to 90 \ndays. \naz network watcher flow-log configure --nsg <NameorID of the Network Security \nGroup> --enabled true --resource-group <resourceGroupName> --retention 91 --\nstorage-account <NameorID of the storage account to save flow logs>",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Network Watcher \n2. Select NSG flow logs blade in the Logs section \n3. Select each Network Security Group from the list \n4. Ensure Status is set to On \n5. Ensure Retention (days) setting greater than 90 days",
            "From Azure CLI": "az network watcher flow-log show --resource-group <resourceGroup> --nsg \n<NameorID of the NetworkSecurityGroup> --query 'retentionPolicy' \nEnsure that enabled is set to true and days is set to greater then or equal to 90.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions \n\u2022 \nPolicy ID: 5e1cd26a-5090-4fdb-9d6a-84a90335e22d - Name: 'Configure \nnetwork security groups to use specific workspace, storage account and flowlog \nretention policy for traffic analytics'"
        },
        "Default Value": "By default, Network Security Group Flow Logs are disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-nsg-\nflow-logging-overview \n2. https://docs.microsoft.com/en-us/cli/azure/network/watcher/flow-log?view=azure-\ncli-latest \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-6-configure-log-storage-retention",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.3 Ensure Adequate Audit Log Storage \n \nEnsure that logging destinations maintain adequate storage to comply with \nthe enterprise s audit log management process. \n \n \n \nv8 \n8.10 Retain Audit Logs \n \nRetain audit logs across enterprise assets for a minimum of 90 days. \n \n \n \nv7 \n6.4 Ensure adequate storage for logs \n \nEnsure that all systems that store logs have adequate storage space for the \nlogs generated. \n \n \n "
    },
    {
        "Rule": "6.6 Ensure that Network Watcher is 'Enabled' (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Enable Network Watcher for physical regions in Azure subscriptions.",
        "Rationale": "Network diagnostic and visualization tools available with Network Watcher help users \nunderstand, diagnose, and gain insights to the network in Azure. \nImpact: \nThere are additional costs per transaction to run and store network data. For high-\nvolume networks these charges will add up quickly.",
        "Audit": "From Azure Portal \n1. Go to Network Watcher \n2. Ensure that a network watcher is listed for each region. \nFrom Azure CLI \naz network watcher list --query \n\"[].{Location:location,State:provisioningState}\" -o table \nThis will list all network watchers and their provisioning state. \nEnsure provisioningState is Succeeded for each network watcher. \naz account list-locations --query \n\"[?metadata.regionType=='Physical'].{Name:name,DisplayName:regionalDisplayNam\ne}\" -o table \nThis will list all physical regions that exist in the subscription. \nCompare this list to the previous one to ensure that for each region, a network watcher \nexists with provisioningState set to Succeeded. \nFrom PowerShell \nGet a list of Network Watchers \nGet-AzNetworkWatcher \nMake sure each watcher is set with the ProvisioningState setting set to Succeeded and \nall Locations are set with a watcher.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Network Watcher \n2. Ensure that a network watcher is listed for each region.",
            "From Azure CLI": "az network watcher list --query \n\"[].{Location:location,State:provisioningState}\" -o table \nThis will list all network watchers and their provisioning state. \nEnsure provisioningState is Succeeded for each network watcher. \naz account list-locations --query \n\"[?metadata.regionType=='Physical'].{Name:name,DisplayName:regionalDisplayNam\ne}\" -o table \nThis will list all physical regions that exist in the subscription. \nCompare this list to the previous one to ensure that for each region, a network watcher \nexists with provisioningState set to Succeeded. \nFrom PowerShell \nGet a list of Network Watchers \nGet-AzNetworkWatcher \nMake sure each watcher is set with the ProvisioningState setting set to Succeeded and \nall Locations are set with a watcher."
        },
        "Remediation": "Opting out of Network Watcher automatic enablement is a permanent change. Once \nyou opt-out you cannot opt-in without contacting support. \nTo manually enable Network Watcher in each region where you want to use Network \nWatcher capabilities, follow the steps below. \n \nFrom Azure Portal \n1. Go to Network Watcher. \n2. Click Create. \n3. Select a Region from the drop-down menu. \n4. Click Add. \nFrom Azure CLI \naz network watcher configure --locations <region> --enabled true --resource-\ngroup <resource_group>",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Network Watcher \n2. Ensure that a network watcher is listed for each region.",
            "From Azure CLI": "az network watcher list --query \n\"[].{Location:location,State:provisioningState}\" -o table \nThis will list all network watchers and their provisioning state. \nEnsure provisioningState is Succeeded for each network watcher. \naz account list-locations --query \n\"[?metadata.regionType=='Physical'].{Name:name,DisplayName:regionalDisplayNam\ne}\" -o table \nThis will list all physical regions that exist in the subscription. \nCompare this list to the previous one to ensure that for each region, a network watcher \nexists with provisioningState set to Succeeded. \nFrom PowerShell \nGet a list of Network Watchers \nGet-AzNetworkWatcher \nMake sure each watcher is set with the ProvisioningState setting set to Succeeded and \nall Locations are set with a watcher."
        },
        "Default Value": "Network Watcher is automatically enabled. When you create or update a virtual network \nin your subscription, Network Watcher will be enabled automatically in your Virtual \nNetwork's region. There is no impact to your resources or associated charge for \nautomatically enabling Network Watcher. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-\nmonitoring-overview \n2. https://docs.azure.cn/zh-cn/cli/network/watcher?view=azure-cli-\nlatest#az_network_watcher_list \n3. https://docs.azure.cn/zh-cn/cli/network/watcher?view=azure-cli-\nlatest#az_network_watcher_configure \n4. https://docs.microsoft.com/en-us/azure/network-watcher/network-watcher-create \n5. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-logging-threat-\ndetection#lt-4-enable-network-logging-for-security-investigation \n6. https://azure.microsoft.com/en-ca/pricing/details/network-watcher/",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n8.3 Ensure Adequate Audit Log Storage \n \nEnsure that logging destinations maintain adequate storage to comply with \nthe enterprise s audit log management process. \n \n \n \nv8 \n8.10 Retain Audit Logs \n \nRetain audit logs across enterprise assets for a minimum of 90 days. \n \n \n \nv7 \n6.4 Ensure adequate storage for logs \n \nEnsure that all systems that store logs have adequate storage space for the \nlogs generated. \n \n \n "
    },
    {
        "Rule": "6.7 Ensure that Public IP addresses are Evaluated on a Periodic \nBasis (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Public IP Addresses provide tenant accounts with Internet connectivity for resources \ncontained within the tenant. During the creation of certain resources in Azure, a Public \nIP Address may be created. All Public IP Addresses within the tenant should be \nperiodically reviewed for accuracy and necessity.",
        "Rationale": "Public IP Addresses allocated to the tenant should be periodically reviewed for \nnecessity. Public IP Addresses that are not intentionally assigned and controlled \npresent a publicly facing vector for threat actors and significant risk to the tenant.",
        "Audit": "From Azure Portal \n1. Open the All Resources blade \n2. Click on Add Filter \n3. In the Add Filter window, select the following: \nFilter: Type \nOperator: Equals \nValue: Public IP address \n4. Click the Apply button \n5. For each Public IP address in the list, use Overview (or Properties) to review the \n\"Associated to:\" field and determine if the associated resource is still relevant \nto your tenant environment. If the associated resource is relevant, ensure that \nadditional controls exist to mitigate risk (e.g. Firewalls, VPNs, Traffic Filtering, \nVirtual Gateway Appliances, Web Application Firewalls, etc.) on all subsequently \nattached resources. \nFrom Azure CLI \nList all Public IP addresses: \naz network public-ip list \nFor each Public IP address in the output, review the \"name\" property and determine if \nthe associated resource is still relevant to your tenant environment. If the associated \nresource is relevant, ensure that additional controls exist to mitigate risk (e.g. Firewalls, \nVPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.) on \nall subsequently attached resources.",
        "Audit Steps": {
            "From Azure Portal": "1. Open the All Resources blade \n2. Click on Add Filter \n3. In the Add Filter window, select the following: \nFilter: Type \nOperator: Equals \nValue: Public IP address \n4. Click the Apply button \n5. For each Public IP address in the list, use Overview (or Properties) to review the \n\"Associated to:\" field and determine if the associated resource is still relevant \nto your tenant environment. If the associated resource is relevant, ensure that \nadditional controls exist to mitigate risk (e.g. Firewalls, VPNs, Traffic Filtering, \nVirtual Gateway Appliances, Web Application Firewalls, etc.) on all subsequently \nattached resources.",
            "From Azure CLI": "List all Public IP addresses: \naz network public-ip list \nFor each Public IP address in the output, review the \"name\" property and determine if \nthe associated resource is still relevant to your tenant environment. If the associated \nresource is relevant, ensure that additional controls exist to mitigate risk (e.g. Firewalls, \nVPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.) on \nall subsequently attached resources."
        },
        "Remediation": "Remediation will vary significantly depending on your organization's security \nrequirements for the resources attached to each individual Public IP address.",
        "Remediation Steps": {
            "From Azure Portal": "1. Open the All Resources blade \n2. Click on Add Filter \n3. In the Add Filter window, select the following: \nFilter: Type \nOperator: Equals \nValue: Public IP address \n4. Click the Apply button \n5. For each Public IP address in the list, use Overview (or Properties) to review the \n\"Associated to:\" field and determine if the associated resource is still relevant \nto your tenant environment. If the associated resource is relevant, ensure that \nadditional controls exist to mitigate risk (e.g. Firewalls, VPNs, Traffic Filtering, \nVirtual Gateway Appliances, Web Application Firewalls, etc.) on all subsequently \nattached resources.",
            "From Azure CLI": "List all Public IP addresses: \naz network public-ip list \nFor each Public IP address in the output, review the \"name\" property and determine if \nthe associated resource is still relevant to your tenant environment. If the associated \nresource is relevant, ensure that additional controls exist to mitigate risk (e.g. Firewalls, \nVPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.) on \nall subsequently attached resources."
        },
        "Default Value": "During Virtual Machine and Application creation, a setting may create and attach a \npublic IP. \nReferences: \n1. https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.1 Ensure Network Infrastructure is Up-to-Date \n \nEnsure network infrastructure is kept up-to-date. Example implementations \ninclude running the latest stable release of software and or using currently \nsupported network-as-a-service NaaS offerings. Review software versions \nmonthly or more frequently to verify software support. \n \n \n \nv7 \n12.1 Maintain an Inventory of Network Boundaries \n \nMaintain an up-to-date inventory of all of the organization s network boundaries. \n \n \n "
    },
    {
        "Rule": "7.1 Ensure an Azure Bastion Host Exists (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "The Azure Bastion service allows secure remote access to Azure Virtual Machines over \nthe Internet without exposing remote access protocol ports and services directly to the \nInternet. The Azure Bastion service provides this access using TLS over 443/TCP, and \nsubscribes to hardened configurations within an organization's Azure Active Directory \nservice.",
        "Rationale": "The Azure Bastion service allows organizations a more secure means of accessing \nAzure Virtual Machines over the Internet without assigning public IP addresses to those \nVirtual Machines. The Azure Bastion service provides Remote Desktop Protocol (RDP) \nand Secure Shell (SSH) access to Virtual Machines using TLS within a web browser, \nthus preventing organizations from opening up 3389/TCP and 22/TCP to the Internet on \nAzure Virtual Machines. Additional benefits of the Bastion service includes Multi-Factor \nAuthentication, Conditional Access Policies, and any other hardening measures \nconfigured within Azure Active Directory using a central point of access. \nImpact: \nThe Azure Bastion service incurs additional costs and requires a specific virtual network \nconfiguration. The Standard tier offers additional configuration options compared to the \nBasic tier and may incur additional costs for those added features.",
        "Audit": "From Azure Portal \n1. Click on Bastions \n2. Ensure there is at least one Bastion host listed under the Name column \nFrom Azure CLI \nNote: The Azure CLI network bastion module is in Preview as of this writing \naz network bastion list --subscription <subscription ID> \nEnsure the output of the above command is not empty. \n \nFrom PowerShell \nRetrieve the Bastion host(s) information for a specific Resource Group \nGet-AzBastion -ResourceGroupName <resource group name> \nEnsure the output of the above command is not empty.",
        "Audit Steps": {
            "From Azure Portal": "1. Click on Bastions \n2. Ensure there is at least one Bastion host listed under the Name column",
            "From Azure CLI": "Note: The Azure CLI network bastion module is in Preview as of this writing \naz network bastion list --subscription <subscription ID> \nEnsure the output of the above command is not empty. \n \nFrom PowerShell \nRetrieve the Bastion host(s) information for a specific Resource Group \nGet-AzBastion -ResourceGroupName <resource group name> \nEnsure the output of the above command is not empty."
        },
        "Remediation": "From Azure Portal \n1. Click on Bastions \n2. Select the Subscription \n3. Select the Resource group \n4. Type a Name for the new Bastion host \n5. Select a Region \n6. Choose Standard next to Tier \n7. Use the slider to set the Instance count \n8. Select the Virtual network or Create new \n9. Select the Subnet named AzureBastionSubnet. Create a Subnet named \nAzureBastionSubnet using a /26 CIDR range if it doesn't already exist. \n10. \nSelct the appropriate Public IP address option. \n11. \nIf Create new is selected for the Public IP address option, provide a Public IP \naddress name. \n12. \nIf Use existing is selected for Public IP address option, select an IP address \nfrom Choose public IP address \n13. \nClick Next: Tags > \n14. \nConfigure the appropriate Tags \n15. \nClick Next: Advanced > \n16. \nSelect the appropriate Advanced options \n17. \nClick Next: Review + create > \n18. \nClick Create \nFrom Azure CLI \naz network bastion create --location <location> --name <name of bastion host> \n--public-ip-address <public IP address name or ID> --resource-group <resource \ngroup name or ID> --vnet-name <virtual network containing subnet called \n\"AzureBastionSubnet\"> --scale-units <integer> --sku Standard [--disable-copy-\npaste true|false] [--enable-ip-connect true|false] [--enable-tunneling \ntrue|false] \n \nFrom PowerShell \nCreate the appropriate Virtual network settings and Public IP Address settings. \n$subnetName = \"AzureBastionSubnet\" \n$subnet = New-AzVirtualNetworkSubnetConfig -Name $subnetName -AddressPrefix \n<IP address range in CIDR notation making sure to use a /26> \n$virtualNet = New-AzVirtualNetwork -Name <virtual network name> -\nResourceGroupName <resource group name> -Location <location> -AddressPrefix \n<IP address range in CIDR notation> -Subnet $subnet \n$publicip = New-AzPublicIpAddress -ResourceGroupName <resource group name> -\nName <public IP address name> -Location <location> -AllocationMethod Dynamic \n-Sku Standard",
        "Remediation Steps": {
            "From Azure Portal": "1. Click on Bastions \n2. Ensure there is at least one Bastion host listed under the Name column",
            "From Azure CLI": "Note: The Azure CLI network bastion module is in Preview as of this writing \naz network bastion list --subscription <subscription ID> \nEnsure the output of the above command is not empty. \n \nFrom PowerShell \nRetrieve the Bastion host(s) information for a specific Resource Group \nGet-AzBastion -ResourceGroupName <resource group name> \nEnsure the output of the above command is not empty."
        },
        "Default Value": "During Virtual Machine and Application creation, a setting may create and attach a \npublic IP. \nReferences: \n1. https://docs.microsoft.com/en-us/cli/azure/network/public-ip?view=azure-cli-latest \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.1 Ensure Network Infrastructure is Up-to-Date \n \nEnsure network infrastructure is kept up-to-date. Example implementations \ninclude running the latest stable release of software and or using currently \nsupported network-as-a-service NaaS offerings. Review software versions \nmonthly or more frequently to verify software support. \n \n \n \nv7 \n12.1 Maintain an Inventory of Network Boundaries \n \nMaintain an up-to-date inventory of all of the organization s network boundaries. \n \n \n "
    },
    {
        "Rule": "7.2 Ensure Virtual Machines are utilizing Managed Disks \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Migrate blob-based VHDs to Managed Disks on Virtual Machines to exploit the default \nfeatures of this configuration. The features include: \n1. Default Disk Encryption \n2. Resilience, as Microsoft will managed the disk storage and move around if \nunderlying hardware goes faulty \n3. Reduction of costs over storage accounts",
        "Rationale": "Managed disks are by default encrypted on the underlying hardware, so no additional \nencryption is required for basic protection. It is available if additional encryption is \nrequired. Managed disks are by design more resilient that storage accounts. \nFor ARM-deployed Virtual Machines, Azure Adviser will at some point recommend \nmoving VHDs to managed disks both from a security and cost management \nperspective. \nImpact: \nThere are additional costs for managed disks based off of disk space allocated. When \nconverting to managed disks, VMs will be powered off and back on.",
        "Audit": "From Azure Portal \n1. Using the search feature, go to Virtual Machines \n2. Click the Manage view dropdown, then select Edit columns \n3. Add Uses managed disks to the selected columns \n4. Select Save \n5. Ensure all virtual machines listed are using managed disks \nFrom PowerShell \nRun the following command: \nGet-AzVM | ForEach-Object {\"Name: \" + $_.Name;\"ManagedDisk Id: \" + \n$_.StorageProfile.OsDisk.ManagedDisk.Id;\"\"}",
        "Audit Steps": {
            "From Azure Portal": "1. Using the search feature, go to Virtual Machines \n2. Click the Manage view dropdown, then select Edit columns \n3. Add Uses managed disks to the selected columns \n4. Select Save \n5. Ensure all virtual machines listed are using managed disks \nFrom PowerShell \nRun the following command: \nGet-AzVM | ForEach-Object {\"Name: \" + $_.Name;\"ManagedDisk Id: \" + \n$_.StorageProfile.OsDisk.ManagedDisk.Id;\"\"}"
        },
        "Remediation": "From Azure Portal \n1. Using the search feature, go to Virtual Machines \n2. Select the virtual machine you would like to convert \n3. Select Disks in the menu for the VM \n4. At the top select Migrate to managed disks \n5. You may follow the prompts to convert the disk and finish by selecting Migrate to \nstart the process \nNOTE VMs will be stopped and restarted after migration is complete. \nFrom PowerShell \nStop-AzVM -ResourceGroupName $rgName -Name $vmName -Force \nConvertTo-AzVMManagedDisk -ResourceGroupName $rgName -VMName $vmName \nStart-AzVM -ResourceGroupName $rgName -Name $vmName",
        "Remediation Steps": {
            "From Azure Portal": "1. Using the search feature, go to Virtual Machines \n2. Click the Manage view dropdown, then select Edit columns \n3. Add Uses managed disks to the selected columns \n4. Select Save \n5. Ensure all virtual machines listed are using managed disks \nFrom PowerShell \nRun the following command: \nGet-AzVM | ForEach-Object {\"Name: \" + $_.Name;\"ManagedDisk Id: \" + \n$_.StorageProfile.OsDisk.ManagedDisk.Id;\"\"}"
        },
        "Default Value": "Managed disks or are an option upon the creation of VMs. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/virtual-machines/windows/convert-\nunmanaged-to-managed-disks \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-4-enable-data-at-rest-encryption-by-default \n3. https://docs.microsoft.com/en-us/azure/virtual-machines/faq-for-disks \n4. https://azure.microsoft.com/en-us/pricing/details/managed-disks/",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.1 Ensure Network Infrastructure is Up-to-Date \n \nEnsure network infrastructure is kept up-to-date. Example implementations \ninclude running the latest stable release of software and or using currently \nsupported network-as-a-service NaaS offerings. Review software versions \nmonthly or more frequently to verify software support. \n \n \n \nv8 \n13.4 Perform Traffic Filtering Between Network Segments \n \nPerform traffic filtering between network segments where appropriate. \n \n \n \nv7 \n9.2 Ensure Only Approved Ports Protocols and Services \nAre Running \n \nEnsure that only network ports protocols and services listening on a system \nwith validated business needs are running on each system. \n \n \n \nv7 \n11.2 Document Traffic Configuration Rules \n \nAll configuration rules that allow traffic to flow through network devices should \nbe documented in a configuration management system with a specific business \nreason for each rule a specific individual s name responsible for that business \nneed and an expected duration of the need. \n \n \n \nv7 \n12.1 Maintain an Inventory of Network Boundaries \n \nMaintain an up-to-date inventory of all of the organization s network boundaries. \n \n \n "
    },
    {
        "Rule": "7.3 Ensure that 'OS and Data' disks are encrypted with Customer \nManaged Key (CMK) (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Ensure that OS disks (boot volumes) and data disks (non-boot volumes) are encrypted \nwith CMK (Customer Managed Keys). Customer Managed keys can be either ADE or \nServer Side Encryption (SSE).",
        "Rationale": "Encrypting the IaaS VM's OS disk (boot volume) and Data disks (non-boot volume) \nensures that the entire content is fully unrecoverable without a key, thus protecting the \nvolume from unwanted reads. PMK (Platform Managed Keys) are enabled by default in \nAzure-managed disks and allow encryption at rest. CMK is recommended because it \ngives the customer the option to control which specific keys are used for the encryption \nand decryption of the disk. The customer can then change keys and increase security \nby disabling them instead of relying on the PMK key that remains unchanging. There is \nalso the option to increase security further by using automatically rotating keys so that \naccess to disk is ensured to be limited. Organizations should evaluate what their \nsecurity requirements are, however, for the data stored on the disk. For high-risk data \nusing CMK is a must, as it provides extra steps of security. If the data is low risk, PMK is \nenabled by default and provides sufficient data security. \nImpact: \nUsing CMK/BYOK will entail additional management of keys. \nNOTE: You must have your key vault set up to utilize this.",
        "Audit": "From Azure Portal \n1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Disks \n4. Ensure that the OS disk and Data disks have encryption set to CMK. \nFrom PowerShell \n$ResourceGroupName=\"yourResourceGroupName\" \n$DiskName=\"yourDiskName\" \n \n$disk=Get-AzDisk -ResourceGroupName $ResourceGroupName -DiskName $DiskName \n$disk.Encryption.Type",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Disks \n4. Ensure that the OS disk and Data disks have encryption set to CMK. \nFrom PowerShell \n$ResourceGroupName=\"yourResourceGroupName\" \n$DiskName=\"yourDiskName\" \n \n$disk=Get-AzDisk -ResourceGroupName $ResourceGroupName -DiskName $DiskName \n$disk.Encryption.Type"
        },
        "Remediation": "From Azure Portal \nNote: Disks must be detached from VMs to have encryption changed. \n1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Disks \n4. Click the ellipsis (...), then click Detach to detach the disk from the VM \n5. Now search for Disks and locate the unattached disk \n6. Click the disk then select Encryption \n7. Change your encryption type, then select your encryption set \n8. Click Save \n9. Go back to the VM and re-attach the disk \nFrom PowerShell \n$KVRGname = 'MyKeyVaultResourceGroup'; \n $VMRGName = 'MyVirtualMachineResourceGroup'; \n $vmName = 'MySecureVM'; \n $KeyVaultName = 'MySecureVault'; \n $KeyVault = Get-AzKeyVault -VaultName $KeyVaultName -ResourceGroupName \n$KVRGname; \n $diskEncryptionKeyVaultUrl = $KeyVault.VaultUri; \n $KeyVaultResourceId = $KeyVault.ResourceId; \n \n Set-AzVMDiskEncryptionExtension -ResourceGroupName $VMRGname -VMName $vmName \n-DiskEncryptionKeyVaultUrl $diskEncryptionKeyVaultUrl -\nDiskEncryptionKeyVaultId $KeyVaultResourceId; \nNOTE: During encryption it is likely that a reboot will be required. It may take up to 15 \nminutes to complete the process. \nNOTE 2: This may differ for Linux machines as you may need to set the -skipVmBackup \nparameter",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Disks \n4. Ensure that the OS disk and Data disks have encryption set to CMK. \nFrom PowerShell \n$ResourceGroupName=\"yourResourceGroupName\" \n$DiskName=\"yourDiskName\" \n \n$disk=Get-AzDisk -ResourceGroupName $ResourceGroupName -DiskName $DiskName \n$disk.Encryption.Type"
        },
        "Default Value": "By default, Azure disks are encrypted using SSE with PMK.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "7.4 Ensure that 'Unattached disks' are encrypted with 'Customer \nManaged Key' (CMK) (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Ensure that unattached disks in a subscription are encrypted with a Customer Managed \nKey (CMK).",
        "Rationale": "Managed disks are encrypted by default with Platform-managed keys. Using Customer-\nmanaged keys may provide an additional level of security or meet an organization's \nregulatory requirements. Encrypting managed disks ensures that its entire content is \nfully unrecoverable without a key and thus protects the volume from unwarranted reads. \nEven if the disk is not attached to any of the VMs, there is always a risk where a \ncompromised user account with administrative access to VM service can mount/attach \nthese data disks, which may lead to sensitive information disclosure and tampering. \nImpact: \nNOTE: You must have your key vault set up to utilize this. Encryption is available only \non Standard tier VMs. This might cost you more. \nUtilizing and maintaining Customer-managed keys will require additional work to create, \nprotect, and rotate keys.",
        "Audit": "From Azure Portal \n1. Go to Disks \n2. Click on Add Filter \n3. In the filter field select Disk state \n4. In the Value field select Unattached \n5. Click Apply \n6. for each disk listed ensure that Encryption type in the encryption blade is \n`Encryption at-rest with a customer-managed key' \nFrom Azure CLI \nEnsure command below does not return any output. \naz disk list --query '[? diskstate == `Unattached`].{encryptionSettings: \nencryptionSettings, name: name}' -o json",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Disks \n2. Click on Add Filter \n3. In the filter field select Disk state \n4. In the Value field select Unattached \n5. Click Apply \n6. for each disk listed ensure that Encryption type in the encryption blade is \n`Encryption at-rest with a customer-managed key'",
            "From Azure CLI": "Ensure command below does not return any output. \naz disk list --query '[? diskstate == `Unattached`].{encryptionSettings: \nencryptionSettings, name: name}' -o json"
        },
        "Remediation": "If data stored in the disk is no longer useful, refer to Azure documentation to delete \nunattached data disks at: \n-https://docs.microsoft.com/en-us/rest/api/compute/disks/delete \n-https://docs.microsoft.com/en-us/cli/azure/disk?view=azure-cli-latest#az-\ndisk-delete \nIf data stored in the disk is important, To encrypt the disk refer azure documentation at: \n-https://docs.microsoft.com/en-us/azure/virtual-machines/disks-enable-\ncustomer-managed-keys-portal \n-https://docs.microsoft.com/en-\nus/rest/api/compute/disks/update#encryptionsettings",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Disks \n2. Click on Add Filter \n3. In the filter field select Disk state \n4. In the Value field select Unattached \n5. Click Apply \n6. for each disk listed ensure that Encryption type in the encryption blade is \n`Encryption at-rest with a customer-managed key'",
            "From Azure CLI": "Ensure command below does not return any output. \naz disk list --query '[? diskstate == `Unattached`].{encryptionSettings: \nencryptionSettings, name: name}' -o json"
        },
        "Default Value": "By default, managed disks are encrypted with a Platform-managed key. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security/fundamentals/azure-disk-\nencryption-vms-vmss \n2. https://docs.microsoft.com/en-us/azure/security-center/security-center-disk-\nencryption?toc=%2fazure%2fsecurity%2ftoc.json \n3. https://docs.microsoft.com/en-us/rest/api/compute/disks/delete",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "7.5 Ensure that Only Approved Extensions Are Installed (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "For added security, only install organization-approved extensions on VMs.",
        "Rationale": "Azure virtual machine extensions are small applications that provide post-deployment \nconfiguration and automation tasks on Azure virtual machines. These extensions run \nwith administrative privileges and could potentially access anything on a virtual \nmachine. The Azure Portal and community provide several such extensions. Each \norganization should carefully evaluate these extensions and ensure that only those that \nare approved for use are actually implemented. \nImpact: \nFunctionality by unsupported extensions will be disabled.",
        "Audit": "From Azure Portal \n1. Go to Virtual machines. \n2. For each virtual machine, click on the server name to select it go to \n3. In the new column menu, under Settings Click on Extensions + applications. \n4. Ensure that all the listed extensions are approved by your organization for use. \nFrom Azure CLI \nUse the below command to list the extensions attached to a VM, and ensure the listed \nextensions are approved for use. \naz vm extension list --vm-name <vmName> --resource-group <sourceGroupName> --\nquery [*].name \nFrom PowerShell \nGet a list of VMs. \nGet-AzVM \nFor each VM run the following command. \nGet-AzVMExtension -ResourceGroupName <VM Resource Group> -VMName <VM Name> \nReview each Name, ExtensionType, and ProvisioningState to make sure no \nunauthorized extensions are installed on any virtual machines.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Virtual machines. \n2. For each virtual machine, click on the server name to select it go to \n3. In the new column menu, under Settings Click on Extensions + applications. \n4. Ensure that all the listed extensions are approved by your organization for use.",
            "From Azure CLI": "Use the below command to list the extensions attached to a VM, and ensure the listed \nextensions are approved for use. \naz vm extension list --vm-name <vmName> --resource-group <sourceGroupName> --\nquery [*].name \nFrom PowerShell \nGet a list of VMs. \nGet-AzVM \nFor each VM run the following command. \nGet-AzVMExtension -ResourceGroupName <VM Resource Group> -VMName <VM Name> \nReview each Name, ExtensionType, and ProvisioningState to make sure no \nunauthorized extensions are installed on any virtual machines."
        },
        "Remediation": "From Azure Portal \n1. Go to Virtual machines \n2. For each virtual machine, go to Settings \n3. Click on Extensions + applications \n4. If there are unapproved extensions, uninstall them. \nFrom Azure CLI \nFrom the audit command identify the unapproved extensions, and use the below CLI \ncommand to remove an unapproved extension attached to VM. \naz vm extension delete --resource-group <resourceGroupName> --vm-name \n<vmName> --name <extensionName> \nFrom PowerShell \nFor each VM and each insecure extension from the Audit Procedure run the following \ncommand. \nRemove-AzVMExtension -ResourceGroupName <ResourceGroupName> -Name \n<ExtensionName> -VMName <VirtualMachineName>",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Virtual machines. \n2. For each virtual machine, click on the server name to select it go to \n3. In the new column menu, under Settings Click on Extensions + applications. \n4. Ensure that all the listed extensions are approved by your organization for use.",
            "From Azure CLI": "Use the below command to list the extensions attached to a VM, and ensure the listed \nextensions are approved for use. \naz vm extension list --vm-name <vmName> --resource-group <sourceGroupName> --\nquery [*].name \nFrom PowerShell \nGet a list of VMs. \nGet-AzVM \nFor each VM run the following command. \nGet-AzVMExtension -ResourceGroupName <VM Resource Group> -VMName <VM Name> \nReview each Name, ExtensionType, and ProvisioningState to make sure no \nunauthorized extensions are installed on any virtual machines."
        },
        "Default Value": "By default, no extensions are added to the virtual machines. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/virtual-machines/windows/extensions-\nfeatures \n2. https://docs.microsoft.com/en-us/powershell/module/az.compute/?view=azps-\n7.5.0#vm-extensions \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-asset-\nmanagement#am-2-use-only-approved-services \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-asset-\nmanagement#am-5-use-only-approved-applications-in-virtual-machine",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "7.6 Ensure that Endpoint Protection for all Virtual Machines is \ninstalled (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Install endpoint protection for all virtual machines.",
        "Rationale": "Installing endpoint protection systems (like anti-malware for Azure) provides for real-\ntime protection capability that helps identify and remove viruses, spyware, and other \nmalicious software. These also offer configurable alerts when known-malicious or \nunwanted software attempts to install itself or run on Azure systems. \nImpact: \nEndpoint protection will incur an additional cost to you.",
        "Audit": "From Azure Portal \n1. Go to Security Center \n2. Click the Recommendations blade \n3. Ensure that there are no recommendations for Endpoint Protection not \ninstalled on Azure VMs \nFrom Azure CLI \naz vm show -g <MyResourceGroup> -n <MyVm> -d --query \n\"resources[?type=='Microsoft.Compute/virtualMachines/extensions'].{ExtensionN\name:name}\" -o table \nIf extensions are installed, it will list the installed extensions. \nEndpointSecurity || TrendMicroDSA* || Antimalware || EndpointProtection || \nSCWPAgent || PortalProtectExtension* || FileSecurity* \nAlternatively, you can employ your own endpoint protection tool for your OS. \n \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Security Center \n2. Click the Recommendations blade \n3. Ensure that there are no recommendations for Endpoint Protection not \ninstalled on Azure VMs",
            "From Azure CLI": "az vm show -g <MyResourceGroup> -n <MyVm> -d --query \n\"resources[?type=='Microsoft.Compute/virtualMachines/extensions'].{ExtensionN\name:name}\" -o table \nIf extensions are installed, it will list the installed extensions. \nEndpointSecurity || TrendMicroDSA* || Antimalware || EndpointProtection || \nSCWPAgent || PortalProtectExtension* || FileSecurity* \nAlternatively, you can employ your own endpoint protection tool for your OS.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "Follow Microsoft Azure documentation to install endpoint protection from the security \ncenter. Alternatively, you can employ your own endpoint protection tool for your OS.",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Security Center \n2. Click the Recommendations blade \n3. Ensure that there are no recommendations for Endpoint Protection not \ninstalled on Azure VMs",
            "From Azure CLI": "az vm show -g <MyResourceGroup> -n <MyVm> -d --query \n\"resources[?type=='Microsoft.Compute/virtualMachines/extensions'].{ExtensionN\name:name}\" -o table \nIf extensions are installed, it will list the installed extensions. \nEndpointSecurity || TrendMicroDSA* || Antimalware || EndpointProtection || \nSCWPAgent || PortalProtectExtension* || FileSecurity* \nAlternatively, you can employ your own endpoint protection tool for your OS.",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "By default Endpoint Protection is disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-install-\nendpoint-protection \n2. https://docs.microsoft.com/en-us/azure/security/azure-security-antimalware \n3. https://docs.microsoft.com/en-us/cli/azure/vm/extension?view=azure-cli-\nlatest#az_vm_extension_list \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-endpoint-\nsecurity#es-1-use-endpoint-detection-and-response-edr",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n10.2 Configure Automatic Anti-Malware Signature \nUpdates \n \nConfigure automatic updates for anti-malware signature files on all \nenterprise assets. \n \n \n \nv7 \n8.2 Ensure Anti-Malware Software and Signatures are \nUpdated \n \nEnsure that the organization s anti-malware software updates its scanning \nengine and signature database on a regular basis. \n \n \n "
    },
    {
        "Rule": "7.7 [Legacy] Ensure that VHDs are Encrypted (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "NOTE: This is a legacy recommendation. Managed Disks are encrypted by default \nand recommended for all new VM implementations. \nVHD (Virtual Hard Disks) are stored in blob storage and are the old-style disks that were \nattached to Virtual Machines. The blob VHD was then leased to the VM. By default, \nstorage accounts are not encrypted, and Microsoft Defender will then recommend that \nthe OS disks should be encrypted. Storage accounts can be encrypted as a whole using \nPMK or CMK. This should be turned on for storage accounts containing VHDs.",
        "Rationale": "While it is recommended to use Managed Disks which are encrypted by default, \n\"legacy\" VHDs may exist for a variety of reasons and may need to remain in VHD \nformat. VHDs are not encrypted by default, so this recommendation intends to address \nthe security of these disks. In these niche cases, VHDs should be encrypted using the \nprocedures in this recommendation to encrypt and protect the data content. \nIf a virtual machine is using a VHD and can be converted to a managed disk, \ninstructions for this procedure can be found in the resources section of this \nrecommendation under the title \"Convert VHD to Managed Disk.\" \nImpact: \nDepending on how the encryption is implemented will change the size of the impact. If \nprovider-managed keys(PMK) are utilized, the impact is relatively low, but processes \nneed to be put in place to regularly rotate the keys. If Customer-managed keys(CMK) \nare utilized, a key management process needs to be implemented to store and manage \nkey rotation, thus the impact is medium to high depending on user maturity with key \nmanagement.",
        "Audit": "From Azure CLI \nFor each virtual machine identify if the VM is using a legacy VHD by reviewing the VHD \nparameter in the output of the following command. The VHD parameter will contain the \nStorage Account name used for the VHD. \naz vm show --name <MyVM> --resource-group <MyResourceGroup> \nNext, identify if the storage account from the VHD parameter is encrypted by reviewing \nthe encryption --> services --> blob --> enabled within the output of the following \ncommand and make sure its value is True.",
        "Audit Steps": {
            "From Azure CLI": "For each virtual machine identify if the VM is using a legacy VHD by reviewing the VHD \nparameter in the output of the following command. The VHD parameter will contain the \nStorage Account name used for the VHD. \naz vm show --name <MyVM> --resource-group <MyResourceGroup> \nNext, identify if the storage account from the VHD parameter is encrypted by reviewing \nthe encryption --> services --> blob --> enabled within the output of the following \ncommand and make sure its value is True."
        },
        "Remediation": "From Azure Portal \n1. Navigate to the storage account that you wish to encrypt \n2. Select encryption \n3. Select the encryption type that you wish to use \nIf you wish to use a Microsoft-managed key (the default), you can save at this point and \nencryption will be applied to the account. \nIf you select Customer-managed keys, it will ask for the location of the key (The default is \nan Azure Key Vault) and the key name. \nOnce these are captured, save the configuration and the account will be encrypted \nusing the provided key. \n \nFrom Azure CLI: \nCreate the Key Vault \naz keyvault create --name <name> --resource-group <resourceGroup> --location \n<location> --enabled-for-disk-encryption \nEncrypt the disk and store the key in Key Vault",
        "Remediation Steps": {
            "From Azure CLI": "For each virtual machine identify if the VM is using a legacy VHD by reviewing the VHD \nparameter in the output of the following command. The VHD parameter will contain the \nStorage Account name used for the VHD. \naz vm show --name <MyVM> --resource-group <MyResourceGroup> \nNext, identify if the storage account from the VHD parameter is encrypted by reviewing \nthe encryption --> services --> blob --> enabled within the output of the following \ncommand and make sure its value is True."
        },
        "Default Value": "By default Endpoint Protection is disabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/security-center/security-center-install-\nendpoint-protection \n2. https://docs.microsoft.com/en-us/azure/security/azure-security-antimalware \n3. https://docs.microsoft.com/en-us/cli/azure/vm/extension?view=azure-cli-\nlatest#az_vm_extension_list \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-endpoint-\nsecurity#es-1-use-endpoint-detection-and-response-edr",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n10.2 Configure Automatic Anti-Malware Signature \nUpdates \n \nConfigure automatic updates for anti-malware signature files on all \nenterprise assets. \n \n \n \nv7 \n8.2 Ensure Anti-Malware Software and Signatures are \nUpdated \n \nEnsure that the organization s anti-malware software updates its scanning \nengine and signature database on a regular basis. \n \n \n "
    },
    {
        "Rule": "7.8 Ensure only MFA enabled identities can access privileged \nVirtual Machine (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Verify identities without MFA that can log in to a privileged virtual machine using \nseparate login credentials. An adversary can leverage the access to move laterally and \nperform actions with the virtual machine's managed identity. Make sure the virtual \nmachine only has necessary permissions, and revoke the admin-level permissions \naccording to the least privileges principal",
        "Rationale": "Integrating multi-factor authentication (MFA) as part of the organizational policy can \ngreatly reduce the risk of an identity gaining control of valid credentials that may be \nused for additional tactics such as initial access, lateral movement, and collecting \ninformation. MFA can also be used to restrict access to cloud resources and APIs. \nAn Adversary may log into accessible cloud services within a compromised environment \nusing Valid Accounts that are synchronized to move laterally and perform actions with \nthe virtual machine's managed identity. The adversary may then perform management \nactions or access cloud-hosted resources as the logged-on managed identity. \nImpact: \nthis recommendation requires an Azure AD P2 License to implement. \nEnsure that identities that are provisioned to a virtual machine utilizes an RBAC/ABAC \ngroup and is allocated a role using Azure PIM, and the Role settings require MFA or use \nanother PAM solution (like CyberArk) for accessing Virtual Machines.",
        "Audit": "From Azure Portal \n1. Log in to the Azure portal. \n2. Select the Subscription, then click on Access control (IAM). \n3. Select Role Assignments from the top menu and apply filters on Assignment type \nas Privileged administrator roles and Type as Virtual Machines. \n4. Verify the list of privileged managed identities attached to any virtual machine. \n5. If there are privileged managed identities from the above list, then check the list \nof users without MFA by navigating to Azure AD. \n6. In the left navigation pane select Users from Manage. \n7. Click on Per-User MFA from the top menu options and for each user with MULTI-\nFACTOR AUTH STATUS as Disabled follow the below-mentioned steps:",
        "Audit Steps": {
            "From Azure Portal": "1. Log in to the Azure portal. \n2. Select the Subscription, then click on Access control (IAM). \n3. Select Role Assignments from the top menu and apply filters on Assignment type \nas Privileged administrator roles and Type as Virtual Machines. \n4. Verify the list of privileged managed identities attached to any virtual machine. \n5. If there are privileged managed identities from the above list, then check the list \nof users without MFA by navigating to Azure AD. \n6. In the left navigation pane select Users from Manage. \n7. Click on Per-User MFA from the top menu options and for each user with MULTI-\nFACTOR AUTH STATUS as Disabled follow the below-mentioned steps:"
        },
        "Remediation": "From Azure Portal \n1. Log in to the Azure portal. \n2. This can be remediated by enabling MFA for user, Removing user access or \nReducing access of managed identities attached to virtual machines. \n\u2022 \nCase I : Enable MFA for users having access on virtual machines. \n1. Navigate to Azure AD from the left pane and select Users from the Manage \nsection. \n2. Click on Per-User MFA from the top menu options and select each user \nwith MULTI-FACTOR AUTH STATUS as Disabled and can login to virtual \nmachines: \n\u25aa \nFrom quick steps on the right side select enable. \n\u25aa \nClick on enable multi-factor auth and share the link with the user \nto setup MFA as required. \n\u2022 \nCase II : Removing user access on a virtual machine. \n1. Select the Subscription, then click on Access control (IAM). \n2. Select Role assignments and search for Virtual Machine Administrator \nLogin or Virtual Machine User Login or any role that provides access to \nlog into virtual machines. \n3. Click on Role Name, Select Assignments, and remove identities with no \nMFA configured. \n\u2022 \nCase III : Reducing access of managed identities attached to virtual machines. \n1. Select the Subscription, then click on Access control (IAM). \n2. Select Role Assignments from the top menu and apply filters on \nAssignment type as Privileged administrator roles and Type as \nVirtual Machines. \n3. Click on Role Name, Select Assignments, and remove identities access \nmake sure this follows the least privileges principal.",
        "Remediation Steps": {
            "From Azure Portal": "1. Log in to the Azure portal. \n2. Select the Subscription, then click on Access control (IAM). \n3. Select Role Assignments from the top menu and apply filters on Assignment type \nas Privileged administrator roles and Type as Virtual Machines. \n4. Verify the list of privileged managed identities attached to any virtual machine. \n5. If there are privileged managed identities from the above list, then check the list \nof users without MFA by navigating to Azure AD. \n6. In the left navigation pane select Users from Manage. \n7. Click on Per-User MFA from the top menu options and for each user with MULTI-\nFACTOR AUTH STATUS as Disabled follow the below-mentioned steps:"
        },
        "Default Value": "The default value for encryption is \"NO Encryption\" \nReferences: \n1. CLI: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disk-\nencryption-cli-quickstart \n2. Powershell: https://docs.microsoft.com/en-us/azure/virtual-\nmachines/windows/disk-encryption-powershell-quickstart \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-4-enable-data-at-rest-encryption-by-default \n4. Convert VHD to Managed Disk: https://docs.microsoft.com/en-us/previous-\nversions/azure/virtual-machines/scripts/virtual-machines-powershell-sample-\ncreate-managed-disk-from-vhd",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.11 Encrypt Sensitive Data at Rest \n \nEncrypt sensitive data at rest on servers applications and databases containing \nsensitive data. Storage-layer encryption also known as server-side encryption \nmeets the minimum requirement of this Safeguard. Additional encryption methods \nmay include application-layer encryption also known as client-side encryption \nwhere access to the data storage device s does not permit access to the plain-text \ndata. \n \n \n \nv7 \n14.8 Encrypt Sensitive Information at Rest \n \nEncrypt all sensitive information at rest using a tool that requires a secondary \nauthentication mechanism not integrated into the operating system in order to \naccess the information. \n \n \n "
    },
    {
        "Rule": "7.9 Ensure Trusted Launch is enabled on Virtual Machines \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "When Secure Boot and vTPM are enabled together, they provide a strong foundation \nfor protecting your VM from boot attacks. For example, if an attacker attempts to replace \nthe bootloader with a malicious version, Secure Boot will prevent the VM from booting. If \nthe attacker is able to bypass Secure Boot and install a malicious bootloader, vTPM can \nbe used to detect the intrusion and alert you.",
        "Rationale": "Secure Boot and vTPM work together to protect your VM from a variety of boot attacks, \nincluding bootkits, rootkits, and firmware rootkits. Not enabling Trusted Launch in Azure \nVM can lead to increased vulnerability to rootkits and boot-level malware, reduced \nability to detect and prevent unauthorized changes to the boot process, and a potential \ncompromise of system integrity and data security. \nImpact: \nSecure Boot and vTPM are not currently supported for Azure Generation 1 VMs. \nIMPORTANT: Before enabling Secure Boot and vTPM on a Generation 2 VM which \ndoes not already have both enabled, it is highly recommended to create a restore point \nof the VM prior to remediation.",
        "Audit": "From Azure Portal \n1. Go to Virtual Machines \n2. For each VM, under Settings, click on Configuration on the left blade \n3. Under Security Type, make sure security type is not standard and if it is Trusted \nLaunch Virtual Machines then make sure Enable Secure Boot & Enable vTPM \nare checked \nFrom Azure Policy \nIf referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Virtual Machines \n2. For each VM, under Settings, click on Configuration on the left blade \n3. Under Security Type, make sure security type is not standard and if it is Trusted \nLaunch Virtual Machines then make sure Enable Secure Boot & Enable vTPM \nare checked",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Remediation": "From Azure Portal \n1. Go to Virtual Machines \n2. For each VM, under Settings, click on Configuration on the left blade \n3. Under Security Type, select 'Trusted Launch Virtual Machines' \n4. Make sure Enable Secure Boot & Enable vTPM are checked \n5. Click on Apply. \nNote: Trusted launch on existing virtual machines (VMs) is currently not supported for \nAzure Generation 1 VMs",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Virtual Machines \n2. For each VM, under Settings, click on Configuration on the left blade \n3. Under Security Type, make sure security type is not standard and if it is Trusted \nLaunch Virtual Machines then make sure Enable Secure Boot & Enable vTPM \nare checked",
            "From Azure Policy": "If referencing a digital copy of this Benchmark, clicking a Policy ID will open a link to the \nassociated Policy definition in Azure. \nIf referencing a printed copy, you can search Policy IDs from this URL: \nhttps://portal.azure.com/#view/Microsoft_Azure_Policy/PolicyMenuBlade/~/Definitions"
        },
        "Default Value": "On Azure Generation 2 VMs, vTPM is enabled by default. Secure Boot is not enabled \nby default. \nReferences: \n1. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-\nvm?tabs=portal \n2. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-\nvm?tabs=portal#enable-trusted-launch-on-existing-vm \n3. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch#secure-\nboot",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.1 Establish and Maintain a Secure Configuration Process \n \nEstablish and maintain a secure configuration process for enterprise assets \n end-user devices including portable and mobile non-computing IoT devices and \nservers and software operating systems and applications . Review and update \ndocumentation annually or when significant enterprise changes occur that could \nimpact this Safeguard. \n \n \n \nv7 \n5.1 Establish Secure Configurations \n \nMaintain documented standard security configuration standards for all \nauthorized operating systems and software. \n \n \n "
    },
    {
        "Rule": "8.1 Ensure that the Expiration Date is set for all Keys in RBAC \nKey Vaults (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that all Keys in Role Based Access Control (RBAC) Azure Key Vaults have an \nexpiration date set.",
        "Rationale": "Azure Key Vault enables users to store and use cryptographic keys within the Microsoft \nAzure environment. The exp (expiration date) attribute identifies the expiration date on \nor after which the key MUST NOT be used for encryption of new data, wrapping of new \nkeys, and signing. By default, keys never expire. It is thus recommended that keys be \nrotated in the key vault and set an explicit expiration date for all keys to help enforce the \nkey rotation. This ensures that the keys cannot be used beyond their assigned lifetimes. \nImpact: \nKeys cannot be used beyond their assigned expiration dates respectively. Keys need to \nbe rotated periodically wherever they are used.",
        "Audit": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that an appropriate Expiration date is set for any keys \nthat are Enabled. \nFrom Azure CLI: \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nThen for each key vault listed ensure that the output of the below command contains \nKey ID (kid), enabled status as true and Expiration date (expires) is not empty or null: \naz keyvault key list --vault-name <VaultName> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'",
        "Audit Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that an appropriate Expiration date is set for any keys \nthat are Enabled.",
            "From Azure CLI": ": \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nThen for each key vault listed ensure that the output of the below command contains \nKey ID (kid), enabled status as true and Expiration date (expires) is not empty or null: \naz keyvault key list --vault-name <VaultName> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"
        },
        "Remediation": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that an appropriate Expiration date is set for any keys \nthat are Enabled. \nFrom Azure CLI: \nUpdate the Expiration date for the key using the below command: \naz keyvault key set-attributes --name <keyName> --vault-name <vaultName> --\nexpires Y-m-d'T'H:M:S'Z' \nNote: \nTo view the expiration date on all keys in a Key Vault using Microsoft API, the \"List\" Key \npermission is required. \nTo update the expiration date for the keys: \n1. Go to the Key vault, click on Access Control (IAM). \n2. Click on Add role assignment and assign the role of Key Vault Crypto Officer to \nthe appropriate user.",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that an appropriate Expiration date is set for any keys \nthat are Enabled.",
            "From Azure CLI": ": \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nThen for each key vault listed ensure that the output of the below command contains \nKey ID (kid), enabled status as true and Expiration date (expires) is not empty or null: \naz keyvault key list --vault-name <VaultName> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"
        },
        "Default Value": "On Azure Generation 2 VMs, vTPM is enabled by default. Secure Boot is not enabled \nby default. \nReferences: \n1. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-\nvm?tabs=portal \n2. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch-existing-\nvm?tabs=portal#enable-trusted-launch-on-existing-vm \n3. https://learn.microsoft.com/en-us/azure/virtual-machines/trusted-launch#secure-\nboot",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n4.1 Establish and Maintain a Secure Configuration Process \n \nEstablish and maintain a secure configuration process for enterprise assets \n end-user devices including portable and mobile non-computing IoT devices and \nservers and software operating systems and applications . Review and update \ndocumentation annually or when significant enterprise changes occur that could \nimpact this Safeguard. \n \n \n \nv7 \n5.1 Establish Secure Configurations \n \nMaintain documented standard security configuration standards for all \nauthorized operating systems and software. \n \n \n "
    },
    {
        "Rule": "8.2 Ensure that the Expiration Date is set for all Keys in Non-\nRBAC Key Vaults. (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that all Keys in Non Role Based Access Control (RBAC) Azure Key Vaults have \nan expiration date set.",
        "Rationale": "Azure Key Vault enables users to store and use cryptographic keys within the Microsoft \nAzure environment. The exp (expiration date) attribute identifies the expiration date on \nor after which the key MUST NOT be used for a cryptographic operation. By default, \nkeys never expire. It is thus recommended that keys be rotated in the key vault and set \nan explicit expiration date for all keys. This ensures that the keys cannot be used \nbeyond their assigned lifetimes. \nImpact: \nKeys cannot be used beyond their assigned expiration dates respectively. Keys need to \nbe rotated periodically wherever they are used.",
        "Audit": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that the status of the key is Enabled. \n4. For each enabled key, ensure that an appropriate Expiration date is set. \nFrom Azure CLI: \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nFor each key vault, ensure that the output of the below command contains Key ID (kid), \nenabled status as true and Expiration date (expires) is not empty or null: \naz keyvault key list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'",
        "Audit Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that the status of the key is Enabled. \n4. For each enabled key, ensure that an appropriate Expiration date is set.",
            "From Azure CLI": ": \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nFor each key vault, ensure that the output of the below command contains Key ID (kid), \nenabled status as true and Expiration date (expires) is not empty or null: \naz keyvault key list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"
        },
        "Remediation": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that the status of the key is Enabled. \n4. For each enabled key, ensure that an appropriate Expiration date is set. \nFrom Azure CLI: \nUpdate the Expiration date for the key using the below command: \naz keyvault key set-attributes --name <keyName> --vault-name <vaultName> --\nexpires Y-m-d'T'H:M:S'Z' \nNote: \nTo view the expiration date on all keys in a Key Vault using Microsoft API, the \"List\" Key \npermission is required. \nTo update the expiration date for the keys: \n1. Go to Key vault, click on Access policies. \n2. Click on Create and add an access policy with the Update permission (in the Key \nPermissions - Key Management Operations section).",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Keys. \n3. In the main pane, ensure that the status of the key is Enabled. \n4. For each enabled key, ensure that an appropriate Expiration date is set.",
            "From Azure CLI": ": \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nFor each key vault, ensure that the output of the below command contains Key ID (kid), \nenabled status as true and Expiration date (expires) is not empty or null: \naz keyvault key list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"
        },
        "Default Value": "By default, keys do not expire. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis \n2. https://docs.microsoft.com/en-us/rest/api/keyvault/about-keys--secrets-and-\ncertificates#key-vault-keys \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-6-use-a-secure-key-management-process \n4. https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-\nazkeyvaultkeyattribute?view=azps-0.10.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.1 Establish and Maintain a Data Management Process \n \nEstablish and maintain a data management process. In the process address \ndata sensitivity data owner handling of data data retention limits and disposal \nrequirements based on sensitivity and retention standards for the enterprise. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "8.3 Ensure that the Expiration Date is set for all Secrets in RBAC \nKey Vaults (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that all Secrets in Role Based Access Control (RBAC) Azure Key Vaults have \nan expiration date set.",
        "Rationale": "The Azure Key Vault enables users to store and keep secrets within the Microsoft Azure \nenvironment. Secrets in the Azure Key Vault are octet sequences with a maximum size \nof 25k bytes each. The exp (expiration date) attribute identifies the expiration date on or \nafter which the secret MUST NOT be used. By default, secrets never expire. It is thus \nrecommended to rotate secrets in the key vault and set an explicit expiration date for all \nsecrets. This ensures that the secrets cannot be used beyond their assigned lifetimes. \nImpact: \nSecrets cannot be used beyond their assigned expiry date respectively. Secrets need to \nbe rotated periodically wherever they are used.",
        "Audit": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. For each enabled secret, ensure that an appropriate Expiration date is set. \nFrom Azure CLI: \nEnsure that the output of the below command contains ID (id), enabled status as true \nand Expiration date (expires) is not empty or null: \naz keyvault secret list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}' \nFrom PowerShell: \nRetrieve a list of Key vaults: \nGet-AzKeyVault \nFor each Key vault, run the following command to determine which vaults are \nconfigured to use RBAC:",
        "Audit Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. For each enabled secret, ensure that an appropriate Expiration date is set.",
            "From Azure CLI": ": \nEnsure that the output of the below command contains ID (id), enabled status as true \nand Expiration date (expires) is not empty or null: \naz keyvault secret list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}' \nFrom PowerShell: \nRetrieve a list of Key vaults: \nGet-AzKeyVault \nFor each Key vault, run the following command to determine which vaults are \nconfigured to use RBAC:"
        },
        "Remediation": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. For each enabled secret, ensure that an appropriate Expiration date is set. \nFrom Azure CLI: \nUpdate the Expiration date for the secret using the below command: \naz keyvault secret set-attributes --name <secretName> --vault-name \n<vaultName> --expires Y-m-d'T'H:M:S'Z' \nNote: \nTo view the expiration date on all secrets in a Key Vault using Microsoft API, the List \nKey permission is required. \nTo update the expiration date for the secrets: \n1. Go to the Key vault, click on Access Control (IAM). \n2. Click on Add role assignment and assign the role of Key Vault Secrets Officer \nto the appropriate user. \nFrom PowerShell: \nSet-AzKeyVaultSecretAttribute -VaultName <Vault Name> -Name <Secret Name> -\nExpires <DateTime>",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. For each enabled secret, ensure that an appropriate Expiration date is set.",
            "From Azure CLI": ": \nEnsure that the output of the below command contains ID (id), enabled status as true \nand Expiration date (expires) is not empty or null: \naz keyvault secret list --vault-name <KEYVAULTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}' \nFrom PowerShell: \nRetrieve a list of Key vaults: \nGet-AzKeyVault \nFor each Key vault, run the following command to determine which vaults are \nconfigured to use RBAC:"
        },
        "Default Value": "By default, secrets do not expire.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.1 Establish and Maintain a Data Management Process \n \nEstablish and maintain a data management process. In the process address \ndata sensitivity data owner handling of data data retention limits and disposal \nrequirements based on sensitivity and retention standards for the enterprise. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "8.4 Ensure that the Expiration Date is set for all Secrets in Non-\nRBAC Key Vaults (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Ensure that all Secrets in Non Role Based Access Control (RBAC) Azure Key Vaults \nhave an expiration date set.",
        "Rationale": "The Azure Key Vault enables users to store and keep secrets within the Microsoft Azure \nenvironment. Secrets in the Azure Key Vault are octet sequences with a maximum size \nof 25k bytes each. The exp (expiration date) attribute identifies the expiration date on or \nafter which the secret MUST NOT be used. By default, secrets never expire. It is thus \nrecommended to rotate secrets in the key vault and set an explicit expiration date for all \nsecrets. This ensures that the secrets cannot be used beyond their assigned lifetimes. \nImpact: \nSecrets cannot be used beyond their assigned expiry date respectively. Secrets need to \nbe rotated periodically wherever they are used.",
        "Audit": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. Set an appropriate Expiration date on all secrets. \nFrom Azure CLI: \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nFor each key vault, ensure that the output of the below command contains ID (id), \nenabled status as true and Expiration date (expires) is not empty or null: \naz keyvault secret list --vault-name <KEYVALUTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'",
        "Audit Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. Set an appropriate Expiration date on all secrets.",
            "From Azure CLI": ": \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nFor each key vault, ensure that the output of the below command contains ID (id), \nenabled status as true and Expiration date (expires) is not empty or null: \naz keyvault secret list --vault-name <KEYVALUTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"
        },
        "Remediation": "From Azure Portal: \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. Set an appropriate Expiration date on all secrets. \nFrom Azure CLI: \nUpdate the Expiration date for the secret using the below command: \naz keyvault secret set-attributes --name <secretName> --vault-name \n<vaultName> --expires Y-m-d'T'H:M:S'Z' \nNote: To view the expiration date on all secrets in a Key Vault using Microsoft API, the \nList Key permission is required. \n \nTo update the expiration date for the secrets: \n1. Go to Key vault, click on Access policies. \n2. Click on Create and add an access policy with the Update permission (in the \nSecret Permissions - Secret Management Operations section).",
        "Remediation Steps": {
            "From Azure Portal": ": \n1. Go to Key vaults. \n2. For each Key vault, click on Secrets. \n3. In the main pane, ensure that the status of the secret is Enabled. \n4. Set an appropriate Expiration date on all secrets.",
            "From Azure CLI": ": \nGet a list of all the key vaults in your Azure environment by running the following \ncommand: \naz keyvault list \nFor each key vault, ensure that the output of the below command contains ID (id), \nenabled status as true and Expiration date (expires) is not empty or null: \naz keyvault secret list --vault-name <KEYVALUTNAME> --query \n'[*].{\"kid\":kid,\"enabled\":attributes.enabled,\"expires\":attributes.expires}'"
        },
        "Default Value": "By default, secrets do not expire.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.1 Establish and Maintain a Data Management Process \n \nEstablish and maintain a data management process. In the process address \ndata sensitivity data owner handling of data data retention limits and disposal \nrequirements based on sensitivity and retention standards for the enterprise. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "8.5 Ensure the Key Vault is Recoverable (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "The Key Vault contains object keys, secrets, and certificates. Accidental unavailability of \na Key Vault can cause immediate data loss or loss of security functions (authentication, \nvalidation, verification, non-repudiation, etc.) supported by the Key Vault objects. \nIt is recommended the Key Vault be made recoverable by enabling the \"Do Not Purge\" \nand \"Soft Delete\" functions. This is in order to prevent loss of encrypted data, including \nstorage accounts, SQL databases, and/or dependent services provided by Key Vault \nobjects (Keys, Secrets, Certificates) etc. This may happen in the case of accidental \ndeletion by a user or from disruptive activity by a malicious user. \nWARNING: A current limitation is that role assignments disappearing when Key Vault is \ndeleted. All role assignments will need to be recreated after recovery.",
        "Rationale": "There could be scenarios where users accidentally run delete/purge commands on Key \nVault or an attacker/malicious user deliberately does so in order to cause disruption. \nDeleting or purging a Key Vault leads to immediate data loss, as keys encrypting data \nand secrets/certificates allowing access/services will become non-accessible. \nThere is a Key Vault property that plays a role in permanent unavailability of a Key \nVault: \nenablePurgeProtection: Setting this parameter to \"true\" for a Key Vault ensures that \neven if Key Vault is deleted, Key Vault itself or its objects remain recoverable for the \nnext 90 days. Key Vault/objects can either be recovered or purged (permanent deletion) \nduring those 90 days. If no action is taken, the key vault and its objects will \nsubsequently be purged. \nEnabling the enablePurgeProtection parameter on Key Vaults ensures that Key Vaults \nand their objects cannot be deleted/purged permanently. \nImpact: \nOnce purge-protection and soft-delete are enabled for a Key Vault, the action is \nirreversible.",
        "Audit": "From Azure Portal \n1. Go to Key Vaults \n2. For each Key Vault \n3. Click Properties \n4. Ensure the \"Enable purge protection (enforce a mandatory retention period for \ndeleted vaults and vault objects)\" is selected for Purge protection option on this \nkey vault` \nFrom Azure CLI \n1. List all Resources of type Key Vaults: \naz resource list --query \"[?type=='Microsoft.KeyVault/vaults']\" \n2. For Every Key Vault ID ensure check parameters enablePurgeProtection is set \nto true. \naz resource show --id /subscriptions/xxxxxx-xxxx-xxxx-xxxx-\nxxxxxxxxxxxx/resourceGroups/<resourceGroupName>/providers/Microsoft.KeyVault \n/vaults/<keyVaultName> \n \nFrom PowerShell \nGet all Key Vaults. \nGet-AzKeyVault \nFor each Key Vault run the following command. \nGet-AzKeyVault -VaultName <Vault Name> \nExamine the results of the above command for the EnablePurgeProtection setting. \nMake sure enablePurgeProtection is set to True.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to Key Vaults \n2. For each Key Vault \n3. Click Properties \n4. Ensure the \"Enable purge protection (enforce a mandatory retention period for \ndeleted vaults and vault objects)\" is selected for Purge protection option on this \nkey vault`",
            "From Azure CLI": "1. List all Resources of type Key Vaults: \naz resource list --query \"[?type=='Microsoft.KeyVault/vaults']\" \n2. For Every Key Vault ID ensure check parameters enablePurgeProtection is set \nto true. \naz resource show --id /subscriptions/xxxxxx-xxxx-xxxx-xxxx-\nxxxxxxxxxxxx/resourceGroups/<resourceGroupName>/providers/Microsoft.KeyVault \n/vaults/<keyVaultName> \n \nFrom PowerShell \nGet all Key Vaults. \nGet-AzKeyVault \nFor each Key Vault run the following command. \nGet-AzKeyVault -VaultName <Vault Name> \nExamine the results of the above command for the EnablePurgeProtection setting. \nMake sure enablePurgeProtection is set to True."
        },
        "Remediation": "To enable \"Do Not Purge\" and \"Soft Delete\" for a Key Vault: \nFrom Azure Portal \n1. Go to Key Vaults \n2. For each Key Vault \n3. Click Properties \n4. Ensure the status of Purge protection reads Enable purge protection (enforce \na mandatory retention period for deleted vaults and vault objects). \nNote, once enabled you cannot disable it.",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to Key Vaults \n2. For each Key Vault \n3. Click Properties \n4. Ensure the \"Enable purge protection (enforce a mandatory retention period for \ndeleted vaults and vault objects)\" is selected for Purge protection option on this \nkey vault`",
            "From Azure CLI": "1. List all Resources of type Key Vaults: \naz resource list --query \"[?type=='Microsoft.KeyVault/vaults']\" \n2. For Every Key Vault ID ensure check parameters enablePurgeProtection is set \nto true. \naz resource show --id /subscriptions/xxxxxx-xxxx-xxxx-xxxx-\nxxxxxxxxxxxx/resourceGroups/<resourceGroupName>/providers/Microsoft.KeyVault \n/vaults/<keyVaultName> \n \nFrom PowerShell \nGet all Key Vaults. \nGet-AzKeyVault \nFor each Key Vault run the following command. \nGet-AzKeyVault -VaultName <Vault Name> \nExamine the results of the above command for the EnablePurgeProtection setting. \nMake sure enablePurgeProtection is set to True."
        },
        "Default Value": "By default, secrets do not expire. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/key-vault/key-vault-whatis \n2. https://docs.microsoft.com/en-us/rest/api/keyvault/about-keys--secrets-and-\ncertificates#key-vault-secrets \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-6-use-a-secure-key-management-process \n4. https://docs.microsoft.com/en-us/powershell/module/az.keyvault/set-\nazkeyvaultsecret?view=azps-7.4.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.1 Establish and Maintain a Data Management Process \n \nEstablish and maintain a data management process. In the process address \ndata sensitivity data owner handling of data data retention limits and disposal \nrequirements based on sensitivity and retention standards for the enterprise. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "8.6 Enable Role Based Access Control for Azure Key Vault \n(Manual)",
        "Profile Applicability": " Level 2",
        "Description": "WARNING: Role assignments disappear when a Key Vault has been deleted (soft-\ndelete) and recovered. Afterwards it will be required to recreate all role assignments. \nThis is a limitation of the soft-delete feature across all Azure services.",
        "Rationale": "The new RBAC permissions model for Key Vaults enables a much finer grained access \ncontrol for key vault secrets, keys, certificates, etc., than the vault access policy. This in \nturn will permit the use of privileged identity management over these roles, thus \nsecuring the key vaults with JIT Access management. \nImpact: \nImplementation needs to be properly designed from the ground up, as this is a \nfundamental change to the way key vaults are accessed/managed. Changing \npermissions to key vaults will result in loss of service as permissions are re-applied. For \nthe least amount of downtime, map your current groups and users to their \ncorresponding permission needs.",
        "Audit": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left corner \n2. Select Key Vaults \n3. Select a Key Vault to audit \n4. Select Access configuration \n5. Ensure the Permission Model radio button is set to Azure role-based access \ncontrol \nFrom Azure CLI* \nRun the following command for each Key Vault in each Resource Group: \naz keyvault show --resource-group <RESOURCE GROUP NAME> --name <KEY VAULT \nNAME> \nEnsure the enableRbacAuthorization setting is set to true within the output of the \nabove command.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left corner \n2. Select Key Vaults \n3. Select a Key Vault to audit \n4. Select Access configuration \n5. Ensure the Permission Model radio button is set to Azure role-based access \ncontrol",
            "From Azure CLI": "* \nRun the following command for each Key Vault in each Resource Group: \naz keyvault show --resource-group <RESOURCE GROUP NAME> --name <KEY VAULT \nNAME> \nEnsure the enableRbacAuthorization setting is set to true within the output of the \nabove command."
        },
        "Remediation": "From Azure Portal \nKey Vaults can be configured to use Azure role-based access control on creation. \nFor existing Key Vaults: \n1. From Azure Home open the Portal Menu in the top left corner \n2. Select Key Vaults \n3. Select a Key Vault to audit \n4. Select Access configuration \n5. Set the Permission model radio button to Azure role-based access control, \ntaking note of the warning message \n6. Click Save \n7. Select Access Control (IAM) \n8. Select the Role Assignments tab \n9. Reapply permissions as needed to groups or users \nFrom Azure CLI* \nTo enable RBAC Authorization for each Key Vault, run the following Azure CLI \ncommand: \naz keyvault update --resource-group <RESOURCE GROUP NAME> --name <KEY VAULT \nNAME> --enable-rbac-authorization true \nFrom PowerShell \nTo enable RBAC authorization on each Key Vault, run the following PowerShell \ncommand: \nUpdate-AzKeyVault -ResourceGroupName <RESOURCE GROUP NAME> -VaultName <KEY \nVAULT NAME> -EnableRbacAuthorization $True",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left corner \n2. Select Key Vaults \n3. Select a Key Vault to audit \n4. Select Access configuration \n5. Ensure the Permission Model radio button is set to Azure role-based access \ncontrol",
            "From Azure CLI": "* \nRun the following command for each Key Vault in each Resource Group: \naz keyvault show --resource-group <RESOURCE GROUP NAME> --name <KEY VAULT \nNAME> \nEnsure the enableRbacAuthorization setting is set to true within the output of the \nabove command."
        },
        "Default Value": "The default value for Access control in Key Vaults is Vault Policy.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n11.1 Establish and Maintain a Data Recovery Process \n \nEstablish and maintain a data recovery process. In the process address the \nscope of data recovery activities recovery prioritization and the security of backup \ndata. Review and update documentation annually or when significant enterprise \nchanges occur that could impact this Safeguard. \n \n \n \nv7 \n10.2 Perform Complete System Backups \n \nEnsure that each of the organization s key systems are backed up as a \ncomplete system through processes such as imaging to enable the quick \nrecovery of an entire system. \n \n \n "
    },
    {
        "Rule": "8.7 Ensure that Private Endpoints are Used for Azure Key Vault \n(Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Private endpoints will secure network traffic from Azure Key Vault to the resources \nrequesting secrets and keys.",
        "Rationale": "Private endpoints will keep network requests to Azure Key Vault limited to the endpoints \nattached to the resources that are whitelisted to communicate with each other. \nAssigning the Key Vault to a network without an endpoint will allow other resources on \nthat network to view all traffic from the Key Vault to its destination. In spite of the \ncomplexity in configuration, this is recommended for high security secrets. \nImpact: \nIncorrect or poorly-timed changing of network configuration could result in service \ninterruption. There are also additional costs tiers for running a private endpoint per \npetabyte or more of networking traffic.",
        "Audit": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Select Networking in the left column. \n5. Select Private endpoint connections from the top row. \n6. View if there is an endpoint attached. \nFrom Azure CLI \nRun the following command within a subscription for each Key Vault you wish to audit. \naz keyvault private-endpoint-connection show -g <resourceGroup> --vault-name \n<keyVaultName> \nFrom Powershell \nRun the following command within a subscription for each Key Vault you wish to audit. \nGet-AzPrivateEndpointConnection -PrivateLinkResourceId \n'/subscriptions/<subscriptionNumber>/resourceGroups/<resourceGroup>/providers\n/Microsoft.KeyVault/vaults/<keyVaultName>/'",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Select Networking in the left column. \n5. Select Private endpoint connections from the top row. \n6. View if there is an endpoint attached.",
            "From Azure CLI": "Run the following command within a subscription for each Key Vault you wish to audit. \naz keyvault private-endpoint-connection show -g <resourceGroup> --vault-name \n<keyVaultName>",
            "From Powershell": "Run the following command within a subscription for each Key Vault you wish to audit. \nGet-AzPrivateEndpointConnection -PrivateLinkResourceId \n'/subscriptions/<subscriptionNumber>/resourceGroups/<resourceGroup>/providers\n/Microsoft.KeyVault/vaults/<keyVaultName>/'"
        },
        "Remediation": "Please see the additional information about the requirements needed before \nstarting this remediation procedure. \nFrom Azure Portal \n1. From Azure Home open the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Select Networking in the left column. \n5. Select Private endpoint connections from the top row. \n6. Select + Create. \n7. Select the subscription the Key Vault is within, and other desired configuration. \n8. Select Next. \n9. For resource type select Microsoft.KeyVault/vaults. \n10. \nSelect the Key Vault to associate the Private Endpoint with. \n11. \nSelect Next. \n12. \nIn the Virtual Networking field, select the network to assign the Endpoint. \n13. \nSelect other configuration options as desired, including an existing or new \napplication security group. \n14. \nSelect Next. \n15. \nSelect the private DNS the Private Endpoints will use. \n16. \nSelect Next. \n17. \nOptionally add Tags. \n18. \nSelect Next : Review + Create. \n19. \nReview the information and select Create. Follow the Audit Procedure to \ndetermine if it has successfully applied. \n20. \nRepeat steps 3-19 for each Key Vault.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Select Networking in the left column. \n5. Select Private endpoint connections from the top row. \n6. View if there is an endpoint attached.",
            "From Azure CLI": "Run the following command within a subscription for each Key Vault you wish to audit. \naz keyvault private-endpoint-connection show -g <resourceGroup> --vault-name \n<keyVaultName>",
            "From Powershell": "Run the following command within a subscription for each Key Vault you wish to audit. \nGet-AzPrivateEndpointConnection -PrivateLinkResourceId \n'/subscriptions/<subscriptionNumber>/resourceGroups/<resourceGroup>/providers\n/Microsoft.KeyVault/vaults/<keyVaultName>/'"
        },
        "Default Value": "The default value for Access control in Key Vaults is Vault Policy.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv8 \n6.8 Define and Maintain Role-Based Access Control \n \nDefine and maintain role-based access control through determining and \ndocumenting the access rights necessary for each role within the enterprise to \nsuccessfully carry out its assigned duties. Perform access control reviews of \nenterprise assets to validate that all privileges are authorized on a recurring \nschedule at a minimum annually or more frequently. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share claims \napplication or database specific access control lists. These controls will enforce the \nprinciple that only authorized individuals should have access to the information \nbased on their need to access the information as a part of their responsibilities. \n \n \n "
    },
    {
        "Rule": "8.8 Ensure Automatic Key Rotation is Enabled Within Azure Key \nVault for the Supported Services (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Automatic Key Rotation is available in Public Preview. The currently supported \napplications are Key Vault, Managed Disks, and Storage accounts accessing keys \nwithin Key Vault. The number of supported applications will incrementally increased.",
        "Rationale": "Once set up, Automatic Private Key Rotation removes the need for manual \nadministration when keys expire at intervals determined by your organization's policy. \nThe recommended key lifetime is 2 years. Your organization should determine its own \nkey expiration policy. \nImpact: \nThere are an additional costs per operation in running the needed applications.",
        "Audit": "From Azure Portal \n1. From Azure Portal select the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Under Objects select Keys. \n5. Select a key to audit. \n6. In the top row select Rotation policy. \n7. Ensure Enable auto rotation is set to Enabled. \n8. Repeat steps 3-7 for each Key Vault and Key. \nFrom Azure CLI \nRun the following command: \naz keyvault key rotation-policy show --vaultname <vaultName> --name <keyName> \n \nFrom PowerShell \nRun the following command: \nGet-AzKeyVaultKeyRotationPolicy -VaultName <vaultName> -Name <keyName>",
        "Audit Steps": {
            "From Azure Portal": "select the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Under Objects select Keys. \n5. Select a key to audit. \n6. In the top row select Rotation policy. \n7. Ensure Enable auto rotation is set to Enabled. \n8. Repeat steps 3-7 for each Key Vault and Key.",
            "From Azure CLI": "Run the following command: \naz keyvault key rotation-policy show --vaultname <vaultName> --name <keyName> \n \nFrom PowerShell \nRun the following command: \nGet-AzKeyVaultKeyRotationPolicy -VaultName <vaultName> -Name <keyName>"
        },
        "Remediation": "Note: \nAzure CLI and Powershell use ISO8601 flags to input timespans. Every timespan input \nwill be in the format P<timespanInISO8601Format>(Y,M,D). The leading P is required \nwith it denoting period. The (Y,M,D) are for the duration of Year, Month,and Day \nrespectively. A time frame of 2 years, 2 months, 2 days would be (P2Y2M2D). \nFrom Azure Portal \n1. From Azure Portal select the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Under Objects select Keys. \n5. Select a key to audit. \n6. In the top row select Rotation policy. \n7. Select an Expiry time. \n8. Set Enable auto rotation to Enabled. \n9. Set an appropriate Rotation option and Rotation time. \n10. \nOptionally set the Notification time. \n11. \nSelect Save. \n12. \nRepeat steps 3-11 for each Key Vault and Key.",
        "Remediation Steps": {
            "From Azure Portal": "select the Portal Menu in the top left. \n2. Select Key Vaults. \n3. Select a Key Vault to audit. \n4. Under Objects select Keys. \n5. Select a key to audit. \n6. In the top row select Rotation policy. \n7. Ensure Enable auto rotation is set to Enabled. \n8. Repeat steps 3-7 for each Key Vault and Key.",
            "From Azure CLI": "Run the following command: \naz keyvault key rotation-policy show --vaultname <vaultName> --name <keyName> \n \nFrom PowerShell \nRun the following command: \nGet-AzKeyVaultKeyRotationPolicy -VaultName <vaultName> -Name <keyName>"
        },
        "Default Value": "By default, Private Endpoints are not enabled for any services within Azure. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/private-link/private-endpoint-overview \n2. https://docs.microsoft.com/en-us/azure/storage/common/storage-private-\nendpoints \n3. https://azure.microsoft.com/en-us/pricing/details/private-link/ \n4. https://docs.microsoft.com/en-us/azure/key-vault/general/private-link-\nservice?tabs=portal \n5. https://docs.microsoft.com/en-us/azure/virtual-network/quick-create-portal \n6. https://docs.microsoft.com/en-us/azure/private-link/tutorial-private-endpoint-\nstorage-portal \n7. https://docs.microsoft.com/en-us/azure/bastion/bastion-overview \n8. https://docs.microsoft.com/azure/dns/private-dns-getstarted-cli#create-an-\nadditional-dns-record \n9. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-8-ensure-security-of-key-and-certificate-repository \nAdditional Information: \nThis recommendation assumes that you have created a Resource Group containing a \nVirtual Network that the services are already associated with and configured private \nDNS. A Bastion on the virtual network is also required, and the service to which you are \nconnecting must already have a Private Endpoint. For information concerning the \ninstallation of these services, please see the attached documentation. \nMicrosoft's own documentation lists the requirements as: A Key Vault. An Azure virtual \nnetwork. A subnet in the virtual network. Owner or contributor permissions for both the \nKey Vault and the virtual network.",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n12.2 Establish and Maintain a Secure Network \nArchitecture \n \nEstablish and maintain a secure network architecture. A secure network \narchitecture must address segmentation least privilege and availability at a \nminimum. \n \n \n "
    },
    {
        "Rule": "9.1 Ensure App Service Authentication is set up for apps in Azure \nApp Service (Automated)",
        "Profile Applicability": " Level 2",
        "Description": "Azure App Service Authentication is a feature that can prevent anonymous HTTP \nrequests from reaching a Web Application or authenticate those with tokens before they \nreach the app. If an anonymous request is received from a browser, App Service will \nredirect to a logon page. To handle the logon process, a choice from a set of identity \nproviders can be made, or a custom authentication mechanism can be implemented.",
        "Rationale": "By Enabling App Service Authentication, every incoming HTTP request passes through \nit before being handled by the application code. It also handles authentication of users \nwith the specified provider (Entra ID, Facebook, Google, Microsoft Account, and \nTwitter), validation, storing and refreshing of tokens, managing the authenticated \nsessions and injecting identity information into request headers. Disabling HTTP Basic \nAuthentication functionality further ensures legacy authentication methods are disabled \nwithin the application. \nImpact: \nThis is only required for App Services which require authentication. Enabling on site like \na marketing or support website will prevent unauthenticated access which would be \nundesirable. \nAdding Authentication requirement will increase cost of App Service and require \nadditional security components to facilitate the authentication.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, Click on Authentication \n5. Ensure that App Service authentication set to Enabled (Will only appear once \nan Identity provider is set up/selected) \n6. Navigate back to the application blade \n7. Under Settings, click on Configuration \n8. Click on the 'General Settings' tab \n9. Under Platform settings, ensure Basic Auth Publishing Credentials is set to \nOff",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, Click on Authentication \n5. Ensure that App Service authentication set to Enabled (Will only appear once \nan Identity provider is set up/selected) \n6. Navigate back to the application blade \n7. Under Settings, click on Configuration \n8. Click on the 'General Settings' tab \n9. Under Platform settings, ensure Basic Auth Publishing Credentials is set to \nOff"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, click on Authentication \n5. If no identity providers are set up, then click Add identity provider \n6. Choose other parameters as per your requirements and click on Add \nTo disable the Basic Auth Publishing Credentials setting, perform the following \nsteps:",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, Click on Authentication \n5. Ensure that App Service authentication set to Enabled (Will only appear once \nan Identity provider is set up/selected) \n6. Navigate back to the application blade \n7. Under Settings, click on Configuration \n8. Click on the 'General Settings' tab \n9. Under Platform settings, ensure Basic Auth Publishing Credentials is set to \nOff"
        },
        "Default Value": "By default, Automatic Key Rotation is not enabled. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/key-vault/keys/how-to-configure-key-\nrotation \n2. https://docs.microsoft.com/en-us/azure/storage/common/customer-managed-\nkeys-overview#update-the-key-version \n3. https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disks-enable-\ncustomer-managed-keys-powershell#set-up-an-azure-key-vault-and-\ndiskencryptionset-optionally-with-automatic-key-rotation \n4. https://azure.microsoft.com/en-us/updates/public-preview-automatic-key-rotation-\nof-customermanaged-keys-for-encrypting-azure-managed-disks/ \n5. https://docs.microsoft.com/en-us/cli/azure/keyvault/key/rotation-\npolicy?view=azure-cli-latest#az-keyvault-key-rotation-policy-update",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.1 Establish and Maintain a Data Management Process \n \nEstablish and maintain a data management process. In the process address \ndata sensitivity data owner handling of data data retention limits and disposal \nrequirements based on sensitivity and retention standards for the enterprise. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv8 \n6.2 Establish an Access Revoking Process \n \nEstablish and follow a process preferably automated for revoking access to \nenterprise assets through disabling accounts immediately upon termination rights \nrevocation or role change of a user. Disabling accounts instead of deleting \naccounts may be necessary to preserve audit trails. \n \n \n \nv7 \n16.7 Establish Process for Revoking Access \n \nEstablish and follow an automated process for revoking system access by \ndisabling accounts immediately upon termination or change of responsibilities of an \nemployee or contractor . Disabling these accounts instead of deleting accounts \nallows preservation of audit trails. \n \n \n "
    },
    {
        "Rule": "9.2 Ensure Web App Redirects All HTTP traffic to HTTPS in \nAzure App Service (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Azure Web Apps allows sites to run under both HTTP and HTTPS by default. Web apps \ncan be accessed by anyone using non-secure HTTP links by default. Non-secure HTTP \nrequests can be restricted and all HTTP requests redirected to the secure HTTPS port. \nIt is recommended to enforce HTTPS-only traffic.",
        "Rationale": "Enabling HTTPS-only traffic will redirect all non-secure HTTP requests to HTTPS ports. \nHTTPS uses the TLS/SSL protocol to provide a secure connection which is both \nencrypted and authenticated. It is therefore important to support HTTPS for the security \nbenefits. \nImpact: \nWhen it is enabled, every incoming HTTP request is redirected to the HTTPS port. This \nmeans an extra level of security will be added to the HTTP requests made to the app.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Click on configuration \n5. Ensure that the HTTPS Only setting is toggled to On \nFrom Azure CLI \nTo check HTTPS-only traffic value for an existing app, run the following command, \naz webapp show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --\nquery httpsOnly \nThe output should return true if HTTPS-only traffic value is set to On. \nFrom PowerShell \nList all the web apps configured within the subscription. \nGet-AzWebApp | Select-Object ResourceGroup, Name, HttpsOnly \nFor each web app review the HttpsOnly setting and make sure it is set to True.",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Click on configuration \n5. Ensure that the HTTPS Only setting is toggled to On",
            "From Azure CLI": "To check HTTPS-only traffic value for an existing app, run the following command, \naz webapp show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --\nquery httpsOnly \nThe output should return true if HTTPS-only traffic value is set to On. \nFrom PowerShell \nList all the web apps configured within the subscription. \nGet-AzWebApp | Select-Object ResourceGroup, Name, HttpsOnly \nFor each web app review the HttpsOnly setting and make sure it is set to True."
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Click on configuration \n5. Under the HTTPS Only heading select 'On' to enable https only \n6. Click Save at the top \nFrom Azure CLI \nTo set HTTPS-only traffic value for an existing app, run the following command: \naz webapp update --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --\nset httpsOnly=true \nFrom PowerShell \nSet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> -\nHttpsOnly $true",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Click on configuration \n5. Ensure that the HTTPS Only setting is toggled to On",
            "From Azure CLI": "To check HTTPS-only traffic value for an existing app, run the following command, \naz webapp show --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> --\nquery httpsOnly \nThe output should return true if HTTPS-only traffic value is set to On. \nFrom PowerShell \nList all the web apps configured within the subscription. \nGet-AzWebApp | Select-Object ResourceGroup, Name, HttpsOnly \nFor each web app review the HttpsOnly setting and make sure it is set to True."
        },
        "Default Value": "By default, HTTPS-only feature will be disabled when a new app is created using the \ncommand-line tool or Azure Portal console. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-\ncustom-ssl#enforce-https \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit \n3. https://docs.microsoft.com/en-us/powershell/module/az.websites/set-\nazwebapp?view=azps-8.1.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.3 Configure Data Access Control Lists \n \nConfigure data access control lists based on a user s need to know. Apply data \naccess control lists also known as access permissions to local and remote file \nsystems databases and applications. \n \n \n \nv7 \n14.6 Protect Information through Access Control Lists \n \nProtect all information stored on systems with file system network share \nclaims application or database specific access control lists. These controls will \nenforce the principle that only authorized individuals should have access to the \ninformation based on their need to access the information as a part of their \nresponsibilities. \n \n \n "
    },
    {
        "Rule": "9.3 Ensure Web App is using the latest version of TLS encryption \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "The TLS (Transport Layer Security) protocol secures transmission of data over the \ninternet using standard encryption technology. Encryption should be set with the latest \nversion of TLS. App service allows TLS 1.2 by default, which is the recommended TLS \nlevel by industry standards such as PCI DSS.",
        "Rationale": "App service currently allows the web app to set TLS versions 1.0, 1.1 and 1.2. It is \nhighly recommended to use the latest TLS 1.2 version for web app secure connections.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on TLS/SSL settings \n5. Under the Bindings pane, ensure that Minimum TLS Version set to 1.2 under \nProtocol Settings \nFrom Azure CLI \nTo check TLS Version for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query minTlsVersion \nThe output should return 1.2 if TLS Version is set to 1.2 (Which is currently the latest \nversion). \nFrom PowerShell \nList all web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> \n|Select-Object -ExpandProperty SiteConfig \nMake sure the minTlsVersion is set to at least 1.2.",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on TLS/SSL settings \n5. Under the Bindings pane, ensure that Minimum TLS Version set to 1.2 under \nProtocol Settings",
            "From Azure CLI": "To check TLS Version for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query minTlsVersion \nThe output should return 1.2 if TLS Version is set to 1.2 (Which is currently the latest \nversion). \nFrom PowerShell \nList all web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> \n|Select-Object -ExpandProperty SiteConfig \nMake sure the minTlsVersion is set to at least 1.2."
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on SSL settings \n5. Under the Bindings pane, set Minimum TLS Version to 1.2 under Protocol \nSettings section \nFrom Azure CLI \nTo set TLS Version for an existing app, run the following command: \naz webapp config set --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> \n--min-tls-version 1.2 \nFrom PowerShell \nSet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> -\nMinTlsVersion 1.2",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on TLS/SSL settings \n5. Under the Bindings pane, ensure that Minimum TLS Version set to 1.2 under \nProtocol Settings",
            "From Azure CLI": "To check TLS Version for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query minTlsVersion \nThe output should return 1.2 if TLS Version is set to 1.2 (Which is currently the latest \nversion). \nFrom PowerShell \nList all web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebApp -ResourceGroupName <RESOURCE_GROUP_NAME> -Name <APP_NAME> \n|Select-Object -ExpandProperty SiteConfig \nMake sure the minTlsVersion is set to at least 1.2."
        },
        "Default Value": "By default, TLS Version feature will be set to 1.2 when a new app is created using the \ncommand-line tool or Azure Portal console. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/app-service/app-service-web-tutorial-\ncustom-ssl#enforce-tls-versions \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-network-\nsecurity#ns-8-detect-and-disable-insecure-services-and-protocols \n4. https://docs.microsoft.com/en-us/powershell/module/az.websites/set-\nazwebapp?view=azps-8.1.0",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "9.4 Ensure that Register with Entra ID is enabled on App Service \n(Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Managed service identity in App Service provides more security by eliminating secrets \nfrom the app, such as credentials in the connection strings. When registering an App \nService with Entra ID, the app will connect to other Azure services securely without the \nneed for usernames and passwords.",
        "Rationale": "App Service provides a highly scalable, self-patching web hosting service in Azure. It \nalso provides a managed identity for apps, which is a turn-key solution for securing \naccess to Azure SQL Database and other Azure services.",
        "Audit": "From Azure Portal \n1. From Azure Portal open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under the Setting section, Click on Identity \n5. Under the System assigned pane, ensure that Status set to On \nFrom Azure CLI \nTo check Register with Entra ID feature status for an existing app, run the following \ncommand, \naz webapp identity show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query principalId \nThe output should return unique Principal ID. \nIf no output for the above command then Register with Entra ID is not set. \nFrom PowerShell \nList the web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebapp -ResourceGroupName  <app resource group> -Name <app name> \nMake sure the Identity setting contains a unique Principal ID",
        "Audit Steps": {
            "From Azure Portal": "open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under the Setting section, Click on Identity \n5. Under the System assigned pane, ensure that Status set to On",
            "From Azure CLI": "To check Register with Entra ID feature status for an existing app, run the following \ncommand, \naz webapp identity show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query principalId \nThe output should return unique Principal ID. \nIf no output for the above command then Register with Entra ID is not set. \nFrom PowerShell \nList the web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebapp -ResourceGroupName  <app resource group> -Name <app name> \nMake sure the Identity setting contains a unique Principal ID"
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Identity \n5. Under the System assigned pane, set Status to On \nFrom Azure CLI \nTo register with Entra ID for an existing app, run the following command: \naz webapp identity assign --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> \nFrom PowerShell \nTo register with Entra ID for an existing app, run the following command: \nSet-AzWebApp -AssignIdentity $True -ResourceGroupName <resource_Group_Name> -\nName <App_Name>",
        "Remediation Steps": {
            "From Azure Portal": "open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under the Setting section, Click on Identity \n5. Under the System assigned pane, ensure that Status set to On",
            "From Azure CLI": "To check Register with Entra ID feature status for an existing app, run the following \ncommand, \naz webapp identity show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query principalId \nThe output should return unique Principal ID. \nIf no output for the above command then Register with Entra ID is not set. \nFrom PowerShell \nList the web apps. \nGet-AzWebApp \nFor each web app run the following command. \nGet-AzWebapp -ResourceGroupName  <app resource group> -Name <app name> \nMake sure the Identity setting contains a unique Principal ID"
        },
        "Default Value": "By default, Managed service identity via Entra ID is disabled. \nReferences: \n1. https://docs.microsoft.com/en-gb/azure/app-service/app-service-web-tutorial-\nconnect-msi \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-1-use-centralized-identity-and-authentication-system",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n "
    },
    {
        "Rule": "9.5 Ensure That 'PHP version' is the Latest, If Used to Run the \nWeb App (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Periodically newer versions are released for PHP software either due to security flaws \nor to include additional functionality. Using the latest PHP version for web apps is \nrecommended in order to take advantage of security fixes, if any, and/or additional \nfunctionalities of the newer version.",
        "Rationale": "Newer versions may contain security enhancements and additional functionality. Using \nthe latest software version is recommended in order to take advantage of \nenhancements and new capabilities. With each software installation, organizations need \nto determine if a given update meets their requirements. They must also verify the \ncompatibility and support provided for any additional software against the update \nrevision that is selected. \nImpact: \nIf your app is written using version-dependent features or libraries, they may not be \navailable on the latest version. If you wish to upgrade, research the impact thoroughly. \nUpgrading may have unforeseen consequences that could result in downtime.",
        "Audit": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane, ensure that for a Stack of PHP the Major \nVersion and Minor Version reflect the latest stable and supported release. \n** The latest stable version can be confirmed by going to php.net. Navigate to the \ndownloads, and then find the most recent version that is marked by Current Stable PHP \n[version_number]. ** \nNOTE: No action is required If PHP version is set to Off as PHP is not used by your \nweb app.",
        "Audit Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane, ensure that for a Stack of PHP the Major \nVersion and Minor Version reflect the latest stable and supported release. \n** The latest stable version can be confirmed by going to php.net. Navigate to the \ndownloads, and then find the most recent version that is marked by Current Stable PHP \n[version_number]. ** \nNOTE: No action is required If PHP version is set to Off as PHP is not used by your \nweb app."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane, ensure that for a Stack of PHP the Major \nVersion and Minor Version reflect the latest stable and supported release. \nNOTE: No action is required If PHP version is set to Off or is set with an empty value as \nPHP is not used by your web app.",
        "Remediation Steps": {
            "From Azure Portal": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane, ensure that for a Stack of PHP the Major \nVersion and Minor Version reflect the latest stable and supported release. \n** The latest stable version can be confirmed by going to php.net. Navigate to the \ndownloads, and then find the most recent version that is marked by Current Stable PHP \n[version_number]. ** \nNOTE: No action is required If PHP version is set to Off as PHP is not used by your \nweb app."
        },
        "Default Value": "By default, Managed service identity via Entra ID is disabled. \nReferences: \n1. https://docs.microsoft.com/en-gb/azure/app-service/app-service-web-tutorial-\nconnect-msi \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-identity-\nmanagement#im-1-use-centralized-identity-and-authentication-system",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n5.6 Centralize Account Management \n \nCentralize account management through a directory or identity service. \n \n \n \nv7 \n16.2 Configure Centralized Point of Authentication \n \nConfigure access for all accounts through as few centralized points of \nauthentication as possible including network security and cloud systems. \n \n \n "
    },
    {
        "Rule": "9.6 Ensure that 'Python version' is the Latest Stable Version, if \nUsed to Run the Web App (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Periodically, newer versions are released for Python software either due to security \nflaws or to include additional functionality. Using the latest full Python version for web \napps is recommended in order to take advantage of security fixes, if any, and/or \nadditional functionalities of the newer version.",
        "Rationale": "Newer versions may contain security enhancements and additional functionality. Using \nthe latest software version is recommended in order to take advantage of \nenhancements and new capabilities. With each software installation, organizations need \nto determine if a given update meets their requirements. They must also verify the \ncompatibility and support provided for any additional software against the update \nrevision that is selected. Using the latest full version will keep your stack secure to \nvulnerabilities and exploits. \nImpact: \nIf your app is written using version-dependent features or libraries, they may not be \navailable on the latest version. If you wish to upgrade, research the impact thoroughly. \nUpgrading may have unforeseen consequences that could result in downtime.",
        "Audit": "From Azure Console \n1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Python, with \nMajor Version of Python 3, that the Minor Version is set to the latest stable \nversion available (Python 3.11, at the time of writing) \nNOTE: No action is required if Python version is set to Off, as Python is not used by \nyour web app.",
        "Audit Steps": {
            "From Azure Console": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Python, with \nMajor Version of Python 3, that the Minor Version is set to the latest stable \nversion available (Python 3.11, at the time of writing) \nNOTE: No action is required if Python version is set to Off, as Python is not used by \nyour web app."
        },
        "Remediation": "From Azure Portal \n1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that the Major Version and the \nMinor Version is set to the latest stable version available (Python 3.11, at the \ntime of writing) \nNOTE: No action is required if Python version is set to Off, as Python is not used by \nyour web app.",
        "Remediation Steps": {
            "From Azure Console": "1. From Azure Home open the Portal Menu in the top left \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Python, with \nMajor Version of Python 3, that the Minor Version is set to the latest stable \nversion available (Python 3.11, at the time of writing) \nNOTE: No action is required if Python version is set to Off, as Python is not used by \nyour web app."
        },
        "Default Value": "The version of PHP is whatever was selected upon App creation. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/app-service/web-sites-configure#general-\nsettings \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-6-rapidly-and-automatically-remediate-\nvulnerabilities \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-3-define-and-establish-secure-configurations-for-\ncompute-resources \n4. https://www.php.net/downloads",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.2 Ensure Authorized Software is Currently Supported \n \nEnsure that only currently supported software is designated as authorized in the \nsoftware inventory for enterprise assets. If software is unsupported yet necessary \nfor the fulfillment of the enterprise s mission document an exception detailing \nmitigating controls and residual risk acceptance. For any unsupported software \nwithout an exception documentation designate as unauthorized. Review the \nsoftware list to verify software support at least monthly or more frequently. \n \n \n "
    },
    {
        "Rule": "9.7 Ensure that 'Java version' is the latest, if used to run the Web \nApp (Manual)",
        "Profile Applicability": " Level 1",
        "Description": "Periodically, newer versions are released for Java software either due to security flaws \nor to include additional functionality. Using the latest Java version for web apps is \nrecommended in order to take advantage of security fixes, if any, and/or new \nfunctionalities of the newer version.",
        "Rationale": "Newer versions may contain security enhancements and additional functionality. Using \nthe latest software version is recommended in order to take advantage of \nenhancements and new capabilities. With each software installation, organizations need \nto determine if a given update meets their requirements. They must also verify the \ncompatibility and support provided for any additional software against the update \nrevision that is selected. \nImpact: \nIf your app is written using version-dependent features or libraries, they may not be \navailable on the latest version. If you wish to upgrade, research the impact thoroughly. \nUpgrading may have unforeseen consequences that could result in downtime.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Java the \nMajor Version and Minor Version reflect the latest stable and supported \nrelease, and that the Java web server version is set to the auto-update option. \nNOTE: No action is required if Java version is set to Off, as Java is not used by your \nweb app.",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Java the \nMajor Version and Minor Version reflect the latest stable and supported \nrelease, and that the Java web server version is set to the auto-update option. \nNOTE: No action is required if Java version is set to Off, as Java is not used by your \nweb app."
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Java the \nMajor Version and Minor Version reflect the latest stable and supported \nrelease, and that the Java web server version is set to the auto-update option. \nNOTE: No action is required if Java version is set to Off, as Java is not used by your \nweb app.",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Settings section, click on Configuration \n5. Click on the General settings pane and ensure that for a Stack of Java the \nMajor Version and Minor Version reflect the latest stable and supported \nrelease, and that the Java web server version is set to the auto-update option. \nNOTE: No action is required if Java version is set to Off, as Java is not used by your \nweb app."
        },
        "Default Value": "The version of Python is whatever was selected upon App creation. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/app-service/web-sites-configure#general-\nsettings \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-6-rapidly-and-automatically-remediate-\nvulnerabilities \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-3-define-and-establish-secure-configurations-for-\ncompute-resources \n4. https://www.python.org/downloads/ \nAdditional Information: \n** The latest stable version can be confirmed by going to python.org. Navigate to the \ndownloads, and then find the most recent version that is marked by security in the \nmaintenance column. **",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.2 Ensure Authorized Software is Currently Supported \n \nEnsure that only currently supported software is designated as authorized in the \nsoftware inventory for enterprise assets. If software is unsupported yet necessary \nfor the fulfillment of the enterprise s mission document an exception detailing \nmitigating controls and residual risk acceptance. For any unsupported software \nwithout an exception documentation designate as unauthorized. Review the \nsoftware list to verify software support at least monthly or more frequently. \n \n \n "
    },
    {
        "Rule": "9.8 Ensure that 'HTTP Version' is the Latest, if Used to Run the \nWeb App (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "Periodically, newer versions are released for HTTP either due to security flaws or to \ninclude additional functionality. Using the latest HTTP version for web apps to take \nadvantage of security fixes, if any, and/or new functionalities of the newer version.",
        "Rationale": "Newer versions may contain security enhancements and additional functionality. Using \nthe latest version is recommended in order to take advantage of enhancements and \nnew capabilities. With each software installation, organizations need to determine if a \ngiven update meets their requirements. They must also verify the compatibility and \nsupport provided for any additional software against the update revision that is selected. \nHTTP 2.0 has additional performance improvements on the head-of-line blocking \nproblem of old HTTP version, header compression, and prioritization of requests. HTTP \n2.0 no longer supports HTTP 1.1's chunked transfer encoding mechanism, as it \nprovides its own, more efficient, mechanisms for data streaming.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Configuration \n5. Ensure that HTTP Version set to 2.0 version under General settings \nNOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-\nencrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to \nyour app with HTTP/2, either buy an App Service Certificate for your app's custom \ndomain or bind a third party certificate. \n \nFrom Azure CLI \nTo check HTTP 2.0 version status for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query http20Enabled \nThe output should return true if HTTPS 2.0 traffic value is set to On.",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Configuration \n5. Ensure that HTTP Version set to 2.0 version under General settings \nNOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-\nencrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to \nyour app with HTTP/2, either buy an App Service Certificate for your app's custom \ndomain or bind a third party certificate.",
            "From Azure CLI": "To check HTTP 2.0 version status for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query http20Enabled \nThe output should return true if HTTPS 2.0 traffic value is set to On."
        },
        "Remediation": "From Azure Portal \n1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Configuration \n5. Set HTTP version to 2.0 under General settings \nNOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-\nencrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to \nyour app with HTTP/2, either buy an App Service Certificate for your app's custom \ndomain or bind a third party certificate. \n \nFrom Azure CLI \nTo set HTTP 2.0 version for an existing app, run the following command: \naz webapp config set --resource-group <RESOURCE_GROUP_NAME> --name <APP_NAME> \n--http20-enabled true \n \nFrom PowerShell \nTo enable HTTP 2.0 version support, run the following command: \nSet-AzWebApp -ResourceGroupName <app resource group> -Name <app name> -\nHttp20Enabled $true",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal using https://portal.azure.com \n2. Go to App Services \n3. Click on each App \n4. Under Setting section, Click on Configuration \n5. Ensure that HTTP Version set to 2.0 version under General settings \nNOTE: Most modern browsers support HTTP 2.0 protocol over TLS only, while non-\nencrypted traffic continues to use HTTP 1.1. To ensure that client browsers connect to \nyour app with HTTP/2, either buy an App Service Certificate for your app's custom \ndomain or bind a third party certificate.",
            "From Azure CLI": "To check HTTP 2.0 version status for an existing app, run the following command, \naz webapp config show --resource-group <RESOURCE_GROUP_NAME> --name \n<APP_NAME> --query http20Enabled \nThe output should return true if HTTPS 2.0 traffic value is set to On."
        },
        "Default Value": "The default setting is whichever setting was chosen in the creation of the webapp. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/app-service/web-sites-configure#general-\nsettings \n2. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-3-define-and-establish-secure-configurations-for-\ncompute-resources \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-6-rapidly-and-automatically-remediate-\nvulnerabilities \n4. https://www.oracle.com/java/technologies/downloads/#java11",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.2 Ensure Authorized Software is Currently Supported \n \nEnsure that only currently supported software is designated as authorized in the \nsoftware inventory for enterprise assets. If software is unsupported yet necessary \nfor the fulfillment of the enterprise s mission document an exception detailing \nmitigating controls and residual risk acceptance. For any unsupported software \nwithout an exception documentation designate as unauthorized. Review the \nsoftware list to verify software support at least monthly or more frequently. \n \n \n \nv7 \n2.2 Ensure Software is Supported by Vendor \n \nEnsure that only software applications or operating systems currently supported \nby the software s vendor are added to the organization s authorized software \ninventory. Unsupported software should be tagged as unsupported in the inventory \nsystem. \n \n \n "
    },
    {
        "Rule": "9.9 Ensure FTP deployments are Disabled (Automated)",
        "Profile Applicability": " Level 1",
        "Description": "By default, Azure Functions, Web, and API Services can be deployed over FTP. If FTP \nis required for an essential deployment workflow, FTPS should be required for FTP \nlogin for all App Service Apps and Functions.",
        "Rationale": "Azure FTP deployment endpoints are public. An attacker listening to traffic on a wifi \nnetwork used by a remote employee or a corporate network could see login traffic in \nclear-text which would then grant them full control of the code base of the app or \nservice. This finding is more severe if User Credentials for deployment are set at the \nsubscription level rather than using the default Application Credentials which are unique \nper App. \nImpact: \nAny deployment workflows that rely on FTP or FTPs rather than the WebDeploy or \nHTTPs endpoints may be affected.",
        "Audit": "From Azure Portal \n1. Go to the Azure Portal \n2. Select App Services \n3. Click on an app \n4. Select Settings and then Configuration \n5. Under General Settings, for the Platform Settings, the FTP state should not \nbe set to All allowed \nFrom Azure CLI \nList webapps to obtain the ids. \naz webapp list \nList the publish profiles to obtain the username, password \nand ftp server url.",
        "Audit Steps": {
            "From Azure Portal": "1. Go to the Azure Portal \n2. Select App Services \n3. Click on an app \n4. Select Settings and then Configuration \n5. Under General Settings, for the Platform Settings, the FTP state should not \nbe set to All allowed",
            "From Azure CLI": "List webapps to obtain the ids. \naz webapp list \nList the publish profiles to obtain the username, password \nand ftp server url."
        },
        "Remediation": "From Azure Portal \n1. Go to the Azure Portal \n2. Select App Services \n3. Click on an app \n4. Select Settings and then Configuration \n5. Under General Settings, for the Platform Settings, the FTP state should be \nset to Disabled or FTPS Only \nFrom Azure CLI \nFor each out of compliance application, run the following choosing either 'disabled' or \n'FtpsOnly' as appropriate: \naz webapp config set --resource-group <resource group name> --name <app name> \n--ftps-state [disabled|FtpsOnly]",
        "Remediation Steps": {
            "From Azure Portal": "1. Go to the Azure Portal \n2. Select App Services \n3. Click on an app \n4. Select Settings and then Configuration \n5. Under General Settings, for the Platform Settings, the FTP state should not \nbe set to All allowed",
            "From Azure CLI": "List webapps to obtain the ids. \naz webapp list \nList the publish profiles to obtain the username, password \nand ftp server url."
        },
        "Default Value": "",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n2.2 Ensure Authorized Software is Currently Supported \n \nEnsure that only currently supported software is designated as authorized in the \nsoftware inventory for enterprise assets. If software is unsupported yet necessary \nfor the fulfillment of the enterprise s mission document an exception detailing \nmitigating controls and residual risk acceptance. For any unsupported software \nwithout an exception documentation designate as unauthorized. Review the \nsoftware list to verify software support at least monthly or more frequently. \n \n \n \nv7 \n2.2 Ensure Software is Supported by Vendor \n \nEnsure that only software applications or operating systems currently supported \nby the software s vendor are added to the organization s authorized software \ninventory. Unsupported software should be tagged as unsupported in the inventory \nsystem. \n \n \n "
    },
    {
        "Rule": "9.10 Ensure Azure Key Vaults are Used to Store Secrets \n(Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Azure Key Vault will store multiple types of sensitive information such as encryption \nkeys, certificate thumbprints, and Managed Identity Credentials. Access to these \n'Secrets' can be controlled through granular permissions.",
        "Rationale": "The credentials given to an application have permissions to create, delete, or modify \ndata stored within the systems they access. If these credentials are stored within the \napplication itself, anyone with access to the application or a copy of the code has \naccess to them. Storing within Azure Key Vault as secrets increases security by \ncontrolling access. This also allows for updates of the credentials without redeploying \nthe entire application. \nImpact: \nIntegrating references to secrets within the key vault are required to be specifically \nintegrated within the application code. This will require additional configuration to be \nmade during the writing of an application, or refactoring of an already written one. There \nare also additional costs that are charged per 10000 requests to the Key Vault.",
        "Audit": "From Azure Portal \n1. Login to Azure Portal \n2. In the expandable menu on the left go to Key Vaults \n3. View the Key Vaults listed. \nFrom Azure CLI \nTo list key vaults within a subscription run the following command: \nGet-AzKeyVault \nTo list the secrets within these key vaults run the following command: \nGet-AzKeyVaultSecret [-VaultName] <vault name> \n \nFrom Powershell \nTo list key vaults within a subscription run the following command: \nGet-AzKeyVault \nTo list all secrets in a key vault run the following command:",
        "Audit Steps": {
            "From Azure Portal": "1. Login to Azure Portal \n2. In the expandable menu on the left go to Key Vaults \n3. View the Key Vaults listed.",
            "From Azure CLI": "To list key vaults within a subscription run the following command: \nGet-AzKeyVault \nTo list the secrets within these key vaults run the following command: \nGet-AzKeyVaultSecret [-VaultName] <vault name>",
            "From Powershell": "To list key vaults within a subscription run the following command: \nGet-AzKeyVault \nTo list all secrets in a key vault run the following command:"
        },
        "Remediation": "Remediation has 2 steps \n1. Setup the Key Vault \n2. Setup the App Service to use the Key Vault \nStep 1: Set up the Key Vault \nFrom Azure CLI \naz keyvault create --name \"<name>\" --resource-group \"<myResourceGroup>\" --\nlocation myLocation \nFrom Powershell \nNew-AzKeyvault -name <name> -ResourceGroupName <myResourceGroup> -Location \n<myLocation> \n \nStep 2: Set up the App Service to use the Key Vault \nSample JSON Template for App Service Configuration:  \n[template continues on following pages]",
        "Remediation Steps": {
            "From Azure Portal": "1. Login to Azure Portal \n2. In the expandable menu on the left go to Key Vaults \n3. View the Key Vaults listed.",
            "From Azure CLI": "To list key vaults within a subscription run the following command: \nGet-AzKeyVault \nTo list the secrets within these key vaults run the following command: \nGet-AzKeyVaultSecret [-VaultName] <vault name>",
            "From Powershell": "To list key vaults within a subscription run the following command: \nGet-AzKeyVault \nTo list all secrets in a key vault run the following command:"
        },
        "Default Value": "By default, FTP based deployment is All allowed \nReferences: \n1. [Azure Web Service Deploy via FTP](https://docs.microsoft.com/en-\nus/azure/app-service/deploy-ftp) \n2. [Azure Web Service Deployment](https://docs.microsoft.com/en-us/azure/app-\nservice/overview-security) \n3. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-data-\nprotection#dp-3-encrypt-sensitive-data-in-transit \n4. https://learn.microsoft.com/en-us/security/benchmark/azure/mcsb-posture-\nvulnerability-management#pv-6-rapidly-and-automatically-remediate-\nvulnerabilities",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.10 Encrypt Sensitive Data in Transit \n \nEncrypt sensitive data in transit. Example implementations can include \nTransport Layer Security TLS and Open Secure Shell OpenSSH . \n \n \n \nv7 \n14.4 Encrypt All Sensitive Information in Transit \n \nEncrypt all sensitive information in transit. \n \n \n \nv7 \n16.5 Encrypt Transmittal of Username and \nAuthentication Credentials \n \nEnsure that all account usernames and authentication credentials are \ntransmitted across networks using encrypted channels. \n \n \n "
    },
    {
        "Rule": "10.1 Ensure that Resource Locks are set for Mission-Critical \nAzure Resources (Manual)",
        "Profile Applicability": " Level 2",
        "Description": "Resource Manager Locks provide a way for administrators to lock down Azure \nresources to prevent deletion of, or modifications to, a resource. These locks sit outside \nof the Role Based Access Controls (RBAC) hierarchy and, when applied, will place \nrestrictions on the resource for all users. These locks are very useful when there is an \nimportant resource in a subscription that users should not be able to delete or change. \nLocks can help prevent accidental and malicious changes or deletion.",
        "Rationale": "As an administrator, it may be necessary to lock a subscription, resource group, or \nresource to prevent other users in the organization from accidentally deleting or \nmodifying critical resources. The lock level can be set to to CanNotDelete or ReadOnly to \nachieve this purpose. \n\u2022 \nCanNotDelete means authorized users can still read and modify a resource, but \nthey cannot delete the resource. \n\u2022 \nReadOnly means authorized users can read a resource, but they cannot delete or \nupdate the resource. Applying this lock is similar to restricting all authorized \nusers to the permissions granted by the Reader role. \nImpact: \nThere can be unintended outcomes of locking a resource. Applying a lock to a parent \nservice will cause it to be inherited by all resources within. Conversely, applying a lock \nto a resource may not apply to connected storage, leaving it unlocked. Please see the \ndocumentation for further information.",
        "Audit": "From Azure Portal \n1. Navigate to the specific Azure Resource or Resource Group \n2. Click on Locks \n3. Ensure the lock is defined with name and description, with type Read-only or \nDelete as appropriate. \nFrom Azure CLI \nReview the list of all locks set currently:",
        "Audit Steps": {
            "From Azure Portal": "1. Navigate to the specific Azure Resource or Resource Group \n2. Click on Locks \n3. Ensure the lock is defined with name and description, with type Read-only or \nDelete as appropriate.",
            "From Azure CLI": "Review the list of all locks set currently:"
        },
        "Remediation": "From Azure Portal \n1. Navigate to the specific Azure Resource or Resource Group \n2. For each mission critical resource, click on Locks \n3. Click Add \n4. Give the lock a name and a description, then select the type, Read-only or \nDelete as appropriate \n5. Click OK \nFrom Azure CLI \nTo lock a resource, provide the name of the resource, its resource type, and its \nresource group name. \naz lock create --name <LockName> --lock-type <CanNotDelete/Read-only> --\nresource-group <resourceGroupName> --resource-name <resourceName> --resource-\ntype <resourceType> \nFrom Powershell \nGet-AzResourceLock -ResourceName <Resource Name> -ResourceType <Resource \nType> -ResourceGroupName <Resource Group Name> -Locktype <CanNotDelete/Read-\nonly>",
        "Remediation Steps": {
            "From Azure Portal": "1. Navigate to the specific Azure Resource or Resource Group \n2. Click on Locks \n3. Ensure the lock is defined with name and description, with type Read-only or \nDelete as appropriate.",
            "From Azure CLI": "Review the list of all locks set currently:"
        },
        "Default Value": "By default, no locks are set. \nReferences: \n1. https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-group-\nlock-resources \n2. https://docs.microsoft.com/en-us/azure/azure-resource-manager/resource-\nmanager-subscription-governance#azure-resource-locks",
        "CIS Controls": "Controls \nVersion \nControl \nIG 1 IG 2 IG 3 \nv8 \n3.1 Establish and Maintain a Data Management Process \n \nEstablish and maintain a data management process. In the process address \ndata sensitivity data owner handling of data data retention limits and disposal \nrequirements based on sensitivity and retention standards for the enterprise. \nReview and update documentation annually or when significant enterprise changes \noccur that could impact this Safeguard. \n \n \n \nv7 \n13.1 Maintain an Inventory Sensitive Information \n \nMaintain an inventory of all sensitive information stored processed or \ntransmitted by the organization s technology systems including those located onsite \nor at a remote service provider. \n \n \n "
    }
]